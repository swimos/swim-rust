trigger: ["master"]
pr: ["master"]

variables:
  RUSTFLAGS: -Dwarnings

jobs:
  - template: ci/azure-test-stable.yml
    parameters:
      name: test_crates
      rust: 1.44.0
      displayName: Test all crates
      cross: eq(variables['Build.SourceBranch'], 'refs/heads/master')

  - template: ci/azure-clippy.yml
    parameters:
      rust: stable
      name: clippy

- job: Docs
  displayName: Check docs
  pool:
    vmImage: ubuntu-16.04
  steps:
    - parameters:
        rust_version: ${{ parameters.rust }}

    - script: |
        RUSTDOCFLAGS="--cfg docsrs" cargo doc --lib --no-deps --all-features
      displayName: Check docs

- job: Clippy
  displayName: Clippy
  pool:
    vmImage: ubuntu-16.04
  steps:
    - parameters:
        rust_version: ${{ parameters.rust }}
    - script: |
        rustup component add clippy
        cargo clippy --version
      displayName: Install clippy
    - script: |
        cargo clippy --all --all-features
      displayName: cargo clippy --all