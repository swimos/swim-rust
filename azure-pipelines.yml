trigger: ["main"]
pr: ["main"]

variables:
  RUSTFLAGS: -Dwarnings
  RUST_VERSION: 1.56.1

stages:
  - stage: (Lint Stage)
    jobs:
      - template: ci/azure-lint.yml
        parameters:
          name: lint_crates
          rust: $(RUST_VERSION)
          displayName: Lint all crates
  - stage: (Test Stage)
    dependsOn: (Lint Stage)
    jobs:
      - template: ci/azure-test-stable.yml
        parameters:
          name: test_crates
          rust: $(RUST_VERSION)
          displayName: Test all crates
          cross: eq(variables['Build.SourceBranch'], 'refs/heads/main')
