// @swim/host v4.0.0-dev.20220527.3 (c) 2015-2023 Nstream, inc.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/core")):"function"==typeof define&&define.amd?define(["exports","@swim/core","@swim/core","@swim/core","@swim/core","@swim/core","@swim/core","@swim/core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swim=e.swim||{},e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim)}(this,(function(e,t,r,i,n,s,o,a){"use strict";class u{get tag(){return this.constructor.tag}toLike(){return this.toValue().toLike()}toRecon(){return r.Recon.toString(this.toValue())}toString(){return t.Format.debug(this)}static fromValue(e){switch(e.tag){case"open":return c.fromValue(e);case"opened":return d.fromValue(e);case"close":return p.fromValue(e);case"closed":return f.fromValue(e);case"connect":return m.fromValue(e);case"connected":return w.fromValue(e);case"disconnect":return g.fromValue(e);case"disconnected":return y.fromValue(e);case"error":return v.fromValue(e);case"event":return C.fromValue(e);case"command":return x.fromValue(e);case"link":return T.fromValue(e);case"linked":return E.fromValue(e);case"sync":return D.fromValue(e);case"synced":return P.fromValue(e);case"unlink":return L.fromValue(e);case"unlinked":return q.fromValue(e);case"auth":return I.fromValue(e);case"authed":return V.fromValue(e);case"deauth":return A.fromValue(e);case"deauthed":return U.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(r.Recon.parse(e))}}class l extends u{static fromValue(e){switch(e.tag){case"open":return c.fromValue(e);case"opened":return d.fromValue(e);case"close":return p.fromValue(e);case"closed":return f.fromValue(e);case"connect":return m.fromValue(e);case"connected":return w.fromValue(e);case"disconnect":return g.fromValue(e);case"disconnected":return y.fromValue(e);case"error":return v.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(r.Recon.parse(e))}}class h extends l{constructor(e,t){super(),this.host=e,this.body=t}withHost(e){return e=s.Uri.fromLike(e),this.copy(e,this.body)}withBody(e){return e=n.Value.fromLike(e),this.copy(this.host,e)}copy(e,t){return new this.constructor(e,t)}equals(e){return this===e||e instanceof h&&(this.constructor===e.constructor&&this.host.equals(e.host)&&this.body.equals(e.body))}hashCode(){return i.Murmur3.mash(i.Murmur3.mix(i.Murmur3.mix(i.Constructors.hash(this.constructor),this.host.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.host.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=n.Record.create(1).slot("host",this.host.toString());return n.Attr.of(this.tag,e).concat(this.body)}static fromValue(e){let t;if(e.header(this.tag).forEach((function(e,r){const i=e.key.stringValue(void 0);void 0!==i?"host"===i&&(t=s.Uri.parse(e.toValue().stringValue(""))):e instanceof n.Value&&0===r&&(t=s.Uri.parse(e.stringValue("")))})),void 0!==t){const r=e.body();return new this(t,r)}return null}static create(e,t){return new this(e=s.Uri.fromLike(e),t=void 0===t?n.Value.absent():n.Value.fromLike(t))}}class c extends h{}c.tag="open";class d extends h{}d.tag="opened";class p extends h{}p.tag="close";class f extends h{}f.tag="closed";class m extends h{}m.tag="connect";class w extends h{}w.tag="connected";class g extends h{}g.tag="disconnect";class y extends h{}y.tag="disconnected";class v extends h{}v.tag="error";class b extends u{withPrio(e){return this}withRate(e){return this}static fromValue(e){switch(e.tag){case"event":return C.fromValue(e);case"command":return x.fromValue(e);case"link":return T.fromValue(e);case"linked":return E.fromValue(e);case"sync":return D.fromValue(e);case"synced":return P.fromValue(e);case"unlink":return L.fromValue(e);case"unlinked":return q.fromValue(e);case"auth":return I.fromValue(e);case"authed":return V.fromValue(e);case"deauth":return A.fromValue(e);case"deauthed":return U.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(r.Recon.parse(e))}}Object.defineProperty(b.prototype,"prio",{get:()=>0,configurable:!0}),Object.defineProperty(b.prototype,"rate",{get:()=>0,configurable:!0});class k extends b{constructor(e){super(),this.body=e}get node(){return s.Uri.empty()}withNode(e){return this}get lane(){return s.Uri.empty()}withLane(e){return this}withBody(e){return e=n.Value.fromLike(e),this.copy(e)}copy(e){return new this.constructor(e)}equals(e){return this===e||e instanceof k&&(this.constructor===e.constructor&&this.body.equals(e.body))}hashCode(){return i.Murmur3.mash(i.Murmur3.mix(i.Constructors.hash(this.constructor),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40),this.body.isDefined()&&(e=e.debug(this.body)),e=e.write(41)}toValue(){return n.Attr.of(this.tag).concat(this.body)}static fromValue(e){if(!e.header(this.tag).isDefined())return null;return new this(e.body())}static create(e){return new this(e=void 0===e?n.Value.absent():n.Value.fromLike(e))}}class S extends b{constructor(e,t,r){super(),this.node=e,this.lane=t,this.body=r}withNode(e){return e=s.Uri.fromLike(e),this.copy(e,this.lane,this.body)}withLane(e){return e=s.Uri.fromLike(e),this.copy(this.node,e,this.body)}withBody(e){return e=n.Value.fromLike(e),this.copy(this.node,this.lane,e)}copy(e,t,r){return new this.constructor(e,t,r)}equals(e){return this===e||e instanceof S&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.body.equals(e.body))}hashCode(){return i.Murmur3.mash(i.Murmur3.mix(i.Murmur3.mix(i.Murmur3.mix(i.Constructors.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=n.Record.create(2).slot("node",this.node.toString()).slot("lane",this.lane.toString());return n.Attr.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r;if(e.header(this.tag).forEach((function(e,i){const o=e.key.stringValue(void 0);void 0!==o?"node"===o?t=s.Uri.parse(e.toValue().stringValue("")):"lane"===o&&(r=s.Uri.parse(e.toValue().stringValue(""))):e instanceof n.Value&&(0===i?t=s.Uri.parse(e.stringValue("")):1===i&&(r=s.Uri.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const i=e.body();return new this(t,r,i)}return null}static create(e,t,r){return new this(e=s.Uri.fromLike(e),t=s.Uri.fromLike(t),r=void 0===r?n.Value.absent():n.Value.fromLike(r))}}class O extends b{constructor(e,t,r,i,n){super(),this.node=e,this.lane=t,Object.defineProperty(this,"prio",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"rate",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.body=n}withNode(e){return e=s.Uri.fromLike(e),this.copy(e,this.lane,this.prio,this.rate,this.body)}withLane(e){return e=s.Uri.fromLike(e),this.copy(this.node,e,this.prio,this.rate,this.body)}withPrio(e){return this.copy(this.node,this.lane,e,this.rate,this.body)}withRate(e){return this.copy(this.node,this.lane,this.prio,e,this.body)}withBody(e){return e=n.Value.fromLike(e),this.copy(this.node,this.lane,this.prio,this.rate,e)}copy(e,t,r,i,n){return new this.constructor(e,t,r,i,n)}equals(e){return this===e||e instanceof O&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.prio===e.prio&&this.rate===e.rate&&this.body.equals(e.body))}hashCode(){return i.Murmur3.mash(i.Murmur3.mix(i.Murmur3.mix(i.Murmur3.mix(i.Murmur3.mix(i.Murmur3.mix(i.Constructors.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),i.Numbers.hash(this.prio)),i.Numbers.hash(this.rate)),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),0===this.prio&&0===this.rate||(e=e.write(", ").debug(this.prio).write(", ").debug(this.rate)),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=n.Record.create(4).slot("node",this.node.toString()).slot("lane",this.lane.toString());return 0!==this.prio&&e.slot("prio",this.prio),0!==this.rate&&e.slot("rate",this.rate),n.Attr.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r,i=0,o=0;if(e.header(this.tag).forEach((function(e,a){const u=e.key.stringValue(void 0);void 0!==u?"node"===u?t=s.Uri.parse(e.toValue().stringValue("")):"lane"===u?r=s.Uri.parse(e.toValue().stringValue("")):"prio"===u?i=e.numberValue(i):"rate"===u&&(o=e.numberValue(o)):e instanceof n.Value&&(0===a?t=s.Uri.parse(e.stringValue("")):1===a&&(r=s.Uri.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const n=e.body();return new this(t,r,i,o,n)}return null}static create(e,t,r,i,o){return void 0===r&&(r=0),void 0===i&&(i=0),new this(e=s.Uri.fromLike(e),t=s.Uri.fromLike(t),r,i,o=void 0===o?n.Value.absent():n.Value.fromLike(o))}}class C extends S{}C.tag="event";class x extends S{}x.tag="command";class T extends O{}T.tag="link";class E extends O{}E.tag="linked";class D extends O{}D.tag="sync";class P extends S{}P.tag="synced";class L extends S{}L.tag="unlink";class q extends S{}q.tag="unlinked";class I extends k{}I.tag="auth";class V extends k{}V.tag="authed";class A extends k{}A.tag="deauth";class U extends k{}function F(e,t,r,i,n,s){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,u=i.kind,l="getter"===u?"get":"setter"===u?"set":"value",h=!t&&e?i.static?e:e.prototype:null,c=t||(h?Object.getOwnPropertyDescriptor(h,i.name):{}),d=!1,p=r.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(e||null))};var w=(0,r[p])("accessor"===u?{get:c.get,set:c.set}:c[l],f);if("accessor"===u){if(void 0===w)continue;if(null===w||"object"!=typeof w)throw new TypeError("Object expected");(a=o(w.get))&&(c.get=a),(a=o(w.set))&&(c.set=a),(a=o(w.init))&&n.unshift(a)}else(a=o(w))&&("field"===u?n.unshift(a):c[l]=a)}h&&Object.defineProperty(h,i.name,c),d=!0}function z(e,t,r){for(var i=arguments.length>2,n=0;n<t.length;n++)r=i?t[n].call(e,r):t[n].call(e);return i?r:void 0}U.tag="deauthed","function"==typeof SuppressedError&&SuppressedError;const M=void 0,j={[Symbol.hasInstance]:e=>i.Objects.hasAllKeys(e,"getDownlink","openDownlink")};let N=(()=>{var e;let t,r,i,s=o.Component,a=[],u=[],l=[],h=[];return e=class extends s{constructor(e,t,r,i,n,s){super(),this.hostUri=void z(this,a),this.online=z(this,u,void 0),this.session=z(this,l,void 0),this.unlinkDelay=z(this,h,void 0),this.hostUri=e,this.nodeUri=t,this.laneUri=r,this.prio=i,this.rate=n,this.body=s,this.views=null}keepLinked(){const e=this.views;if(null!==e)for(const t of e)if(t.relinks)return!0;return!1}keepSynced(){const e=this.views;if(null!==e)for(const t of e)if(t.syncs)return!0;return!1}get connected(){return 0!=(this.flags&e.ConnectedFlag)}setConnected(t){t&&0==(this.flags&e.ConnectedFlag)?(this.setFlags(this.flags|e.ConnectedFlag),this.willConnect(),this.onConnect(),this.didConnect()):t||0==(this.flags&e.ConnectedFlag)||(this.setFlags(this.flags&~e.ConnectedFlag),this.willDisconnect(),this.onDisconnect(),this.didDisconnect())}willConnect(){}onConnect(){const e=this.views;if(null!==e)for(const t of e)t.hostDidConnect()}didConnect(){this.keepSynced()?this.sync():this.link()}willDisconnect(){this.setFlags(this.flags&~e.DownlinkMask)}onDisconnect(){const e=this.views;if(null!==e)for(const t of e)t.hostDidDisconnect()}didDisconnect(){this.keepLinked()||this.close()}get linked(){return 0!=(this.flags&e.LinkedFlag)}get synced(){return 0!=(this.flags&e.SyncedFlag)}get authenticated(){return 0!=(this.flags&Y.AuthenticatedFlag)}setAuthenticated(e){e!==(0!=(this.flags&Y.AuthenticatedFlag))&&(this.willSetAuthenticated(e),e?this.setFlags(this.flags|Y.AuthenticatedFlag):this.setFlags(this.flags&~Y.AuthenticatedFlag),this.onSetAuthenticated(e),this.didSetAuthenticated(e))}willSetAuthenticated(e){}onSetAuthenticated(e){}didSetAuthenticated(e){}get deauthenticated(){return 0!=(this.flags&Y.AuthenticatedFlag)}setDeauthenticated(e){e!==(0!=(this.flags&Y.DeauthenticatedFlag))&&(this.willSetDeauthenticated(e),e?this.setFlags(this.flags|Y.DeauthenticatedFlag):this.setFlags(this.flags&~Y.DeauthenticatedFlag),this.onSetDeauthenticated(e),this.didSetDeauthenticated(e))}willSetDeauthenticated(e){}onSetDeauthenticated(e){}didSetDeauthenticated(e){}addDownlink(e){let t=this.views;if(null===t)t=new Set,this.views=t;else if(t.has(e))return;t.add(e)}removeDownlink(e){const t=this.views;if(null!==t&&t.has(e)){if(t.delete(e),0===t.size){const e=this.unlinkDelay.value;e<0?this.unlink():setTimeout(this.doUnlink.bind(this),e)}e.close()}}sync(){const e=this.getAncestor(Y);if(null===e)return;const t=e.unresolve(this.nodeUri),r=new D(t,this.laneUri,this.prio,this.rate,this.body);this.onSyncRequest(r),e.push(r)}link(){const e=this.getAncestor(Y);if(null===e)return;const t=e.unresolve(this.nodeUri),r=new T(t,this.laneUri,this.prio,this.rate,this.body);this.onLinkRequest(r),e.push(r)}unlink(){this.setFlags(this.flags&~e.DownlinkMask|e.UnlinkingFlag);const t=this.getAncestor(Y);null!==t&&t.unlinkDownlink(this)}doUnlink(){null!==this.views&&0===this.views.size&&this.unlink()}command(e){const t=this.getAncestor(Y);null!==t&&(e=n.Value.fromLike(e),this.onCommandMessage(e),t.command(this.nodeUri,this.laneUri,e))}onEventMessage(e,t){const r=this.views;if(null!==r)for(const t of r)t.onEventMessage(e)}onCommandMessage(e){const t=this.views;if(null!==t)for(const r of t)r.onCommandMessage(e)}onLinkRequest(t){this.setFlags(this.flags|e.LinkingFlag);const r=this.views;if(null!==r)for(const e of r)e.onLinkRequest(t)}onLinkedResponse(t,r){this.setFlags(this.flags&~e.LinkingFlag|e.LinkedFlag);const i=this.views;if(null!==i)for(const e of i)e.onLinkedResponse(t)}onSyncRequest(t){this.setFlags(this.flags|e.SyncingFlag);const r=this.views;if(null!==r)for(const e of r)e.onSyncRequest(t)}onSyncedResponse(t,r){this.setFlags(this.flags&~e.SyncingFlag|e.SyncedFlag);const i=this.views;if(null!==i)for(const e of i)e.onSyncedResponse(t)}onUnlinkRequest(t,r){this.setFlags(this.flags&~(e.LinkingFlag|e.SyncingFlag)|e.UnlinkingFlag);const i=this.views;if(null!==i)for(const e of i)e.onUnlinkRequest(t)}onUnlinkedResponse(t,r){this.setFlags(this.flags&~e.UnlinkingFlag);const i=this.views;if(null!==i&&0!==i.size&&0==(this.flags&e.DownlinkMask))this.keepSynced()?this.sync():this.link();else{if(null!==i)for(const e of i)e.onUnlinkedResponse(t);this.close()}}hostDidFail(e,t){const r=this.views;if(null!==r)for(const t of r)t.hostDidFail(e)}close(){this.remove()}onUnmount(){super.onUnmount();const e=this.views;if(null!==e){this.views=null;for(const t of e)t.close()}}},(()=>{var c;const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(c=s[Symbol.metadata])&&void 0!==c?c:null):void 0;t=[o.Property({valueType:Boolean,value:!0,inherits:!0})],r=[o.Property({valueType:n.Value,value:n.Value.absent(),inherits:!0})],i=[o.Property({valueType:Number,value:0,inherits:!0})],F(null,null,t,{kind:"field",name:"online",static:!1,private:!1,access:{has:e=>"online"in e,get:e=>e.online,set:(e,t)=>{e.online=t}},metadata:d},u,a),F(null,null,r,{kind:"field",name:"session",static:!1,private:!1,access:{has:e=>"session"in e,get:e=>e.session,set:(e,t)=>{e.session=t}},metadata:d},l,a),F(null,null,i,{kind:"field",name:"unlinkDelay",static:!1,private:!1,access:{has:e=>"unlinkDelay"in e,get:e=>e.unlinkDelay,set:(e,t)=>{e.unlinkDelay=t}},metadata:d},h,a),d&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d})})(),e.ConnectedFlag=1<<o.Component.FlagShift+0,e.AuthenticatedFlag=1<<o.Component.FlagShift+1,e.DeauthenticatedFlag=1<<o.Component.FlagShift+2,e.LinkingFlag=1<<o.Component.FlagShift+3,e.LinkedFlag=1<<o.Component.FlagShift+4,e.SyncingFlag=1<<o.Component.FlagShift+5,e.SyncedFlag=1<<o.Component.FlagShift+6,e.UnlinkingFlag=1<<o.Component.FlagShift+7,e.DownlinkMask=e.LinkingFlag|e.LinkedFlag|e.SyncingFlag|e.SyncedFlag|e.UnlinkingFlag,e.FlagShift=o.Component.FlagShift+8,e.FlagMask=(1<<e.FlagShift)-1,e})();const R=o.Fastener.extend("WarpDownlink",{get fastenerType(){return R},initHostUri(){let e=Object.getPrototypeOf(this).hostUri;return void 0===e&&(e=null),e},getHostUri(){let e=this.hostUri;return null===e&&i.Objects.hasAllKeys(this.owner,"hostUri")&&(e=this.owner.hostUri.value),e},setHostUri(e){return null!==e&&(e=s.Uri.fromLike(e)),i.Equals(this.hostUri,e)||(this.hostUri=e,this.reopen()),this},initNodeUri(){let e=Object.getPrototypeOf(this).nodeUri;return void 0===e&&(e=null),e},getNodeUri(){let e=this.nodeUri;return null===e&&i.Objects.hasAllKeys(this.owner,"nodeUri")&&(e=this.owner.nodeUri.value),e},setNodeUri(e){return null!==e&&(e=s.Uri.fromLike(e)),i.Equals(this.nodeUri,e)||(this.nodeUri=e,this.reopen()),this},initLaneUri(){let e=Object.getPrototypeOf(this).laneUri;return void 0===e&&(e=null),e},getLaneUri(){let e=this.laneUri;return null===e&&i.Objects.hasAllKeys(this.owner,"laneUri")&&(e=this.owner.laneUri.value),e},setLaneUri(e){return null!==e&&(e=s.Uri.fromLike(e)),i.Equals(this.laneUri,e)||(this.laneUri=e,this.reopen()),this},initPrio(){return Object.getPrototypeOf(this).prio},getPrio(){return this.prio},setPrio(e){return this.prio!==e&&(this.prio=e,this.reopen()),this},initRate(){return Object.getPrototypeOf(this).rate},getRate(){return this.rate},setRate(e){return this.rate!==e&&(this.rate=e,this.reopen()),this},initBody(){let e=Object.getPrototypeOf(this).body;return void 0===e&&(e=null),e},getBody(){return this.body},setBody(e){return null!==e&&(e=n.Value.fromLike(e)),i.Equals(this.body,e)||(this.body=e,this.reopen()),this},get relinks(){return 0!=(this.flags&R.RelinksFlag)},relink(e){void 0===e&&(e=!0);const t=this.flags;return e&&0==(t&R.RelinksFlag)?this.setFlags(t|R.RelinksFlag):e||0==(t&R.RelinksFlag)||this.setFlags(t&~R.RelinksFlag),this},get syncs(){return 0!=(this.flags&R.SyncsFlag)},sync(e){void 0===e&&(e=!0);const t=this.flags;return e&&0==(t&R.SyncsFlag)?this.setFlags(t|R.SyncsFlag):e||0==(t&R.SyncsFlag)||this.setFlags(t&~R.SyncsFlag),this},get opened(){return null!==this.model},get online(){const e=this.model;return null!==e&&e.online.value},get connected(){const e=this.model;return null!==e&&e.connected},get authenticated(){const e=this.model;return null!==e&&e.authenticated},get deauthenticated(){const e=this.model;return null!==e&&e.deauthenticated},get linked(){const e=this.model;return null!==e&&e.linked},get synced(){const e=this.model;return null!==e&&e.synced},get session(){const e=this.model;return null!==e?e.session.value:n.Value.absent()},command(e){const t=this.model;if(null===t)throw new Error("unopened downlink");t.command(e)},onEvent(e){},onCommand(e){},willLink(){},didLink(){},willSync(){},didSync(){},willUnlink(){},didUnlink(){},didConnect(){},didDisconnect(){},didClose(){},didFail(e){},onEventMessage(e){this.onEvent(e.body),this.callObservers("onEvent",e.body,this)},onCommandMessage(e){this.onCommand(e),this.callObservers("onCommand",e,this)},onLinkRequest(e){this.willLink(),this.callObservers("willLink",this)},onLinkedResponse(e){this.didLink(),this.callObservers("didLink",this)},onSyncRequest(e){this.willSync(),this.callObservers("willSync",this)},onSyncedResponse(e){this.didSync(),this.callObservers("didSync",this)},onUnlinkRequest(e){this.willUnlink(),this.callObservers("willUnlink",this)},onUnlinkedResponse(e){this.didUnlink(),this.callObservers("didUnlink",this)},hostDidConnect(){this.didConnect(),this.callObservers("didConnect",this)},hostDidDisconnect(){this.didDisconnect(),this.callObservers("didDisconnect",this)},hostDidFail(e){this.didFail(e),this.callObservers("didFail",e,this)},observe(e){let t=this.observers;if(null===t)t=new Set,this.observers=t;else if(t.has(e))return;this.willObserve(e),t.add(e),this.onObserve(e),this.didObserve(e)},willObserve(e){},onObserve(e){},didObserve(e){},unobserve(e){const t=this.observers;null!==t&&t.has(e)&&(this.willUnobserve(e),t.delete(e),this.onUnobserve(e),this.didUnobserve(e))},willUnobserve(e){},onUnobserve(e){},didUnobserve(e){},callObservers:function(e,...t){const r=this.observers;if(null!==r)for(const i of r){const r=i[e];"function"==typeof r&&r.call(i,...t)}},consume(e){let t=this.consumers;if(null===t)t=new Set,this.consumers=t;else if(t.has(e))return;this.willConsume(e),t.add(e),this.onConsume(e),this.didConsume(e),1===t.size&&this.mounted&&this.startConsuming()},willConsume(e){},onConsume(e){},didConsume(e){},unconsume(e){const t=this.consumers;null!==t&&t.has(e)&&(this.willUnconsume(e),t.delete(e),this.onUnconsume(e),this.didUnconsume(e),0===t.size&&this.stopConsuming())},willUnconsume(e){},onUnconsume(e){},didUnconsume(e){},get consuming(){return 0!=(this.flags&R.ConsumingFlag)},startConsuming(){0==(this.flags&R.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|R.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())},willStartConsuming(){},onStartConsuming(){this.setCoherent(!1),this.requireRecohere()},didStartConsuming(){},stopConsuming(){0!=(this.flags&R.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~R.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())},willStopConsuming(){},onStopConsuming(){this.close()},didStopConsuming(){},open(){throw new Error("abstract")},close(){const e=this.model;null!==e&&(this.model=null,e.removeDownlink(this),this.didClose(),this.callObservers("didClose",this))},reopen(){this.close(),0!=(this.flags&R.ConsumingFlag)&&(this.setCoherent(!1),this.requireRecohere())},recohere(e){this.setCoherentTime(e),this.setCoherent(!0),0!=(this.flags&R.ConsumingFlag)&&this.open()},onMount(){super.onMount(),null!==this.consumers&&0!==this.consumers.size&&this.startConsuming()},onUnmount(){super.onUnmount(),this.stopConsuming()}},{construct(e,t){return(e=super.construct(e,t)).observers=null,e.consumers=null,e.hostUri=e.initHostUri(),e.nodeUri=e.initNodeUri(),e.laneUri=e.initLaneUri(),e.prio=e.initPrio(),e.rate=e.initRate(),e.body=e.initBody(),e.model=null,e},refine(e){super.refine(e);const t=e.prototype;let r=t.flagsInit;Object.prototype.hasOwnProperty.call(t,"relinks")&&(t.relinks?r|=R.RelinksFlag:r&=~R.RelinksFlag,delete t.relinks),Object.prototype.hasOwnProperty.call(t,"syncs")&&(t.syncs?r|=R.SyncsFlag:r&=~R.SyncsFlag,delete t.syncs),Object.defineProperty(t,"flagsInit",{value:r,enumerable:!0,configurable:!0});const i=Object.getOwnPropertyDescriptor(t,"hostUri");void 0!==i&&"value"in i&&(i.value=s.Uri.fromLike(i.value),Object.defineProperty(t,"hostUri",i));const o=Object.getOwnPropertyDescriptor(t,"nodeUri");void 0!==o&&"value"in o&&(o.value=s.Uri.fromLike(o.value),Object.defineProperty(t,"nodeUri",o));const a=Object.getOwnPropertyDescriptor(t,"laneUri");void 0!==a&&"value"in a&&(a.value=s.Uri.fromLike(a.value),Object.defineProperty(t,"laneUri",a));const u=Object.getOwnPropertyDescriptor(t,"body");void 0!==u&&"value"in u&&(u.value=n.Value.fromLike(u.value),Object.defineProperty(t,"body",u))},RelinksFlag:1<<o.Fastener.FlagShift+0,SyncsFlag:1<<o.Fastener.FlagShift+1,ConsumingFlag:1<<o.Fastener.FlagShift+2,FlagShift:o.Fastener.FlagShift+3,FlagMask:(1<<o.Fastener.FlagShift+3)-1});class B extends N{constructor(e,t,r,i,n,s){super(e,t,r,i,n,s)}}const W=R.extend("EventDownlink",{relinks:!0,open(){if(null!==this.model)return this;const e=this.getLaneUri();if(null===e)throw new Error("no laneUri");let t=this.getNodeUri();if(null===t)throw new Error("no nodeUri");let r=this.getHostUri();null===r&&(r=t.endpoint(),t=r.unresolve(t));let i=this.getPrio();void 0===i&&(i=0);let s=this.getRate();void 0===s&&(s=0);let o=this.getBody();null===o&&(o=n.Value.absent());const a=this.owner;if(!j[Symbol.hasInstance](a))throw new Error("no downlink context");let u=a.getDownlink(r,t,e);if(null!==u){if(!(u instanceof B))throw new Error("downlink type mismatch");u.addDownlink(this)}else u=new B(r,t,e,i,s,o),u.addDownlink(this),a.openDownlink(u);return this.model=u,this}},{construct(e,t){return e=super.construct(e,t)}});class Q extends N{constructor(e,t,r,i,s,o,a){super(e,t,r,i,s,o),null===a&&(a=n.Value.absent()),this.state=a}get(){return this.state}set(e,t){if(!(e instanceof n.Value))return super.set(e,t),this;e=this.valueWillSet(e);const r=this.state;return this.setState(e),this.valueDidSet(e,r),this.command(e),this}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t),this.onSetEvent(e.body)}onSetEvent(e){e=this.valueWillSet(e);const t=this.state;this.setState(e),this.valueDidSet(e,t)}valueWillSet(e){const t=this.views;if(null!==t)for(const r of t)e=r.valueWillSet(e);return e}valueDidSet(e,t){const r=this.views;if(null!==r)for(const i of r)i.valueDidSet(e,t)}}const H=R.extend("ValueDownlink",{relinks:!0,syncs:!0,initValueForm(){const e=Object.getPrototypeOf(this).valueForm;return void 0===e?n.Form.forValue():e},setValueForm(e){return this.valueForm!==e&&(this.valueForm=e,this.relink()),this},initState(){let e=this.stateInit;return void 0===e&&(e=null),e},setState(e){const t=this.model;if(null===t)throw new Error("unopened downlink");t.setState(e)},get(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.get().coerce(this.valueForm)},set(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.valueForm.mold(e);t.set(r)},valueWillSet(e){let t;const r=this.valueForm;if(void 0!==this.willSet){t=e.coerce(r);const i=this.willSet(t);void 0!==i&&(t=i,e=r.mold(t))}const i=this.observers;if(null!==i&&0!==i.size){void 0===t&&(t=e.coerce(r));for(const n of i){if(void 0===n.willSet)continue;const i=n.willSet(t,this);void 0!==i&&(t=i,e=r.mold(t))}}return e},valueDidSet(e,t){let r,i;const n=this.valueForm;void 0!==this.didSet&&(r=e.coerce(n),i=t.coerce(n),this.didSet(r,i));const s=this.observers;if(null!==s&&0!==s.size){void 0===r&&(r=e.coerce(n)),void 0===i&&(i=t.coerce(n));for(const e of s)void 0!==e.didSet&&e.didSet(r,i,this)}},didAliasModel(){const e=this.model;null!==e&&e.linked&&(this.onLinkedResponse(),this.valueDidSet(e.get(),n.Value.absent()),e.synced&&this.onSyncedResponse())},open(){if(null!==this.model)return this;const e=this.getLaneUri();if(null===e)throw new Error("no laneUri");let t=this.getNodeUri();if(null===t)throw new Error("no nodeUri");let r=this.getHostUri();null===r&&(r=t.endpoint(),t=r.unresolve(t));let i=this.getPrio();void 0===i&&(i=0);let s=this.getRate();void 0===s&&(s=0);let o=this.getBody();null===o&&(o=n.Value.absent());const a=this.owner;if(!j[Symbol.hasInstance](a))throw new Error("no downlink context");let u=a.getDownlink(r,t,e);if(null!==u){if(!(u instanceof Q))throw new Error("downlink type mismatch");u.addDownlink(this),this.model=u,setTimeout(this.didAliasModel.bind(this))}else{const n=this.initState();u=new Q(r,t,e,i,s,o,n),u.addDownlink(this),a.openDownlink(u),this.model=u}return this}},{construct(e,t){return(e=super.construct(e,t)).valueForm=e.initValueForm(),e}});class K extends N{constructor(e,t,r,i,n,s,o){super(e,t,r,i,n,s),null===o&&(o=new a.STree),this.state=o}get size(){return this.state.length}isEmpty(){return this.state.isEmpty()}get(e,t){return this.state.get(e,t)||n.Value.absent()}getEntry(e,t){return this.state.getEntry(e,t)}set(e,t,r){if("number"!=typeof e)return super.set(e,t),this;if(void 0!==r&&(e=this.state.lookup(r,e))<0)throw new RangeError(""+r);if(e<0||e>=this.state.length)throw new RangeError(""+e);t=this.listWillUpdate(e,t);const i=this.state.getEntry(e);this.state.set(e,t),this.listDidUpdate(e,t,i[1]);const s=n.Record.create(2).slot("key",i[0]).slot("index",e);return this.command(n.Attr.of("update",s).concat(t)),this}insert(e,t,r){if(e<0||e>this.state.length)throw new RangeError(""+e);t=this.listWillUpdate(e,t),this.state.insert(e,t,r);const i=this.state.getEntry(e);this.listDidUpdate(e,t,n.Value.absent());const s=n.Record.create(2).slot("key",i[0]).slot("index",e);return this.command(n.Attr.of("update",s).concat(t)),this}remove(e,t){if(0===arguments.length)return void super.remove();if(void 0!==t&&(e=this.state.lookup(t,e))<0)throw new RangeError(""+t);if(e<0||e>this.state.length)throw new RangeError(""+e);this.listWillRemove(e);const r=this.state.getEntry(e);this.state.remove(e),this.listDidRemove(e,r[1]);const i=n.Record.create(2).slot("key",r[0]).slot("index",e);return this.command(n.Record.create(1).attr("remove",i)),this}push(...e){for(let t=0;t<e.length;t+=1){const r=this.state.length+t,i=this.listWillUpdate(r,e[t]);this.state.insert(r,i);const s=this.state.getEntry(r);this.listDidUpdate(r,i,n.Value.absent());const o=n.Record.create(2).slot("key",s[0]).slot("index",r);this.command(n.Attr.of("update",o).concat(i))}return this.state.length}pop(){const e=this.state.length-1;if(e<0)return n.Value.absent();this.listWillRemove(e);const t=this.state.getEntry(e);this.state.remove(e),this.listDidRemove(e,t[1]);const r=n.Record.create(2).slot("key",t[0]).slot("index",e);return this.command(n.Record.create(1).attr("remove",r)),t[1]}unshift(...e){for(let t=e.length-1;t>=0;t-=1){const r=this.listWillUpdate(0,e[t]);this.state.insert(0,r);const i=this.state.getEntry(0);this.listDidUpdate(0,r,n.Value.absent());const s=n.Record.create(2).slot("key",i[0]).slot("index",0);this.command(n.Attr.of("update",s).concat(r))}return this.state.length}shift(){if(this.state.length<=0)return n.Value.absent();this.listWillRemove(0);const e=this.state.getEntry(0);this.state.remove(0),this.listDidRemove(0,e[1]);const t=n.Record.create(2).slot("key",e[0]).slot("index",0);return this.command(n.Record.create(1).attr("remove",t)),e[1]}move(e,t,r){if(void 0!==r&&(e=this.state.lookup(r,e))<0)throw new RangeError(""+r);if(e<0||e>=this.state.length)throw new RangeError(""+e);if(t<0||t>=this.state.length)throw new RangeError(""+t);if(e!==t){const r=this.state.getEntry(e);this.listWillMove(e,t,r[1]),this.state.remove(e).insert(t,r[1],r[0]),this.listDidMove(e,t,r[1]);const i=n.Record.create(2).slot("key",r[0]).slot("from",e).slot("to",t);this.command(n.Record.create(1).attr("move",i))}return this}splice(e,t,...r){e<0&&(e=this.state.length+e),e=Math.min(Math.max(0,e),this.state.length),void 0===t&&(t=this.state.length-e);const i=[];for(let r=e,s=e+t;r<s;r+=1){this.listWillRemove(e);const t=this.state.getEntry(e);i.push(t[1]),this.state.remove(e),this.listDidRemove(e,t[1]);const r=n.Record.create(2).slot("key",t[0]).slot("index",e);this.command(n.Record.create(1).attr("remove",r))}for(let t=0;t<r.length;t+=1){const i=e+t,s=this.listWillUpdate(i,r[t]);this.state.insert(i,s);const o=this.state.getEntry(i);this.listDidUpdate(i,s,n.Value.absent());const a=n.Record.create(2).slot("key",o[0]).slot("index",i);this.command(n.Attr.of("update",a).concat(s))}return i}clear(){this.listWillClear(),this.state.clear(),this.listDidClear(),this.command(n.Record.create(1).attr("clear"))}forEach(e,t){return this.state.forEach(e,t)}values(){return this.state.values()}keys(){return this.state.keys()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t);const r=e.body,i=r.tag;if("update"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("index").numberValue());t>=0?this.onUpdateEvent(t,r.body(),e.get("key")):this.onInsertEvent(e.get("index").numberValue(0),r.body(),e.get("key"))}else if("move"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("from").numberValue());t>=0&&this.onMoveEvent(t,e.get("to").numberValue(0),e.get("key"))}else if("remove"===i){const e=r.head().toValue(),t=this.state.lookup(e.get("key"),e.get("index").numberValue());t>=0&&this.onRemoveEvent(t,e.get("key"))}else if("drop"===i){const e=r.head();this.onDropEvent(e.numberValue(0))}else if("take"===i){const e=r.head();this.onTakeEvent(e.numberValue(0))}else"clear"===i&&this.onClearEvent()}onInsertEvent(e,t,r){t=this.listWillUpdate(e,t),this.state.insert(e,t,r),this.listDidUpdate(e,t,n.Value.absent())}onUpdateEvent(e,t,r){t=this.listWillUpdate(e,t);const i=this.state.get(e)||n.Value.absent();this.state.set(e,t),this.listDidUpdate(e,t,i)}onMoveEvent(e,t,r){if(e===(t=Math.min(Math.max(0,t),this.state.length)))return;const i=this.state.get(e)||n.Value.absent();this.listWillMove(e,t,i),this.state.remove(e).insert(t,i,r),this.listDidMove(e,t,i)}onRemoveEvent(e,t){this.listWillRemove(e);const r=this.state.get(e)||n.Value.absent();this.state.remove(e),this.listDidRemove(e,r)}onDropEvent(e){this.listWillDrop(e),this.state.drop(e),this.listDidDrop(e)}onTakeEvent(e){this.listWillTake(e),this.state.take(e),this.listDidTake(e)}onClearEvent(){this.listWillClear(),this.state.clear(),this.listDidClear()}listWillUpdate(e,t){const r=this.views;if(null!==r)for(const i of r)t=i.listWillUpdate(e,t);return t}listDidUpdate(e,t,r){const i=this.views;if(null!==i)for(const n of i)n.listDidUpdate(e,t,r)}listWillMove(e,t,r){const i=this.views;if(null!==i)for(const n of i)n.listWillMove(e,t,r)}listDidMove(e,t,r){const i=this.views;if(null!==i)for(const n of i)n.listDidMove(e,t,r)}listWillRemove(e){const t=this.views;if(null!==t)for(const r of t)r.listWillRemove(e)}listDidRemove(e,t){const r=this.views;if(null!==r)for(const i of r)i.listDidRemove(e,t)}listWillDrop(e){const t=this.views;if(null!==t)for(const r of t)r.listWillDrop(e)}listDidDrop(e){const t=this.views;if(null!==t)for(const r of t)r.listDidDrop(e)}listWillTake(e){const t=this.views;if(null!==t)for(const r of t)r.listWillTake(e)}listDidTake(e){const t=this.views;if(null!==t)for(const r of t)r.listDidTake(e)}listWillClear(){const e=this.views;if(null!==e)for(const t of e)t.listWillClear()}listDidClear(){const e=this.views;if(null!==e)for(const t of e)t.listDidClear()}}const Z=R.extend("ListDownlink",{relinks:!0,syncs:!0,initValueForm(){let e=Object.getPrototypeOf(this).valueForm;return void 0===e&&(e=n.Form.forValue()),e},setValueForm(e){return this.valueForm!==e&&(this.valueForm=e,this.relink()),this},initState(){let e=this.stateInit;return void 0===e&&(e=null),e},setState(e){const t=this.model;if(null===t)throw new Error("unopened downlink");t.setState(e)},get size(){const e=this.model;return null!==e?e.size:0},isEmpty(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.isEmpty()},get(e,t){if(0===arguments.length)return this;const r=this.model;if(null===r)throw new Error("unopened downlink");return r.get(e,t).coerce(this.valueForm)},getEntry(e,t){const r=this.model;if(null===r)throw new Error("unopened downlink");const i=r.getEntry(e,t);if(void 0!==i)return[i[0].coerce(this.valueForm),i[1]]},set(e,t,r){const i=this.model;if(null===i)throw new Error("unopened downlink");const n=this.valueForm.mold(t);return i.set(e,n,r),this},insert(e,t,r){const i=this.model;if(null===i)throw new Error("unopened downlink");const n=this.valueForm.mold(t);return i.insert(e,n,r),this},remove(e,t){const r=this.model;if(null===r)throw new Error("unopened downlink");return r.remove(e,t),this},push(...e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.valueForm,i=new Array(e.length);for(let t=0;t<e.length;t+=1)i[t]=r.mold(e[t]);return t.push(...i)},pop(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.pop().coerce(this.valueForm)},unshift(...e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.valueForm,i=new Array(e.length);for(let t=0;t<e.length;t+=1)i[t]=r.mold(e[t]);return t.unshift(...i)},shift(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.shift().coerce(this.valueForm)},move(e,t,r){const i=this.model;if(null===i)throw new Error("unopened downlink");return i.move(e,t,r),this},splice(e,t,...r){if(null===this.model)throw new Error("unopened downlink");const i=this.valueForm,n=new Array(r.length);for(let e=0;e<r.length;e+=1)n[e]=i.mold(r[e]);const s=this.model.splice(e,t,...n),o=new Array(s.length);for(let e=0;e<s.length;e+=1)o[e]=s[e].coerce(i);return o},clear(){const e=this.model;if(null===e)throw new Error("unopened downlink");e.clear()},forEach(e,t){const r=this.model;if(null===r)throw new Error("unopened downlink");const i=this.valueForm;return i===n.Form.forValue()?r.state.forEach(e,t):r.state.forEach((function(r,n,s){const o=r.coerce(i);return e.call(t,o,n,s)}),this)},values(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.values(),r=this.valueForm;return r===n.Form.forValue()?t:new n.ValueCursor(t,r)},keys(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.keys()},entries(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.entries();return this.valueForm===n.Form.forValue()?t:new n.ValueEntryCursor(t,n.Form.forValue(),this.valueForm)},snapshot(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.snapshot()},listWillUpdate(e,t){let r;const i=this.valueForm;if(void 0!==this.willUpdate){r=t.coerce(i);const n=this.willUpdate(e,r);void 0!==n&&(r=n,t=i.mold(r))}const n=this.observers;if(null!==n&&0!==n.size){void 0===r&&(r=t.coerce(i));for(const s of n){if(void 0===s.willUpdate)continue;const n=s.willUpdate(e,r,this);void 0!==n&&(r=n,t=i.mold(r))}}return t},listDidUpdate(e,t,r){let i,n;const s=this.valueForm;void 0!==this.didUpdate&&(i=t.coerce(s),n=r.coerce(s),this.didUpdate(e,i,n));const o=this.observers;if(null!==o&&0!==o.size){void 0===i&&(i=t.coerce(s)),void 0===n&&(n=r.coerce(s));for(const t of o)void 0!==t.didUpdate&&t.didUpdate(e,i,n,this)}},listWillMove(e,t,r){let i;const n=this.valueForm;void 0!==this.willMove&&(i=r.coerce(n),this.willMove(e,t,i));const s=this.observers;if(null!==s&&0!==s.size){void 0===i&&(i=r.coerce(n));for(const r of s)void 0!==r.willMove&&r.willMove(e,t,i,this)}},listDidMove(e,t,r){let i;const n=this.valueForm;void 0!==this.didMove&&(i=r.coerce(n),this.didMove(e,t,i));const s=this.observers;if(null!==s&&0!==s.size){void 0===i&&(i=r.coerce(n));for(const r of s)void 0!==r.didMove&&r.didMove(e,t,i,this)}},listWillRemove(e){void 0!==this.willRemove&&this.willRemove(e),this.callObservers("willRemove",e,this)},listDidRemove(e,t){let r;const i=this.valueForm;void 0!==this.didRemove&&(r=t.coerce(i),this.didRemove(e,r));const n=this.observers;if(null!==n&&0!==n.size){void 0===r&&(r=t.coerce(i));for(const t of n)void 0!==t.didRemove&&t.didRemove(e,r,this)}},listWillDrop(e){void 0!==this.willDrop&&this.willDrop(e),this.callObservers("willDrop",e,this)},listDidDrop(e){void 0!==this.didDrop&&this.didDrop(e),this.callObservers("didDrop",e,this)},listWillTake(e){void 0!==this.willTake&&this.willTake(e),this.callObservers("willTake",e,this)},listDidTake(e){void 0!==this.didTake&&this.didTake(e),this.callObservers("didTake",e,this)},listWillClear(){void 0!==this.willClear&&this.willClear(),this.callObservers("willClear",this)},listDidClear(){void 0!==this.didClear&&this.didClear(),this.callObservers("didClear",this)},didAliasModel(){const e=this.model;null!==e&&e.linked&&(this.onLinkedResponse(),e.state.forEach((function(e,t){this.listDidUpdate(t,e,n.Value.absent())}),this),e.synced&&this.onSyncedResponse())},open(){if(null!==this.model)return this;const e=this.getLaneUri();if(null===e)throw new Error("no laneUri");let t=this.getNodeUri();if(null===t)throw new Error("no nodeUri");let r=this.getHostUri();null===r&&(r=t.endpoint(),t=r.unresolve(t));let i=this.getPrio();void 0===i&&(i=0);let s=this.getRate();void 0===s&&(s=0);let o=this.getBody();null===o&&(o=n.Value.absent());const a=this.owner;if(!j[Symbol.hasInstance](a))throw new Error("no downlink context");let u=a.getDownlink(r,t,e);if(null!==u){if(!(u instanceof K))throw new Error("downlink type mismatch");u.addDownlink(this),this.model=u,setTimeout(this.didAliasModel.bind(this))}else{const n=this.initState();u=new K(r,t,e,i,s,o,n),u.addDownlink(this),a.openDownlink(u),this.model=u}return this}},{construct(e,t){return(e=super.construct(e,t)).valueForm=e.initValueForm(),e}});class X extends N{constructor(e,t,r,i,n,s,o){super(e,t,r,i,n,s),null===o&&(o=new a.BTree),this.state=o}get size(){return this.state.size}isEmpty(){return this.state.isEmpty()}has(e){return this.state.has(e)}get(e){var t;return null!==(t=this.state.get(e))&&void 0!==t?t:n.Value.absent()}getEntry(e){return this.state.getEntry(e)}set(e,t){var r;if(!(e instanceof n.Value))return super.set(e,t),this;t=this.mapWillUpdate(e,t);const i=null!==(r=this.state.get(e))&&void 0!==r?r:n.Value.absent();this.state.set(e,t),this.mapDidUpdate(e,t,i);const s=n.Record.create(1).slot("key",e);return this.command(n.Attr.of("update",s).concat(t)),this}delete(e){var t;if(!this.state.has(e))return!1;this.mapWillRemove(e);const r=null!==(t=this.state.get(e))&&void 0!==t?t:n.Value.absent();this.state.delete(e),this.mapDidRemove(e,r);const i=n.Record.create(1).slot("key",e);return this.command(n.Record.create(1).attr("remove",i)),!0}drop(e){return this.mapWillDrop(e),this.state.drop(e),this.mapDidDrop(e),this.command(n.Record.create(1).attr("drop",e)),this}take(e){return this.mapWillTake(e),this.state.take(e),this.mapDidTake(e),this.command(n.Record.create(1).attr("take",e)),this}clear(){this.mapWillClear(),this.state.clear(),this.mapDidClear(),this.command(n.Record.create(1).attr("clear"))}forEach(e,t){return this.state.forEach(e,t)}keys(){return this.state.keys()}values(){return this.state.values()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(e){this.state=e}onEventMessage(e,t){super.onEventMessage(e,t);const r=e.body,i=r.tag;if("update"===i){const e=r.head().toValue();this.onUpdateEvent(e.get("key"),r.body())}else if("remove"===i){const e=r.head().toValue();this.onRemoveEvent(e.get("key"))}else if("drop"===i){const e=r.head().toValue();this.onDropEvent(e.numberValue(0))}else if("take"===i){const e=r.head().toValue();this.onTakeEvent(e.numberValue(0))}else"clear"===i&&this.onClearEvent()}onUpdateEvent(e,t){var r;t=this.mapWillUpdate(e,t);const i=null!==(r=this.state.get(e))&&void 0!==r?r:n.Value.absent();this.state.set(e,t),this.mapDidUpdate(e,t,i)}onRemoveEvent(e){var t;this.mapWillRemove(e);const r=null!==(t=this.state.get(e))&&void 0!==t?t:n.Value.absent();this.state.delete(e),this.mapDidRemove(e,r)}onDropEvent(e){this.mapWillDrop(e),this.state.drop(e),this.mapDidDrop(e)}onTakeEvent(e){this.mapWillTake(e),this.state.take(e),this.mapDidTake(e)}onClearEvent(){this.mapWillClear(),this.state.clear(),this.mapDidClear()}mapWillUpdate(e,t){const r=this.views;if(null!==r)for(const i of r)t=i.mapWillUpdate(e,t);return t}mapDidUpdate(e,t,r){const i=this.views;if(null!==i)for(const n of i)n.mapDidUpdate(e,t,r)}mapWillRemove(e){const t=this.views;if(null!==t)for(const r of t)r.mapWillRemove(e)}mapDidRemove(e,t){const r=this.views;if(null!==r)for(const i of r)i.mapDidRemove(e,t)}mapWillDrop(e){const t=this.views;if(null!==t)for(const r of t)r.mapWillDrop(e)}mapDidDrop(e){const t=this.views;if(null!==t)for(const r of t)r.mapDidDrop(e)}mapWillTake(e){const t=this.views;if(null!==t)for(const r of t)r.mapWillTake(e)}mapDidTake(e){const t=this.views;if(null!==t)for(const r of t)r.mapDidTake(e)}mapWillClear(){const e=this.views;if(null!==e)for(const t of e)t.mapWillClear()}mapDidClear(){const e=this.views;if(null!==e)for(const t of e)t.mapDidClear()}}const J=R.extend("MapDownlink",{relinks:!0,syncs:!0,initKeyForm(){let e=Object.getPrototypeOf(this).keyForm;return void 0===e&&(e=n.Form.forValue()),e},setKeyForm(e){return this.keyForm!==e&&(this.keyForm=e,this.relink()),this},initValueForm(){let e=Object.getPrototypeOf(this).valueForm;return void 0===e&&(e=n.Form.forValue()),e},setValueForm(e){return this.valueForm!==e&&(this.valueForm=e,this.relink()),this},initState(){let e=this.stateInit;return void 0===e&&(e=null),e},setState(e){const t=this.model;if(null===t)throw new Error("unopened downlink");t.setState(e)},get size(){const e=this.model;return null!==e?e.size:0},isEmpty(){const e=this.model;return null===e||e.isEmpty()},has(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e);return t.has(r)},get(e){if(0===arguments.length)return this;const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e);return t.get(r).coerce(this.valueForm)},getEntry(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=t.getEntry(e);if(void 0!==r)return[r[0].coerce(this.keyForm),r[1].coerce(this.valueForm)]},firstKey(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.firstKey();if(void 0!==t)return t.coerce(this.keyForm)},firstValue(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.firstValue();if(void 0!==t)return t.coerce(this.valueForm)},firstEntry(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.firstEntry();if(void 0!==t)return[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)]},lastKey(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.lastKey();if(void 0!==t)return t.coerce(this.keyForm)},lastValue(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.lastValue();if(void 0!==t)return t.coerce(this.valueForm)},lastEntry(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.state.lastEntry();if(void 0!==t)return[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)]},nextKey(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.nextKey(r);if(void 0!==i)return i.coerce(this.keyForm)},nextValue(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.nextValue(r);if(void 0!==i)return i.coerce(this.valueForm)},nextEntry(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.nextEntry(r);if(void 0!==i)return[i[0].coerce(this.keyForm),i[1].coerce(this.valueForm)]},previousKey(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.previousKey(r);if(void 0!==i)return i.coerce(this.keyForm)},previousValue(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.previousValue(r);if(void 0!==i)return i.coerce(this.valueForm)},previousEntry(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e),i=t.state.previousEntry(r);if(void 0!==i)return[i[0].coerce(this.keyForm),i[1].coerce(this.valueForm)]},set(e,t){const r=this.model;if(null===r)throw new Error("unopened downlink");const i=this.keyForm.mold(e),n=this.valueForm.mold(t);return r.set(i,n),this},delete(e){const t=this.model;if(null===t)throw new Error("unopened downlink");const r=this.keyForm.mold(e);return t.delete(r)},drop(e){const t=this.model;if(null===t)throw new Error("unopened downlink");return t.drop(e),this},take(e){const t=this.model;if(null===t)throw new Error("unopened downlink");return t.take(e),this},clear(){const e=this.model;if(null===e)throw new Error("unopened downlink");e.clear()},forEach(e,t){const r=this.model;if(null===r)throw new Error("unopened downlink");const i=this.keyForm,s=this.valueForm;return i===n.Form.forValue()&&s===n.Form.forValue()?r.state.forEach((function(r,i){return e.call(t,r,i,this)}),this):r.state.forEach((function(r,n){const o=r.coerce(s),a=n.coerce(i);return e.call(t,o,a,this)}),this)},keys(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.keys();return this.keyForm===n.Form.forValue()?t:new n.ValueCursor(t,this.keyForm)},values(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.values();return this.valueForm===n.Form.forValue()?t:new n.ValueCursor(t,this.valueForm)},entries(){const e=this.model;if(null===e)throw new Error("unopened downlink");const t=e.entries();return this.keyForm===n.Form.forValue()&&this.valueForm===n.Form.forValue()?t:new n.ValueEntryCursor(t,this.keyForm,this.valueForm)},snapshot(){const e=this.model;if(null===e)throw new Error("unopened downlink");return e.snapshot()},mapWillUpdate(e,t){let r,i;const n=this.keyForm,s=this.valueForm;if(void 0!==this.willUpdate){r=e.coerce(n),i=t.coerce(s);const o=this.willUpdate(r,i);void 0!==o&&(i=o,t=s.mold(i))}const o=this.observers;if(null!==o&&0!==o.size){void 0===r&&(r=e.coerce(n)),void 0===i&&(i=t.coerce(s));for(const e of o){if(void 0===e.willUpdate)continue;const n=e.willUpdate(r,i,this);void 0!==n&&(i=n,t=s.mold(i))}}return t},mapDidUpdate(e,t,r){let i,n,s;const o=this.keyForm,a=this.valueForm;void 0!==this.didUpdate&&(i=e.coerce(o),n=t.coerce(a),s=r.coerce(a),this.didUpdate(i,n,s));const u=this.observers;if(null!==u&&0!==u.size){void 0===i&&(i=e.coerce(o)),void 0===n&&(n=t.coerce(a)),void 0===s&&(s=r.coerce(a));for(const e of u)void 0!==e.didUpdate&&e.didUpdate(i,n,s,this)}},mapWillRemove(e){let t;const r=this.keyForm;void 0!==this.willRemove&&(t=e.coerce(r),this.willRemove(t));const i=this.observers;if(null!==i&&0!==i.size){void 0===t&&(t=e.coerce(r));for(const e of i)void 0!==e.willRemove&&e.willRemove(t,this)}},mapDidRemove(e,t){let r,i;const n=this.keyForm,s=this.valueForm;void 0!==this.didRemove&&(r=e.coerce(n),i=t.coerce(s),this.didRemove(r,i));const o=this.observers;if(null!==o&&0!==o.size){void 0===r&&(r=e.coerce(n)),void 0===i&&(i=t.coerce(s));for(const e of o)void 0!==e.didRemove&&e.didRemove(r,i,this)}},mapWillDrop(e){void 0!==this.willDrop&&this.willDrop(e),this.callObservers("willDrop",e,this)},mapDidDrop(e){void 0!==this.didDrop&&this.didDrop(e),this.callObservers("didDrop",e,this)},mapWillTake(e){void 0!==this.willTake&&this.willTake(e),this.callObservers("willTake",e,this)},mapDidTake(e){void 0!==this.didTake&&this.didTake(e),this.callObservers("didTake",e,this)},mapWillClear(){void 0!==this.willClear&&this.willClear(),this.callObservers("willClear",this)},mapDidClear(){void 0!==this.didClear&&this.didClear(),this.callObservers("didClear",this)},didAliasModel(){const e=this.model;null!==e&&e.linked&&(this.onLinkedResponse(),e.state.forEach((function(e,t){this.mapDidUpdate(t,e,n.Value.absent())}),this),e.synced&&this.onSyncedResponse())},open(){if(null!==this.model)return this;const e=this.getLaneUri();if(null===e)throw new Error("no laneUri");let t=this.getNodeUri();if(null===t)throw new Error("no nodeUri");let r=this.getHostUri();null===r&&(r=t.endpoint(),t=r.unresolve(t));let i=this.getPrio();void 0===i&&(i=0);let s=this.getRate();void 0===s&&(s=0);let o=this.getBody();null===o&&(o=n.Value.absent());const a=this.owner;if(!j[Symbol.hasInstance](a))throw new Error("no downlink context");let u=a.getDownlink(r,t,e);if(null!==u){if(!(u instanceof X))throw new Error("downlink type mismatch");u.addDownlink(this),this.model=u,setTimeout(this.didAliasModel.bind(this))}else{const n=this.initState();u=new X(r,t,e,i,s,o,n),u.addDownlink(this),a.openDownlink(u),this.model=u}return this}},{construct(e,t){return(e=super.construct(e,t)).keyForm=e.initKeyForm(),e.valueForm=e.initValueForm(),e}});let Y=(()=>{var e;let t,r,a,u,l,h,c,d,p,f=o.Component,m=[],w=[],g=[],y=[],v=[],b=[],k=[],S=[],O=[],M=[];return e=class extends f{constructor(e){super(),this.hostUri=void z(this,m),this.reconnectTimer=z(this,w,void 0),this.maxReconnectTimeout=z(this,g,void 0),this.online=z(this,y,void 0),this.unlinkDelay=z(this,v,void 0),this.idleTimer=z(this,b,void 0),this.idleTimeout=z(this,k,void 0),this.credentials=z(this,S,void 0),this.session=z(this,O,void 0),this.sendBufferSize=z(this,M,void 0),this.hostUri=e,this.uriCache=new s.UriCache(e.endpoint()),this.downlinks={},this.downlinkCount=0,this.sendBuffer=[]}resolve(e){return this.uriCache.resolve(e)}unresolve(e){return this.uriCache.unresolve(e)}get connected(){return 0!=(this.flags&e.ConnectedFlag)}setConnected(t){t&&0==(this.flags&e.ConnectedFlag)?(this.setFlags(this.flags|e.ConnectedFlag),this.willConnect(),this.onConnect(),this.didConnect()):t||0==(this.flags&e.ConnectedFlag)||(this.setFlags(this.flags&~e.ConnectedFlag),this.willDisconnect(),this.onDisconnect(),this.didDisconnect())}willConnect(){this.reconnectTimer.reset();const e=this.credentials.value;if(e.isDefined()){const t=new I(e);this.push(t)}}onConnect(){this.callObservers("hostDidConnect",this);let e=this.firstChild;for(;null!==e;){const t=e.nextSibling;e instanceof N&&e.setConnected(!0),e=t}}didConnect(){let e;for(;(e=this.sendBuffer.shift())&&this.connected;)this.push(e);this.idleTimer.watch()}willDisconnect(){}onDisconnect(){this.callObservers("hostDidDisconnect",this);let e=this.firstChild;for(;null!==e;){const t=e.nextSibling;e instanceof N&&e.setConnected(!1),e=t}}didDisconnect(){this.setAuthenticated(!1),this.setDeauthenticated(!1),this.session.set(n.Value.absent()),this.idleTimer.cancel(),this.idle?this.close():this.reconnect()}didFail(e){this.callObservers("hostDidFail",e,this);let t=this.firstChild;for(;null!==t;){const r=t.nextSibling;t instanceof N&&t.hostDidFail(e,this),t=r}}reconnect(){this.online.value&&this.reconnectTimer.backoff()}close(){this.reconnectTimer.cancel(),this.idleTimer.cancel(),this.disconnect(),this.remove()}get idle(){return 0===this.sendBuffer.length&&0===this.downlinkCount}get authenticated(){return 0!=(this.flags&e.AuthenticatedFlag)}setAuthenticated(t){t!==(0!=(this.flags&e.AuthenticatedFlag))&&(t?this.setFlags(this.flags|e.AuthenticatedFlag):this.setFlags(this.flags&~e.AuthenticatedFlag),this.willSetAuthenticated(t),this.onSetAuthenticated(t),this.didSetAuthenticated(t))}willSetAuthenticated(e){}onSetAuthenticated(e){let t=this.firstChild;for(;null!==t;){const r=t.nextSibling;t instanceof N&&t.setAuthenticated(e),t=r}}didSetAuthenticated(e){e&&this.callObservers("hostDidAuthenticate",this.session.value,this)}get deauthenticated(){return 0!=(this.flags&e.AuthenticatedFlag)}setDeauthenticated(t){t!==(0!=(this.flags&e.DeauthenticatedFlag))&&(t?this.setFlags(this.flags|e.DeauthenticatedFlag):this.setFlags(this.flags&~e.DeauthenticatedFlag),this.willSetDeauthenticated(t),this.onSetDeauthenticated(t),this.didSetDeauthenticated(t))}willSetDeauthenticated(e){}onSetDeauthenticated(e){let t=this.firstChild;for(;null!==t;){const r=t.nextSibling;t instanceof N&&t.setDeauthenticated(e),t=r}}didSetDeauthenticated(e){e&&this.callObservers("hostDidDeauthenticate",this.session.value,this)}authenticate(e){this.credentials.set(e)}getDownlink(e,t){e=this.resolve(e);const r=this.downlinks[e.toString()];if(void 0!==r){const e=r[t.toString()];if(void 0!==e)return e}return null}openDownlink(e){this.appendChild(e),!this.connected&&this.online.value&&this.connect()}unlinkDownlink(e){if(!this.connected)return;const t=this.resolve(e.nodeUri),r=e.laneUri,i=this.downlinks[t.toString()];if(void 0!==i&&void 0!==i[r.toString()]){const i=new L(this.unresolve(t),r,n.Value.absent());e.onUnlinkRequest(i,this),this.push(i)}}willInsertChild(e,t){super.willInsertChild(e,t),e instanceof N&&this.willInsertDownlink(e)}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof N&&this.onInsertDownlink(e)}didInsertChild(e,t){super.didInsertChild(e,t),e instanceof N&&this.didInsertDownlink(e)}willInsertDownlink(e){this.idleTimer.cancel()}onInsertDownlink(e){const t=this.resolve(e.nodeUri),r=e.laneUri;let i=this.downlinks[t.toString()];if(void 0===i&&(i={},this.downlinks[t.toString()]=i),void 0!==i[r.toString()])throw new Error("duplicate downlink");i[r.toString()]=e,this.downlinkCount+=1}didInsertDownlink(e){e.setConnected(this.connected),e.setAuthenticated(this.authenticated),e.setDeauthenticated(this.deauthenticated)}willRemoveChild(e){super.willRemoveChild(e),e instanceof N&&this.willRemoveDownlink(e)}onRemoveChild(e){super.onRemoveChild(e),e instanceof N&&this.onRemoveDownlink(e)}didRemoveChild(e){e instanceof N&&this.didRemoveDownlink(e),super.didRemoveChild(e)}willRemoveDownlink(e){}onRemoveDownlink(e){const t=this.resolve(e.nodeUri),r=e.laneUri,n=this.downlinks[t.toString()];void 0!==n&&void 0!==n[r.toString()]&&(this.downlinkCount-=1,delete n[r.toString()],i.Objects.isEmpty(n)&&delete this.downlinks[t.toString()],0===this.downlinkCount&&this.idleTimer.watch())}didRemoveDownlink(e){e.setConnected(!1),e.setAuthenticated(!1),e.setDeauthenticated(!1)}command(e,t,r){e=s.Uri.fromLike(e),e=this.resolve(e),t=s.Uri.fromLike(t),r=n.Value.fromLike(r);const i=new x(this.unresolve(e),t,r);this.push(i)}onEnvelope(e){e instanceof C?this.onEventMessage(e):e instanceof x?this.onCommandMessage(e):e instanceof T?this.onLinkRequest(e):e instanceof E?this.onLinkedResponse(e):e instanceof D?this.onSyncRequest(e):e instanceof P?this.onSyncedResponse(e):e instanceof L?this.onUnlinkRequest(e):e instanceof q?this.onUnlinkedResponse(e):e instanceof I?this.onAuthRequest(e):e instanceof V?this.onAuthedResponse(e):e instanceof A?this.onDeauthRequest(e):e instanceof U?this.onDeauthedResponse(e):this.onUnknownEnvelope(e)}onEventMessage(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks[t.toString()];if(void 0===i)return;const n=i[r.toString()];if(void 0===n)return;const s=e.withNode(t);n.onEventMessage(s,this)}onCommandMessage(e){}onLinkRequest(e){}onLinkedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks[t.toString()];if(void 0===i)return;const n=i[r.toString()];if(void 0===n)return;const s=e.withNode(t);n.onLinkedResponse(s,this)}onSyncRequest(e){}onSyncedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks[t.toString()];if(void 0===i)return;const n=i[r.toString()];if(void 0===n)return;const s=e.withNode(t);n.onSyncedResponse(s,this)}onUnlinkRequest(e){}onUnlinkedResponse(e){const t=this.resolve(e.node),r=e.lane,i=this.downlinks[t.toString()];if(void 0===i)return;const n=i[r.toString()];if(void 0===n)return;const s=e.withNode(t);n.onUnlinkedResponse(s,this)}onAuthRequest(e){}onAuthedResponse(e){this.session.set(e.body),this.setDeauthenticated(!1),this.setAuthenticated(!0)}onDeauthRequest(e){}onDeauthedResponse(e){this.session.set(e.body),this.setAuthenticated(!1),this.setDeauthenticated(!0)}onUnknownEnvelope(e){}},(()=>{var i;const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(i=f[Symbol.metadata])&&void 0!==i?i:null):void 0;t=[o.Timer({delay:0,fire(){this.owner.connect()},backoff(){if(!this.scheduled){let e=this.delay;if(0===e)e=Math.floor(500+1e3*Math.random());else{const t=this.owner.maxReconnectTimeout.value;e=Math.min(Math.floor(1.8*e),t)}this.schedule(e)}},reset(){this.cancel(),this.setDelay(0)}})],r=[o.Property({valueType:Number,value:3e4,inherits:!0})],a=[o.Property({valueType:Boolean,value:!0,inherits:!0})],u=[o.Property({valueType:Number,value:0,inherits:!0})],l=[o.Timer({delay:1e3,fire(){this.owner.connected&&this.owner.idle&&this.owner.close()},watch(){this.owner.connected&&this.owner.idle&&this.debounce()}})],h=[o.Property({valueType:Number,value:1e3,inherits:!0,didSetValue(e){this.owner.idleTimer.setDelay(e)}})],c=[o.Property({valueType:n.Value,value:n.Value.absent(),didSetValue(e){if(this.owner.connected){const t=new I(e);this.owner.push(t)}else this.owner.online.value&&e.isDefined()&&this.owner.connect()}})],d=[o.Property({valueType:n.Value,value:n.Value.absent()})],p=[o.Property({valueType:Number,value:1024,inherits:!0})],F(null,null,t,{kind:"field",name:"reconnectTimer",static:!1,private:!1,access:{has:e=>"reconnectTimer"in e,get:e=>e.reconnectTimer,set:(e,t)=>{e.reconnectTimer=t}},metadata:s},w,m),F(null,null,r,{kind:"field",name:"maxReconnectTimeout",static:!1,private:!1,access:{has:e=>"maxReconnectTimeout"in e,get:e=>e.maxReconnectTimeout,set:(e,t)=>{e.maxReconnectTimeout=t}},metadata:s},g,m),F(null,null,a,{kind:"field",name:"online",static:!1,private:!1,access:{has:e=>"online"in e,get:e=>e.online,set:(e,t)=>{e.online=t}},metadata:s},y,m),F(null,null,u,{kind:"field",name:"unlinkDelay",static:!1,private:!1,access:{has:e=>"unlinkDelay"in e,get:e=>e.unlinkDelay,set:(e,t)=>{e.unlinkDelay=t}},metadata:s},v,m),F(null,null,l,{kind:"field",name:"idleTimer",static:!1,private:!1,access:{has:e=>"idleTimer"in e,get:e=>e.idleTimer,set:(e,t)=>{e.idleTimer=t}},metadata:s},b,m),F(null,null,h,{kind:"field",name:"idleTimeout",static:!1,private:!1,access:{has:e=>"idleTimeout"in e,get:e=>e.idleTimeout,set:(e,t)=>{e.idleTimeout=t}},metadata:s},k,m),F(null,null,c,{kind:"field",name:"credentials",static:!1,private:!1,access:{has:e=>"credentials"in e,get:e=>e.credentials,set:(e,t)=>{e.credentials=t}},metadata:s},S,m),F(null,null,d,{kind:"field",name:"session",static:!1,private:!1,access:{has:e=>"session"in e,get:e=>e.session,set:(e,t)=>{e.session=t}},metadata:s},O,m),F(null,null,p,{kind:"field",name:"sendBufferSize",static:!1,private:!1,access:{has:e=>"sendBufferSize"in e,get:e=>e.sendBufferSize,set:(e,t)=>{e.sendBufferSize=t}},metadata:s},M,m),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s})})(),e.ConnectedFlag=1<<o.Component.FlagShift+0,e.AuthenticatedFlag=1<<o.Component.FlagShift+1,e.DeauthenticatedFlag=1<<o.Component.FlagShift+2,e.FlagShift=o.Component.FlagShift+3,e.FlagMask=(1<<e.FlagShift)-1,e})(),$=(()=>{var e;let t,r,i=Y,n=[],s=[],a=[];return e=class extends i{constructor(e){super(e),this.socket=void z(this,n),this.wsConstructor=z(this,s,void 0),this.wsProtocols=z(this,a,void 0),this.socket=null}push(e){if(this.connected){this.idleTimer.cancel();const t=e.toRecon();this.socket.send(t),this.idleTimer.watch()}else if(e instanceof x){if(this.sendBuffer.length>=this.sendBufferSize.value)throw new Error("send buffer overflow");this.sendBuffer.push(e),!this.connected&&this.online.value&&this.connect()}}connect(){this.reconnectTimer.cancel();let e=this.socket;if(null!==e)return;let t=this.hostUri;const r=t.schemeName;"warp"===r||"swim"===r?t=t.withSchemeName("ws"):"warps"!==r&&"swims"!==r||(t=t.withSchemeName("wss"));const i=this.wsConstructor.getValue(),n=this.wsProtocols.value;e=void 0!==n?new i(t.toString(),n):new i(t.toString()),e.onopen=this.onWebSocketOpen.bind(this),e.onmessage=this.onWebSocketMessage.bind(this),e.onclose=this.onWebSocketClose.bind(this),e.onerror=this.onWebSocketError.bind(this),this.socket=e}disconnect(){const e=this.socket;null!==e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,this.socket=null,e.close()),this.setConnected(!1)}onWebSocketOpen(){this.setConnected(!0)}onWebSocketMessage(e){const t=e.data;if("string"==typeof t){const e=b.parseRecon(t);null!==e?this.onEnvelope(e):this.onUnknownEnvelope(t)}}onWebSocketClose(){const e=this.socket;null!==e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,this.socket=null),this.connected?this.setConnected(!1):(this.idleTimer.cancel(),this.idle?this.close():this.reconnect())}onWebSocketError(){null!==this.socket&&(this.socket.close(),this.online.value?this.didFail():this.onWebSocketClose())}},(()=>{var u;const l="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=i[Symbol.metadata])&&void 0!==u?u:null):void 0;t=[o.Property({value:"undefined"!=typeof WebSocket?WebSocket:M,inherits:!0,equalValues:(e,t)=>e===t})],r=[o.Property({inherits:!0})],F(null,null,t,{kind:"field",name:"wsConstructor",static:!1,private:!1,access:{has:e=>"wsConstructor"in e,get:e=>e.wsConstructor,set:(e,t)=>{e.wsConstructor=t}},metadata:l},s,n),F(null,null,r,{kind:"field",name:"wsProtocols",static:!1,private:!1,access:{has:e=>"wsProtocols"in e,get:e=>e.wsProtocols,set:(e,t)=>{e.wsProtocols=t}},metadata:l},a,n),l&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l})})(),e})();class G extends Y{constructor(e,t){super(e),this.worker=t,this.port=null,this.onWorkerReceive=this.onWorkerReceive.bind(this),this.onPortReceive=this.onPortReceive.bind(this),this.worker.addEventListener("message",this.onWorkerReceive),this.worker.postMessage(c.create(this.hostUri).toLike())}push(e){if(this.connected)this.idleTimer.cancel(),this.port.postMessage(e.toLike()),this.idleTimer.watch();else if(e instanceof x){if(this.sendBuffer.length>=this.sendBufferSize.value)throw new Error("send buffer overflow");this.sendBuffer.push(e),!this.connected&&this.online.value&&this.connect()}}connect(){this.reconnectTimer.cancel();const e=this.port;null!==e&&e.postMessage(m.create(this.hostUri).toLike())}disconnect(){const e=this.port;null!==e&&e.postMessage(g.create(this.hostUri).toLike()),this.setConnected(!1)}onWorkerReceive(e){const t=n.Value.fromLike(e.data),r=l.fromValue(t);null!==r&&r.host.equals(this.hostUri)&&this.onSignal(r,e)}onPortReceive(e){const t=n.Value.fromLike(e.data),r=u.fromValue(t);null!==r?this.onMessage(r,e):this.onUnknownMessage(t)}onMessage(e,t){e instanceof l?this.onSignal(e,t):e instanceof b?this.onEnvelope(e):this.onUnknownMessage(e)}onSignal(e,t){e instanceof d?this.onOpenedSignal(e,t):e instanceof f?this.onClosedSignal(e):e instanceof w?this.onConnectedSignal(e):e instanceof y?this.onDisconnectedSignal(e):e instanceof v?this.onErrorSignal(e):this.onUnexpectedSignal(e)}onOpenedSignal(e,t){const r=t.ports[0];void 0!==r&&(this.port=r,r.addEventListener("message",this.onPortReceive),r.start())}onClosedSignal(e){const t=this.port;null!==t&&(this.port=null,t.removeEventListener("message",this.onPortReceive)),this.setConnected(!1)}onConnectedSignal(e){this.setConnected(!0)}onDisconnectedSignal(e){this.connected?this.setConnected(!1):(this.idleTimer.cancel(),this.idle?this.close():this.reconnect())}onErrorSignal(e){}onUnexpectedSignal(e){throw new Error("unexpected warp host signal: "+e)}onUnknownMessage(e){throw new Error("unknown warp host message: "+e)}}const _={[Symbol.hasInstance]:e=>i.Objects.hasAllKeys(e,"downlink","downlinkValue","downlinkList","downlinkMap")};let ee=(()=>{var e;let t,r,i,a,u,l=o.Component,h=[],c=[],d=[],p=[],f=[],m=[];return e=class extends l{constructor(){super(...arguments),this.hostUri=(z(this,h),z(this,c,void 0)),this.nodeUri=z(this,d,void 0),this.laneUri=z(this,p,void 0),this.warpRef=z(this,f,void 0),this.online=z(this,m,void 0)}downlink(e){let t=W;return void 0!==e&&(t=t.define("downlink",e)),t.create(this)}downlinkValue(e){let t=H;return void 0!==e&&(t=t.define("downlinkValue",e)),t.create(this)}downlinkList(e){let t=Z;return void 0!==e&&(t=t.define("downlinkList",e)),t.create(this)}downlinkMap(e){let t=J;return void 0!==e&&(t=t.define("downlinkMap",e)),t.create(this)}command(e,t,r,i){void 0===t?(i=n.Value.fromLike(e),r=this.laneUri.getValue(),t=this.nodeUri.getValue(),e=this.hostUri.value):void 0===r?(i=n.Value.fromLike(t),r=s.Uri.fromLike(e),t=this.nodeUri.getValue(),e=this.hostUri.value):void 0===i?(i=n.Value.fromLike(r),r=s.Uri.fromLike(t),t=s.Uri.fromLike(e),e=this.hostUri.value):(i=n.Value.fromLike(i),r=s.Uri.fromLike(r),t=s.Uri.fromLike(t),e=s.Uri.fromLike(e)),null===e&&(e=t.endpoint(),t=e.unresolve(t));this.warpRef.value.command(e,t,r,i)}authenticate(e,t){void 0===t?(t=n.Value.fromLike(e),e=this.hostUri.getValue()):(t=n.Value.fromLike(t),e=s.Uri.fromLike(e));this.warpRef.value.authenticate(e,t)}hostRef(t){t=s.Uri.fromLike(t);const r=new e;return r.hostUri.set(t),this.appendChild(r),r}nodeRef(t,r){void 0===r?(t=(r=s.Uri.fromLike(t)).endpoint()).isDefined()?r=t.unresolve(r):t=void 0:(r=s.Uri.fromLike(r),t=s.Uri.fromLike(t));const i=new e;return void 0!==t&&i.hostUri.set(t),void 0!==r&&i.nodeUri.set(r),this.appendChild(i),i}laneRef(t,r,i){void 0===r?(i=s.Uri.fromLike(t),r=void 0,t=void 0):void 0===i?(i=s.Uri.fromLike(r),(t=(r=s.Uri.fromLike(t)).endpoint()).isDefined()?r=t.unresolve(r):t=void 0):(i=s.Uri.fromLike(i),r=s.Uri.fromLike(r),t=s.Uri.fromLike(t));const n=new e;return void 0!==t&&n.hostUri.set(t),void 0!==r&&n.nodeUri.set(r),void 0!==i&&n.laneUri.set(i),this.appendChild(n),n}getDownlink(e,t,r){return this.warpRef.value.getDownlink(e,t,r)}openDownlink(e){this.warpRef.value.openDownlink(e)}},(()=>{var n;const w="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(n=l[Symbol.metadata])&&void 0!==n?n:null):void 0;t=[o.Property({valueType:s.Uri,value:null,inherits:!0})],r=[o.Property({valueType:s.Uri,value:null,inherits:!0})],i=[o.Property({valueType:s.Uri,value:null,inherits:!0})],a=[o.Property({valueType:_,inherits:!0,initValue(){if(!(this.owner instanceof te))return te.global()},equalValues:(e,t)=>e===t})],u=[o.Property({valueType:Boolean,value:!0,inherits:!0})],F(null,null,t,{kind:"field",name:"hostUri",static:!1,private:!1,access:{has:e=>"hostUri"in e,get:e=>e.hostUri,set:(e,t)=>{e.hostUri=t}},metadata:w},c,h),F(null,null,r,{kind:"field",name:"nodeUri",static:!1,private:!1,access:{has:e=>"nodeUri"in e,get:e=>e.nodeUri,set:(e,t)=>{e.nodeUri=t}},metadata:w},d,h),F(null,null,i,{kind:"field",name:"laneUri",static:!1,private:!1,access:{has:e=>"laneUri"in e,get:e=>e.laneUri,set:(e,t)=>{e.laneUri=t}},metadata:w},p,h),F(null,null,a,{kind:"field",name:"warpRef",static:!1,private:!1,access:{has:e=>"warpRef"in e,get:e=>e.warpRef,set:(e,t)=>{e.warpRef=t}},metadata:w},f,h),F(null,null,u,{kind:"field",name:"online",static:!1,private:!1,access:{has:e=>"online"in e,get:e=>e.online,set:(e,t)=>{e.online=t}},metadata:w},m,h),w&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:w})})(),e})(),te=(()=>{var e;let t,r,a,u,l,h,c,d,p,f,m=ee,w=[],g=[],y=[],v=[],b=[],k=[],S=[],O=[],C=[],x=[],T=[];return e=class extends m{constructor(){super(),this.sendBufferSize=(z(this,g),z(this,y,void 0)),this.maxReconnectTimeout=z(this,v,void 0),this.idleTimeout=z(this,b,void 0),this.unlinkDelay=z(this,k,void 0),this.wsConstructor=z(this,S,void 0),this.wsProtocols=z(this,O,void 0),this.workerUrl=z(this,C,void 0),this.warpRef=z(this,x,void 0),this.online=z(this,T,void 0),this.hostUri.setInherits(!1),this.nodeUri.setInherits(!1),this.laneUri.setInherits(!1),this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this)}command(e,t,r,i){void 0===t?(i=n.Value.fromLike(e),r=this.laneUri.getValue(),t=this.nodeUri.getValue(),e=this.hostUri.value):void 0===r?(i=n.Value.fromLike(t),r=s.Uri.fromLike(e),t=this.nodeUri.getValue(),e=this.hostUri.value):void 0===i?(i=n.Value.fromLike(r),r=s.Uri.fromLike(t),t=s.Uri.fromLike(e),e=this.hostUri.value):(i=n.Value.fromLike(i),r=s.Uri.fromLike(r),t=s.Uri.fromLike(t),e=s.Uri.fromLike(e)),null===e&&(e=t.endpoint(),t=e.unresolve(t));this.openHost(e).command(t,r,i)}authenticate(e,t){void 0===t?(t=n.Value.fromLike(e),e=this.hostUri.getValue()):(t=n.Value.fromLike(t),e=s.Uri.fromLike(e));this.openHost(e).authenticate(t)}getDownlink(e,t,r){const i=this.getHost(e);return null!==i?i.getDownlink(t,r):null}openDownlink(e){this.openHost(e.hostUri).openDownlink(e)}getHost(e){return e=s.Uri.fromLike(e),this.getChild(e.toString(),Y)}openHost(e){e=s.Uri.fromLike(e);let t=this.getChild(e.toString(),Y);return null===t&&(t=this.createHost(e),this.setChild(e.toString(),t)),t}createHost(e){let t=null;try{const r=this.workerUrl.value;if(void 0!==r){const i=new Worker(r,{name:e.toString(),type:"classic",credentials:"same-origin"});t=new G(e,i)}}catch(e){}return null===t&&(t=new $(e)),t}closeHost(e){e=s.Uri.fromLike(e);const t=this.getChild(e.toString(),Y);return null!==t&&this.removeChild(t),t}hostDidConnect(e){this.callObservers("clientDidConnect",e,this)}hostDidAuthenticate(e,t){this.callObservers("clientDidAuthenticate",e,t,this)}hostDidDeauthenticate(e,t){this.callObservers("clientDidDeauthenticate",e,t,this)}hostDidDisconnect(e){this.callObservers("clientDidDisconnect",e,this)}hostDidFail(e,t){this.callObservers("clientDidFail",e,t,this)}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof Y&&this.onInsertHost(e)}onInsertHost(e){e.observe(this)}onRemoveChild(e){super.onRemoveChild(e),e instanceof Y&&this.onRemoveHost(e)}onRemoveHost(e){e.unobserve(this)}onOnline(e){this.online.setIntrinsic(!0)}onOffline(e){this.online.setIntrinsic(!1)}onMount(){super.onMount(),"object"==typeof window&&(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline))}onUnmount(){super.onUnmount(),"object"==typeof window&&(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline))}static global(){const t=new e;return t.mount(),t}},(()=>{var n;const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(n=m[Symbol.metadata])&&void 0!==n?n:null):void 0;r=[o.Property({valueType:Number,value:1024})],a=[o.Property({valueType:Number,value:3e4})],u=[o.Property({valueType:Number,value:1e3})],l=[o.Property({valueType:Number,value:0})],h=[o.Property({value:"undefined"!=typeof WebSocket?WebSocket:M,equalValues:(e,t)=>e===t})],c=[o.Property({})],d=[o.Property({valueType:String,initValue(){if("undefined"==typeof Blob)return;const e=new Blob(['// @swim/client/webworker v4.0.0-dev.20220527.3 (c) 2015-2023 Nstream, inc.\n!function(){"use strict";const e=void 0;Symbol.toStringTag;function t(e,t,r,i,n,s){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,u=i.kind,h="getter"===u?"get":"setter"===u?"set":"value",l=!t&&e?i.static?e:e.prototype:null,c=t||(l?Object.getOwnPropertyDescriptor(l,i.name):{}),d=!1,p=r.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(e||null))};var w=(0,r[p])("accessor"===u?{get:c.get,set:c.set}:c[h],f);if("accessor"===u){if(void 0===w)continue;if(null===w||"object"!=typeof w)throw new TypeError("Object expected");(a=o(w.get))&&(c.get=a),(a=o(w.set))&&(c.set=a),(a=o(w.init))&&n.unshift(a)}else(a=o(w))&&("field"===u?n.unshift(a):c[h]=a)}l&&Object.defineProperty(l,i.name,c),d=!0}function r(e,t,r){for(var i=arguments.length>2,n=0;n<t.length;n++)r=i?t[n].call(e,r):t[n].call(e);return i?r:void 0}"function"==typeof SuppressedError&&SuppressedError;const i={fillBytes:"undefined"!=typeof window&&void 0!==window.crypto?function(e){window.crypto.getRandomValues(e)}:"undefined"!=typeof window&&void 0!==window.msCrypto?function(e){window.msCrypto.getRandomValues(e)}:function(e){if(e instanceof Int8Array)for(let t=0;t<e.length;t+=1)e[t]=128-Math.round(256*Math.random());else if(e instanceof Uint8Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(256*Math.random());else if(e instanceof Int16Array)for(let t=0;t<e.length;t+=1)e[t]=32768-Math.round(65536*Math.random());else if(e instanceof Uint16Array)for(let t=0;t<e.length;t+=1)e[t]=Math.round(65536*Math.random());else if(e instanceof Int32Array)for(let t=0;t<e.length;t+=1)e[t]=2147483648-Math.round(4294967296*Math.random());else{if(!(e instanceof Uint32Array))throw new TypeError(""+e);for(let t=0;t<e.length;t+=1)e[t]=Math.round(4294967296*Math.random())}}},n={get BigEndian(){return"BE"},get LittleEndian(){return"LE"},NativeEndian:void 0,get NativeOrder(){if(void 0===this.NativeEndian){const e=new ArrayBuffer(2);new Uint16Array(e)[0]=65279;const t=new Uint8Array(e);if(254===t[0]&&255===t[1])this.NativeEndian=this.BigEndian;else{if(255!==t[0]||254!==t[1])throw new Error;this.NativeEndian=this.LittleEndian}}return this.NativeEndian}},s={mix(e,t){return t=3432918353*(65535&t)+((3432918353*(t>>>16)&65535)<<16)&4294967295,e^=t=461845907*(65535&(t=this.rotl(t,15)))+((461845907*(t>>>16)&65535)<<16)&4294967295,e=27492+(65535&(e=5*(65535&(e=this.rotl(e,13)))+((5*(e>>>16)&65535)<<16)&4294967295))+((58964+(e>>>16)&65535)<<16)},mixUint8Array(e,t){if(n.NativeOrder===n.BigEndian)return this.mixUint8ArrayBE(e,t);if(n.NativeOrder===n.LittleEndian)return this.mixUInt8ArrayLE(e,t);throw new Error},mixUint8ArrayBE(e,t){let r=0;const i=t.length;for(;r+3<i;){const i=(255&t[r])<<24|(255&t[r+1])<<16|(255&t[r+2])<<8|255&t[r+3];e=this.mix(e,i),r+=4}if(r<i){let n=(255&t[r])<<24;r+1<i&&(n|=(255&t[r+1])<<16,r+2<i&&(n|=(255&t[r+2])<<8)),n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295,n=this.rotl(n,15),n=461845907*(65535&n)+((461845907*(n>>>16)&65535)<<16)&4294967295,e^=n}return e^i},mixUInt8ArrayLE(e,t){let r=0;const i=t.length;for(;r+3<i;){const i=255&t[r]|(255&t[r+1])<<8|(255&t[r+2])<<16|(255&t[r+3])<<24;e=this.mix(e,i),r+=4}if(r<i){let n=255&t[r];r+1<i&&(n|=(255&t[r+1])<<8,r+2<i&&(n|=(255&t[r+2])<<16)),n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295,n=this.rotl(n,15),n=461845907*(65535&n)+((461845907*(n>>>16)&65535)<<16)&4294967295,e^=n}return e^i},mixString(e,t){if(n.NativeOrder===n.BigEndian)return this.mixStringBE(e,t);if(n.NativeOrder===n.LittleEndian)return this.mixStringLE(e,t);throw new Error},mixStringBE(e,t){let r=0,i=32,n=0;const s=t.length;let o=0;for(;n<s;){let s=t.codePointAt(n);void 0===s&&(s=t.charCodeAt(n)),s>=0&&s<=127?(i-=8,r|=s<<i,0===i&&(e=this.mix(e,r),r=0,i=32),o+=1):s>=128&&s<=2047?(i-=8,r|=(192|s>>>6)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|63&s)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),o+=2):s>=2048&&s<=65535||s>=57344&&s<=65535?(i-=8,r|=(224|s>>>12)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|s>>>6&63)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|63&s)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),o+=3):s>=65536&&s<=1114111?(i-=8,r|=(240|s>>>18)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|s>>>12&63)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|s>>>6&63)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=(128|63&s)<<i,0===i&&(e=this.mix(e,r),r=0,i=32),o+=4):(i-=8,r|=239<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=191<<i,0===i&&(e=this.mix(e,r),r=0,i=32),i-=8,r|=189<<i,0===i&&(e=this.mix(e,r),r=0,i=32),o+=3),n=p.offsetByCodePoints(t,n,1)}return 32!==i&&(r=3432918353*(65535&r)+((3432918353*(r>>>16)&65535)<<16)&4294967295,r=this.rotl(r,15),r=461845907*(65535&r)+((461845907*(r>>>16)&65535)<<16)&4294967295,e^=r),e^o},mixStringLE(e,t){let r=0,i=0,n=0;const s=t.length;let o=0;for(;n<s;){let s=t.codePointAt(n);void 0===s&&(s=t.charCodeAt(n)),s>=0&&s<=127?(r|=s<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),o+=1):s>=128&&s<=2047?(r|=(192|s>>>6)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|63&s)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),o+=2):s>=2048&&s<=65535||s>=57344&&s<=65535?(r|=(224|s>>>12)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|s>>>6&63)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|63&s)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),o+=3):s>=65536&&s<=1114111?(r|=(240|s>>>18)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|s>>>12&63)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|s>>>6&63)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=(128|63&s)<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),o+=4):(r|=239<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=191<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),r|=189<<i,i+=8,32===i&&(e=this.mix(e,r),r=0,i=0),o+=3),n=p.offsetByCodePoints(t,n,1)}return 32!==i&&(r=3432918353*(65535&r)+((3432918353*(r>>>16)&65535)<<16)&4294967295,r=this.rotl(r,15),r=461845907*(65535&r)+((461845907*(r>>>16)&65535)<<16)&4294967295,e^=r),e^o},mash:e=>(e=2246822507*(65535&(e^=e>>>16))+((2246822507*(e>>>16)&65535)<<16)&4294967295,e=3266489909*(65535&(e^=e>>>13))+((3266489909*(e>>>16)&65535)<<16)&4294967295,(e^=e>>>16)>>>0),rotl:(e,t)=>e<<t|e>>>32-t},o=function(e,t){let r,i=!1;return function(){return i||(i=!0,r=e.call(this)),r}},a=function(){const e=function(t,r){return e[Symbol.hasInstance](t)?t.equals(r):t===r};return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return null!==e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.equals},enumerable:!0,configurable:!0}),e}(),u=function(){const e=function(e){return void 0===e?0:null===e?1:e.hashCode()};return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return null!==e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.hashCode},enumerable:!0,configurable:!0}),e}(),h=function(){const e=function(t,r,i){return e[Symbol.hasInstance](t)?t.equivalentTo(r,i):t===r};return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return null!==e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.equivalentTo},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Epsilon",{value:1e-8,enumerable:!0,configurable:!0}),e}(),l=function(){const e=function(e,t){return void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"function"==typeof e.compareTo?null==t?-1:e.compareTo(t):NaN};return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return null!==e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.compareTo},enumerable:!0,configurable:!0}),e}(),c={compare:(e,t)=>"boolean"==typeof e?"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN,hash(e){if(!0===e)return 3;if(!1===e)return 2;if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},fromLike:e=>null==e?e:Boolean(e)},d={equal:(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),equivalent:(e,t,r)=>e===t||"number"==typeof e&&"number"==typeof t&&(isNaN(e)&&isNaN(t)||Math.abs(t-e)<(void 0!==r?r:h.Epsilon)),compare:(e,t)=>"number"==typeof e?"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN,hash:function(){let e=null,t=null,r=null;return function(i){if("number"==typeof i)return i===~~i?~~i:(null===e&&(e=new ArrayBuffer(8),t=new Float64Array(e),r=new Int32Array(e)),t[0]=i,r[0]^r[1]);if(null===i)return 1;if(void 0===i)return 0;throw new TypeError(""+i)}}(),fromLike:e=>null==e?e:Number(e)},p={codePointAt(e,t){const r=e.length;if((t=t?Number(t):0)!=t&&(t=0),t>=0&&t<r){const i=e.charCodeAt(t);if(i<=55295||i>=57344)return i;if(i<=56319&&t+1<r){const r=e.charCodeAt(t+1);if(r>=56320&&r<=57343)return 65536+((1023&i)<<10+r&1023)}}},offsetByCodePoints(e,t,r){if(r>0){const i=e.length;for(;r>0&&t<i;){const n=e.charCodeAt(t);if(n<=55295||n>=57344)t+=1;else if(n<=56319&&t+1<i){const r=e.charCodeAt(t+1);t+=r>=56320&&r<=57343?2:1}else t+=1;r-=1}}else if(r<0)for(;r<0&&t>0;){const i=e.charCodeAt(t-1);if(i<=55295||i>=57344)t-=1;else if(i>=56320&&i<=57343&&t-1>0){const r=e.charCodeAt(t-2);t-=r>=55296&&r<=57343?2:1}else t-=1;r-=1}return t},compare:(e,t)=>"string"==typeof e?"string"==typeof t?e<t?-1:e>t?1:0:-1:null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN,hash(e){if("string"==typeof e)return s.mash(s.mixString(0,e));if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)},fromLike:e=>null==e?e:String(e)},f={compare(e,t){if("function"==typeof e){if("function"==typeof t){const r=f.hash(e),i=f.hash(t);return r<i?-1:r>i?1:0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(){let e=null,t=2;return function(r){if("function"==typeof r){null===e&&(e=new WeakMap);let i=e.get(r);return void 0===i&&(i=~~t,e.set(r,i),t+=1),i}if(null===r)return 1;if(void 0===r)return 0;throw new TypeError(""+r)}}()},m={compare(e,t){if("function"==typeof e){if("function"==typeof t){const r=m.hash(e),i=m.hash(t);return r<i?-1:r>i?1:0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash:function(){let e=null;return function(t){if("function"==typeof t){null===e&&(e=new WeakMap);let r=e.get(t);return void 0===r&&(r=s.mash(s.mixString(0,t.name)),e.set(t,r)),r}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)}}()},w={empty:o((function(){return Object.freeze([])})),inserted(e,t){const r=null!=t?t.length:0,i=new Array(r+1);for(let n=0;n<r;n+=1){const r=t[n];if(r===e)return t;i[n]=r}return i[r]=e,i},removed(e,t){const r=null!=t?t.length:0;if(0===r)return null!=t?t:w.empty();if(1===r)return t[0]!==e?t:w.empty();const i=new Array(r-1);let n=0;for(;n<r;){const s=t[n];if(s===e){for(n+=1;n<r;)i[n-1]=t[n],n+=1;return i}i[n]=s,n+=1}return t},equal(e,t){if(e===t)return!0;if(null!==e&&"object"==typeof e&&null!==t&&"object"==typeof t){const r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i+=1)if(!g.equal(e[i],t[i]))return!1;return!0}return!1},equivalent(e,t,r){if(e===t)return!0;if(null!==e&&"object"==typeof e&&null!==t&&"object"==typeof t){const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n+=1)if(!g.equivalent(e[n],t[n],r))return!1;return!0}return!1},compare(e,t){if(null!==e&&"object"==typeof e){if(null!==t&&"object"==typeof t){if(e===t)return 0;const r=e.length,i=t.length;let n=0;for(let s=0,o=Math.min(r,i);s<o&&0===n;s+=1)n=g.compare(e[s],t[s]);return 0!==n?n:r>i?1:r<i?-1:0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash(e){if("object"==typeof e&&null!==e){let t=0;for(let r=0;r<e.length;r+=1)t=s.mix(t,g.hash(e[r]));return s.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}},y={isEmpty(e){if(null!==e&&"object"==typeof e)for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},hasAnyKey(e,...t){if(null===e||"object"!=typeof e&&"function"!=typeof e)return!1;for(let r=0;r<t.length;r+=1)if(t[r]in e)return!0;return!1},hasAllKeys(e,...t){if(null===e||"object"!=typeof e&&"function"!=typeof e)return!1;for(let r=0;r<t.length;r+=1)if(!(t[r]in e))return!1;return!0},inserted(e,t,r,i){let n=!1;const s={};for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const a=e[o];n||a!==i||(s[t]=r,n=!0),s[o]=a}return n||(s[t]=r),s},getFirstKey(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return t},getFirstValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},getNextKey(e,t){let r=!1;for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(r)return i;i===t&&(r=!0)}},getNextValue(e,t){let r=!1;for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(r)return e[i];i===t&&(r=!0)}},equal(e,t){if(e===t)return!0;if(null!==e&&"object"==typeof e&&null!==t&&"object"==typeof t){const r=Object.keys(e),i=Object.keys(t),n=r.length;if(n!==i.length)return!1;for(let s=0;s<n;s+=1){const n=r[s];if(n!==i[s]||!g.equal(e[n],t[n]))return!1}return!0}return!1},equivalent(e,t,r){if(e===t)return!0;if(null!==e&&"object"==typeof e&&null!==t&&"object"==typeof t){const i=Object.keys(e),n=Object.keys(t),s=i.length;if(s!==n.length)return!1;for(let o=0;o<s;o+=1){const s=i[o];if(s!==n[o]||!g.equivalent(e[s],t[s],r))return!1}return!0}return!1},compare(e,t){if(null!==e&&"object"==typeof e){if(null!==t&&"object"==typeof t){if(e===t)return 0;const r=Object.keys(e),i=Object.keys(t),n=r.length,s=i.length,o=Math.min(n,s);let a=0;for(let n=0;n<o&&0===a;n+=1){const s=r[n],o=i[n];a=p.compare(s,o),0===a&&(a=g.compare(e[s],t[o]))}return 0!==a?a:n>s?1:n<s?-1:0}return-1}return null===e?void 0===t?-1:null===t?0:1:void 0===e?void 0===t?0:1:NaN},hash(e){if("object"==typeof e&&null!==e){let t=0;const r=Object.keys(e);for(let i=0;i<r.length;i+=1){const n=r[i];t=s.mix(s.mix(t,p.hash(n)),g.hash(e[n]))}return s.mash(t)}if(null===e)return 1;if(void 0===e)return 0;throw new TypeError(""+e)}},g={equal(e,t){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)}else{if(a[Symbol.hasInstance](e))return e.equals(t);if(Array.isArray(e)){if(Array.isArray(t))return w.equal(e,t)}else if(null!==e&&"object"==typeof e&&null!==t&&"object"==typeof t)return y.equal(e,t)}return!1},equivalent(e,t,r=h.Epsilon){if(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t)return!0;if("number"==typeof e){if("number"==typeof t)return isNaN(e)&&isNaN(t)||Math.abs(t-e)<r}else{if(h[Symbol.hasInstance](e))return e.equivalentTo(t,r);if(Array.isArray(e)){if(Array.isArray(t))return w.equivalent(e,t,r)}else if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t)return y.equivalent(e,t,r)}return!1},compare:(e,t)=>(e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),void 0===e?void 0===t?0:1:null===e?void 0===t?-1:null===t?0:1:"boolean"==typeof e?null==t?-1:"boolean"==typeof t?e&&!t?-1:!e&&t?1:0:1:"number"==typeof e?null==t||"boolean"==typeof t?-1:"number"==typeof t?e<t?-1:e>t?1:isNaN(t)?isNaN(e)?0:-1:isNaN(e)?1:0:1:"string"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t?-1:"string"==typeof t?e<t?-1:e>t?1:0:1:l[Symbol.hasInstance](e)?e.compareTo(t):"function"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t?-1:"function"==typeof t?f.compare(e,t):1:Array.isArray(e)?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t?-1:Array.isArray(t)?w.compare(e,t):1:"object"==typeof e?null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"function"==typeof t||Array.isArray(t)?-1:"object"==typeof t?y.compare(e,t):1:NaN),hash(e){if(e instanceof Date&&(e=e.getTime()),void 0===e)return 0;if(null===e)return 1;if(!1===e)return 2;if(!0===e)return 3;if("number"==typeof e)return d.hash(e);if("string"==typeof e)return p.hash(e);if(u[Symbol.hasInstance](e))return e.hashCode();if("function"==typeof e)return f.hash(e);if(Array.isArray(e))return w.hash(e);if("object"==typeof e)return y.hash(e);throw new TypeError(""+e)}};let b=(()=>{var e;let i,n=[];return e=class{set(e){throw new Error("immutable")}delete(){throw new Error("immutable")}[Symbol.iterator](){return this}static empty(){return new v}static unary(e){return new k(e)}static array(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new O(e,t,r)}static keys(e){return new x(e)}static values(e){return new S(e)}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class v extends b{isEmpty(){return!0}head(){throw new Error("empty")}step(){throw new Error("empty")}skip(e){}hasNext(){return!1}nextIndex(){return 0}next(){return{done:!0,value:void 0}}hasPrevious(){return!1}previousIndex(){return-1}previous(){return{done:!0,value:void 0}}}class k extends b{constructor(e){super(),this.value=e,this.index=0}isEmpty(){return 0!==this.index}head(){if(0!==this.index)throw new Error("empty");return this.value}step(){if(0!==this.index)throw new Error("empty");this.index=1}skip(e){this.index=Math.min(Math.max(0,this.index+e),1)}hasNext(){return 0===this.index}nextIndex(){return this.index}next(){return 0!==this.index?{done:!0,value:void 0}:(this.index=1,{done:!0,value:this.value})}hasPrevious(){return 1===this.index}previousIndex(){return this.index-1}previous(){return 1!==this.index?{done:!0,value:void 0}:(this.index=0,{done:!0,value:this.value})}}class O extends b{constructor(e,t,r){super(),this.array=e,this.index=t,this.limit=r}isEmpty(){return this.index>=this.limit}head(){if(this.index>=this.limit)throw new Error("empty");return this.array[this.index]}step(){if(this.index>=this.limit)throw new Error("empty");this.index+=1}skip(e){this.index=Math.min(this.index+e,this.limit)}hasNext(){return this.index<this.limit}nextIndex(){return this.index}next(){const e=this.index;return e>=this.limit?(this.index=this.limit,{done:!0,value:void 0}):(this.index+=1,{done:this.index===this.limit,value:this.array[e]})}hasPrevious(){return this.index>0}previousIndex(){return this.index-1}previous(){const e=this.index-1;return e<0?(this.index=0,{done:!0,value:void 0}):(this.index=e,{done:0===e,value:this.array[e]})}}class x extends b{constructor(e){super(),this.cursor=e}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[0]}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const e=this.cursor.next();return{done:e.done,value:void 0!==e.value?e.value[0]:void 0}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const e=this.cursor.previous();return{done:e.done,value:void 0!==e.value?e.value[0]:void 0}}delete(){this.cursor.delete()}}class S extends b{constructor(e){super(),this.cursor=e}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[1]}step(){this.cursor.step()}skip(e){this.cursor.skip(e)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const e=this.cursor.next();return{done:e.done,value:void 0!==e.value?e.value[1]:void 0}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const e=this.cursor.previous();return{done:e.done,value:void 0!==e.value?e.value[1]:void 0}}delete(){this.cursor.delete()}}const C=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.domain.equivalentTo(e.domain,r)&&this.range.equivalentTo(e.range,r))},t.prototype.toString=function(){return"Mapping("+this.domain+", "+this.range+")"},t}(Function);!function(e){const t=function(...e){const r=function(e){return r.interval(e)(e)};Object.setPrototypeOf(r,t.prototype);const i=e.length;if(0===i)throw new Error("no piecewise intervals");let n=e[0],s=n.domain,o=n.range;for(let t=1;t<i;t+=1)n=e[t],s=s.union(n.domain),o=o.union(n.range);return r.intervals=e,r.domain=s,r.range=o,r};t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.interval=function(e){const t=this.intervals;let r,i=0,n=t.length-1;for(;i<=n;){const s=i+n>>>1;r=t[s];const o=(0,r.domain)(e);if(o<0)n=s-1;else{if(!(o>=1))break;i=s+1}}return r},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){let e="Piecewise(";const t=this.intervals;for(let r=0;r<t.length;r+=1){0!==r&&(e+=", "),e+=t[r].toString()}return e+=")",e}}(C);const E=function(e){const t=function(e,r){const i=function(e){return g.equal(e,i[1])?1:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:()=>T.unit(),enumerable:!0,configurable:!0}),t.prototype.contains=function(e){return g.compare(this[0],e)<=0&&g.compare(e,this[1])<=0},t.prototype.union=function(e){const r=this[0],i=this[1],n=e[0],s=e[1],o=g.compare(r,n)<=0?r:n,a=g.compare(i,s)>=0?i:s;return t(o,a)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&g.equal(this[0],e[0])&&g.equal(this[1],e[1]))},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(g.equivalent(this[0],e[0],r)&&g.equivalent(this[1],e[1],r))},t.prototype.toString=function(){return"Domain("+this[0]+", "+this[1]+")"},t.unit=o((function(){return B(0,1)})),t}(C),T=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"domain",{get:()=>E.unit(),enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get(){return this},enumerable:!0,configurable:!0}),t.prototype.union=function(e){const r=this[0],i=this[1],n=e[0],s=e[1],o=g.compare(r,i),a=g.compare(n,s);let u,h;return o<=0&&a<=0?(u=g.compare(r,n)<=0?r:n,h=g.compare(i,s)>=0?i:s):o>=0&&a>=0?(u=g.compare(r,n)>=0?r:n,h=g.compare(i,s)<=0?i:s):o<=0&&a>=0?(u=g.compare(r,s)<=0?r:s,h=g.compare(i,n)>=0?i:n):(u=g.compare(i,n)<=0?i:n,h=g.compare(r,s)>=0?r:s),t(u,h)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&g.equal(this[0],e[0])&&g.equal(this[1],e[1]))},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(g.equivalent(this[0],e[0],r)&&g.equivalent(this[1],e[1],r))},t.prototype.toString=function(){return"Range("+this[0]+", "+this[1]+")"},t.unit=o((function(){return R(0,1)})),t}(C);!function(e){const t=function(e){const r=function(e){return r.value};return Object.setPrototypeOf(r,t.prototype),r.value=e,r};t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.value},enumerable:!0,configurable:!0}),t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&g.equal(this.value,e.value))},t.prototype.toString=function(){return"Constant("+this.value+")"}}(T);const P=function(){const e=function(t,r){return e[Symbol.hasInstance](t)?t.interpolateTo(r):null};return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return null!==e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.interpolateTo},enumerable:!0,configurable:!0}),e}(),D=function(e){const t=function(e,t){let r;return e===t?r=q(e):"number"==typeof e&&"number"==typeof t?r=A(e,t):Array.isArray(e)&&Array.isArray(t)?r=N(e,t):(r=P(e,t),null===r&&(r=I(e,t))),r};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.union=function(e){const r=this[0],i=this[1],n=e[0],s=e[1],o=g.compare(r,i),a=g.compare(n,s);let u,h;return o<=0&&a<=0?(u=g.compare(r,n)<=0?r:n,h=g.compare(i,s)>=0?i:s):o>=0&&a>=0?(u=g.compare(r,n)>=0?r:n,h=g.compare(i,s)<=0?i:s):o<=0&&a>=0?(u=g.compare(r,s)<=0?r:s,h=g.compare(i,n)>=0?i:n):(u=g.compare(i,n)<=0?i:n,h=g.compare(r,s)>=0?r:s),t(u,h)},t.prototype.map=function(e){return L(this,e)},t.prototype.interpolateTo=function(e){return e instanceof t?j(this,e):null},t.prototype.canEqual=function(e){return e instanceof this.constructor},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&g.equal(this[0],e[0])&&g.equal(this[1],e[1]))},t.prototype.toString=function(){return"Interpolator("+this[0]+", "+this[1]+")"},t}(T),L=function(e){const t=function(e,r){const i=function(e){return i.transform(i.interpolator(e))};return Object.setPrototypeOf(i,t.prototype),i.interpolator=e,i.transform=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.transform(this.interpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.transform(this.interpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.interpolator.equals(e.interpolator)&&this.transform===e.transform)},t}(D),q=function(e){const t=function(e){const r=function(e){return r.value};return Object.setPrototypeOf(r,t.prototype),r.value=e,r};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return this.value},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return this.value},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&this.value===e.value},t}(D),I=function(e){const t=function(e,r,i){const n=function(e){return e<n.phase?n[0]:n[1]};return Object.setPrototypeOf(n,t.prototype),void 0===i&&(i=1),n.phase=i,n[0]=e,n[1]=r,n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.phase===e.phase&&g.equal(this[0],e[0])&&g.equal(this[1],e[1]))},t}(D),A=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),N=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=t[i](e);return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=D(e[t],r[t]);return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][0];return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i][1];return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t!==e.interpolators.length)return!1;for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}return!1},t}(D),j=function(e){const t=function(e,r){const i=function(e){return 0===e?i[0]:1===e?i[1]:D(i[0](e),i[1](e))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),z=function(e){const t=function(e,r,i){const n=function(e){const t=n[0],r=n[1];return n.easing(Math.min(Math.max(0,(e-t)/(r-t)),1))};return Object.setPrototypeOf(n,t.prototype),n.easing=e,n[0]=r,n[1]=i,n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"duration",{get(){return this[1]-this[0]},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.withDomain=function(e,r){return t(this.easing,e,r)},t.prototype.withDuration=function(e){const r=this[0];return t(this.easing,r,r+e)},t.prototype.overRange=function(e,t){let r;return r=1===arguments.length?e:D(e,t),M(this,r)},t.prototype.union=function(e){return t(this.easing,Math.min(this[0],e[0]),Math.max(this[1],e[1]))},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this.easing.equals(e.easing)&&g.equal(this[0],e[0])&&g.equal(this[1],e[1]))},t.prototype.equivalentTo=function(e,r){return this===e||e instanceof t&&(this.easing.equivalentTo(e.easing,r)&&g.equivalent(this[0],e[0],r)&&g.equivalent(this[1],e[1],r))},t.prototype.toString=function(){return"Timing("+this.easing+", "+this[0]+", "+this[1]+")"},t.fromLike=function(e){if(null==e||"boolean"==typeof e||e instanceof t)return e;if("object"==typeof e)return this.fromInit(e);throw new TypeError(""+e)},t.fromInit=function(e){let r=e.easing;void 0===r?r=V.linear:"string"==typeof r&&(r=V(r));let i=e.t0;void 0===i&&(i=0);let n=e.t1;if(void 0===n){const t=e.dt;n=void 0!==t?i+t:i}return t(r,i,n)},t}(E),V=function(e){const t=function(e){switch(e){case"linear":return t.linear;case"quad-in":return t.quadIn;case"quad-out":return t.quadOut;case"quad-in-out":return t.quadInOut;case"cubic-in":return t.cubicIn;case"cubic-out":return t.cubicOut;case"cubic-in-out":return t.cubicInOut;case"quart-in":return t.quartIn;case"quart-out":return t.quartOut;case"quart-in-out":return t.quartInOut;case"expo-in":return t.expoIn;case"expo-out":return t.expoOut;case"expo-in-out":return t.expoInOut;case"circ-in":return t.circIn;case"circ-out":return t.circOut;case"circ-in-out":return t.circInOut;case"back-in":return t.backIn;case"back-out":return t.backOut;case"back-in-out":return t.backInOut;case"elastic-in":return t.elasticIn;case"elastic-out":return t.elasticOut;case"elastic-in-out":return t.elasticInOut;case"bounce-in":return t.bounceIn;case"bounce-out":return t.bounceOut;case"bounce-in-out":return t.bounceInOut;default:throw new Error("unknown easing function: "+e)}};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{value:0}),Object.defineProperty(t.prototype,1,{value:1}),Object.defineProperty(t.prototype,"easing",{get(){return this}}),t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e},t.prototype.equivalentTo=function(e,t){return this===e},t.prototype.toString=function(){return\'Easing("\'+this.type+\'")\'},t.fromLike=function(e){if(null==e||e instanceof t)return e;if("string"==typeof e)return t(e);throw new TypeError(""+e)},t.linear=function(e){return e},Object.setPrototypeOf(t.linear,t.prototype),t.linear.type="linear",t.quadIn=function(e){return e*e},Object.setPrototypeOf(t.quadIn,t.prototype),t.quadIn.type="quad-in",t.quadOut=function(e){return e*(2-e)},Object.setPrototypeOf(t.quadOut,t.prototype),t.quadOut.type="quad-out",t.quadInOut=function(e){return(e*=2)<=1?e*=e:(e-=1,e*=2-e,e+=1),e/=2},Object.setPrototypeOf(t.quadInOut,t.prototype),t.quadInOut.type="quad-in-out",t.cubicIn=function(e){return e*e*e},Object.setPrototypeOf(t.cubicIn,t.prototype),t.cubicIn.type="cubic-in",t.cubicOut=function(e){return e-=1,e*=e*e,e+=1},Object.setPrototypeOf(t.cubicOut,t.prototype),t.cubicOut.type="cubic-out",t.cubicInOut=function(e){return(e*=2)<=1?e*=e*e:(e-=2,e*=e*e,e+=2),e/=2},Object.setPrototypeOf(t.cubicInOut,t.prototype),t.cubicInOut.type="cubic-in-out",t.quartIn=function(e){return e*e*e*e},Object.setPrototypeOf(t.quartIn,t.prototype),t.quartIn.type="quart-in",t.quartOut=function(e){return 1-(e-=1)*e*e*e},Object.setPrototypeOf(t.quartOut,t.prototype),t.quartOut.type="quart-out",t.quartInOut=function(e){const t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t},Object.setPrototypeOf(t.quartInOut,t.prototype),t.quartInOut.type="quart-in-out",t.expoIn=function(e){return 0===e?0:Math.pow(2,10*(e-1))},Object.setPrototypeOf(t.expoIn,t.prototype),t.expoIn.type="expo-in",t.expoOut=function(e){return 1===e?1:1-Math.pow(2,-10*e)},Object.setPrototypeOf(t.expoOut,t.prototype),t.expoOut.type="expo-out",t.expoInOut=function(e){return 1===e||0===e?e:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))},Object.setPrototypeOf(t.expoInOut,t.prototype),t.expoInOut.type="expo-in-out",t.circIn=function(e){return-1*(Math.sqrt(1-e/1*e)-1)},Object.setPrototypeOf(t.circIn,t.prototype),t.circIn.type="circ-in",t.circOut=function(e){return e-=1,Math.sqrt(1-e*e)},Object.setPrototypeOf(t.circOut,t.prototype),t.circOut.type="circ-out",t.circInOut=function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-e*e)-1);const t=e-2;return.5*(Math.sqrt(1-t*t)+1)},Object.setPrototypeOf(t.circInOut,t.prototype),t.circInOut.type="circ-in-out",t.backIn=function(e){const t=1.70158;return e*e*((t+1)*e-t)},Object.setPrototypeOf(t.backIn,t.prototype),t.backIn.type="back-in",t.backOut=function(e){const t=1.70158,r=e/1-1;return r*r*((t+1)*t+t)+1},Object.setPrototypeOf(t.backOut,t.prototype),t.backOut.type="back-out",t.backInOut=function(e){const t=2.5949095;if((e*=2)<1)return.5*e*e*((t+1)*e-t);const r=e-2;return.5*(r*r*((t+1)*r+t)+2)},Object.setPrototypeOf(t.backInOut,t.prototype),t.backInOut.type="back-in-out",t.elasticIn=function(e){if(0===e||1===e)return e;const t=e/1-1,r=(1-.7)/2*Math.PI*Math.asin(1);return-Math.pow(2,10*t)*Math.sin(2*(t-r)*Math.PI/(1-.7))},Object.setPrototypeOf(t.elasticIn,t.prototype),t.elasticIn.type="elastic-in",t.elasticOut=function(e){if(0===e||1===e)return e;const t=(1-.7)/(2*Math.PI)*Math.asin(1);return e*=2,Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/(1-.7))+1},Object.setPrototypeOf(t.elasticOut,t.prototype),t.elasticOut.type="elastic-out",t.elasticInOut=function(e){if(0===e||1===e)return e;const t=.65,r=(1-t)/(2*Math.PI)*Math.asin(1),i=2*e,n=i-1;return i<1?Math.pow(2,10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*-.5:Math.pow(2,-10*n)*Math.sin(2*(n-r)*Math.PI/(1-t))*.5+1},Object.setPrototypeOf(t.elasticInOut,t.prototype),t.elasticInOut.type="elastic-in-out",t.bounceIn=function(e){const t=7.5625;return(e=1-e)<1/2.75?1-t*e*e:e<2/2.75?1-(t*(e-=1.5/2.75)*e+.75):e<2.5/2.75?1-(t*(e-=2.25/2.75)*e+.9375):1-(t*(e-=2.625/2.75)*e+.984375)},Object.setPrototypeOf(t.bounceIn,t.prototype),t.bounceIn.type="bounce-in",t.bounceOut=function(e){const t=7.5625;return e<1/2.75?t*e*e:e<2/2.75?t*(e-=1.5/2.75)*e+.75:e<2.5/2.75?t*(e-=2.25/2.75)*e+.9375:t*(e-=2.625/2.75)*e+.984375},Object.setPrototypeOf(t.bounceOut,t.prototype),t.bounceOut.type="bounce-out",t.bounceInOut=function(e){const t=e<.5,r=7.5625;return(e=t?1-2*e:2*e-1)<1/2.75?e*=r*e:e=e<2/2.75?r*(e-=1.5/2.75)*e+.75:e<2.5/2.75?r*(e-=2.25/2.75)*e+.9375:r*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5},Object.setPrototypeOf(t.bounceInOut,t.prototype),t.bounceInOut.type="bounce-in-out",t}(z),M=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.withDomain=function(e,t){return this.domain.withDomain(e,t).overRange(this.range)},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Tweening("+this.domain+", "+this.range+")"},t}(C),F=function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"ContinuousScale("+this.domain+", "+this.range+")"},t}(function(e){const t=function(){throw new Error};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"Scale("+this.domain+", "+this.range+")"},t}(C)),B=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1]-t;return 0!==r?(e-t)/r:0};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return R(this[0],this[1])},configurable:!0}),t.prototype.contains=function(e){return this[0]<=e&&e<=this[1]},t.prototype.union=function(e){return t(Math.min(this[0],e[0]),Math.max(this[1],e[1]))},t.prototype.interpolateTo=function(e){return e instanceof t?U(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearDomain("+this[0]+", "+this[1]+")"},t}(E),U=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return B(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),R=function(e){const t=function(e,r){const i=function(e){const t=i[0];return t+e*(i[1]-t)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return B(this[0],this[1])},configurable:!0}),t.prototype.union=function(e){const r=this[0],i=this[1],n=e[0],s=e[1];let o,a;return r<=i&&n<=s?(o=Math.min(r,n),a=Math.max(i,s)):r>=i&&n>=s?(o=Math.max(r,n),a=Math.min(i,s)):r<=i&&n>=s?(o=Math.min(r,s),a=Math.max(i,n)):(o=Math.min(i,n),a=Math.max(r,s)),t(o,a)},t.prototype.interpolateTo=function(e){return e instanceof t?W(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(e.canEqual(this)&&this[0]===e[0]&&this[1]===e[1])},t.prototype.toString=function(){return"LinearRange("+this[0]+", "+this[1]+")"},t}(T),W=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=t[0],n=t[1],s=i[1],o=s[0],a=s[1];return R(r+e*(o-r),n+e*(a-n))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D),H=function(e){const t=function(e,r){const i=function(e){return i.range(i.domain(e))};return Object.setPrototypeOf(i,t.prototype),i.domain=e,i.range=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,"inverse",{get(){return t(this.range.inverse,this.domain.inverse)},configurable:!0}),t.prototype.withDomain=function(e,r){let i;return i=1===arguments.length?e:B(e,r),t(i,this.range)},t.prototype.overRange=function(e,r){let i;return i=1===arguments.length?e:R(e,r),t(this.domain,i)},t.prototype.clampDomain=function(e,r,i,n,s){void 0===s&&(s=h.Epsilon);let o=this.domain[0],a=this.domain[1];void 0!==e&&void 0!==r&&Math.abs(a-o)>r-e?o<a?(o=e,a=r):(a=e,o=r):(void 0!==e&&(o<a&&o<e?(a+=e-o,o=e):a<o&&a<e&&(o+=e-a,a=e)),void 0!==r&&(o<a&&a>r?(o-=a-r,a=r):a<o&&o>r&&(a-=o-r,o=r)));const u=this(o),l=this(a),c=u<l?l-u:u-l,d=Math.abs(c/(a-o));if(void 0!==i&&d<1/i){const e=c*i,t=o+a;o=(t-e)/2,a=(t+e)/2}else if(void 0!==n&&d>1/n){const e=c*n,t=o+a;o=(t-e)/2,a=(t+e)/2}return Math.abs(o-this.domain[0])<s&&Math.abs(a-this.domain[1])<s?this:t(B(o,a),this.range)},t.prototype.solveDomain=function(e,r,i,n,s,o){void 0===o&&(o=h.Epsilon);const a=this.domain[1]-this.domain[0],u=this.range[0],l=this.range[1];let c;void 0===i||void 0===n||Math.abs(i-e)<o||Math.abs(n-r)<o?c=(l-u)/(0!==a?a:o):(c=(n-r)/(i-e),void 0!==s&&s||c<0==(l-u)/a<0||(c=-c));const d=r-c*e,p=(u-d)/c,f=(l-d)/c;return Math.abs(p-this.domain[0])<o&&Math.abs(f-this.domain[1])<o?this:t(B(p,f),this.range)},t.prototype.interpolateTo=function(e){return e instanceof t?Z(this,e):null},t.prototype.canEqual=function(e){return e instanceof t},t.prototype.equals=function(e){return this===e||e instanceof t&&(this.domain.equals(e.domain)&&this.range.equals(e.range))},t.prototype.toString=function(){return"LinearScale("+this.domain+", "+this.range+")"},t}(F),Z=function(e){const t=function(e,r){const i=function(e){const t=i[0],r=i[1],n=t.domain,s=n[0],o=n[1],a=r.domain,u=a[0],h=a[1],l=B(s+e*(u-s),o+e*(h-o)),c=t.range,d=c[0],p=c[1],f=r.range,m=f[0],w=f[1],y=R(d+e*(m-d),p+e*(w-p));return H(l,y)};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class Q{constructor(e,t){this.level=e,this.label=t}isTrace(){return this.level===Q.TraceLevel}isDebug(){return this.level===Q.DebugLevel}isInfo(){return this.level===Q.InfoLevel}isNote(){return this.level===Q.NoteLevel}isWarning(){return this.level===Q.WarningLevel}isError(){return this.level===Q.ErrorLevel}isAlert(){return this.level===Q.AlertLevel}isFatal(){return this.level===Q.FatalLevel}compareTo(e){return this===e?0:e instanceof Q?this.level<e.level?-1:this.level>e.level?1:this.label.localeCompare(e.label):NaN}equals(e){return this===e||e instanceof Q&&(this.level===e.level&&this.label===e.label)}hashCode(){return s.mash(s.mix(s.mix(m.hash(Q),d.hash(this.level)),p.hash(this.label)))}toString(){return this.label}static create(e,t){switch(e){case this.TraceLevel:return this.trace(t);case this.DebugLevel:return this.debug(t);case this.InfoLevel:return this.info(t);case this.NoteLevel:return this.note(t);case this.WarningLevel:return this.warning(t);case this.ErrorLevel:return this.error(t);case this.AlertLevel:return this.alert(t);case this.FatalLevel:return this.fatal(t);default:throw new Error(""+e)}}static trace(e){return void 0===e||e===this.TraceLabel?(null===this.Trace&&(this.Trace=new Q(this.TraceLevel,this.TraceLabel)),this.Trace):new Q(this.TraceLevel,e)}static debug(e){return void 0===e||e===this.DebugLabel?(null===this.Debug&&(this.Debug=new Q(this.DebugLevel,this.DebugLabel)),this.Debug):new Q(this.DebugLevel,e)}static info(e){return void 0===e||e===this.InfoLabel?(null===this.Info&&(this.Info=new Q(this.InfoLevel,this.InfoLabel)),this.Info):new Q(this.InfoLevel,e)}static note(e){return void 0===e||e===this.NoteLabel?(null===this.Note&&(this.Note=new Q(this.NoteLevel,this.NoteLabel)),this.Note):new Q(this.NoteLevel,e)}static warning(e){return void 0===e||e===this.WarningLabel?(null===this.Warning&&(this.Warning=new Q(this.WarningLevel,this.WarningLabel)),this.Warning):new Q(this.WarningLevel,e)}static error(e){return void 0===e||e===this.ErrorLabel?(null===this.Error&&(this.Error=new Q(this.ErrorLevel,this.ErrorLabel)),this.Error):new Q(this.ErrorLevel,e)}static alert(e){return void 0===e||e===this.AlertLabel?(null===this.Alert&&(this.Alert=new Q(this.AlertLevel,this.AlertLabel)),this.Alert):new Q(this.AlertLevel,e)}static fatal(e){return void 0===e||e===this.FatalLabel?(null===this.Fatal&&(this.Fatal=new Q(this.FatalLevel,this.FatalLabel)),this.Fatal):new Q(this.FatalLevel,e)}}Q.TraceLevel=0,Q.DebugLevel=1,Q.InfoLevel=2,Q.NoteLevel=3,Q.WarningLevel=4,Q.ErrorLevel=5,Q.AlertLevel=6,Q.FatalLevel=7,Q.TraceLabel="trace",Q.DebugLabel="debug",Q.InfoLabel="info",Q.NoteLabel="note",Q.WarningLabel="warning",Q.ErrorLabel="error",Q.AlertLabel="alert",Q.FatalLabel="fatal",Q.Trace=null,Q.Debug=null,Q.Info=null,Q.Note=null,Q.Warning=null,Q.Error=null,Q.Alert=null,Q.Fatal=null;Symbol.toStringTag;class G{}let X=(()=>{var e;let i,n=G,a=[];return e=class extends n{constructor(e,t,r,i){super(),this.offset=e,this.line=t,this.column=r,this.note=i}withNote(t){return this.note!==t?e.at(this.offset,this.line,this.column,t):this}min(e){return this.offset<=e.offset?this:e}max(e){return this.offset>=e.offset?this:e}get start(){return this}get end(){return this}union(t){if(t instanceof e)return this.offset===t.offset&&this.line===t.line&&this.column===t.column?this:$.from(this,t);if(t instanceof $){const e=this.min(t.start),r=this.max(t.end);return e===t.start&&r===t.end?t:$.from(e,r)}throw new Error(t.toString())}shift(t){const r=this.offset+(this.offset-t.offset),i=this.line+(this.line-t.line);let n=this.column;return 1===i&&(n+=this.column-t.column),r===this.offset&&i===this.line&&n===this.column?this:e.at(r,i,n,this.note)}equals(t){return this===t||t instanceof e&&(this.offset===t.offset&&this.line===t.line&&this.column===t.column&&this.note===t.note)}hashCode(){return s.mash(s.mix(s.mix(s.mix(s.mix(m.hash(e),d.hash(this.offset)),d.hash(this.line)),d.hash(this.column)),p.hash(this.note)))}display(e){return e=(e=le.displayNumber(e,this.line)).write(58),e=le.displayNumber(e,this.column),void 0!==this.note&&(e=e.write(58).write(32).write(this.note)),e}debug(e){return e=e.write("Mark").write(".").write("at").write("("),e=(e=le.debugNumber(e,this.offset)).write(", "),e=(e=le.debugNumber(e,this.line)).write(", "),e=le.debugNumber(e,this.column),void 0!==this.note&&(e=e.write(", "),e=le.debugString(e,this.note)),e=e.write(")")}toString(){return le.display(this)}static get zero(){return new e(0,1,1,void 0)}static at(t,r,i,n){return new e(t,r,i,n)}},(()=>{var s;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(s=n[Symbol.metadata])&&void 0!==s?s:null):void 0;i=[o],t(e,null,i,{kind:"getter",name:"zero",static:!0,private:!1,access:{has:e=>"zero"in e,get:e=>e.zero},metadata:u},null,a),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,a)})(),e})();class $ extends G{constructor(e,t){super(),this.start=e,this.end=t}union(e){if(e instanceof X){const t=this.start.min(e),r=this.end.max(e);return t===this.start&&r===this.end?this:$.from(t,r)}if(e instanceof $){const t=this.start.min(e.start),r=this.end.max(e.end);return t===this.start&&r===this.end?this:$.from(t,r)}throw new Error(e.toString())}shift(e){const t=this.start.shift(e),r=this.end.shift(e);return t===this.start&&r===this.end?this:$.from(t,r)}equals(e){return this===e||e instanceof $&&(this.start.equals(e.start)&&this.end.equals(e.end))}hashCode(){return s.mash(s.mix(s.mix(m.hash($),this.start.hashCode()),this.end.hashCode()))}display(e){return void 0!==this.start.note&&(e=e.write(this.start.note).write(58).write(32)),e=(e=le.displayNumber(e,this.start.line)).write(58),e=(e=le.displayNumber(e,this.start.column)).write(45),e=(e=le.displayNumber(e,this.end.line)).write(58),e=le.displayNumber(e,this.end.column),void 0!==this.end.note&&(e=e.write(58).write(32).write(this.end.note)),e}debug(e){return e=e.write("Span").write(".").write("from").write("("),e=(e=this.start.debug(e)).write(", "),e=(e=this.end.debug(e)).write(")")}toString(){return le.display(this)}static from(e,t){if(e.offset>t.offset){const r=e;e=t,t=r}return new $(e,t)}}const K=function(){const e={reset:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(109)),e},bold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(109)),e},faint:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(50).write(109)),e},black:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(48).write(109)),e},red:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(49).write(109)),e},green:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(50).write(109)),e},yellow:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(51).write(109)),e},blue:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(52).write(109)),e},magenta:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(53).write(109)),e},cyan:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(54).write(109)),e},gray:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(48).write(59).write(51).write(55).write(109)),e},blackBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(48).write(109)),e},redBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(49).write(109)),e},greenBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(50).write(109)),e},yellowBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(51).write(109)),e},blueBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(52).write(109)),e},magentaBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(53).write(109)),e},cyanBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(54).write(109)),e},grayBold:function(e){return e.settings.isStyled()&&(e=e.write(27).write(91).write(49).write(59).write(51).write(55).write(109)),e}};return e}();let Y=(()=>{var e;let i,n,a,u,h=[];return e=class{constructor(e,t,r,i){Object.defineProperty(this,"lineSeparator",{value:e,enumerable:!0}),Object.defineProperty(this,"pretty",{value:t,enumerable:!0}),Object.defineProperty(this,"styled",{value:r,enumerable:!0}),Object.defineProperty(this,"precision",{value:i,enumerable:!0})}withLineSeparator(e){return this.copy(e,this.pretty,this.styled,this.precision)}isPretty(){return this.pretty}asPretty(e){return this.copy(this.lineSeparator,e,this.styled,this.precision)}isStyled(){return this.styled}asStyled(e){return this.copy(this.lineSeparator,this.pretty,e,this.precision)}withPrecision(e){return this.copy(this.lineSeparator,this.pretty,this.styled,e)}copy(t,r,i,n){return e.create(t,r,i,n)}canEqual(t){return t instanceof e}equals(t){return this===t||t instanceof e&&(t.canEqual(this)&&this.lineSeparator===t.lineSeparator&&this.pretty===t.pretty&&this.styled===t.styled&&this.precision===t.precision)}hashCode(){return s.mash(s.mix(s.mix(s.mix(s.mix(m.hash(e),p.hash(this.lineSeparator)),c.hash(this.pretty)),c.hash(this.styled)),d.hash(this.precision)))}debug(e){return e=e.write("OutputSettings").write(46),e=(e=this.pretty||this.styled?this.pretty&&!this.styled?e.write("pretty"):!this.pretty&&this.styled?e.write("styled"):e.write("prettyStyled"):e.write("standard")).write(40).write(41),this.lineSeparator!==le.lineSeparator&&(e=e.write(46).write("lineSeparator").write(40).display(this.lineSeparator).write(41)),-1!==this.precision&&(e=e.write(46).write("precision").write(40).display(this.precision).write(41)),e}toString(){return le.debug(this)}static standard(){return new e(le.lineSeparator,!1,!1,-1)}static pretty(){return new e(le.lineSeparator,!0,!1,-1)}static styled(){return new e(le.lineSeparator,!1,!0,-1)}static prettyStyled(){return new e(le.lineSeparator,!0,!0,-1)}static create(t,r,i,n){return"string"!=typeof t&&(t=le.lineSeparator),"boolean"!=typeof r&&(r=!1),"boolean"!=typeof i&&(i=!1),"number"!=typeof n&&(n=-1),t===le.lineSeparator&&-1===n?r||i?r&&!i?e.pretty():!r&&i?e.styled():e.prettyStyled():e.standard():new e(t,r,i,n)}static fromInit(t){return e.create(t.lineSeparator,t.isPretty,t.isStyled,t.precision)}static fromLike(t){return t instanceof e?t:"object"==typeof t&&null!==t?e.fromInit(t):e.standard()}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],a=[o],u=[o],t(e,null,i,{kind:"method",name:"standard",static:!0,private:!1,access:{has:e=>"standard"in e,get:e=>e.standard},metadata:s},null,h),t(e,null,n,{kind:"method",name:"pretty",static:!0,private:!1,access:{has:e=>"pretty"in e,get:e=>e.pretty},metadata:s},null,h),t(e,null,a,{kind:"method",name:"styled",static:!0,private:!1,access:{has:e=>"styled"in e,get:e=>e.styled},metadata:s},null,h),t(e,null,u,{kind:"method",name:"prettyStyled",static:!0,private:!1,access:{has:e=>"prettyStyled"in e,get:e=>e.prettyStyled},metadata:s},null,h),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,h)})(),e})();class J extends Error{constructor(e){super(e),Object.setPrototypeOf(this,J.prototype)}}let _=(()=>{var e;let i,n,a=[];return e=class{constructor(e){Object.defineProperty(this,"stripped",{value:e,enumerable:!0})}isStripped(){return this.stripped}asStripped(e){return this.copy(e)}copy(t){return e.create(t)}canEqual(t){return t instanceof e}equals(t){return this===t||t instanceof e&&(t.canEqual(this)&&this.stripped===t.stripped)}hashCode(){return s.mash(s.mix(m.hash(e),c.hash(this.stripped)))}debug(e){return e=e.write("InputSettings").write(46),e=(e=this.stripped?e.write("stripped"):e.write("standard")).write(40).write(41)}toString(){return le.debug(this)}static standard(){return new e(!1)}static stripped(){return new e(!0)}static create(t){return t?e.stripped():e.standard()}static fromLike(t){return t instanceof e?t:"object"==typeof t&&null!==t?e.create(t.isStripped):e.standard()}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"standard",static:!0,private:!1,access:{has:e=>"standard"in e,get:e=>e.standard},metadata:s},null,a),t(e,null,n,{kind:"method",name:"stripped",static:!0,private:!1,access:{has:e=>"stripped"in e,get:e=>e.stripped},metadata:s},null,a),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,a)})(),e})(),ee=(()=>{var e;let i,n,s=[];return e=class{trap(){throw new J}static empty(){return new pe(void 0,X.zero,_.standard())}static done(){return new fe(void 0,X.zero,_.standard())}static error(e){return new te(e,void 0,X.zero,_.standard())}},(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:a},null,s),t(e,null,n,{kind:"method",name:"done",static:!0,private:!1,access:{has:e=>"done"in e,get:e=>e.done},metadata:a},null,s),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),r(e,s)})(),e})();class te extends ee{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}head(){throw new J}step(){const e=new J("error step");return new te(e,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new J("error seek");return new te(t,this.id,this.mark,this.settings)}withId(e){return new te(this.error,e,this.mark,this.settings)}withMark(e){return new te(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new te(this.error,this.id,this.mark,e)}clone(){return this}}class re extends ee{constructor(e,t,r,i,n,s,o,a){super(),this.string=e,this.index=o,this.part=a,this.id=t,this.offset=r,this.line=i,this.column=n,this.settings=s}isCont(){return this.index<this.string.length}isEmpty(){return this.part&&this.index>=this.string.length}isDone(){return!this.part&&this.index>=this.string.length}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}head(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return void 0!==r?r:e.charCodeAt(t)}throw new J}step(){const e=this.string,t=this.index;if(t<e.length){const r=e.codePointAt(t);return this.index=p.offsetByCodePoints(e,t,1),this.offset+=this.index-t,10===r?(this.line+=1,this.column=1):this.column+=1,this}{const e=new J("invalid step");return new te(e,this.id,this.mark,this.settings)}}seek(e){if(void 0!==e){const t=this.index+(e.offset-this.offset);if(0<=t&&t<=this.string.length)return this.index=t,this.offset=e.offset,this.line=e.line,this.column=e.column,this;{const t=new J("invalid seek to "+e);return new te(t,this.id,this.mark,this.settings)}}return this.index=0,this.offset=0,this.line=1,this.column=1,this}withId(e){return this.id=e,this}get mark(){return X.at(this.offset,this.line,this.column)}withMark(e){return this.offset=e.offset,this.line=e.line,this.column=e.column,this}withSettings(e){return e=_.fromLike(e),this.settings=e,this}clone(){return new re(this.string,this.id,this.offset,this.line,this.column,this.settings,this.index,this.part)}static create(e){return new re(e,void 0,0,1,1,_.standard(),0,!1)}}class ie extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ie.prototype)}}let ne=(()=>{var e;let i,n,s=[];return e=class{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}display(e){return le.displayAny(this,e)}debug(e){return le.debugAny(this,e)}flush(){return this}push(...e){const t=e.length;for(let r=0;r<t;r+=1)this.write(e[r])}trap(){throw new ie}clone(){throw new Error}static full(){return new be(Y.standard())}static done(){return new ve(Y.standard())}static error(e){return new ke(e,Y.standard())}},(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"full",static:!0,private:!1,access:{has:e=>"full"in e,get:e=>e.full},metadata:a},null,s),t(e,null,n,{kind:"method",name:"done",static:!0,private:!1,access:{has:e=>"done"in e,get:e=>e.done},metadata:a},null,s),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),r(e,s)})(),e})();class se extends ne{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}writeln(e){return void 0!==e&&(this.string=this.string.concat(e)),this.string=this.string.concat(this.settings.lineSeparator),this}withSettings(e){return e=Y.fromLike(e),this.settings=e,this}bind(){return this.string}clone(){return new se(this.string,this.settings)}toString(){return this.string}}class oe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,oe.prototype)}}let ae=(()=>{var e;let i,n=[];return e=class{isCont(){return!0}isDone(){return!1}isError(){return!1}feed(e){throw new oe}fork(e){return this}bind(){throw new oe}trap(){throw new oe}asDone(){throw new oe}asError(){throw new oe}andThen(e){return new Ae(this,e)}static end(){return new Le}static done(e){return new qe(e)}static error(e){return new Ie(e)}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"end",static:!0,private:!1,access:{has:e=>"end"in e,get:e=>e.end},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})(),ue=class e extends ae{constructor(e,t,r=0){super(),this.value=e,this.input=t,this.index=r}feed(t){return new e(t,""+t)}pull(t){return e.write(t,this.value,this.input,this.index)}static write(t,r,i,n=0){const s=i.length;for(;n<s&&t.isCont();){let e=i.codePointAt(n);void 0===e&&(e=i.charCodeAt(n)),t=t.write(e),n=p.offsetByCodePoints(i,n,1)}return n===s?ae.done(r):t.isDone()?ae.error(new oe("truncated")):t.isError()?ae.error(t.trap()):new e(r,i,n)}};const he=function(){const e={stringInput:function(e){return re.create(e)},stringOutput:function(e,t){return void 0===t&&"string"!=typeof e?(t=e,e=""):"string"!=typeof e&&(e=""),t=Y.fromLike(t),new se(e,t)},stringWriter:function(e){return void 0===e?new ue(void 0,""):new ue(e,""+e)},writeString:function(e,t){return ue.write(e,void 0,""+t)},isAlpha:function(e){return e>=65&&e<=90||e>=97&&e<=122},isDigit:function(e){return e>=48&&e<=57},isSpace:function(e){return 32===e||9===e},isNewline:function(e){return 10===e||13===e},isWhitespace:function(t){return e.isSpace(t)||e.isNewline(t)}};return e}(),le=function(){const e={};return Object.defineProperty(e,"lineSeparator",{value:"\\n",enumerable:!0,configurable:!0}),e.display=function(e,t){if(void 0===e)return"undefined";if(null===e)return"null";if("number"==typeof e)return""+e;if("string"==typeof e)return e;if("function"==typeof e.display){let r=he.stringOutput(t);return r=e.display(r),r.bind()}return""+e},e.debug=function(t,r){if(void 0===t)return"undefined";if(null===t)return"null";if("number"==typeof t)return""+t;if("string"==typeof t){let i=he.stringOutput(r);return i=e.debugString(i,t),i.bind()}if("function"==typeof t.debug){let e=he.stringOutput(r);return e=t.debug(e),e.bind()}return""+t},e.displayAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.displayNumber(t,r):"string"==typeof r?t.write(r):"function"==typeof r.display?r.display(t):t.write(""+r)},e.debugAny=function(t,r){return t=void 0===r?t.write("undefined"):null===r?t.write("null"):"number"==typeof r?e.debugNumber(t,r):"string"==typeof r?e.debugString(t,r):"function"==typeof r.debug?r.debug(t):t.write(""+r)},e.displayNumber=function(t,r){if(isFinite(r)&&Math.floor(r)===r&&Math.abs(r)<2147483648)if(r<0&&(t=t.write(45)),r>-10&&r<10)t=t.write(48+Math.abs(r));else{const e=new Array(19);let i=r,n=18;for(;0!==i;)e[n]=Math.abs(i%10|0),i=i/10|0,n-=1;for(n+=1;n<19;)t=t.write(48+e[n]),n+=1}else t=t.write(e.decimal(r,t.settings.precision));return t},e.debugNumber=function(t,r){return e.displayNumber(t,r)},e.debugChar=function(t,r){switch(t=t.write(39),r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 39:t.write(92).write(39);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}return t=t.write(39)},e.debugString=function(t,r){t=t.write(34);let i=he.stringInput(r);for(;i.isCont();){const r=i.head();switch(r){case 8:t.write(92).write(98);break;case 9:t.write(92).write(116);break;case 10:t.write(92).write(110);break;case 12:t.write(92).write(102);break;case 13:t.write(92).write(114);break;case 34:t.write(92).write(34);break;case 92:t.write(92).write(92);break;default:t=r>=0&&r<=31||r>=127&&r<=159?t.write(92).write(117).write(e.encodeHex(r>>>12&15)).write(e.encodeHex(r>>>8&15)).write(e.encodeHex(r>>>4&15)).write(e.encodeHex(15&r)):t.write(r)}i=i.step()}return t=t.write(34)},e.encodeHex=function(e){return e<10?48+e:e-10+65},e.prefix=function(){const t=["y","z","a","f","p","n",String.fromCharCode(956),"m","","k","M","G","T","P","E"," Z","Y"];return function(r,i=1){if(isFinite(r)){const n=Math.abs(r).toExponential(),s=n.indexOf("e"),o=s>=0?+n.slice(s+1):NaN,a=3*Math.min(Math.max(-8,Math.floor(o/3)),8),u=Math.pow(10,-a)*r;let h=e.trimTrailingZeros(Math.abs(u).toFixed(i));return u<0&&0!=+h&&(h="-"+h),h+=t[8+a/3],h}return""+r}}(),e.decimal=function(t,r=-1){if(r>=0){let i=e.trimTrailingZeros(Math.abs(t).toFixed(r));return t<0&&0!=+i&&(i="-"+i),i}return""+t},e.trimTrailingZeros=function(e){let t,r=-1;for(let i=1;i<e.length;i+=1){const n=e.charCodeAt(i);if(46===n)r=i,t=i;else if(48===n)0===r&&(r=i),t=i;else if(n>=49&&n<=57)r>0&&(r=0);else if(r>0)break}return r>0&&(e=e.slice(0,r)+e.slice(t+1)),e},e.duration=function(e,t=" "){if(isFinite(e)){const r=1e3,i=60*r,n=60*i,s=24*n,o=7*s;let a,u,h,l,c;e>o&&(a=Math.floor(e/o),e%=o),e>s&&(u=Math.floor(e/s),e%=s),e>n&&(h=Math.floor(e/n),e%=n),e>i&&(l=Math.floor(e/i),e%=i),e>r&&(c=Math.floor(e/r),e%=r);let d="";return void 0!==a&&(d+=a+"w"),void 0!==u&&(d+=(0!==d.length?t:"")+u+"d"),void 0!==h&&(d+=(0!==d.length?t:"")+h+"h"),void 0!==l&&(d+=(0!==d.length?t:"")+l+"m"),void 0===c&&0!==e||(d+=(0!==d.length?t:"")+(void 0!==c?c:0)+"s"),0!==e&&0===d.length&&(d+=e+"ms"),d}return""+e},e}(),ce=function(){const e={isDigit:function(e){return e>=48&&e<=57},decodeDigit:function(e){if(e>=48&&e<=57)return e-48;{let t=he.stringOutput();throw t=t.write("Invalid base-10 digit: "),t=le.debugChar(t,e),new Error(t.bind())}},encodeDigit:function(e){if(e>=0&&e<=9)return 48+e;throw new Error(""+e)},countDigits:function(e){let t=0;do{t+=1,e=e/10|0}while(0!==e);return t},integerParser:function(){return new Ze(void 0,void 0,0)},parseInteger:function(e){return Ze.parse(e,void 0,void 0,0)},decimalParser:function(){return new Ze(void 0,void 0,1)},parseDecimal:function(e){return Ze.parse(e,void 0,void 0,1)},numberParser:function(){return new Ze},parseNumber:function(e){return Ze.parse(e)},integerWriter:function(e){return new Ge(void 0,void 0===e?0:e)},writeInteger:function(e,t){return Ge.write(e,void 0,t)}};return e}();class de{constructor(e,t,r,i,n,s){this.input=e,this.tag=t,this.severity=r,this.message=i,this.note=n,this.cause=s}lineDigits(){let e=ce.countDigits(this.tag.end.line);return null!==this.cause&&(e=Math.max(e,this.cause.lineDigits())),e}display(e){const t=this.input.clone(),r=this.tag.start,i=this.tag.end,n=this.severity,s=this.message,o=this.note,a=this.cause,u=this.lineDigits();return e=de.display(e,t,r,i,n,s,o,a,2,u)}static display(e,t,r,i,n,s,o,a,u,h){for(;;){void 0!==s&&(e=(e=de.displayMessage(e,n,s)).writeln()),e=(e=de.displayAnchor(e,t,r,h)).writeln();const l=de.displayContext(e,t,r,i,n,o,a,u,h),c=l[0];if(e=l[1],null===c)break;e=e.writeln(),t=c.input.clone(),r=c.tag.start,i=c.tag.end,n=c.severity,s=c.message,o=c.note,a=c.cause}return e}static displayMessage(e,t,r){return e=(e=de.formatSeverity(e,t)).write(t.label),e=K.reset(e),e=(e=K.bold(e)).write(58),void 0!==r&&(e=e.write(32).write(r)),e=K.reset(e)}static displayAnchor(e,t,r,i){e=(e=de.displayLineLeadArrow(e,i)).write(32);const n=t.id;return void 0!==n&&(e=le.displayAny(e,n)),e=e.write(58),e=(e=le.displayNumber(e,r.line)).write(58),e=(e=le.displayNumber(e,r.column)).writeln(),e=de.displayLineLead(e,i)}static displayContext(e,t,r,i,n,s,o,a,u){let h=o;const l=null!==o&&void 0===o.message&&g.equal(t.id,o.input.id)?r.offset<=o.tag.start.offset?-1:1:0;if(1===l){const t=de.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=(e=t[1]).writeln(),e=(e=de.displayLineLeadEllipsis(e,u)).writeln()}if(e=de.displayLines(e,t,r,i,n,a,u),void 0!==s&&(e=de.displayNote(e,s,u)),-1===l){e=e.writeln(),e=(e=de.displayLineLeadEllipsis(e,u)).writeln();const t=de.displayContext(e,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=t[0],e=t[1]}return[h,e]}static displayLines(e,t,r,i,n,s,o){const a=r.line,u=i.line;let h=t.line;for(;h<a;)de.consumeLineText(t,h),h+=1;if(u-a>2*s+2){for(;h<=a+s;)e=de.displayLine(e,t,r,i,n,h,o),h+=1;for(e=(e=de.displayLineLeadEllipsis(e,o)).write(32),e=(e=de.formatSeverity(e,n)).write(124),e=(e=K.reset(e)).writeln();h<u-s;)de.consumeLineText(t,h),h+=1}for(;h<=u;)e=de.displayLine(e,t,r,i,n,h,o),h+=1;return e}static displayNote(e,t,r){return e=e.writeln(),e=(e=de.displayLineLead(e,r)).writeln(),e=de.displayLineComment(e,"note",t,r)}static displayLine(e,t,r,i,n,s,o){return e=r.line===s&&i.line===s?de.displaySingleLine(e,t,r,i,n,s,o):r.line===s?de.displayStartLine(e,t,r,n,s,o):i.line===s?de.displayEndLine(e,t,i,n,s,o):de.displayMidLine(e,t,n,s,o)}static displaySingleLine(e,t,r,i,n,s,o){e=(e=de.displayLineLeadNumber(e,s,o)).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=de.displayLineText(e,t,s),e=(e=de.displayLineLead(e,o)).write(32);let a=1;for(;a<r.column;)e=e.write(32),a+=1;for(e=de.formatSeverity(e,n);a<=i.column;)e=e.write(94),a+=1;return void 0!==i.note&&(e=e.write(32).write(i.note)),e=K.reset(e)}static displayStartLine(e,t,r,i,n,s){e=(e=de.displayLineLeadNumber(e,n,s)).write(32).write(32).write(32);for(let r=1;r<t.column;r+=1)e=e.write(32);e=de.displayLineText(e,t,n),e=(e=de.displayLineLead(e,s)).write(32).write(32),e=(e=de.formatSeverity(e,i)).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=(e=K.reset(e)).writeln()}static displayEndLine(e,t,r,i,n,s){e=(e=de.displayLineLeadNumber(e,n,s)).write(32),e=(e=de.formatSeverity(e,i)).write(124),e=(e=K.reset(e)).write(32),e=de.displayLineText(e,t,n),e=(e=de.displayLineLead(e,s)).write(32),e=(e=de.formatSeverity(e,i)).write(124).write(95);let o=1;for(;o<r.column;)e=e.write(95),o+=1;return e=e.write(94),void 0!==r.note&&(e=e.write(32).write(r.note)),e=K.reset(e)}static displayMidLine(e,t,r,i,n){return e=(e=de.displayLineLeadNumber(e,i,n)).write(32),e=(e=de.formatSeverity(e,r)).write(124),e=(e=K.reset(e)).write(32),e=de.displayLineText(e,t,i)}static displayLineComment(e,t,r,i){return e=(e=de.displayLineLeadComment(e,i)).write(32),e=(e=K.bold(e)).write(t).write(58),e=K.reset(e),void 0!==r&&(e=e.write(32).write(r)),e}static displayLineLead(e,t){e=K.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(124),e=K.reset(e)}static displayLineLeadComment(e,t){e=K.blueBold(e);const r=1+t;for(let t=0;t<r;t+=1)e=e.write(32);return e=e.write(61),e=K.reset(e)}static displayLineLeadArrow(e,t){for(let r=0;r<t;r+=1)e=e.write(32);return e=(e=K.blueBold(e)).write(45).write(45).write(62),e=K.reset(e)}static displayLineLeadEllipsis(e,t){e=K.blueBold(e);for(let r=0;r<t;r+=1)e=e.write(46);return e=(e=K.reset(e)).write(32).write(32)}static displayLineLeadNumber(e,t,r){const i=r-ce.countDigits(t);for(let t=0;t<i;t+=1)e=e.write(32);return e=K.blueBold(e),e=(e=le.displayNumber(e,t)).write(32).write(124),e=K.reset(e)}static displayLineText(e,t,r){for(;t.isCont()&&t.line===r;)e=e.write(t.head()),t=t.step();return t.line===r&&(e=e.writeln()),e}static consumeLineText(e,t){for(;e.isCont()&&e.line===t;)e=e.step()}static formatSeverity(e,t){switch(t.level){case Q.FatalLevel:case Q.AlertLevel:case Q.ErrorLevel:e=K.redBold(e);break;case Q.WarningLevel:e=K.yellowBold(e);break;case Q.NoteLevel:e=K.greenBold(e);break;case Q.InfoLevel:e=K.cyanBold(e);break;case Q.DebugLevel:case Q.TraceLevel:default:e=K.magentaBold(e)}return e}toString(e){return le.display(this,e)}static create(e,t,r,i,n,s){return 3===arguments.length?(s=null,n=void 0,i=void 0):4===arguments.length?null===i||i instanceof de?(s=i,i=void 0):s=null:5===arguments.length?null===n||n instanceof de?(s=n,n=void 0):s=null:void 0===s&&(s=null),new de(e.clone(),t,r,i,n,s)}static message(e,t,r,i,n){2===arguments.length?(n=null,i=void 0,r=Q.error()):3===arguments.length?null===r||r instanceof de?(n=r,r=Q.error()):"string"==typeof r?(n=null,i=r,r=Q.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=Q.error()):null===i||i instanceof de?(n=i,i=void 0):n=null:void 0===n&&(n=null);const s=t.mark,o=t.clone();return o.seek(),new de(o,s,r,e,i,n)}static unexpected(e,t,r,i){let n;if(1===arguments.length?(i=null,t=Q.error()):2===arguments.length?null===t||t instanceof de?(i=t,t=Q.error()):"string"==typeof t?(i=null,r=t,t=Q.error()):i=null:3===arguments.length?"string"==typeof t?(i=r,r=t,t=Q.error()):null===r||r instanceof de?(i=r,r=void 0):i=null:void 0===i&&(i=null),e.isCont()){let t=he.stringOutput().write("unexpected").write(32);t=le.debugChar(t,e.head()),n=t.bind()}else n="unexpected end of input";const s=e.mark,o=e.clone();return o.seek(),new de(o,s,t,n,r,i)}static expected(e,t,r,i,n){2===arguments.length?(n=null,r=Q.error()):3===arguments.length?null===r||r instanceof de?(n=r,r=Q.error()):"string"==typeof r?(n=null,i=r,r=Q.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=Q.error()):null===i||i instanceof de?(n=i,i=void 0):n=null:void 0===n&&(n=null);let s=he.stringOutput().write("expected").write(32);s="number"==typeof e?le.debugChar(s,e):s.write(e),s=s.write(44).write(32).write("but found").write(32),s=t.isCont()?le.debugChar(s,t.head()):s.write("end of input");const o=s.bind(),a=t.mark,u=t.clone();return u.seek(),new de(u,a,r,o,i,n)}}class pe extends ee{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new fe(this.id,this.mark,this.settings)}head(){throw new J}step(){const e=new J("empty step");return new te(e,this.id,this.mark,this.settings)}seek(e){const t=new J("empty seek");return new te(t,this.id,this.mark,this.settings)}withId(e){return new pe(e,this.mark,this.settings)}withMark(e){return new pe(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new pe(this.id,this.mark,e)}clone(){return this}}class fe extends ee{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new pe(this.id,this.mark,this.settings):this}head(){throw new J}step(){const e=new J("done step");return new te(e,this.id,this.mark,this.settings)}seek(e){const t=new J("empty seek");return new te(t,this.id,this.mark,this.settings)}withId(e){return new fe(e,this.mark,this.settings)}withMark(e){return new fe(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new fe(this.id,this.mark,e)}clone(){return this}}let me=(()=>{var e;let i,n,s=ee,a=[];return e=class extends s{static empty(){return new we(void 0,X.zero,_.standard())}static done(){return new ye(void 0,X.zero,_.standard())}static error(e){return new ge(e,void 0,X.zero,_.standard())}},(()=>{var u;const h="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=s[Symbol.metadata])&&void 0!==u?u:null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:h},null,a),t(e,null,n,{kind:"method",name:"done",static:!0,private:!1,access:{has:e=>"done"in e,get:e=>e.done},metadata:h},null,a),h&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),r(e,a)})(),e})();class we extends me{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new ye(this.id,this.mark,this.settings)}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new J("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new J("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new J}set(e,t){throw new J}head(){throw new J}step(e){const t=new J("empty step");return new ge(t,this.id,this.mark,this.settings)}seek(e){const t=new J("empty seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new we(e,this.mark,this.settings)}withMark(e){return new we(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new we(this.id,this.mark,e)}clone(){return this}}class ye extends me{constructor(e,t,r){super(),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new we(this.id,this.mark,this.settings):this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new J("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new J("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new J}set(e,t){throw new J}head(){throw new J}step(e){const t=new J("done step");return new ge(t,this.id,this.mark,this.settings)}seek(e){const t=new J("done seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new ye(e,this.mark,this.settings)}withMark(e){return new ye(this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new ye(this.id,this.mark,e)}clone(){return this}}class ge extends me{constructor(e,t,r,i){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){if(0===e)return this;{const e=new J("invalid index");return new ge(e,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(e){if(0===e)return this;{const e=new J("invalid limit");return new ge(e,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new J}set(e,t){throw new J}head(){throw new J}step(e){const t=new J("error step");return new ge(t,this.id,this.mark,this.settings)}trap(){return this.error}seek(e){const t=new J("error seek");return new ge(t,this.id,this.mark,this.settings)}withId(e){return new ge(this.error,e,this.mark,this.settings)}withMark(e){return new ge(this.error,this.id,e,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(e){return e=_.fromLike(e),new ge(this.error,this.id,this.mark,e)}clone(){return this}}class be extends ne{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new ve(this.settings)}write(e){return new ke(new ie("full"),this.settings)}writeln(e){return new ke(new ie("full"),this.settings)}bind(){throw new ie}withSettings(e){return e=Y.fromLike(e),new be(e)}clone(){return this}}class ve extends ne{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new be(this.settings):this}write(e){return new ke(new ie("done"),this.settings)}writeln(e){return new ke(new ie("done"),this.settings)}bind(){throw new ie}withSettings(e){return e=Y.fromLike(e),new ve(e)}clone(){return this}}class ke extends ne{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}write(e){return this}writeln(e){return this}bind(){throw new ie}trap(){return this.error}withSettings(e){return e=Y.fromLike(e),new ke(this.error,e)}clone(){return this}}let Oe=(()=>{var e;let i,n,s=ne,a=[];return e=class extends s{writeln(e){return"string"==typeof e&&this.write(e),this.write(this.settings.lineSeparator)}flush(){return this}clone(){throw new Error}static full(){return new xe(Y.standard())}static done(){return new Se(Y.standard())}static error(e){return new Ce(e,Y.standard())}},(()=>{var u;const h="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=s[Symbol.metadata])&&void 0!==u?u:null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"full",static:!0,private:!1,access:{has:e=>"full"in e,get:e=>e.full},metadata:h},null,a),t(e,null,n,{kind:"method",name:"done",static:!0,private:!1,access:{has:e=>"done"in e,get:e=>e.done},metadata:h},null,a),h&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),r(e,a)})(),e})();class xe extends Oe{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(e){return e?this:new Se(this.settings)}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new ie("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new ie("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new ie}set(e,t){throw new ie}write(e){return new Ce(new ie("full"),this.settings)}writeln(e){return new Ce(new ie("full"),this.settings)}step(e=1){return 0===e?this:new Ce(new ie("invalid step"),this.settings)}bind(){throw new ie}withSettings(e){return e=Y.fromLike(e),new xe(e)}clone(){return this}}class Se extends Oe{constructor(e){super(),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(e){return e?new xe(this.settings):this}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new ie("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new ie("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new ie}set(e,t){throw new ie}write(e){return new Ce(new ie("done"),this.settings)}writeln(e){return new Ce(new ie("done"),this.settings)}step(e=1){return 0===e?this:new Ce(new ie("invalid step"),this.settings)}bind(){throw new ie}withSettings(e){return e=Y.fromLike(e),new Se(e)}clone(){return this}}class Ce extends Oe{constructor(e,t){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(e){return this}get index(){return 0}withIndex(e){return 0===e?this:new Ce(new ie("invalid index"),this.settings)}get limit(){return 0}withLimit(e){return 0===e?this:new Ce(new ie("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(e){return!1}get(e){throw new ie}set(e,t){throw new ie}write(e){return this}writeln(e){return this}step(e=1){return 0===e?this:new Ce(new ie("invalid step"),this.settings)}bind(){throw new ie}trap(){return this.error}withSettings(e){return e=Y.fromLike(e),new Ce(this.error,e)}clone(){return this}}class Ee extends Error{constructor(e){super(e instanceof de?e.message:e),Object.setPrototypeOf(this,Ee.prototype),this.diagnostic=e instanceof de?e:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class Te{isCont(){return!0}isDone(){return!1}isError(){return!1}fork(e){return this}bind(){throw new Ee}trap(){throw new Ee}asError(){throw new Ee}static done(e){return new Pe(e)}static error(e){return e instanceof Error?new De(e):new De(new Ee(e))}}class Pe extends Te{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}feed(e){return this}bind(){return this.value}}class De extends Te{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}feed(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}}class Le extends ae{constructor(){super()}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){throw new oe}asDone(){return this}andThen(e){return e}}class qe extends ae{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0})}isCont(){return!1}isDone(){return!0}pull(e){return this}bind(){return this.value}asDone(){return this}andThen(e){return e}}class Ie extends ae{constructor(e){super(),Object.defineProperty(this,"error",{value:e,enumerable:!0})}isCont(){return!1}isError(){return!0}pull(e){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}andThen(e){return this}}class Ae extends ae{constructor(e,t){super(),this.head=e,this.tail=t}pull(e){let t=this.head;return t.isCont()&&(t=t.pull(e)),t.isError()?t.asError():t.isDone()?this.tail.pull(e):new Ae(t,this.tail)}}class Ne extends ne{constructor(e,t,r){super(),this.array=e,this.size=t,this.settings=r}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e){const t=this.size,r=this.array;let i;return null===r||t+1>r.length?(i=new Uint8Array(Ne.expand(t+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[t]=e,this.size=t+1,this}throw new TypeError(""+e)}writeln(e){throw new TypeError(""+e)}toUint8Array(){const e=this.size,t=this.array;if(null!==t&&e===t.length)return t;{const r=new Uint8Array(e);return null!==t&&r.set(t.slice(0,e),0),this.array=r,r}}cloneArray(){const e=this.array;return null!==e?e.slice(0,this.size):null}withSettings(e){return e=Y.fromLike(e),this.settings=e,this}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class je extends Ne{constructor(e,t,r){super(e,t,r)}bind(){return this.toUint8Array()}clone(){return new je(this.cloneArray(),this.size,this.settings)}}class ze extends Oe{constructor(e,t,r,i,n){super(),this.array=e,this.index=t,this.limit=r,this.part=i,this.settings=n}isCont(){return this.index<this.limit}isFull(){return this.part&&this.index>=this.limit}isDone(){return!this.part&&this.index>=this.limit}isError(){return!1}isPart(){return this.part}asPart(e){return this.part=e,this}withIndex(e){return 0<=e&&e<=this.limit?(this.index=e,this):new Ce(new ie("invalid index"),this.settings)}withLimit(e){return 0<=e&&e<=this.array.length?(this.limit=e,this):new Ce(new ie("invalid limit"),this.settings)}get capacity(){return this.array.length}get remaining(){return this.limit-this.index}has(e){return 0<=e&&e<this.limit}get(e){if(0<=e&&e<this.limit)return this.array[e];throw new ie}set(e,t){if(!(0<=e&&e<this.limit))throw new ie;this.array[e]=t}write(e){if("number"==typeof e){const t=this.index;return t<this.limit?(this.array[t]=e,this.index+=1,this):new Ce(new ie("full"),this.settings)}return new Ce(new ie("binary output"),this.settings)}writeln(e){return new Ce(new ie("binary output"),this.settings)}step(e){const t=this.index+e;return 0<=t&&t<=this.limit?(this.index=t,this):new Ce(new ie("invalid step"),this.settings)}bind(){return new Uint8Array(this.array.buffer,0,this.index)}withSettings(e){return e=Y.fromLike(e),this.settings=e,this}clone(){return new ze(this.array,this.index,this.limit,this.part,this.settings)}static create(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),new ze(e,t,t+r,!1,Y.standard())}}const Ve=function(){const e={output:function(e,t){let r;return void 0===t&&"number"!=typeof e?(t=e,e=void 0):"number"!=typeof e&&(e=void 0),r="number"==typeof e?new Uint8Array(e):null,t=Y.fromLike(t),new je(r,0,t)},outputBuffer:function(e,t,r){return ze.create(e,t,r)}};return e}();let Me=(()=>{var e;let i,n,s,a,u=[];return e=class{isFatal(){return!1}isReplacement(){return!1}toString(){return le.debug(this)}static fatal(){return new Fe(!1)}static fatalNonZero(){return new Fe(!0)}static replacement(){return new Be(65533,!1)}static replacementNonZero(){return new Be(65533,!0)}},(()=>{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],s=[o],a=[o],t(e,null,i,{kind:"method",name:"fatal",static:!0,private:!1,access:{has:e=>"fatal"in e,get:e=>e.fatal},metadata:h},null,u),t(e,null,n,{kind:"method",name:"fatalNonZero",static:!0,private:!1,access:{has:e=>"fatalNonZero"in e,get:e=>e.fatalNonZero},metadata:h},null,u),t(e,null,s,{kind:"method",name:"replacement",static:!0,private:!1,access:{has:e=>"replacement"in e,get:e=>e.replacement},metadata:h},null,u),t(e,null,a,{kind:"method",name:"replacementNonZero",static:!0,private:!1,access:{has:e=>"replacementNonZero"in e,get:e=>e.replacementNonZero},metadata:h},null,u),h&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),r(e,u)})(),e})();class Fe extends Me{constructor(e){super(),Object.defineProperty(this,"nonZero",{value:e,enumerable:!0})}isFatal(){return!0}get replacementChar(){return 65533}isNonZero(){return this.nonZero}asNonZero(e){return e?Me.fatalNonZero():Me.fatal()}equals(e){return this===e||e instanceof Fe&&this.nonZero===e.nonZero}hashCode(){return s.mash(s.mix(m.hash(Fe),c.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"fatalNonZero":"fatal").write(40).write(41)}}class Be extends Me{constructor(e,t){super(),Object.defineProperty(this,"replacementChar",{value:e,enumerable:!0}),Object.defineProperty(this,"nonZero",{value:t,enumerable:!0})}isReplacement(){return!0}isNonZero(){return this.nonZero}asNonZero(e){return 65533===this.replacementChar?e?Me.replacementNonZero():Me.replacement():new Be(this.replacementChar,e)}equals(e){return this===e||e instanceof Be&&(this.replacementChar===e.replacementChar&&this.nonZero===e.nonZero)}hashCode(){return s.mash(s.mix(s.mix(m.hash(Be),d.hash(this.replacementChar)),c.hash(this.nonZero)))}debug(e){return e=e.write("UtfErrorMode").write(46).write(this.nonZero?"replacementNonZero":"replacement").write(40).write(41)}}let Ue=(()=>{var e;let i,n,s=[];return e=class{constructor(e){Object.defineProperty(this,"alphabet",{value:e,enumerable:!0})}encodeDigit(e){return this.alphabet.charCodeAt(e)}uint8ArrayWriter(e){return void 0===e?new $e(this,void 0,null):new $e(this,e,e)}writeUint8Array(e,t){return $e.write(e,this,void 0,t)}writeInteger(e,t,r=0){return Ke.write(e,this,void 0,t,r)}writeIntegerLiteral(e,t,r=0){return Ke.writeLiteral(e,this,void 0,t,r)}static get lowercase(){return new e("0123456789abcdef")}static get uppercase(){return new e("0123456789ABCDEF")}static isDigit(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}static decodeDigit(e){if(e>=48&&e<=57)return e-48;if(e>=65&&e<=70)return e-65+10;if(e>=97&&e<=102)return e-97+10;{let t=he.stringOutput();throw t=t.write("Invalid base-16 digit: "),t=le.debugChar(t,e),new Error(t.bind())}}static writeQuantum(t,r,i){const n=e.decodeDigit(r),s=e.decodeDigit(i);return t=t.write(n<<4|s)}static parser(e){return new Xe(e)}static parse(e,t){return Xe.parse(e,t)}static parseUint8Array(e){return Xe.parse(e,Ve.output())}},(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],t(e,null,i,{kind:"getter",name:"lowercase",static:!0,private:!1,access:{has:e=>"lowercase"in e,get:e=>e.lowercase},metadata:a},null,s),t(e,null,n,{kind:"getter",name:"uppercase",static:!0,private:!1,access:{has:e=>"uppercase"in e,get:e=>e.uppercase},metadata:a},null,s),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),r(e,s)})(),e})();class Re extends ne{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c1=r,this.c2=i,this.c3=n,this.have=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return this.output.isError()}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=this.c1,r=this.c2,i=this.c3,n=-1,s=this.have;if(e>=0)switch(s){case 0:t=255&e,s=1;break;case 1:r=255&e,s=2;break;case 2:i=255&e,s=3;break;case 3:n=255&e,s=4;break;default:throw new Error("unreachable")}if(0===t&&this.errorMode.isNonZero())return ne.error(new ie("unexpected NUL byte"));if(t>=0&&t<=127)this.output=this.output.write(t),this.have=0;else if(t>=194&&t<=244)if(t>=194&&t<=223&&r>=128&&r<=191)this.output=this.output.write((31&t)<<6|63&r),this.c1=-1,this.have=0;else if(224===t&&r>=160&&r<=191||t>=225&&t<=236&&r>=128&&r<=191||237===t&&r>=128&&r<=159||t>=238&&t<=239&&r>=128&&r<=191)if(i>=128&&i<=191)this.output=this.output.write((15&t)<<12|(63&r)<<6|63&i),this.c1=-1,this.c2=-1,this.have=0;else if(i>=0){if(this.errorMode.isFatal())return ne.error(new ie(Re.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ne.error(new ie(Re.invalid(t,r)));this.c2=r,this.have=2}else if(240===t&&r>=144&&r<=191||t>=241&&t<=243&&r>=128&&r<=191||244===t&&r>=128&&r<=143)if(i>=128&&i<=191)if(n>=128&&n<=191)this.have=4,this.output=this.output.write((7&t)<<18|(63&r)<<12|(63&i)<<6|63&n),this.c1=-1,this.c2=-1,this.c3=-1,this.have=0;else if(n>=0){if(this.errorMode.isFatal())return ne.error(new ie(Re.invalid(t,r,i,n)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=n,this.c2=-1,this.c3=-1,this.have=1}else{if(e<0||this.output.isDone())return ne.error(new ie(Re.invalid(t,r,i)));this.c3=i,this.have=3}else if(i>=0){if(this.errorMode.isFatal())return ne.error(new ie(Re.invalid(t,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(e<0||this.output.isDone())return ne.error(new ie(Re.invalid(t,r)));this.c2=r,this.have=2}else if(r>=0){if(this.errorMode.isFatal())return ne.error(new ie(Re.invalid(t,r)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=r,this.have=1}else{if(e<0||this.output.isDone())return ne.error(new ie(Re.invalid(t)));this.c1=t,this.have=1}else if(t>=0){if(this.errorMode.isFatal())return ne.error(new ie(Re.invalid(t)));this.output=this.output.write(this.errorMode.replacementChar),this.have=0}return this.output.isError()?this.output:this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}static invalid(e,t,r,i){let n=he.stringOutput();n=n.write("invalid UTF-8 code unit sequence: ");const s=Ue.uppercase;return s.writeIntegerLiteral(n,e,2),void 0!==t&&(n=n.write(" "),s.writeIntegerLiteral(n,t,2),void 0!==r&&(n=n.write(" "),s.writeIntegerLiteral(n,r,2),void 0!==i&&(n=n.write(" "),s.writeIntegerLiteral(n,i,2)))),n.bind()}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return 0===this.have?this.output.bind():this.write(-1).bind()}trap(){return this.output.trap()}clone(){return new Re(this.output.clone(),this.errorMode,this.c1,this.c2,this.c3,this.have)}static create(e,t){return void 0===t&&(t=Me.fatal()),new Re(e,t,-1,-1,-1,0)}}class We extends ne{constructor(e,t,r,i,n,s){super(),this.output=e,this.errorMode=t,this.c2=r,this.c3=i,this.c4=n,this.index=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return!1}isPart(){return this.output.isPart()}asPart(e){return this.output=this.output.asPart(e),this}write(e){if("number"==typeof e){let t=0,r=this.c2,i=this.c3,n=this.c4,s=this.output,o=this.index;for(;o<4;){if(!s.isCont())return ne.error(new ie("unable to flush buffered code units"));switch(o){case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}o+=1}if(e>=0&&e<=127)n=e,o=3;else if(e>=128&&e<=2047)i=192|e>>>6,n=128|63&e,o=2;else if(e>=2048&&e<=65535||e>=57344&&e<=65535)r=224|e>>>12,i=128|e>>>6&63,n=128|63&e,o=1;else{if(!(e>=65536&&e<=1114111))return this.errorMode.isFatal()?ne.error(new ie("invalid code point: "+e)):this.write(this.errorMode.replacementChar);t=240|e>>>18,r=128|e>>>12&63,i=128|e>>>6&63,n=128|63&e,o=0}do{switch(o){case 0:s=s.write(t);break;case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}this.output=s,o+=1}while(o<4&&s.isCont());return o<4&&(o<3&&(o<2&&(this.c2=r),this.c3=i),this.c4=n),this.output=s,this.index=o,this}if("string"==typeof e)return this.output=this.output.write(e),this;throw new TypeError(""+e)}flush(){let e=this.output,t=this.index;for(;t<4;){if(!e.isCont())return ne.error(new ie("unable to flush buffered code units"));switch(t){case 1:e=e.write(this.c2),this.c2=0;break;case 2:e=e.write(this.c3),this.c3=0;break;case 3:e=e.write(this.c4),this.c4=0;break;default:throw new Error("unreachable")}t+=1}return this.output=e,this.index=t,this}get settings(){return this.output.settings}withSettings(e){return this.output=this.output.withSettings(e),this}bind(){return this.output.bind()}clone(){return new We(this.output.clone(),this.errorMode,this.c2,this.c3,this.c4,this.index)}static create(e,t){return void 0===t&&(t=Me.fatal()),new We(e,t,0,0,0,4)}}const He=function(){const e={sizeOf:function(t,r){if("number"==typeof t||void 0===t){if("number"==typeof t){if(0===t&&void 0!==r&&r.isNonZero())return 2;if(t>=0&&t<=127)return 1;if(t>=128&&t<=2047)return 2;if(t>=2048&&t<=65535||t>=57344&&t<=65535)return 3;if(t>=65536&&t<=1114111)return 4}return void 0===r?3:r.isReplacement()?e.sizeOf(r.replacementChar):0}if("string"==typeof t){let i=0;for(let n=0;n<t.length;n=p.offsetByCodePoints(t,n,1))i+=e.sizeOf(t.charCodeAt(n),r);return i}throw new TypeError(""+t)},decodedOutput:function(e,t){return Re.create(e,t)},encodedOutput:function(e,t){return We.create(e,t)},decodedString:function(){return e.decodedOutput(he.stringOutput())}};return e}();class Ze extends Te{constructor(e=1,t=0,r=2,i=1){super(),this.sign=e,this.value=t,this.mode=r,this.step=i}feed(e){return Ze.parse(e,this.sign,this.value,this.mode,this.step)}static parse(e,t=1,r=0,i=2,n=1){let s=0;if(1===n)if(e.isCont())s=e.head(),45===s?(e=e.step(),t=-1):43===s&&(e=e.step(),t=1),n=2;else if(e.isDone())return Te.error(de.expected("number",e));if(2===n)if(e.isCont())if(s=e.head(),48===s)e=e.step(),n=4;else{if(!(s>=49&&s<=57)){if(i>0&&46===s){let r=he.stringOutput();return t<0&&(r=r.write(45)),Qe.parse(e,r,i)}return Te.error(de.expected("number",e))}e=e.step(),r=t*(s-48),n=3}else if(e.isDone())return Te.error(de.expected("number",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);){const i=10*r+t*(s-48);if(!(-9007199254740991<=i&&i<=9007199254740992))return Te.error(de.message("integer overflow",e));r=i,e=e.step()}if(e.isCont())n=4;else if(e.isDone())return Te.done(r)}if(4===n){if(e.isCont()){if(s=e.head(),i>0&&46===s||i>1&&(69===s||101===s)){let n=he.stringOutput();return n=t<0&&0===r?n.write(45).write(48):n.write(""+r),Qe.parse(e,n,i)}return Te.done(r)}if(e.isDone())return Te.done(r)}return new Ze(t,r,i,n)}}class Qe extends Te{constructor(e,t=2,r=1){super(),this.output=e,this.mode=t,this.step=r}feed(e){return Qe.parse(e,this.output,this.mode,this.step)}static parse(e,t,r=2,i=1){let n=0;if(1===i)if(e.isCont())if(n=e.head(),46===n)e=e.step(),t=t.write(n),i=2;else{if(!(r>1)||69!==n&&101!==n)return Te.error(de.expected("decimal or exponent",e));e=e.step(),t=t.write(n),i=5}else if(e.isDone())return Te.error(de.expected("decimal or exponent",e));if(2===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Te.error(de.expected("digit",e));e=e.step(),t=t.write(n),i=3}else if(e.isDone())return Te.error(de.expected("digit",e));if(3===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(e.isCont()){if(!(r>1))return Te.done(+t.bind());i=4}else if(e.isDone())return Te.done(+t.bind())}if(4===i){if(n=e.head(),69!==n&&101!==n)return Te.done(+t.bind());e=e.step(),t=t.write(n),i=5}if(5===i)if(e.isCont())n=e.head(),43!==n&&45!==n||(e=e.step(),t=t.write(n)),i=6;else if(e.isDone())return Te.error(de.unexpected(e));if(6===i)if(e.isCont()){if(n=e.head(),!(n>=48&&n<=57))return Te.error(de.expected("digit",e));e=e.step(),t=t.write(n),i=7}else if(e.isDone())return Te.error(de.expected("digit",e));if(7===i){for(;e.isCont()&&(n=e.head(),n>=48&&n<=57);)e=e.step(),t=t.write(n);if(!e.isEmpty())return Te.done(+t.bind())}return new Qe(t,r,i)}}class Ge extends ae{constructor(e,t,r=0,i=1){super(),this.value=e,this.input=t,this.index=r,this.step=i}pull(e){return Ge.write(e,this.value,this.input,this.index,this.step)}static write(e,t,r,i=0,n=1){if(0===n)return ae.end();if(1===n&&(r<0?e.isCont()&&(e=e.write(45),n=2):n=2),2===n)if(r>-10&&r<10){if(e.isCont())return e=e.write(ce.encodeDigit(Math.abs(0|r))),ae.done(t)}else{const n=new Array(19);let s=r,o=18;for(;0!==s;)n[o]=Math.abs(s%10|0),s=s/10|0,o-=1;for(o+=1+i;o<19&&e.isCont();)e=e.write(ce.encodeDigit(n[o])),i+=1,o+=1;if(19===o)return ae.done(t)}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Ge(t,r,i,n)}}class Xe extends Te{constructor(e,t=0,r=1){super(),this.output=e,this.p=t,this.step=r}feed(e){return Xe.parse(e,this.output.clone(),this.p,this.step)}static parse(e,t,r=0,i=1){let n=0;for(;!e.isEmpty();){if(1===i)if(e.isCont()&&(n=e.head(),Ue.isDigit(n)))e=e.step(),r=n,i=2;else if(!e.isEmpty())return Te.done(t.bind());if(2===i)if(e.isCont()&&(n=e.head(),Ue.isDigit(n)))e=e.step(),t=Ue.writeQuantum(t,r,n),r=0,i=1;else if(!e.isEmpty())return Te.error(de.expected("base16 digit",e))}return new Xe(t,r,i)}}class $e extends ae{constructor(e,t,r,i=0,n=1){super(),this.base16=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new $e(this.base16,void 0,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new oe;return $e.write(e,this.base16,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n<i.length;){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>4)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(15&r)),n+=1,s=1)}return n===i.length?ae.done(r):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new $e(t,r,i,n,s)}}class Ke extends ae{constructor(e,t,r,i,n=0,s=3){super(),this.base16=e,this.value=t,this.input=r,this.width=i,this.index=n,this.step=s}pull(e){return Ke.write(e,this.base16,this.value,this.input,this.width,this.index,this.step)}static write(e,t,r,i,n,s=0,o=3){if(o<=0)return ae.end();if(1===o&&e.isCont()&&(e=e.write(48),o=2),2===o&&e.isCont()&&(e=e.write(120),o=3),3===o)if(i>=0&&i<16&&n<=1){if(e.isCont())return e=e.write(t.encodeDigit(i)),ae.done(r)}else{let o=15;const a=new Array(16);let u=i;for(;0!==u||o>=16-n;)a[o]=15&u,u>>>=4,o-=1;for(o+=1+s;o<16&&e.isCont();)e=e.write(t.encodeDigit(a[o])),s+=1,o+=1;if(16===o)return ae.done(r)}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Ke(t,r,i,n,s,o)}static writeLiteral(e,t,r,i,n){return Ke.write(e,t,r,i,n,0,1)}}let Ye=(()=>{var e;let i,n,s,a,u=[];return e=class{decodeDigit(e){if(e>=65&&e<=90)return e-65;if(e>=97&&e<=122)return e+-71;if(e>=48&&e<=57)return e+4;if(43===e||45===e)return 62;if(47===e||95===e)return 63;{let t=he.stringOutput();throw t=t.write("Invalid base-64 digit: "),t=le.debugChar(t,e),new Error(t.bind())}}encodeDigit(e){return this.alphabet.charCodeAt(e)}writeQuantum(e,t,r,i,n){const s=this.decodeDigit(t),o=this.decodeDigit(r);if(61!==i){const t=this.decodeDigit(i);if(61!==n){const r=this.decodeDigit(n);e=(e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)).write(t<<6|r)}else e=(e=e.write(s<<2|o>>>4)).write(o<<4|t>>>2)}else{if(61!==n)return ne.error(new Error("Improperly padded base-64"));e=e.write(s<<2|o>>>4)}return e}parser(e){return new et(this,e)}parse(e,t){return et.parse(e,this,t)}parseUint8Array(e){return et.parse(e,this,Ve.output())}uint8ArrayWriter(e){return void 0===e?new tt(this,void 0,null):new tt(this,e,e)}writeUint8Array(e,t){return tt.write(e,this,void 0,t)}static get standardPadded(){return new Je(!0)}static get standardUnpadded(){return new Je(!1)}static standard(t=!0){return t?e.standardPadded:e.standardUnpadded}static get urlPadded(){return new _e(!0)}static get urlUnpadded(){return new _e(!1)}static url(t=!0){return t?e.urlPadded:e.urlUnpadded}},(()=>{const h="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],s=[o],a=[o],t(e,null,i,{kind:"getter",name:"standardPadded",static:!0,private:!1,access:{has:e=>"standardPadded"in e,get:e=>e.standardPadded},metadata:h},null,u),t(e,null,n,{kind:"getter",name:"standardUnpadded",static:!0,private:!1,access:{has:e=>"standardUnpadded"in e,get:e=>e.standardUnpadded},metadata:h},null,u),t(e,null,s,{kind:"getter",name:"urlPadded",static:!0,private:!1,access:{has:e=>"urlPadded"in e,get:e=>e.urlPadded},metadata:h},null,u),t(e,null,a,{kind:"getter",name:"urlUnpadded",static:!0,private:!1,access:{has:e=>"urlUnpadded"in e,get:e=>e.urlUnpadded},metadata:h},null,u),h&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),r(e,u)})(),e})();class Je extends Ye{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:Ye.standard(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||43===e||47===e}}class _e extends Ye{constructor(e){super(),Object.defineProperty(this,"padded",{value:e,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}isPadded(){return this.padded}asPadded(e){return e===this.padded?this:Ye.url(e)}isDigit(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||45===e||95===e}}class et extends Te{constructor(e,t,r=0,i=0,n=0,s=1){super(),this.base64=e,this.output=t,this.p=r,this.q=i,this.r=n,this.step=s}feed(e){return et.parse(e,this.base64,this.output.clone(),this.p,this.q,this.r,this.step)}static parse(e,t,r,i=0,n=0,s=0,o=1){let a=0;for(;!e.isEmpty();){if(1===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),i=a,o=2;else if(!e.isEmpty())return Te.done(r.bind());if(2===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)))e=e.step(),n=a,o=3;else if(!e.isEmpty())return Te.error(de.expected("base64 digit",e));if(3===o)if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a))e=e.step(),s=a,o=61!==a?4:5;else if(!e.isEmpty())return t.isPadded()?Te.error(de.unexpected(e)):(r=t.writeQuantum(r,i,n,61,61),Te.done(r.bind()));if(4===o){if(e.isCont()&&(a=e.head(),t.isDigit(a)||61===a)){if(e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,61===a)return Te.done(r.bind());o=1}else if(!e.isEmpty())return t.isPadded()?Te.error(de.unexpected(e)):(r=t.writeQuantum(r,i,n,s,61),Te.done(r.bind()))}else if(5===o){if(e.isCont()&&(a=e.head(),61===a))return e=e.step(),r=t.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,Te.done(r.bind());if(!e.isEmpty())return Te.error(de.expected(61,e))}}return new et(t,r,i,n,s,o)}}class tt extends ae{constructor(e,t,r,i=0,n=1){super(),this.base64=e,this.value=t,this.input=r,this.index=i,this.step=n}feed(e){if(e instanceof Uint8Array)return new tt(this.base64,null,e);throw new TypeError(""+e)}pull(e){if(null===this.input)throw new oe;return tt.write(e,this.base64,this.value,this.input,this.index,this.step)}static write(e,t,r,i,n=0,s=1){for(;n+2<i.length&&e.isCont();){const r=i[n],o=i[n+1],a=i[n+2];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(o<<2|a>>>6))),s=4),4===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&a)),n+=3,s=1)}if(n+1<i.length&&e.isCont()){const r=i[n],o=i[n+1];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&e.isCont()&&(e=e.write(t.encodeDigit(o<<2&63)),s=4),4===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),n+=2):n+=2)}else if(n<i.length&&e.isCont()){const r=i[n];1===s&&e.isCont()&&(e=e.write(t.encodeDigit(r>>>2)),s=2),2===s&&e.isCont()&&(e=e.write(t.encodeDigit(r<<4&63)),s=3),3===s&&(t.isPadded()?e.isCont()&&(e=e.write(61),s=4):n+=1),4===s&&e.isCont()&&(e=e.write(61),n+=1)}return n===i.length?ae.done(r):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new tt(t,r,i,n,s)}}let rt=(()=>{var e;let i,n=[];return e=class{constructor(){}updated(e,t){const r=dt.create(2);return r.push(this),r.set(e,t),r}updatedAttr(e,t){const r=dt.create(2);return r.push(this),r.setAttr(e,t),r}updatedSlot(e,t){const r=dt.create(2);return r.push(this),r.setSlot(e,t),r}appended(...e){const t=dt.create(1+arguments.length);return t.push(this),t.push(...e),t}prepended(...e){const t=dt.create(arguments.length+1);return t.push(...e),t.push(this),t}concat(...t){const r=dt.create();r.push(this);for(let i=0;i<t.length;i+=1)e.fromLike(t[i]).forEach((function(e){r.push(e)}));return r}lt(t){return t=e.fromLike(t),this.compareTo(t)<0?xt.from(!0):e.absent()}le(t){return t=e.fromLike(t),this.compareTo(t)<=0?xt.from(!0):e.absent()}eq(t){return t=e.fromLike(t),this.equals(t)?xt.from(!0):e.absent()}ne(t){return t=e.fromLike(t),this.equals(t)?e.absent():xt.from(!0)}ge(t){return t=e.fromLike(t),this.compareTo(t)>=0?xt.from(!0):e.absent()}gt(t){return t=e.fromLike(t),this.compareTo(t)>0?xt.from(!0):e.absent()}invoke(t){return e.absent()}filter(e){const t=sr.literal(this);return 0===arguments.length?t.filter():t.filter(e)}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}evaluate(e){return this}substitute(e){return this}cast(e,t){let r=e.cast(this);return void 0===r&&(r=t),r}coerce(e,t){let r=e.cast(this);return void 0===r&&(r=e.unit),void 0===r&&(r=t),r}get precedence(){return 11}forEach(e,t){return e.call(t,this,0)}iterator(){return b.unary(this)}[Symbol.iterator](){return this.iterator()}interpolateTo(t){return t instanceof e?it(this,t):null}display(e){return this.debug(e)}toString(){return le.debug(this)}static empty(){return dt.empty()}static extant(){return St.extant()}static absent(){return Ct.absent()}static fromLike(t){return t instanceof e?t:lt.fromLike(t)}static globalScope(){return dt.create(1).slot("math",br.scope).commit()}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"globalScope",static:!0,private:!1,access:{has:e=>"globalScope"in e,get:e=>e.globalScope},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();const it=function(e){const t=function(e,r){const i=function(e){return e<1?i[0]:i[1]};return Object.setPrototypeOf(i,t.prototype),i[0]=e.commit(),i[1]=r.commit(),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);class nt extends rt{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}toValue(){return this.value}get tag(){}get target(){return this.value}flattened(){return lt.absent()}unflattened(){return dt.of(this)}header(e){return lt.absent()}headers(e){}head(){return rt.absent()}tail(){return dt.empty()}body(){return lt.absent()}get length(){return 0}has(e){return!1}get(e){return lt.absent()}getAttr(e){return lt.absent()}getSlot(e){return lt.absent()}getField(e){}getItem(e){return rt.absent()}deleted(e){return this}conditional(e,t){return e=rt.fromLike(e)}or(e){return this}and(e){return e=rt.fromLike(e)}lambda(e){return lt.absent()}stringValue(e){return this.value.stringValue(e)}numberValue(e){return this.value.numberValue(e)}booleanValue(e){return this.value.booleanValue(e)}interpolateTo(e){return e instanceof nt?st(this,e):super.interpolateTo(e)}static of(e,t){let r;return"string"==typeof e?r=e:e instanceof bt&&(r=e.value),void 0!==r&&64===r.charCodeAt(0)?(r=r.slice(1),1===arguments.length?ot.of(r):ot.of(r,t)):1===arguments.length?ut.of(e):ut.of(e,t)}static fromLike(e){if(e instanceof nt)return e;if("object"==typeof e&&null!==e){if(void 0!==e.$key)return nt.of(e.$key,e.$value);for(const t in e)return nt.of(t,e[t])}throw new TypeError(""+e)}}nt.ImmutableFlag=1;const st=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return ut.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return ut.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return ut.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D);class ot extends nt{constructor(e,t,r){super(),this.key=e,this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}get name(){return this.key.value}setValue(e){if(0!=(this.flags&nt.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new ot(this.key,e)}bitwiseOr(e){if((e=rt.fromLike(e))instanceof Et)return new Ft(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof lt?this.value.bitwiseOr(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}bitwiseXor(e){if((e=rt.fromLike(e))instanceof Et)return new Bt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof lt?this.value.bitwiseXor(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}bitwiseAnd(e){if((e=rt.fromLike(e))instanceof Et)return new Ut(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof lt?this.value.bitwiseAnd(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}plus(e){if((e=rt.fromLike(e))instanceof Et)return new Xt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof lt?this.value.plus(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}minus(e){if((e=rt.fromLike(e))instanceof Et)return new $t(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof lt?this.value.minus(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}times(e){if((e=rt.fromLike(e))instanceof Et)return new Kt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.times(e.value):e instanceof lt?this.value.times(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}divide(e){if((e=rt.fromLike(e))instanceof Et)return new Yt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof lt?this.value.divide(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}modulo(e){if((e=rt.fromLike(e))instanceof Et)return new Jt(this,e);let t;return t=e instanceof ot&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof lt?this.value.modulo(e):lt.absent(),t.isDefined()?new ot(this.key,t):rt.absent()}not(){const e=this.value.not();return e.isDefined()?new ot(this.key,e):rt.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new ot(this.key,e):rt.absent()}negative(){const e=this.value.negative();return e.isDefined()?new ot(this.key,e):rt.absent()}positive(){const e=this.value.positive();return e.isDefined()?new ot(this.key,e):rt.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new ot(this.key,e):rt.absent()}evaluate(e){e=zt.fromLike(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof bt?new ot(t,r):new ut(t,r):rt.absent()}substitute(e){e=zt.fromLike(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?t instanceof bt?new ot(t,r):new ut(t,r):rt.absent()}toLike(){const e={};return e["@"+this.key.value]=this.value.toLike(),e}isAliased(){return!1}isMutable(){return 0==(this.flags&nt.ImmutableFlag)}alias(){this.flags|=nt.ImmutableFlag}branch(){return 0==(this.flags&nt.ImmutableFlag)?this:new ot(this.key,this.value,this.flags&~nt.ImmutableFlag)}clone(){return new ot(this.key.clone(),this.value.clone())}commit(){return this.flags|=nt.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof ot?at(this,e):super.interpolateTo(e)}get typeOrder(){return 1}compareTo(e){if(e instanceof ot){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ot&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e?this.key.value===e:e instanceof nt?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof ot&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return s.mash(s.mix(s.mix(m.hash(ot),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Attr").write(46).write("of").write(40).display(this.key),this.value instanceof St||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=bt.fromLike(e),t=1===arguments.length?lt.extant():lt.fromLike(t),new ot(e,t)}}const at=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return ot.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return ot.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return ot.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D);class ut extends nt{constructor(e,t,r){super(),this.key=e.commit(),this.value=t,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}setValue(e){if(0!=(this.flags&nt.ImmutableFlag))throw new Error("immutable");const t=this.value;return this.value=e,t}updatedValue(e){return new ut(this.key,e)}bitwiseOr(e){if((e=rt.fromLike(e))instanceof Et)return new Ft(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.bitwiseOr(e.value):e instanceof lt?this.value.bitwiseOr(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}bitwiseXor(e){if((e=rt.fromLike(e))instanceof Et)return new Bt(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.bitwiseXor(e.value):e instanceof lt?this.value.bitwiseXor(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}bitwiseAnd(e){if((e=rt.fromLike(e))instanceof Et)return new Ut(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.bitwiseAnd(e.value):e instanceof lt?this.value.bitwiseAnd(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}plus(e){if((e=rt.fromLike(e))instanceof Et)return new Xt(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.plus(e.value):e instanceof lt?this.value.plus(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}minus(e){if((e=rt.fromLike(e))instanceof Et)return new $t(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.minus(e.value):e instanceof lt?this.value.minus(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}times(e){if((e=rt.fromLike(e))instanceof Et)return new Kt(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.times(e.value):e instanceof lt?this.value.times(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}divide(e){if((e=rt.fromLike(e))instanceof Et)return new Yt(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.divide(e.value):e instanceof lt?this.value.divide(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}modulo(e){if((e=rt.fromLike(e))instanceof Et)return new Jt(this,e);let t;return t=e instanceof ut&&this.key.equals(e.key)?this.value.modulo(e.value):e instanceof lt?this.value.modulo(e):lt.absent(),t.isDefined()?new ut(this.key,t):rt.absent()}not(){const e=this.value.not();return e.isDefined()?new ut(this.key,e):rt.absent()}bitwiseNot(){const e=this.value.bitwiseNot();return e.isDefined()?new ut(this.key,e):rt.absent()}negative(){const e=this.value.negative();return e.isDefined()?new ut(this.key,e):rt.absent()}positive(){const e=this.value.positive();return e.isDefined()?new ut(this.key,e):rt.absent()}inverse(){const e=this.value.inverse();return e.isDefined()?new ut(this.key,e):rt.absent()}evaluate(e){e=zt.fromLike(e);const t=this.key.evaluate(e).toValue(),r=this.value.evaluate(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new ut(t,r):rt.absent()}substitute(e){e=zt.fromLike(e);const t=this.key.substitute(e).toValue(),r=this.value.substitute(e).toValue();return t===this.key&&r===this.value?this:t.isDefined()&&r.isDefined()?new ut(t,r):rt.absent()}toLike(){const e={};return this.key instanceof bt?e[this.key.value]=this.value.toLike():(e.$key=this.key.toLike(),e.$value=this.value.toLike()),e}isAliased(){return!1}isMutable(){return 0==(this.flags&nt.ImmutableFlag)}alias(){this.flags|=nt.ImmutableFlag}branch(){return 0==(this.flags&nt.ImmutableFlag)?this:new ut(this.key,this.value,this.flags&~nt.ImmutableFlag)}clone(){return new ut(this.key.clone(),this.value.clone())}commit(){return this.flags|=nt.ImmutableFlag,this.value.commit(),this}interpolateTo(e){return e instanceof ut?ht(this,e):super.interpolateTo(e)}get typeOrder(){return 2}compareTo(e){if(e instanceof ut){let t=this.key.compareTo(e.key);return 0===t&&(t=this.value.compareTo(e.value)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ut&&(this.key.equals(e.key)&&this.value.equivalentTo(e.value,t))}keyEquals(e){return"string"==typeof e&&this.key instanceof bt?this.key.value===e:e instanceof nt?this.key.equals(e.key):this.key.equals(e)}equals(e){return this===e||e instanceof ut&&(this.key.equals(e.key)&&this.value.equals(e.value))}hashCode(){return s.mash(s.mix(s.mix(m.hash(ut),this.key.hashCode()),this.value.hashCode()))}debug(e){return e=e.write("Slot").write(46).write("of").write(40).display(this.key),this.value instanceof St||(e=e.write(44).write(32).display(this.value)),e=e.write(41)}static of(e,t){return e=lt.fromLike(e),t=1===arguments.length?lt.extant():lt.fromLike(t),new ut(e,t)}}const ht=function(e){const t=function(e,r){const i=function(e){const t=i.keyInterpolator(e),r=i.valueInterpolator(e);return ut.of(t,r)};return Object.setPrototypeOf(i,t.prototype),i.keyInterpolator=e.key.interpolateTo(r.key),i.valueInterpolator=e.value.interpolateTo(r.value),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){return ut.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){return ut.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.keyInterpolator.equals(e.keyInterpolator)&&this.valueInterpolator.equals(e.valueInterpolator))},t}(D);class lt extends rt{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}get key(){return lt.absent()}toValue(){return this}get tag(){}get target(){return this}flattened(){return this}unflattened(){return dt.of(this)}header(e){return lt.absent()}headers(e){}head(){return rt.absent()}tail(){return dt.empty()}body(){return lt.extant()}get length(){return 0}has(e){return!1}get(e){return lt.absent()}getAttr(e){return lt.absent()}getSlot(e){return lt.absent()}getField(e){}getItem(e){return rt.absent()}deleted(e){return this}conditional(e,t){return e=rt.fromLike(e)}or(e){return this}and(e){return e=rt.fromLike(e)}bitwiseOr(e){if((e=rt.fromLike(e))instanceof Et)return new Ft(this,e);if(e instanceof ot){const t=this.bitwiseOr(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.bitwiseOr(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}bitwiseXor(e){if((e=rt.fromLike(e))instanceof Et)return new Bt(this,e);if(e instanceof ot){const t=this.bitwiseXor(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.bitwiseXor(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}bitwiseAnd(e){if((e=rt.fromLike(e))instanceof Et)return new Ut(this,e);if(e instanceof ot){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.bitwiseAnd(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}lt(e){return(e=rt.fromLike(e))instanceof Et?new Rt(this,e):super.lt(e)}le(e){return(e=rt.fromLike(e))instanceof Et?new Wt(this,e):super.le(e)}eq(e){return(e=rt.fromLike(e))instanceof Et?new Ht(this,e):super.eq(e)}ne(e){return(e=rt.fromLike(e))instanceof Et?new Zt(this,e):super.ne(e)}ge(e){return(e=rt.fromLike(e))instanceof Et?new Qt(this,e):super.ge(e)}gt(e){return(e=rt.fromLike(e))instanceof Et?new Gt(this,e):super.gt(e)}plus(e){if((e=rt.fromLike(e))instanceof Et)return new Xt(this,e);if(e instanceof ot){const t=this.plus(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.plus(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}minus(e){if((e=rt.fromLike(e))instanceof Et)return new $t(this,e);if(e instanceof ot){const t=this.minus(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.minus(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}times(e){if((e=rt.fromLike(e))instanceof Et)return new Kt(this,e);if(e instanceof ot){const t=this.times(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.times(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}divide(e){if((e=rt.fromLike(e))instanceof Et)return new Yt(this,e);if(e instanceof ot){const t=this.divide(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.divide(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}modulo(e){if((e=rt.fromLike(e))instanceof Et)return new Jt(this,e);if(e instanceof ot){const t=this.modulo(e.value);if(t.isDefined())return new ot(e.key,t)}else if(e instanceof ut){const t=this.modulo(e.value);if(t.isDefined())return new ut(e.key,t)}return rt.absent()}not(){return lt.absent()}bitwiseNot(){return lt.absent()}negative(){return lt.absent()}positive(){return lt.absent()}inverse(){return lt.absent()}lambda(e){return new yr(this,e)}stringValue(e){return e}numberValue(e){return e}booleanValue(e){return e}isAliased(){return!1}isMutable(){return!1}alias(){}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}keyEquals(e){return!1}static builder(){return new ct}static empty(){return dt.empty()}static extant(){return St.extant()}static absent(){return Ct.absent()}static fromLike(e){if(e instanceof lt)return e;if(e instanceof rt)return dt.create(1).item(e);if(void 0===e)return Ct.absent();if(null===e)return St.extant();if("boolean"==typeof e)return xt.from(e);if("number"==typeof e)return kt.from(e);if("string"==typeof e)return bt.from(e);if(e instanceof Uint8Array)return yt.wrap(e);if(Array.isArray(e))return dt.fromArray(e);if("object"==typeof e)return dt.fromObject(e);throw new TypeError(""+e)}}class ct{constructor(){this.record=null,this.value=null}push(...e){for(let t=0;t<e.length;t+=1){const r=e[t];if(r instanceof nt)return this.pushField(r);if(r instanceof lt)return this.pushValue(r);throw new TypeError(""+r)}}pushField(e){null===this.record&&(this.record=dt.create(),null!==this.value&&(this.record.push(this.value),this.value=null)),this.record.push(e)}pushValue(e){null!==this.record?this.record.push(e):null===this.value?this.value=e:(this.record=dt.create(),this.record.push(this.value),this.value=null,this.record.push(e))}build(){return null!==this.record?this.record:null!==this.value?this.value:lt.absent()}}class dt extends lt{constructor(){super()}isDefinite(){return!this.isEmpty()}isArray(){return 0===this.fieldCount}isObject(){return 0===this.valueCount}get valueCount(){let e=0;return this.forEach((function(t){t instanceof lt&&(e+=1)}),this),e}isConstant(){return void 0===this.forEach((function(e){return!!e.isConstant()&&void 0}),this)}get tag(){const e=this.head();if(e instanceof ot)return e.key.value}get target(){let e,t,r=!1;return this.forEach((function(i){i instanceof ot?r=!0:void 0===e&&i instanceof lt?e=i:(void 0===t&&(t=dt.create(),void 0!==e&&t.push(e)),t.push(i))}),this),void 0===e?lt.extant():void 0===t?e:r?t:this}flattened(){if(this.isEmpty())return lt.extant();const e=this.iterator(),t=e.head();return e.step(),e.isEmpty()&&t instanceof lt?t:this.branch()}unflattened(){return this}header(e){const t=this.head();return t instanceof ot&&t.key.value===e?t.value:lt.absent()}headers(e){const t=this.head();if(!(t instanceof ot)||t.key.value!==e)return;const r=t.value;return r instanceof dt?r:dt.of(r)}head(){return this.forEach((function(e){return e}),this)||rt.absent()}tail(){const e=dt.create();return this.forEach((function(t,r){r>0&&e.push(t)}),this),e}body(){const e=this.tail();return e.isEmpty()?lt.absent():e.flattened()}has(e){return e=lt.fromLike(e),this.forEach((function(t){return!!(t instanceof nt&&t.key.equals(e))||void 0}),this)||!1}indexOf(e,t=0){e=rt.fromLike(e),t<0&&(t=Math.max(0,this.length+t));const r=this.forEach((function(r,i){return i>=t&&e.equals(r)?i:void 0}),this);return void 0!==r?r:-1}lastIndexOf(e,t){e=rt.fromLike(e);const r=this.length;for(void 0===t?t=r-1:t<0&&(t=r+t),t=Math.min(t,r-1);t>=0;){if(e.equals(this.getItem(t)))return t;t-=1}return-1}get(e){return e=lt.fromLike(e),this.forEach((function(t){return t instanceof nt&&t.key.equals(e)?t.value:void 0}),this)||lt.absent()}getAttr(e){return e=bt.fromLike(e),this.forEach((function(t){return t instanceof ot&&t.key.equals(e)?t.value:void 0}),this)||lt.absent()}getSlot(e){return e=lt.fromLike(e),this.forEach((function(t){return t instanceof ut&&t.key.equals(e)?t.value:void 0}),this)||lt.absent()}getField(e){return e=lt.fromLike(e),this.forEach((function(t){return t instanceof nt&&t.key.equals(e)?t:void 0}),this)}set(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof nt&&i.key.equals(e))return i.isMutable()?i.setValue(t):r.set(i.updatedValue(t)),this;r.step()}return this.push(new ut(e,t)),this}setAttr(e,t){e=bt.fromLike(e),t=lt.fromLike(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof nt&&i.key.equals(e))return i instanceof ot&&i.isMutable()?i.setValue(t):r.set(new ot(e,t)),this;r.step()}return this.push(new ot(e,t)),this}setSlot(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof nt&&i.key.equals(e))return i instanceof ut&&i.isMutable()?i.setValue(t):r.set(new ut(e,t)),this;r.step()}return this.push(new ut(e,t)),this}updated(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof nt&&n.isMutable()?n.setValue(t):i.set(new ut(e,t)),r;i.step()}return r.push(new ut(e,t)),r}updatedAttr(e,t){e=bt.fromLike(e),t=lt.fromLike(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof ot&&n.isMutable()?n.setValue(t):i.set(new ot(e,t)),r;i.step()}return r.push(new ot(e,t)),r}updatedSlot(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(e))return n instanceof ut&&n.isMutable()?n.setValue(t):i.set(new ut(e,t)),r;i.step()}return r.push(new ut(e,t)),r}appended(...e){const t=this.isMutable()?this:this.branch();return t.push(...e),t}prepended(...e){const t=this.isMutable()?this:this.branch();return t.splice(0,0,...e),t}deleted(e){const t=this.isMutable()?this:this.branch();return t.delete(e),t}concat(...e){const t=this.isMutable()?this:this.branch();for(let r=0;r<e.length;r+=1)rt.fromLike(e[r]).forEach((function(e){t.push(e)}));return t}slice(e,t){return this.subRecord(e,t).branch()}attr(e,t){let r;return r=1===arguments.length?ot.of(e):ot.of(e,t),this.push(r),this}slot(e,t){let r;return r=1===arguments.length?ut.of(e):ut.of(e,t),this.push(r),this}item(e){return this.push(e),this}items(...e){return this.push(this,...e),this}evaluate(e){e=zt.fromLike(e);const t=dt.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.evaluate(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}substitute(e){e=zt.fromLike(e);const t=dt.create();e.pushScope(t);let r=!1;return this.forEach((function(i){const n=i.substitute(e);n.isDefined()&&t.push(n),i!==n&&(r=!0)}),this),e.popScope(),r?t:this}stringValue(e){let t="";return void 0===this.forEach((function(e){if(e instanceof lt){const r=e.stringValue();if(void 0!==r)return void(t+=r)}return null}),this)?t:void 0}toLike(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()}toArray(){const e=new Array(this.length);return this.forEach((function(t,r){t instanceof lt?e[r]=t.toLike():t instanceof nt&&(e[r]={$key:t.key.toLike(),$value:t.value.toLike()})}),this),e}toObject(){const e={};return this.forEach((function(t,r){t instanceof ot?e["@"+t.key.value]=t.value.toLike():t instanceof ut?t.key instanceof bt?e[t.key.value]=t.value.toLike():e["$"+r]={$key:t.key.toLike(),$value:t.value.toLike()}:t instanceof lt&&(e["$"+r]=t.toLike())}),this),e}isAliased(){return!1}isMutable(){return!0}alias(){}branch(){const e=dt.create();return this.forEach((function(t){e.push(t)}),this),e}clone(){const e=dt.create();return this.forEach((function(t){e.push(t.clone())}),this),e}commit(){return this}build(){return this}subRecord(e,t){const r=this.length;void 0===e?e=0:e<0&&(e=r+e),e=Math.min(Math.max(0,e),r),void 0===t?t=r:t<0&&(t=r+t);const i=dt.create();return this.forEach((function(r,n){return n<e?void 0:n<t?void i.push(r):null}),this),i}iterator(){return new ft(this)}interpolateTo(e){return e instanceof dt?pt(this,e):super.interpolateTo(e)}get typeOrder(){return 3}compareTo(e){if(e instanceof dt){const t=this.iterator(),r=e.iterator();let i=0;do{if(t.isEmpty()||r.isEmpty())break;i=t.head().compareTo(r.head()),t.step(),r.step()}while(0===i);return 0!==i?i:t.isEmpty()&&!r.isEmpty()?-1:!t.isEmpty()&&r.isEmpty()?1:0}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){if(this===e)return!0;if(e instanceof dt){const r=this.iterator(),i=e.iterator();for(;!r.isEmpty()&&!i.isEmpty();){if(!r.head().equivalentTo(i.head(),t))return!1;r.step(),i.step()}return r.isEmpty()&&i.isEmpty()}return!1}equals(e){if(this===e)return!0;if(e instanceof dt){const t=this.iterator(),r=e.iterator();for(;!t.isEmpty()&&!r.isEmpty();){if(!t.head().equals(r.head()))return!1;t.step(),r.step()}return t.isEmpty()&&r.isEmpty()}return!1}hashCode(){let e=m.hash(dt);return this.forEach((function(t){e=s.mix(e,t.hashCode())}),this),e}debug(e){return e=e.write("Record").write(46),this.isEmpty()?e=e.write("empty").write(40).write(41):(e=e.write("of").write(40),this.forEach((function(t,r){0!==r&&(e=e.write(44).write(32)),e=e.display(t)}),this),e=e.write(41)),e}static empty(){return mt.empty()}static create(e){return mt.create(e)}static of(...e){return mt.of(...e)}static fromLike(e){if(e instanceof dt)return e;if(Array.isArray(e))return dt.fromArray(e);if("object"==typeof e&&null!==e)return dt.fromObject(e);throw new TypeError(""+e)}static fromArray(e){const t=e.length||0,r=dt.create(t);for(let i=0;i<t;i+=1)r.push(rt.fromLike(e[i]));return r}static fromObject(e){const t=dt.create();for(const r in e){const i=e[r];36===r.charCodeAt(0)?i&&"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"$key")?t.push(nt.of(i.$key,i.$value)):t.push(lt.fromLike(i)):t.push(nt.of(r,i))}return t}static expand(e){return e=Math.max(8,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}dt.AliasedFlag=1,dt.ImmutableFlag=2,Object.defineProperty(dt.prototype,"fieldCount",{get(){let e=0;return this.forEach((function(t){t instanceof nt&&(e+=1)}),this),e},configurable:!0});const pt=function(e){const t=function(e,r){const i=function(e){const t=i.interpolators,r=t.length,n=dt.create(r);for(let i=0;i<r;i+=1)n.push(t[i](e));return n};Object.setPrototypeOf(i,t.prototype);const n=Math.min(e.length,r.length),s=new Array(n);for(let t=0;t<n;t+=1)s[t]=e.getItem(t).interpolateTo(r.getItem(t));return i.interpolators=s,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.interpolators,t=e.length,r=dt.create(t);for(let i=0;i<t;i+=1)r.push(e[i][0]);return r},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.interpolators,t=e.length,r=dt.create(t);for(let i=0;i<t;i+=1)r.push(e[i][1]);return r},configurable:!0}),t.prototype.equals=function(e){if(this===e)return!0;if(e instanceof t){const t=this.interpolators.length;if(t===e.interpolators.length){for(let r=0;r<t;r+=1)if(!this.interpolators[r].equals(e.interpolators[r]))return!1;return!0}}return!1},t}(D);class ft extends b{constructor(e,t,r,i){super(),void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===i&&(i=t),this.record=e,this.lower=t,this.upper=r,this.index=i,this.direction=0}isEmpty(){return this.index>=this.upper}head(){if(this.direction=0,this.index>=this.upper)throw new Error("empty");return this.record.getItem(this.index)}step(){this.direction=0;const e=this.index;if(e>=this.upper)throw new Error("empty");this.index=e+1}skip(e){this.index=Math.min(Math.max(this.lower,this.index+e,this.upper))}hasNext(){return this.index<this.upper}nextIndex(){return this.index-this.lower}next(){this.direction=1;const e=this.index;return e>=this.upper?(this.index=this.upper,{done:!0,value:void 0}):(this.index=e+1,{done:this.index===this.upper,value:this.record.getItem(e)})}hasPrevious(){return this.index>this.lower}previousIndex(){return this.index-this.lower-1}previous(){this.direction=-1;const e=this.index-1;return e<this.lower?(this.index=0,{done:!0,value:void 0}):(this.index=e,{done:e===this.lower,value:this.record.getItem(e)})}set(e){this.direction>0?this.record.setItem(this.index-1,e):this.record.setItem(this.index,e)}delete(){let e=this.index;this.direction>0&&(e-=1,this.index=e),this.record.splice(e,1),this.direction=0}}let mt=(()=>{var e;let i,n=dt,s=[];return e=class extends n{constructor(e,t,r,i,n){super(),this.array=e,this.table=t,Object.defineProperty(this,"length",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"fieldCount",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.flags=n}isEmpty(){return 0===this.length}get valueCount(){return this.length-this.fieldCount}isConstant(){const e=this.array;for(let t=0;t<this.length;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(0===this.fieldCount)return;const e=this.array[0];return e instanceof ot?e.key.value:void 0}get target(){let e,t,r=!1;const i=this.array;for(let n=0;n<this.length;n+=1){const s=i[n];s instanceof ot?r=!0:void 0===e&&s instanceof lt?e=s:(void 0===t&&(t=dt.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?lt.extant():void 0===t?e:r?t:this}head(){return 0===this.length?rt.absent():this.array[0]}tail(){const e=this.length;return 0===e?dt.empty():new wt(this,1,e)}body(){const e=this.length;if(0===e||1===e)return lt.absent();if(2===e){const e=this.array[1];return e instanceof lt?e:dt.of(e)}return new wt(this,1,e).branch()}has(e){if(0===this.fieldCount)return!1;e=lt.fromLike(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return!0;n=(n+1)%r}while(n!==i);return!1}indexOf(e,t=0){e=rt.fromLike(e);const r=this.array,i=this.length;for(t<0&&(t=Math.max(0,i+t));t<i;){if(e.equals(r[t]))return t;t+=1}return-1}lastIndexOf(e,t){e=rt.fromLike(e);const r=this.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=Math.min(t,i-1);t>=0;){if(e.equals(r[t]))return t;t-=1}return-1}get(e){if(0===this.fieldCount)return lt.absent();e=lt.fromLike(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i);return lt.absent()}getAttr(e){if(0===this.fieldCount)return lt.absent();e=bt.fromLike(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof ot&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i);return lt.absent()}getSlot(e){if(0===this.fieldCount)return lt.absent();e=lt.fromLike(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i instanceof ut&&i.key.equals(e))return i.value;n=(n+1)%r}while(n!==i);return lt.absent()}getField(e){if(0===this.fieldCount)return;e=lt.fromLike(e);const t=this.hashTable(),r=t.length,i=Math.abs(e.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)break;if(i.key.equals(e))return i;n=(n+1)%r}while(n!==i)}getItem(e){e instanceof kt&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e<0||e>=t?rt.absent():this.array[e]}set(e,t){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");return e=lt.fromLike(e),t=lt.fromLike(t),0!=(this.flags&dt.AliasedFlag)?this.fieldCount>0?this.setAliased(e,t):this.pushAliased(new ut(e,t)):this.fieldCount>0?null!==this.table?this.setMutable(e,t):this.updateMutable(e,t):this.pushMutable(new ut(e,t)),this}setAliased(e,t){const r=this.length,i=this.array,n=new Array(dt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof nt&&o.key.equals(e)){for(n[s]=o.updatedValue(t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~dt.AliasedFlag)}n[s]=o}n[r]=new ut(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~dt.AliasedFlag}setMutable(t,r){const i=this.table,n=i.length,s=Math.abs(t.hashCode()%n);let o=s;do{const e=i[o];if(void 0===e)break;if(e.key.equals(t))return void(e.isMutable()?e.setValue(r):this.updateMutable(t,r));o=(o+1)%n}while(o!==s);const a=new ut(t,r);this.pushMutable(a),e.put(i,a)}updateMutable(t,r){const i=this.array;for(let e=0;e<this.length;e+=1){const n=i[e];if(n instanceof nt&&n.key.equals(t))return i[e]=n.updatedValue(r),void(this.table=null)}const n=new ut(t,r);this.pushMutable(n),e.put(this.table,n)}setAttr(e,t){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");return e=bt.fromLike(e),t=lt.fromLike(t),0!=(this.flags&dt.AliasedFlag)?this.fieldCount>0?this.setAttrAliased(e,t):this.pushAliased(new ot(e,t)):this.fieldCount>0?null!==this.table?this.setAttrMutable(e,t):this.updateAttrMutable(e,t):this.pushMutable(new ot(e,t)),this}setAttrAliased(e,t){const r=this.length,i=this.array,n=new Array(dt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof nt&&o.key.equals(e)){for(n[s]=new ot(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~dt.AliasedFlag)}n[s]=o}n[r]=new ot(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~dt.AliasedFlag}setAttrMutable(t,r){const i=this.table,n=i.length,s=Math.abs(t.hashCode()%n);let o=s;do{const e=i[o];if(void 0===e)break;if(e.key.equals(t))return void(e instanceof ot&&e.isMutable()?e.setValue(r):this.updateAttrMutable(t,r));o=(o+1)%n}while(o!==s);const a=new ot(t,r);this.push(a),e.put(i,a)}updateAttrMutable(t,r){const i=this.array;for(let e=0;e<this.length;e+=1){const n=i[e];if(n instanceof nt&&n.key.equals(t))return i[e]=new ot(t,r),void(this.table=null)}const n=new ot(t,r);this.push(n),e.put(this.table,n)}setSlot(e,t){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");return e=lt.fromLike(e),t=lt.fromLike(t),0!=(this.flags&dt.AliasedFlag)?this.fieldCount>0?this.setSlotAliased(e,t):this.pushAliased(new ut(e,t)):this.fieldCount>0?null!==this.table?this.setSlotMutable(e,t):this.updateSlotMutable(e,t):this.pushMutable(new ut(e,t)),this}setSlotAliased(e,t){const r=this.length,i=this.array,n=new Array(dt.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof nt&&o.key.equals(e)){for(n[s]=new ut(e,t),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~dt.AliasedFlag)}n[s]=o}n[r]=new ut(e,t),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~dt.AliasedFlag}setSlotMutable(t,r){const i=this.table,n=i.length,s=Math.abs(t.hashCode()%n);let o=s;do{const e=i[o];if(void 0===e)break;if(e.key.equals(t))return void(e instanceof ut&&e.isMutable()?e.setValue(r):this.updateSlotMutable(t,r));o=(o+1)%n}while(o!==s);const a=new ut(t,r);this.push(a),e.put(i,a)}updateSlotMutable(t,r){const i=this.array;for(let e=0;e<this.length;e+=1){const n=i[e];if(n instanceof nt&&n.key.equals(t))return i[e]=new ut(t,r),void(this.table=null)}const n=new ut(t,r);this.push(n),e.put(this.table,n)}setItem(e,t){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");t=rt.fromLike(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.flags&dt.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.length,i=this.array,n=new Array(dt.expand(r));for(let e=0;e<r;e+=1)n[e]=i[e];const s=i[e];n[e]=t,this.array=n,this.table=null,t instanceof nt?s instanceof nt||(this.fieldCount+=1):s instanceof nt&&(this.fieldCount-=1),this.flags&=~dt.AliasedFlag}setItemMutable(e,t){const r=this.array,i=r[e];r[e]=t,t instanceof nt?(this.table=null,i instanceof nt||(this.fieldCount+=1)):i instanceof nt&&(this.table=null,this.fieldCount-=1)}updated(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=0==(this.flags&dt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&dt.AliasedFlag)?r.fieldCount>0?r.setAliased(e,t):r.pushAliased(new ut(e,t)):r.fieldCount>0?null!==r.table?r.setMutable(e,t):r.updateMutable(e,t):r.pushMutable(new ut(e,t)),r}updatedAttr(e,t){e=bt.fromLike(e),t=lt.fromLike(t);const r=0==(this.flags&dt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&dt.AliasedFlag)?r.fieldCount>0?r.setAttrAliased(e,t):r.pushAliased(new ot(e,t)):r.fieldCount>0?null!==r.table?r.setAttrMutable(e,t):r.updateAttrMutable(e,t):r.pushMutable(new ot(e,t)),r}updatedSlot(e,t){e=lt.fromLike(e),t=lt.fromLike(t);const r=0==(this.flags&dt.ImmutableFlag)?this:this.branch();return 0!=(r.flags&dt.AliasedFlag)?r.fieldCount>0?r.setSlotAliased(e,t):r.pushAliased(new ut(e,t)):r.fieldCount>0?null!==r.table?r.setSlotMutable(e,t):r.updateSlotMutable(e,t):r.pushMutable(new ut(e,t)),r}push(...e){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");return 0!=(this.flags&dt.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array,s=new Array(dt.expand(r+t));if(null!==n)for(let e=0;e<r;e+=1)s[e]=n[e];for(let n=0;n<t;n+=1){const t=rt.fromLike(e[n]);s[r]=t,r+=1,t instanceof nt&&(i+=1)}this.array=s,this.table=null,this.length=r,this.fieldCount=i,this.flags&=~dt.AliasedFlag}pushMutable(...e){const t=e.length;let r=this.length,i=this.fieldCount;const n=this.array;let s;if(null===n||r+t>n.length){if(s=new Array(dt.expand(r+t)),null!==n)for(let e=0;e<r;e+=1)s[e]=n[e]}else s=n;for(let n=0;n<t;n+=1){const t=rt.fromLike(e[n]);s[r]=t,r+=1,t instanceof nt&&(i+=1,this.table=null)}this.array=s,this.length=r,this.fieldCount=i}splice(e,t=0,...r){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");const i=this.length;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),0!=(this.flags&dt.AliasedFlag)?this.spliceAliased(e,t,...r):this.spliceMutable(e,t,...r)}spliceAliased(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array,a=new Array(dt.expand(n-t+i));for(let t=0;t<e;t+=1)a[t]=o[t];const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof nt&&(s-=1)}for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=rt.fromLike(r[t]);a[t+e]=i,n+=1,i instanceof nt&&(s+=1)}return this.array=a,this.table=null,this.length=n,this.fieldCount=s,this.flags&=~dt.AliasedFlag,u}spliceMutable(e,t,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array;let a;if(null===o||n-t+i>o.length){if(a=new Array(dt.expand(n-t+i)),null!==o)for(let t=0;t<e;t+=1)a[t]=o[t]}else a=o;const u=[];for(let r=e;r<e+t;r+=1){const e=o[r];u.push(e),n-=1,e instanceof nt&&(s-=1)}if(i>t)for(let r=n-1;r>=e;r-=1)a[r+i]=o[r+t];else for(let r=e;r<n;r+=1)a[r+i]=o[r+t];for(let t=0;t<i;t+=1){const i=rt.fromLike(r[t]);a[t+e]=i,n+=1,i instanceof nt&&(s+=1)}return this.array=a,this.length=n,this.fieldCount=s,u}delete(e){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");return e=lt.fromLike(e),0!=(this.flags&dt.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.length,r=this.array,i=new Array(dt.expand(t));for(let n=0;n<t;n+=1){const s=r[n];if(s instanceof nt&&s.key.equals(e)){for(let e=n+1;e<t;e+=1,n+=1)i[n]=r[e];return this.array=i,this.table=null,this.length=t-1,this.fieldCount-=1,this.flags&=~dt.AliasedFlag,s}i[n]=s}return rt.absent()}deleteMutable(e){const t=this.length,r=this.array;for(let i=0;i<t;i+=1){const n=r[i];if(n instanceof nt&&n.key.equals(e)){for(let e=i+1;e<t;e+=1,i+=1)r[i]=r[e];return r[t-1]=void 0,this.table=null,this.length=t-1,this.fieldCount-=1,n}}return rt.absent()}clear(){if(0!=(this.flags&dt.ImmutableFlag))throw new Error("immutable");this.array=null,this.table=null,this.length=0,this.fieldCount=0,this.flags=0}isAliased(){return 0!=(this.flags&dt.AliasedFlag)}isMutable(){return 0==(this.flags&dt.ImmutableFlag)}alias(){this.flags|=dt.AliasedFlag}branch(){if(0==(this.flags&(dt.AliasedFlag|dt.ImmutableFlag))){const e=this.array;for(let t=0;t<this.length;t+=1)e[t].alias()}return this.flags|=dt.AliasedFlag,new e(this.array,this.table,this.length,this.fieldCount,dt.AliasedFlag)}clone(){const t=this.length,r=this.array,i=new Array(t);for(let e=0;e<t;e+=1)i[e]=r[e].clone();return new e(i,null,t,this.fieldCount,0)}commit(){if(0!=(this.flags&dt.ImmutableFlag))return this;this.flags|=dt.ImmutableFlag;const e=this.array;for(let t=0;t<this.length;t+=1)e[t].commit();return this}hashTable(){const t=this.fieldCount;let r=this.table;if(0!==t&&null===r){r=new Array(dt.expand(Math.max(t,10*t/7)));const i=this.array;for(let t=0;t<this.length;t+=1){const n=i[t];n instanceof nt&&e.put(r,n)}this.table=r}return r}static put(e,t){if(null===e)return;const r=e.length,i=Math.abs(t.key.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i||t.key.equals(i.key))return void(e[n]=t);n=(n+1)%r}while(n!==i);throw new Error}evaluate(e){e=zt.fromLike(e);const t=this.array,r=this.length,i=dt.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.evaluate(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}substitute(e){e=zt.fromLike(e);const t=this.array,r=this.length,i=dt.create(r);e.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=t[s],o=r.substitute(e);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return e.popScope(),n?i:this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new wt(this,e,t)}forEach(e,t){const r=this.array;for(let i=0;i<this.length;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}static empty(){return new e(null,null,0,0,dt.AliasedFlag|dt.ImmutableFlag)}static create(t){return void 0===t?new e(null,null,0,0,dt.AliasedFlag):new e(new Array(t),null,0,0,0)}static of(...t){const r=t.length;if(0===r)return new e(null,null,0,0,dt.AliasedFlag);const i=new Array(r);let n=0,s=0;for(let e=0;e<r;e+=1){const r=rt.fromLike(t[e]);i[e]=r,n+=1,r instanceof nt&&(s+=1)}return new e(i,null,n,s,0)}},(()=>{var a;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=n[Symbol.metadata])&&void 0!==a?a:null):void 0;i=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:u},null,s),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,s)})(),e})();class wt extends dt{constructor(e,t,r){super(),this.record=e,this.lower=t,this.upper=r}isEmpty(){return this.lower===this.upper}isArray(){const e=this.record.array;for(let t=this.lower;t<this.upper;t+=1)if(e[t]instanceof nt)return!1;return!0}isObject(){const e=this.record.array;for(let t=this.lower;t<this.upper;t+=1)if(e[t]instanceof lt)return!1;return!0}get length(){return this.upper-this.lower}get valueCount(){let e=0;const t=this.record.array;for(let r=this.lower;r<this.upper;r+=1)t[r]instanceof lt&&(e+=1);return e}isConstant(){const e=this.record.array;for(let t=this.lower;t<this.upper;t+=1)if(!e[t].isConstant())return!1;return!0}get tag(){if(0===this.length)return;const e=this.record.array[this.lower];return e instanceof ot?e.key.value:void 0}get target(){let e,t,r=!1;const i=this.record.array;for(let n=this.lower;n<this.upper;n+=1){const s=i[n];s instanceof ot?r=!0:void 0===e&&s instanceof lt?e=s:(void 0===t&&(t=dt.create(),void 0!==e&&t.push(e)),t.push(s))}return void 0===e?lt.extant():void 0===t?e:r?t:this}head(){return 0===this.length?rt.absent():this.record.array[this.lower]}tail(){return 0===this.length?dt.empty():new wt(this.record,this.lower+1,this.upper)}body(){const e=this.length;if(0===e||1===e)return lt.absent();if(2===e){const e=this.record.array[this.lower+1];return e instanceof lt?e:dt.of(e)}return new wt(this.record,this.lower+1,this.upper).branch()}indexOf(e,t=0){e=rt.fromLike(e);const r=this.record.array,i=this.length;for(t<0&&(t=Math.max(0,i+t)),t=this.lower+t;t<this.upper;){if(e.equals(r[t]))return t-this.lower;t+=1}return-1}lastIndexOf(e,t){e=rt.fromLike(e);const r=this.record.array,i=this.length;for(void 0===t?t=i-1:t<0&&(t=i+t),t=this.lower+Math.min(t,i-1);t>=this.lower;){if(e.equals(r[t]))return t-this.lower;t-=1}return-1}getItem(e){e instanceof kt&&(e=e.value);const t=this.length;return e<0&&(e=t+e),e<0||e>=t?rt.absent():this.record.array[this.lower+e]}setItem(e,t){if(0!=(this.record.flags&dt.ImmutableFlag))throw new Error("immutable");t=rt.fromLike(t);const r=this.length;if(e<0&&(e=r+e),e<0||e>r)throw new RangeError(""+e);return 0!=(this.record.flags&dt.AliasedFlag)?this.setItemAliased(e,t):this.setItemMutable(e,t),this}setItemAliased(e,t){const r=this.record,i=r.length,n=r.array,s=new Array(dt.expand(i));for(let e=0;e<i;e+=1)s[e]=n[e];const o=null!==n?n[this.lower+e]:null;s[this.lower+e]=t,r.array=s,r.table=null,t instanceof nt?o instanceof nt||(r.fieldCount+=1):o instanceof nt&&(r.fieldCount-=1),r.flags&=~dt.AliasedFlag}setItemMutable(e,t){const r=this.record,i=r.array,n=i[this.lower+e];i[this.lower+e]=t,t instanceof nt?(r.table=null,n instanceof nt||(r.fieldCount+=1)):n instanceof nt&&(r.table=null,r.fieldCount-=1)}push(...e){if(0!=(this.record.flags&dt.ImmutableFlag))throw new Error("immutable");return 0!=(this.record.flags&dt.AliasedFlag)?this.pushAliased(...e):this.pushMutable(...e),this.length}pushAliased(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array,o=new Array(dt.expand(i+r));if(null!==s){for(let e=0;e<this.upper;e+=1)o[e]=s[e];for(let e=this.upper;e<i;e+=1)o[e+r]=s[e]}for(let t=0;t<r;t+=1){const r=rt.fromLike(e[t]);o[t+this.upper]=r,i+=1,r instanceof nt&&(n+=1)}t.array=o,t.table=null,t.length=i,t.fieldCount=n,t.flags&=~dt.AliasedFlag,this.upper+=r}pushMutable(...e){const t=this.record,r=e.length;let i=t.length,n=t.fieldCount;const s=t.array;let o;if(null===s||i+r>s.length){if(o=new Array(dt.expand(i+r)),null!==s)for(let e=0;e<this.upper;e+=1)o[e]=s[e]}else o=s;for(let e=i-1;e>=this.upper;e-=1)o[e+r]=s[e];for(let s=0;s<r;s+=1){const r=rt.fromLike(e[s]);o[s+this.upper]=r,i+=1,r instanceof nt&&(n+=1,t.table=null)}t.array=o,t.length=i,t.fieldCount=n,this.upper+=r}splice(e,t=0,...r){if(0!=(this.record.flags&dt.ImmutableFlag))throw new Error("immutable");const i=this.length;let n;return e<0&&(e=i+e),e=Math.min(Math.max(0,e),i),t=Math.min(Math.max(0,t),i-e),n=0!=(this.record.flags&dt.AliasedFlag)?this.record.spliceAliased(this.lower+e,t,...r):this.record.spliceMutable(this.lower+e,t,...r),this.upper+=r.length-n.length,n}delete(e){if(0!=(this.record.flags&dt.ImmutableFlag))throw new Error("immutable");return e=lt.fromLike(e),0!=(this.record.flags&dt.AliasedFlag)?this.deleteAliased(e):this.deleteMutable(e)}deleteAliased(e){const t=this.record,r=t.length,i=t.array,n=new Array(dt.expand(r));for(let s=this.lower;s<this.upper;s+=1){const o=i[s];if(o instanceof nt&&o.key.equals(e)){for(let e=s+1;e<r;e+=1,s+=1)n[s]=i[e];return t.array=n,t.table=null,t.length=r-1,t.fieldCount-=1,t.flags&=~dt.AliasedFlag,this.upper-=1,o}n[s]=o}return rt.absent()}deleteMutable(e){const t=this.record,r=t.length,i=t.array;for(let n=this.lower;n<this.upper;n+=1){const s=i[n];if(s instanceof nt&&s.key.equals(e)){for(let e=n+1;e<r;e+=1,n+=1)i[n]=i[e];return i[r-1]=void 0,t.table=null,t.length=r-1,t.fieldCount-=1,this.upper-=1,s}}return rt.absent()}clear(){if(0!=(this.record.flags&dt.ImmutableFlag))throw new Error("immutable");0!=(this.record.flags&dt.AliasedFlag)?this.clearAliased():this.clearMutable()}clearAliased(){const e=this.record,t=e.length;let r=e.fieldCount;const i=t-this.length,n=e.array,s=new Array(dt.expand(i));let o=0;for(;o<this.lower;)s[o]=n[o],o+=1;for(;o<this.upper;)n[o]instanceof nt&&(r-=1),o+=1;o=this.lower;let a=this.upper;for(;a<t;)s[o]=n[a],o+=1,a+=1;e.array=s,e.table=null,e.length=i,e.fieldCount=r,e.flags&=~dt.AliasedFlag,this.upper=this.lower}clearMutable(){const e=this.record,t=e.length;let r=e.fieldCount;const i=e.array;let n=this.lower;for(;n<this.upper;)i[n]instanceof nt&&(r-=1),n+=1;n=this.lower;let s=this.upper;for(;s<t;){const t=i[s];t instanceof nt&&(e.table=null),i[n]=t,n+=1,s+=1}for(e.length=n,e.fieldCount=r;n<t;)i[n]=void 0,n+=1;this.upper=this.lower}isAliased(){return 0!=(this.record.flags&dt.AliasedFlag)}isMutable(){return 0==(this.record.flags&dt.ImmutableFlag)}alias(){this.record.flags|=dt.AliasedFlag}branch(){const e=this.length;let t=0;const r=this.record.array,i=new Array(dt.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e,e instanceof nt&&(t+=1),n+=1,s+=1}return new mt(i,null,e,t,0)}clone(){const e=this.length;let t=0;const r=this.record.array,i=new Array(dt.expand(e));let n=this.lower,s=0;for(;s<e;){const e=r[n];i[s]=e.clone(),e instanceof nt&&(t+=1),n+=1,s+=1}return new mt(i,null,e,t,0)}commit(){return this.record.commit(),this}subRecord(e,t){const r=this.length;if(void 0===e?e=0:e<0&&(e=r+e),void 0===t?t=r:t<0&&(t=r+t),e<0||t>r||e>t)throw new RangeError(e+", "+t);return new wt(this.record,this.lower+e,this.upper+t)}forEach(e,t){const r=this.record.array;for(let i=this.lower;i<this.upper;i+=1){const n=e.call(t,r[i],i);if(void 0!==n)return n}}}Object.defineProperty(wt.prototype,"fieldCount",{get(){const e=this.record.array;let t=0;for(let r=this.lower;r<this.upper;r+=1)e[r]instanceof nt&&(t+=1);return t},configurable:!0});let yt=(()=>{var e;let n,a=lt,u=[];return e=class extends a{constructor(e,t,r){super(),this.array=e,this.size=t,this.flags=r}isConstant(){return!0}getByte(e){if(e<0||e>=this.size)throw new RangeError(""+e);return this.array[e]}setByte(t,r){const i=this.flags;if(0!=(i&e.ImmutableFlag))throw new Error("immutable");if(t<0||t>=this.size)throw new RangeError(""+t);return 0!=(i&e.AliasedFlag)?this.setByteAliased(t,r):this.setByteMutable(t,r)}setByteAliased(t,r){const i=this.size,n=this.array,s=new Uint8Array(e.expand(i));return s.set(n,0),s[t]=r,this.array=s,this.flags&=~e.AliasedFlag,this}setByteMutable(e,t){return this.array[e]=t,this}addByte(t){const r=this.flags;if(0!=(r&e.ImmutableFlag))throw new Error("immutable");return 0!=(r&e.AliasedFlag)?this.addByteAliased(t):this.addByteMutable(t)}addByteAliased(t){const r=this.size,i=this.array,n=new Uint8Array(e.expand(r+1));return null!==i&&n.set(i,0),n[r]=t,this.array=n,this.size=r+1,this.flags&=~e.AliasedFlag,this}addByteMutable(t){const r=this.size,i=this.array;let n;return null===i||r+1>i.length?(n=new Uint8Array(e.expand(r+1)),null!==i&&n.set(i,0),this.array=n):n=i,n[r]=t,this.size=r+1,this}addData(e){let t=e.array;if(null===t)return this;const r=e.size;return t.length>r&&(t=t.slice(0,r)),this.addUint8Array(t)}addUint8Array(t){const r=this.flags;if(0!=(r&e.ImmutableFlag))throw new Error("immutable");return 0!=(r&e.AliasedFlag)?this.addUint8ArrayAliased(t):this.addUint8ArrayMutable(t)}addUint8ArrayAliased(t){const r=t.length;if(0===r)return this;const i=this.size,n=this.array,s=new Uint8Array(e.expand(i+r));return null!==n&&s.set(n,0),s.set(t,i),this.array=s,this.size=i+r,this.flags&=~e.AliasedFlag,this}addUint8ArrayMutable(t){const r=t.length;if(0===r)return this;const i=this.size,n=this.array;let s;return null===n||i+r>n.length?(s=new Uint8Array(e.expand(i+r)),null!==n&&s.set(n,0),this.array=s):s=n,s.set(t,i),this.size=i+r,this}clear(){if(0!=(this.flags&e.ImmutableFlag))throw new Error("immutable");this.array=null,this.size=0,this.flags=e.AliasedFlag}toUint8Array(){const t=this.array,r=this.flags;if(0!=(r&e.ImmutableFlag))return null!==t?t.slice(0):new Uint8Array(0);if(0!=(r&e.AliasedFlag)||this.size!==t.length){const r=null!==t?t.slice(0):new Uint8Array(0);return this.array=r,this.flags&=~e.AliasedFlag,r}return t}asUint8Array(){const e=this.array;if(null!==e&&0!==this.size)return e.length!==this.size?new Uint8Array(e.buffer,e.byteOffset,this.size):e}toLike(){return this.toUint8Array()}isAliased(){return 0!=(this.flags&e.AliasedFlag)}isMutable(){return 0==(this.flags&e.ImmutableFlag)}branch(){return this.flags|=e.AliasedFlag,new e(this.array,this.size,e.AliasedFlag)}clone(){return this.branch()}commit(){return this.flags|=e.ImmutableFlag,this}writeBase16(e,t=Ue.uppercase){let r=this.array;const i=this.size;return null===r||0===i?ae.end():(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r))}toBase16(e=Ue.uppercase){const t=he.stringOutput();return this.writeBase16(t,e).bind(),t.bind()}writeBase64(e,t=Ye.standard()){let r=this.array;const i=this.size;return null===r||0===i?ae.end():(r.length!==i&&(r=r.slice(0,i)),t.writeUint8Array(e,r))}toBase64(e=Ye.standard()){const t=he.stringOutput();return this.writeBase64(t,e),t.bind()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 4}compareTo(t){if(t instanceof e){const e=this.array,r=t.array,i=this.size,n=t.size;let s=0,o=0;do{if(!(o<i&&o<n))break;s=e[o]-r[o],o+=1}while(0===s);return s>0?1:s<0?-1:i>n?1:i<n?-1:0}return t instanceof rt?d.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(t){if(this===t)return!0;if(t instanceof e){const e=this.array,r=t.array,i=this.size;if(i!==t.size)return!1;for(let t=0;t<i;t+=1)if(e[t]!==r[t])return!1;return!0}return!1}hashCode(){return s.mash(s.mixUint8Array(m.hash(e),null!==this.array?this.array:new Uint8Array(0)))}debug(e){if(e=e.write("Data").write(46),0===this.size)e=e.write("empty").write(40).write(41);else{e=e.write("base16").write(40).write(34);const t=this.writeBase16(e);if(!t.isDone())return ne.error(t.trap());e=e.write(34).write(41)}return e}static empty(){return new e(null,0,e.AliasedFlag|e.ImmutableFlag)}static create(t){return void 0===t?new e(null,0,e.AliasedFlag):new e(new Uint8Array(t),0,0)}static wrap(t){return new e(t,t.length,e.AliasedFlag)}static fromBase16(t){return"string"==typeof t&&(t=he.stringInput(t)),Ue.parse(t,e.output()).bind()}static fromBase64(t,r=Ye.standard()){return"string"==typeof t&&(t=he.stringInput(t)),r.parse(t,e.output()).bind()}static fromLike(t){if(t instanceof e)return t;if(t instanceof Uint8Array)return e.wrap(t);throw new TypeError(""+t)}static random(t){const r=new Uint8Array(t);return i.fillBytes(r),e.wrap(r)}static output(t){return t instanceof e||(t=e.create(t)),new gt(t,Y.standard())}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}},(()=>{var i;const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(i=a[Symbol.metadata])&&void 0!==i?i:null):void 0;n=[o],t(e,null,n,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:s},null,u),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,u)})(),e.AliasedFlag=1,e.ImmutableFlag=2,e})();class gt extends ne{constructor(e,t){super(),this.data=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"!=typeof e)throw new TypeError(""+e);return this.data.addByte(e),this}writeln(e){throw new TypeError(""+e)}withSettings(e){return e=Y.fromLike(e),this.settings=e,this}bind(){return this.data}clone(){return new gt(this.data.branch(),this.settings)}}let bt=(()=>{var e;let i,n=lt,s=[];return e=class extends n{constructor(e){super(),this.value=e,this.hashValue=void 0}isConstant(){return!0}get size(){return this.value.length}stringValue(e){return this.value}numberValue(e){try{return kt.parse(this.value).numberValue()}catch(t){return e}}booleanValue(e){return"true"===this.value||"false"!==this.value&&e}toLike(){return this.value}valueOf(){return this.value}plus(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value+t.value):super.plus(t)}branch(){return this}clone(){return this}commit(){return this}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 5}compareTo(t){return t instanceof e?this.value.localeCompare(t.value):t instanceof rt?d.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(t){return this===t||t instanceof e&&this.value===t.value}hashCode(){let e=this.hashValue;return void 0===e&&(e=p.hash(this.value),this.hashValue=e),e}debug(e){return e=e.write("Text").write(46),e=0===this.value.length?e.write("empty").write(40).write(41):e.write("from").write(40).debug(this.value).write(41)}display(e){return le.debugAny(e,this.value)}toString(){return this.value}static empty(){return new e("")}static from(t){return 0===t.length?e.empty():new e(t)}static fromLike(t){if(t instanceof e)return t;if("string"==typeof t)return e.from(t);throw new TypeError(""+t)}static output(e){return void 0===e&&(e=Y.standard()),new vt("",e)}},(()=>{var a;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=n[Symbol.metadata])&&void 0!==a?a:null):void 0;i=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:u},null,s),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,s)})(),e})();class vt extends ne{constructor(e,t){super(),this.string=e,this.settings=t}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(e){return this}write(e){if("number"==typeof e)if(e>=0&&e<=55295||e>=57344&&e<=65535)e=String.fromCharCode(e);else if(e>=65536&&e<=1114111){const t=e-65536;e=String.fromCharCode(55296|t>>>10,56320|1023&t)}else e="�";return this.string+=e,this}withSettings(e){return e=Y.fromLike(e),this.settings=e,this}bind(){return bt.from(this.string)}clone(){return new vt(this.string,this.settings)}toString(){return this.string}}let kt=(()=>{var e;let i,n,s,a,u,l=lt,c=[];return e=class extends l{constructor(e,t){super(),this.value=e,this.flags=void 0!==t?t:0}isConstant(){return!0}isNaN(){return isNaN(this.value)}isInfinite(){return!isNaN(this.value)&&!isFinite(this.value)}isUint32(){return 0!=(this.flags&e.Uint32Flag)}isUint64(){return 0!=(this.flags&e.Uint64Flag)}stringValue(e){return""+this.value}numberValue(e){return this.value}booleanValue(e){return!!this.value}toLike(){return this.value}valueOf(){return this.value}bitwiseOr(t){return(t=rt.fromLike(t))instanceof e?e.from((this.value|t.value)>>>0):super.bitwiseOr(t)}bitwiseXor(t){return(t=rt.fromLike(t))instanceof e?e.from((this.value^t.value)>>>0):super.bitwiseXor(t)}bitwiseAnd(t){return(t=rt.fromLike(t))instanceof e?e.from((this.value&t.value)>>>0):super.bitwiseAnd(t)}plus(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value+t.value):super.plus(t)}minus(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value-t.value):super.minus(t)}times(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value*t.value):super.times(t)}divide(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value/t.value):super.divide(t)}modulo(t){return(t=rt.fromLike(t))instanceof e?e.from(this.value%t.value):super.modulo(t)}bitwiseNot(){return e.from(~this.value>>>0)}negative(){return e.from(-this.value)}positive(){return this}inverse(){return e.from(1/this.value)}abs(){return e.from(Math.abs(this.value))}ceil(){return e.from(Math.ceil(this.value))}floor(){return e.from(Math.floor(this.value))}round(){return e.from(Math.round(this.value))}sqrt(){return e.from(Math.sqrt(this.value))}pow(t){return t=e.fromLike(t),e.from(Math.pow(this.value,t.value))}max(e){return this.compareTo(e)>=0?this:e}min(e){return this.compareTo(e)<=0?this:e}interpolateTo(t){return t instanceof e?Ot(this,t):super.interpolateTo(t)}get typeOrder(){return 6}compareTo(t){if(t instanceof e){const e=this.value,r=t.value;return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return t instanceof rt?d.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,r){if(this===t)return!0;if(t instanceof e){const e=this.value,i=t.value;return e===i||isNaN(e)&&isNaN(i)||Math.abs(i-e)<(void 0!==r?r:h.Epsilon)}return!1}equals(t){if(this===t)return!0;if(t instanceof e){const e=this.value,r=t.value;return e===r||isNaN(e)&&isNaN(r)}return!1}hashCode(){return d.hash(this.value)}debug(e){return e=e.write("Num").write(46).write("from").write(40).display(this).write(41)}display(e){return le.displayNumber(e,this.value)}static zero(){return new e(0)}static negativeZero(){return new e(-0)}static one(){return new e(1)}static negativeOne(){return new e(-1)}static nan(){return new e(NaN)}static uint32(t){return new e(t,e.Uint32Flag)}static uint64(t){return new e(t,e.Uint64Flag)}static from(t){return 0===t?1/t==-1/0?e.negativeZero():e.zero():1===t?e.one():-1===t?e.negativeOne():isNaN(t)?e.nan():new e(t)}static fromLike(t){if(t instanceof e)return t;if("number"==typeof t)return e.from(t);throw new TypeError(""+t)}static parse(t){if("NaN"===t)return e.nan();const r=+t;if(!isFinite(r))throw new Error(t);return e.from(r)}},(()=>{var h;const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(h=l[Symbol.metadata])&&void 0!==h?h:null):void 0;i=[o],n=[o],s=[o],a=[o],u=[o],t(e,null,i,{kind:"method",name:"zero",static:!0,private:!1,access:{has:e=>"zero"in e,get:e=>e.zero},metadata:d},null,c),t(e,null,n,{kind:"method",name:"negativeZero",static:!0,private:!1,access:{has:e=>"negativeZero"in e,get:e=>e.negativeZero},metadata:d},null,c),t(e,null,s,{kind:"method",name:"one",static:!0,private:!1,access:{has:e=>"one"in e,get:e=>e.one},metadata:d},null,c),t(e,null,a,{kind:"method",name:"negativeOne",static:!0,private:!1,access:{has:e=>"negativeOne"in e,get:e=>e.negativeOne},metadata:d},null,c),t(e,null,u,{kind:"method",name:"nan",static:!0,private:!1,access:{has:e=>"nan"in e,get:e=>e.nan},metadata:d},null,c),d&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d}),r(e,c)})(),e.Uint32Flag=1,e.Uint64Flag=2,e.TypeMask=3,e})();const Ot=function(e){const t=function(e,r){const i=function(e){const t=i[0].value,r=i[1].value;return kt.from(t+e*(r-t))};return Object.setPrototypeOf(i,t.prototype),i[0]=e,i[1]=r,i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(D);let xt=(()=>{var e;let i,n,s=lt,a=[];return e=class extends s{constructor(e){super(),Object.defineProperty(this,"value",{value:e,enumerable:!0}),Object.defineProperty(this,"hashValue",{value:p.hash(e?"true":"false")})}isDefinite(){return this.value}isConstant(){return!0}stringValue(e){return this.value?"true":"false"}booleanValue(e){return this.value}toLike(){return this.value}valueOf(){return this.value}conditional(e,t){return this.value?rt.fromLike(e):rt.fromLike(t)}or(e){return this.value?this:rt.fromLike(e)}and(e){return this.value?rt.fromLike(e):this}not(){return e.from(!this.value)}get typeOrder(){return 7}compareTo(t){return t instanceof e?this.value&&!t.value?-1:!this.value&&t.value?1:0:t instanceof rt?d.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(e){return this.equals(e)}equals(t){return this===t||t instanceof e&&this.value===t.value}hashCode(){return this.hashValue}debug(e){return e=e.write("Bool").write(46).write("from").write(40).write(this.value?"true":"false").write(41)}display(e){return e=e.write(this.value?"true":"false")}static true(){return new e(!0)}static false(){return new e(!1)}static from(t){return t?e.true():e.false()}static fromLike(t){if(t instanceof e)return t;if("boolean"==typeof t)return e.from(t);throw new TypeError(""+t)}},(()=>{var u;const h="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=s[Symbol.metadata])&&void 0!==u?u:null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"true",static:!0,private:!1,access:{has:e=>"true"in e,get:e=>e.true},metadata:h},null,a),t(e,null,n,{kind:"method",name:"false",static:!0,private:!1,access:{has:e=>"false"in e,get:e=>e.false},metadata:h},null,a),h&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h}),r(e,a)})(),e})(),St=(()=>{var e;let i,n=lt,s=[];return e=class extends n{constructor(){super()}isDefined(){return!0}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return dt.empty()}not(){return lt.absent()}stringValue(e){return""}booleanValue(e){return!0}toLike(){return null}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 98}compareTo(e){return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(e)}debug(e){return e=e.write("Value").write(46).write("extant").write(40).write(41)}display(e){return e=e.write("null")}static extant(){return new e}static fromLike(t){if(t instanceof e)return t;if(null===t)return e.extant();throw new TypeError(""+t)}},(()=>{var a;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=n[Symbol.metadata])&&void 0!==a?a:null):void 0;i=[o],t(e,null,i,{kind:"method",name:"extant",static:!0,private:!1,access:{has:e=>"extant"in e,get:e=>e.extant},metadata:u},null,s),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,s)})(),e})(),Ct=(()=>{var e;let i,n=lt,s=[];return e=class extends n{constructor(){super()}isDefined(){return!1}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return dt.empty()}updated(e,t){return dt.of(ut.of(e,t))}updatedAttr(e,t){return dt.of(ot.of(e,t))}updatedSlot(e,t){return dt.of(ut.of(e,t))}appended(...e){return dt.of(e)}prepended(...e){return dt.of(e)}concat(...e){const t=dt.create();for(let r=0;r<e.length;r+=1)rt.fromLike(e[r]).forEach((function(e){t.push(e)}));return t}conditional(e,t){return rt.fromLike(t)}or(e){return rt.fromLike(e)}and(e){return this}not(){return lt.extant()}booleanValue(e){return!1}toLike(){}forEach(e,t){}iterator(){return b.empty()}interpolateTo(e){return super.interpolateTo(e)}get typeOrder(){return 99}compareTo(e){return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(e)}debug(e){return e=e.write("Value").write(46).write("absent").write(40).write(41)}display(e){return e=e.write("undefined")}static absent(){return new e}static fromLike(t){if(t instanceof e)return t;if(void 0===t)return e.absent();throw new TypeError(""+t)}},(()=>{var a;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=n[Symbol.metadata])&&void 0!==a?a:null):void 0;i=[o],t(e,null,i,{kind:"method",name:"absent",static:!0,private:!1,access:{has:e=>"absent"in e,get:e=>e.absent},metadata:u},null,s),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,s)})(),e})();class Et extends lt{constructor(){super()}conditional(e,t){return e=rt.fromLike(e),t=rt.fromLike(t),new It(this,e,t)}or(e){return e=rt.fromLike(e),new Vt(this,e)}and(e){return e=rt.fromLike(e),new Mt(this,e)}bitwiseOr(e){return e=rt.fromLike(e),new Ft(this,e)}bitwiseXor(e){return e=rt.fromLike(e),new Bt(this,e)}bitwiseAnd(e){return e=rt.fromLike(e),new Ut(this,e)}lt(e){return e=rt.fromLike(e),new Rt(this,e)}le(e){return e=rt.fromLike(e),new Wt(this,e)}eq(e){return e=rt.fromLike(e),new Ht(this,e)}ne(e){return e=rt.fromLike(e),new Zt(this,e)}ge(e){return e=rt.fromLike(e),new Qt(this,e)}gt(e){return e=rt.fromLike(e),new Gt(this,e)}plus(e){return e=rt.fromLike(e),new Xt(this,e)}minus(e){return e=rt.fromLike(e),new $t(this,e)}times(e){return e=rt.fromLike(e),new Kt(this,e)}divide(e){return e=rt.fromLike(e),new Yt(this,e)}modulo(e){return e=rt.fromLike(e),new Jt(this,e)}not(){return new _t(this)}bitwiseNot(){return new er(this)}negative(){return new tr(this)}positive(){return new rr(this)}inverse(){return new Yt(kt.one(),this)}toLike(){return this}}class Tt extends Et{constructor(){super()}static binary(e,t,r){switch(t){case"||":return new Vt(e,r);case"&&":return new Mt(e,r);case"|":return new Ft(e,r);case"^":return new Bt(e,r);case"&":return new Ut(e,r);case"<":return new Rt(e,r);case"<=":return new Wt(e,r);case"==":return new Ht(e,r);case"!=":return new Zt(e,r);case">=":return new Qt(e,r);case">":return new Gt(e,r);case"+":return new Xt(e,r);case"-":return new $t(e,r);case"*":return new Kt(e,r);case"/":return new Yt(e,r);case"%":return new Jt(e,r);default:throw new Error(t)}}static unary(e,t){switch(e){case"!":return new _t(t);case"~":return new er(t);case"-":return new tr(t);case"+":return new rr(t);default:throw new Error(e)}}}class Pt extends Tt{constructor(e,t){super(),this.operand1=e,this.operand2=t}isConstant(){return this.operand1.isConstant()&&this.operand2.isConstant()}interpolateTo(e){return e instanceof Pt&&this.operator===e.operator?Dt(this,e):super.interpolateTo(e)}}const Dt=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operand1Interpolator(e),r=n.operand2Interpolator(e);return Tt.binary(t,n.operator,r)};return Object.setPrototypeOf(n,t.prototype),n.operand1Interpolator=e.operand1.interpolateTo(r.operand1),n.operator=i,n.operand2Interpolator=e.operand2.interpolateTo(r.operand2),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operand1Interpolator[0],t=this.operand2Interpolator[0];return Tt.binary(e,this.operator,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operand1Interpolator[1],t=this.operand2Interpolator[1];return Tt.binary(e,this.operator,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operand1Interpolator.equals(e.operand1Interpolator)&&this.operand2Interpolator.equals(e.operand2Interpolator))},t}(D);class Lt extends Tt{constructor(e){super(),this.operand=e}isConstant(){return this.operand.isConstant()}interpolateTo(e){return e instanceof Lt&&this.operator===e.operator?qt(this,e):super.interpolateTo(e)}}const qt=function(e){const t=function(e,r){const i=e.operator;if(i!==r.operator)throw new Error;const n=function(e){const t=n.operandInterpolator(e);return Tt.unary(n.operator,t)};return Object.setPrototypeOf(n,t.prototype),n.operator=i,n.operandInterpolator=e.operand.interpolateTo(r.operand),n};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.operandInterpolator[0];return Tt.unary(this.operator,e)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.operandInterpolator[1];return Tt.unary(this.operator,e)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.operator===e.operator&&this.operandInterpolator.equals(e.operandInterpolator))},t}(D);class It extends Tt{constructor(e,t,r){super(),this.ifTerm=e.commit(),this.thenTerm=t.commit(),this.elseTerm=r.commit()}isConstant(){return this.ifTerm.isConstant()&&this.thenTerm.isConstant()&&this.elseTerm.isConstant()}get precedence(){return 2}evaluate(e){let t;(e=zt.fromLike(e)).willOperate(this);if(this.ifTerm.evaluate(e).isDefinite()){t=this.thenTerm.evaluate(e)}else{t=this.elseTerm.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=zt.fromLike(e);const t=this.ifTerm.substitute(e),r=this.thenTerm.substitute(e),i=this.elseTerm.substitute(e);return new It(t,r,i)}interpolateTo(e){return e instanceof It?At(this,e):super.interpolateTo(e)}get typeOrder(){return 20}compareTo(e){if(e instanceof It){let t=this.ifTerm.compareTo(e.ifTerm);return 0===t&&(t=this.thenTerm.compareTo(e.thenTerm),0===t&&(t=this.elseTerm.compareTo(e.elseTerm))),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof It&&(this.ifTerm.equivalentTo(e.ifTerm,t)&&this.thenTerm.equivalentTo(e.thenTerm,t)&&this.elseTerm.equivalentTo(e.elseTerm,t))}equals(e){return this===e||e instanceof It&&(this.ifTerm.equals(e.ifTerm)&&this.thenTerm.equals(e.thenTerm)&&this.elseTerm.equals(e.elseTerm))}hashCode(){return s.mash(s.mix(s.mix(s.mix(m.hash(It),this.ifTerm.hashCode()),this.thenTerm.hashCode()),this.elseTerm.hashCode()))}debug(e){return e=e.debug(this.ifTerm).write(46).write("conditional").write(40).debug(this.thenTerm).write(44).write(32).debug(this.elseTerm).write(41)}clone(){return new It(this.ifTerm.clone(),this.thenTerm.clone(),this.elseTerm.clone())}}const At=function(e){const t=function(e,r){const i=function(e){const t=i.ifTermInterpolator(e),r=i.thenTermInterpolator(e),n=i.elseTermInterpolator(e);return new It(t,r,n)};return Object.setPrototypeOf(i,t.prototype),i.ifTermInterpolator=e.ifTerm.interpolateTo(r.ifTerm),i.thenTermInterpolator=e.thenTerm.interpolateTo(r.thenTerm),i.elseTermInterpolator=e.elseTerm.interpolateTo(r.elseTerm),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.ifTermInterpolator[0],t=this.thenTermInterpolator[0],r=this.elseTermInterpolator[0];return new It(e,t,r)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.ifTermInterpolator[1],t=this.thenTermInterpolator[1],r=this.elseTermInterpolator[1];return new It(e,t,r)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.ifTermInterpolator.equals(e.ifTermInterpolator)&&this.thenTermInterpolator.equals(e.thenTermInterpolator)&&this.elseTermInterpolator.equals(e.elseTermInterpolator))},t}(D);class Nt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Nt.prototype)}}let jt=(()=>{var e;let i,n=[];return e=class{constructor(e){this.maxScopeDepth=e}withMaxScopeDepth(e){return this.copy(e)}copy(t){return new e(t)}canEqual(t){return t instanceof e}equals(t){return this===t||t instanceof e&&(t.canEqual(this)&&this.maxScopeDepth===t.maxScopeDepth)}hashCode(){return s.mash(s.mix(m.hash(e),d.hash(this.maxScopeDepth)))}debug(e){return e=e.write("new").write(32).write("InterpreterSettings").write(40).debug(this.maxScopeDepth).write(41)}toString(){return le.debug(this)}static standard(){return new e(1024)}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"standard",static:!0,private:!1,access:{has:e=>"standard"in e,get:e=>e.standard},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class zt{constructor(e,t,r){this.settings=void 0!==e?e:jt.standard(),this.scopeStack=void 0!==t?t:null,this.scopeDepth=void 0!==r?r:0}withSettings(e){return this.settings=e,this}peekScope(){const e=this.scopeDepth;if(e<=0)throw new Nt("scope stack empty");return this.scopeStack[e-1]}getScope(e){if(e<0||e>=this.scopeDepth)throw new RangeError(""+e);return this.scopeStack[e]}pushScope(e){const t=this.scopeDepth;if(t>=this.settings.maxScopeDepth)throw new Nt("scope stack overflow");const r=this.scopeStack;let i;if(null===r||t+1>r.length){if(i=new Array(zt.expand(t+1)),null!==r)for(let e=0;e<t;e+=1)i[e]=r[e];this.scopeStack=i}else i=r;i[t]=e,this.scopeDepth+=1}popScope(){const e=this.scopeDepth;if(e<=0)throw new Nt("scope stack empty");const t=this.scopeStack,r=t[e-1];return t[e-1]=void 0,this.scopeDepth-=1,r}swapScope(e){const t=this.scopeDepth;if(t<=0)throw new Nt("scope stack empty");const r=this.scopeStack,i=r[t-1];return r[t-1]=e,i}willOperate(e){}didOperate(e,t){}willSelect(e){}didSelect(e,t){}willTransform(e){}didTransform(e,t){}static of(...e){const t=e.length,r=new Array(zt.expand(t));for(let i=0;i<t;i+=1){const t=rt.fromLike(e[i]);r[i]=t}return new zt(jt.standard(),r,t)}static fromLike(e,t=rt.globalScope()){if(!(e instanceof zt)){const r=e;e=new zt,void 0!==t&&e.pushScope(t),void 0!==r&&e.pushScope(rt.fromLike(r))}return e}static expand(e){return e=Math.max(32,e)-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)+1}}class Vt extends Pt{constructor(e,t){super(e,t)}get operator(){return"||"}get precedence(){return 3}evaluate(e){let t;(e=zt.fromLike(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite())t=r;else{t=this.operand2.evaluate(e)}return e.didOperate(this,t),t}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.or(r)}get typeOrder(){return 21}compareTo(e){if(e instanceof Vt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Vt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Vt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Vt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("or").write(40).debug(this.operand2).write(41)}clone(){return new Vt(this.operand1.clone(),this.operand2.clone())}}class Mt extends Pt{constructor(e,t){super(e,t)}get operator(){return"&&"}get precedence(){return 4}evaluate(e){let t;(e=zt.fromLike(e)).willOperate(this);const r=this.operand1.evaluate(e);if(r.isDefinite()){t=this.operand2.evaluate(e)}else t=r;return e.didOperate(this,t),t}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.and(r)}get typeOrder(){return 22}compareTo(e){if(e instanceof Mt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Mt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Mt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Mt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("and").write(40).debug(this.operand2).write(41)}clone(){return new Mt(this.operand1.clone(),this.operand2.clone())}}class Ft extends Pt{constructor(e,t){super(e,t)}get operator(){return"|"}get precedence(){return 5}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseOr(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseOr(r)}get typeOrder(){return 23}compareTo(e){if(e instanceof Ft){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ft&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ft&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Ft),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseOr").write(40).debug(this.operand2).write(41)}clone(){return new Ft(this.operand1.clone(),this.operand2.clone())}}class Bt extends Pt{constructor(e,t){super(e,t)}get operator(){return"^"}get precedence(){return 6}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseXor(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseXor(r)}get typeOrder(){return 24}compareTo(e){if(e instanceof Bt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Bt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Bt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Bt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseXor").write(40).debug(this.operand2).write(41)}clone(){return new Bt(this.operand1.clone(),this.operand2.clone())}}class Ut extends Pt{constructor(e,t){super(e,t)}get operator(){return"&"}get precedence(){return 7}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.bitwiseAnd(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.bitwiseAnd(r)}get typeOrder(){return 25}compareTo(e){if(e instanceof Ut){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ut&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ut&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Ut),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("bitwiseAnd").write(40).debug(this.operand2).write(41)}clone(){return new Ut(this.operand1.clone(),this.operand2.clone())}}class Rt extends Pt{constructor(e,t){super(e,t)}get operator(){return"<"}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.lt(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.lt(r)}get typeOrder(){return 26}compareTo(e){if(e instanceof Rt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Rt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Rt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Rt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("lt").write(40).debug(this.operand2).write(41)}clone(){return new Rt(this.operand1.clone(),this.operand2.clone())}}class Wt extends Pt{constructor(e,t){super(e,t)}get operator(){return"<="}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.le(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.le(r)}get typeOrder(){return 27}compareTo(e){if(e instanceof Wt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Wt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Wt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Wt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e.debug(this.operand1).write(46).write("le").write(40).debug(this.operand2).write(41)}clone(){return new Wt(this.operand1.clone(),this.operand2.clone())}}class Ht extends Pt{constructor(e,t){super(e,t)}get operator(){return"=="}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.eq(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.eq(r)}get typeOrder(){return 28}compareTo(e){if(e instanceof Ht){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Ht&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Ht&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Ht),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("eq").write(40).debug(this.operand2).write(41)}clone(){return new Ht(this.operand1.clone(),this.operand2.clone())}}class Zt extends Pt{constructor(e,t){super(e,t)}get operator(){return"!="}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ne(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ne(r)}get typeOrder(){return 29}compareTo(e){if(e instanceof Zt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Zt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Zt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Zt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ne").write(40).debug(this.operand2).write(41)}clone(){return new Zt(this.operand1.clone(),this.operand2.clone())}}class Qt extends Pt{constructor(e,t){super(e,t)}get operator(){return">="}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.ge(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.ge(r)}get typeOrder(){return 30}compareTo(e){if(e instanceof Qt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Qt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Qt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Qt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("ge").write(40).debug(this.operand2).write(41)}clone(){return new Qt(this.operand1.clone(),this.operand2.clone())}}class Gt extends Pt{constructor(e,t){super(e,t)}get operator(){return">"}get precedence(){return 0}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.gt(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.gt(r)}get typeOrder(){return 31}compareTo(e){if(e instanceof Gt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Gt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Gt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Gt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("gt").write(40).debug(this.operand2).write(41)}clone(){return new Gt(this.operand1.clone(),this.operand2.clone())}}class Xt extends Pt{constructor(e,t){super(e,t)}get operator(){return"+"}get precedence(){return 8}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.plus(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.plus(r)}get typeOrder(){return 32}compareTo(e){if(e instanceof Xt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Xt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Xt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Xt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("plus").write(40).debug(this.operand2).write(41)}clone(){return new Xt(this.operand1.clone(),this.operand2.clone())}}class $t extends Pt{constructor(e,t){super(e,t)}get operator(){return"-"}get precedence(){return 8}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.minus(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.minus(r)}get typeOrder(){return 33}compareTo(e){if(e instanceof $t){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof $t&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof $t&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash($t),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("minus").write(40).debug(this.operand2).write(41)}clone(){return new $t(this.operand1.clone(),this.operand2.clone())}}class Kt extends Pt{constructor(e,t){super(e,t)}get operator(){return"*"}get precedence(){return 9}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.times(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.times(r)}get typeOrder(){return 34}compareTo(e){if(e instanceof Kt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Kt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Kt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Kt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("times").write(40).debug(this.operand2).write(41)}clone(){return new Kt(this.operand1.clone(),this.operand2.clone())}}class Yt extends Pt{constructor(e,t){super(e,t)}get operator(){return"/"}get precedence(){return 9}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.divide(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.divide(r)}get typeOrder(){return 35}compareTo(e){if(e instanceof Yt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Yt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Yt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Yt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("divide").write(40).debug(this.operand2).write(41)}clone(){return new Yt(this.operand1.clone(),this.operand2.clone())}}class Jt extends Pt{constructor(e,t){super(e,t)}get operator(){return"%"}get precedence(){return 9}evaluate(e){(e=zt.fromLike(e)).willOperate(this);const t=this.operand1.evaluate(e),r=this.operand2.evaluate(e),i=t.modulo(r);return e.didOperate(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.operand1.substitute(e),r=this.operand2.substitute(e);return t.modulo(r)}get typeOrder(){return 36}compareTo(e){if(e instanceof Jt){let t=this.operand1.compareTo(e.operand1);return 0===t&&(t=this.operand2.compareTo(e.operand2)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof Jt&&(this.operand1.equivalentTo(e.operand1,t)&&this.operand2.equivalentTo(e.operand2,t))}equals(e){return this===e||e instanceof Jt&&(this.operand1.equals(e.operand1)&&this.operand2.equals(e.operand2))}hashCode(){return s.mash(s.mix(s.mix(m.hash(Jt),this.operand1.hashCode()),this.operand2.hashCode()))}debug(e){return e=e.debug(this.operand1).write(46).write("modulo").write(40).debug(this.operand2).write(41)}clone(){return new Jt(this.operand1.clone(),this.operand2.clone())}}class _t extends Lt{constructor(e){super(e)}get operator(){return"!"}get precedence(){return 10}evaluate(e){e=zt.fromLike(e);return this.operand.evaluate(e).not()}substitute(e){e=zt.fromLike(e);return this.operand.substitute(e).not()}get typeOrder(){return 37}compareTo(e){return d.compare(this.typeOrder,e.typeOrder)}equivalentTo(e,t){return this===e||e instanceof _t&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof _t&&this.operand.equals(e.operand)}hashCode(){return s.mash(s.mix(m.hash(_t),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("not").write(40).write(41)}clone(){return new _t(this.operand.clone())}}class er extends Lt{constructor(e){super(e)}get operator(){return"~"}get precedence(){return 10}evaluate(e){e=zt.fromLike(e);return this.operand.evaluate(e).bitwiseNot()}substitute(e){e=zt.fromLike(e);return this.operand.substitute(e).bitwiseNot()}get typeOrder(){return 38}compareTo(e){return e instanceof er?this.operand.compareTo(e.operand):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof er&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof er&&this.operand.equals(e.operand)}hashCode(){return s.mash(s.mix(m.hash(er),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("bitwiseNot").write(40).write(41)}clone(){return new er(this.operand.clone())}}class tr extends Lt{constructor(e){super(e)}get operator(){return"-"}get precedence(){return 10}evaluate(e){e=zt.fromLike(e);return this.operand.evaluate(e).negative()}substitute(e){e=zt.fromLike(e);return this.operand.substitute(e).negative()}get typeOrder(){return 39}compareTo(e){return e instanceof tr?this.operand.compareTo(e.operand):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof tr&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof tr&&this.operand.equals(e.operand)}hashCode(){return s.mash(s.mix(m.hash(tr),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("negative").write(40).write(41)}clone(){return new tr(this.operand.clone())}}class rr extends Lt{constructor(e){super(e)}get operator(){return"+"}get precedence(){return 10}evaluate(e){e=zt.fromLike(e);return this.operand.evaluate(e).positive()}substitute(e){e=zt.fromLike(e);return this.operand.substitute(e).positive()}get typeOrder(){return 40}compareTo(e){return e instanceof rr?this.operand.compareTo(e.operand):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof rr&&this.operand.equivalentTo(e.operand,t)}equals(e){return this===e||e instanceof rr&&this.operand.equals(e.operand)}hashCode(){return s.mash(s.mix(m.hash(rr),this.operand.hashCode()))}debug(e){return e=e.debug(this.operand).write(46).write("positive").write(40).write(41)}clone(){return new rr(this.operand.clone())}}class ir extends Tt{constructor(e,t){super(),this.func=e,this.args=t.commit(),this.state=void 0}setState(e){this.state=e}isConstant(){return this.func.isConstant()&&this.args.isConstant()}get precedence(){return 11}evaluate(e){e=zt.fromLike(e);const t=this.func.evaluate(e);return t instanceof wr?t.invoke(this.args,e,this):rt.absent()}substitute(e){e=zt.fromLike(e);const t=this.func.evaluate(e);if(t instanceof wr){const r=t.expand(this.args,e,this);if(void 0!==r)return r}const r=this.args.substitute(e).toValue();return new ir(this.func,r)}interpolateTo(e){return e instanceof ir?nr(this,e):super.interpolateTo(e)}get typeOrder(){return 41}compareTo(e){if(e instanceof ir){let t=this.func.compareTo(e.func);return 0===t&&(t=this.args.compareTo(e.args)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ir&&(this.func.equals(e.func)&&this.args.equivalentTo(e.args,t))}equals(e){return this===e||e instanceof ir&&(this.func.equals(e.func)&&this.args.equals(e.args))}hashCode(){return s.mash(s.mix(s.mix(m.hash(ir),this.func.hashCode()),this.args.hashCode()))}debug(e){return e=e.debug(this.func).write(46).write("invoke").write(40).debug(this.args).write(41)}clone(){return new ir(this.func.clone(),this.args.clone())}}const nr=function(e){const t=function(e,r){const i=function(e){const t=i.funcInterpolator(e),r=i.argsInterpolator(e);return new ir(t,r)};return Object.setPrototypeOf(i,t.prototype),i.funcInterpolator=e.func.interpolateTo(r.func),i.argsInterpolator=e.args.interpolateTo(r.args),i};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.defineProperty(t.prototype,0,{get(){const e=this.funcInterpolator[0],t=this.argsInterpolator[0];return new ir(e,t)},configurable:!0}),Object.defineProperty(t.prototype,1,{get(){const e=this.funcInterpolator[1],t=this.argsInterpolator[1];return new ir(e,t)},configurable:!0}),t.prototype.equals=function(e){return this===e||e instanceof t&&(this.funcInterpolator.equals(e.funcInterpolator)&&this.argsInterpolator.equals(e.argsInterpolator))},t}(D);let sr=(()=>{var e;let i,n,s,a,u,h=Et,l=[];return e=class extends h{constructor(){super()}isConstant(){return!1}evaluate(e){e=zt.fromLike(e);let t=rt.absent(),r=0;return this.forSelected(e,(function(e){const i=e.peekScope();if(void 0!==i){if(0===r)t=i;else{if(1===r){const e=dt.create();e.push(t),t=e}t.push(i)}r+=1}}),this),t}get(t){return t=lt.fromLike(t),this.andThen(new ar(t,e.identity()))}getAttr(t){return t=bt.fromLike(t),this.andThen(new ur(t,e.identity()))}getItem(t){return t=kt.fromLike(t),this.andThen(new hr(t,e.identity()))}keys(){return this.andThen(e.keys())}values(){return this.andThen(e.values())}children(){return this.andThen(e.children())}descendants(){return this.andThen(e.descendants())}filter(t){return 0===arguments.length?new fr(this,e.identity()):(t=rt.fromLike(t),this.andThen(t.filter()))}invoke(e){return new ir(this,e)}get precedence(){return 11}debug(e){return e=e.write("Selector").write(46).write("identity").write(40).write(41),e=this.debugThen(e)}static identity(){return new or}static get(t){return t=lt.fromLike(t),new ar(t,e.identity())}static getAttr(t){return t=bt.fromLike(t),new ur(t,e.identity())}static getItem(t){return t=kt.fromLike(t),new hr(t,e.identity())}static keys(){return new lr(e.identity())}static values(){return new cr(e.identity())}static children(){return new dr(e.identity())}static descendants(){return new pr(e.identity())}static literal(t){return(t=rt.fromLike(t))instanceof e||(t=new mr(t,e.identity())),t}},(()=>{var c;const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(c=h[Symbol.metadata])&&void 0!==c?c:null):void 0;i=[o],n=[o],s=[o],a=[o],u=[o],t(e,null,i,{kind:"method",name:"identity",static:!0,private:!1,access:{has:e=>"identity"in e,get:e=>e.identity},metadata:d},null,l),t(e,null,n,{kind:"method",name:"keys",static:!0,private:!1,access:{has:e=>"keys"in e,get:e=>e.keys},metadata:d},null,l),t(e,null,s,{kind:"method",name:"values",static:!0,private:!1,access:{has:e=>"values"in e,get:e=>e.values},metadata:d},null,l),t(e,null,a,{kind:"method",name:"children",static:!0,private:!1,access:{has:e=>"children"in e,get:e=>e.children},metadata:d},null,l),t(e,null,u,{kind:"method",name:"descendants",static:!0,private:!1,access:{has:e=>"descendants"in e,get:e=>e.descendants},metadata:d},null,l),d&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d}),r(e,l)})(),e})();class or extends sr{get then(){return this}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope(),s=n.evaluate(e);e.pushScope(s),i=t.call(r,e),e.swapScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){return t.call(r,e)}substitute(e){return(e=zt.fromLike(e)).peekScope().substitute(e)}get(e){return e=lt.fromLike(e),new ar(e,this)}getAttr(e){return e=bt.fromLike(e),new ur(e,this)}getItem(e){return e=kt.fromLike(e),new hr(e,this)}andThen(e){return e}keys(){return sr.keys()}values(){return sr.values()}children(){return sr.children()}descendants(){return sr.descendants()}filter(e){return 0===arguments.length?new fr(this,this):(e=rt.fromLike(e)).filter()}get typeOrder(){return 10}compareTo(e){return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(or)}debugThen(e){return e}clone(){return this}}class ar extends sr{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item.evaluate(e).toValue(),n=ar.forSelected(i,this.then,e,t,r);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof dt&&(a=o.getField(e),void 0!==a&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&(s=ar.forSelected(e,t,r,i,n)),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item.evaluate(e).toValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof dt){const i=s.getField(n);if(void 0!==i){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof nt?n.equals(o.key)?s.set(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.set(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.item.evaluate(e).toValue(),r=ar.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof sr||(i=this.then),new ar(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof dt&&(s=n.getField(e),void 0!==s&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&(i=ar.substitute(e,t,r)),r.pushScope(n)}return i}andThen(e){return new ar(this.item,this.then.andThen(e))}get typeOrder(){return 12}compareTo(e){if(e instanceof ar){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ar&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof ar&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return s.mash(s.mix(s.mix(m.hash(ar),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("get").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new ar(this.item.clone(),this.then.clone())}}class ur extends sr{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){e.willSelect(this);const i=this.item,n=ur.forSelected(i,this.then,e,t);return e.didSelect(this,n),n}static forSelected(e,t,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof dt&&(a=o.getField(e),a instanceof ot&&(r.pushScope(a.toValue()),s=t.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&(s=ur.forSelected(e,t,r,i,n)),r.pushScope(o)}return s}mapSelected(e,t,r){let i;e.willTransform(this);const n=this.item;if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof dt){const i=s.getField(n);if(i instanceof ot){e.pushScope(i.toValue());const o=this.then.mapSelected(e,t,r);e.popScope(),o instanceof nt?n.equals(o.key)?s.setAttr(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.setAttr(n,o.toValue()):s.delete(n)}}e.pushScope(s),i=s}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.item,r=ur.substitute(t,this.then,e);if(void 0!==r)return r;let i=this.then.substitute(e);return i instanceof sr||(i=this.then),new ur(this.item,i)}static substitute(e,t,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof dt&&(s=n.getField(e),s instanceof ot&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&(i=ur.substitute(e,t,r)),r.pushScope(n)}return i}andThen(e){return new ur(this.item,this.then.andThen(e))}get typeOrder(){return 13}compareTo(e){if(e instanceof ur){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof ur&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof ur&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return s.mash(s.mix(s.mix(m.hash(ur),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getAttr").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new ur(this.item.clone(),this.then.clone())}}class hr extends sr{constructor(e,t){super(),this.item=e,this.then=t}forSelected(e,t,r){let i;e.willSelect(this);const n=this.item.numberValue();if(0!==e.scopeDepth){const s=e.popScope().toValue();if(s instanceof dt&&n<s.length){const o=s.getItem(n);e.pushScope(o),i=this.then.forSelected(e,t,r),e.popScope()}e.pushScope(s)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue(),s=this.item.numberValue();if(n instanceof dt&&s<n.length){const i=n.getItem(s);e.pushScope(i);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?n.setItem(s,o):n.splice(s,1)}e.pushScope(n),i=n}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.item.numberValue();if(0!==e.scopeDepth){const r=e.popScope().toValue();let i;if(r instanceof dt&&t<r.length){i=r.getItem(t).substitute(e)}if(e.pushScope(r),void 0!==i)return i}let r=this.then.substitute(e);return r instanceof sr||(r=this.then),new hr(this.item,r)}andThen(e){return new hr(this.item,this.then.andThen(e))}get typeOrder(){return 14}compareTo(e){if(e instanceof hr){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof hr&&(this.item.equals(e.item)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof hr&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return s.mash(s.mix(s.mix(m.hash(hr),this.item.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("getItem").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}clone(){return new hr(this.item,this.then.clone())}}class lr extends sr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof dt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;n instanceof nt&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope())}}else n instanceof nt&&(e.pushScope(n.key),i=this.then.forSelected(e,t,r),e.popScope());e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof dt){const i=n.iterator();for(;i.hasNext();){const s=i.next().value;if(s instanceof nt){const o=s.key;e.pushScope(o);const a=this.then.mapSelected(e,t,r).toValue();e.popScope(),a.isDefined()?o!==a&&(n instanceof ot&&a instanceof bt?i.set(ot.of(a,n.toValue())):i.set(ut.of(a,n.toValue()))):i.delete()}}}else if(n instanceof nt){const i=n.key;e.pushScope(i);const s=this.then.mapSelected(e,t,r).toValue();e.popScope(),s.isDefined()?i!==s&&(n=n instanceof ot&&s instanceof bt?ot.of(s,n.toValue()):ut.of(s,n.toValue())):n=rt.absent()}e.pushScope(n),i=n}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);let t=this.then.substitute(e);return t instanceof sr||(t=this.then),new lr(t)}andThen(e){return new lr(this.then.andThen(e))}get typeOrder(){return 15}compareTo(e){return e instanceof lr?this.then.compareTo(e.then):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof lr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof lr&&this.then.equals(e.then)}hashCode(){return s.mash(s.mix(m.hash(lr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("keys").write(40).write(41),e=this.then.debugThen(e)}clone(){return new lr(this.then.clone())}}class cr extends sr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope();if(n instanceof dt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope()}}else e.pushScope(n.toValue()),i=this.then.forSelected(e,t,r),e.popScope();e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=e.popScope();if(n instanceof dt){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;if(n instanceof nt){const s=n.toValue();e.pushScope(s);const o=this.then.mapSelected(e,t,r);e.popScope(),o.isDefined()?o instanceof nt?i.set(o):o!==s&&i.set(n.updatedValue(o.toValue())):i.delete()}else{e.pushScope(n.toValue());const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?n!==s&&i.set(s):i.delete()}}}else if(n instanceof nt){const i=n.toValue();e.pushScope(i);const s=this.then.mapSelected(e,t,r);e.popScope(),s.isDefined()?s instanceof nt?n=s:s!==i&&(n=n.updatedValue(s.toValue())):n=rt.absent()}else e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope();e.pushScope(n),i=n}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);let t=this.then.substitute(e);return t instanceof sr||(t=this.then),new cr(t)}andThen(e){return new cr(this.then.andThen(e))}get typeOrder(){return 16}compareTo(e){return e instanceof cr?this.then.compareTo(e.then):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof cr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof cr&&this.then.equals(e.then)}hashCode(){return s.mash(s.mix(m.hash(cr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("values").write(40).write(41),e=this.then.debugThen(e)}clone(){return new cr(this.then.clone())}}class dr extends sr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof dt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const r=e.popScope().toValue();if(r instanceof dt){const i=r.iterator();for(;i.hasNext();){const r=i.next().value;e.pushScope(r);const n=this.then.mapSelected(e,t);e.popScope(),n.isDefined()?n!==r&&i.set(n):i.delete()}}e.pushScope(r),i=r}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);let t=this.then.substitute(e);return t instanceof sr||(t=this.then),new dr(t)}andThen(e){return new dr(this.then.andThen(e))}get typeOrder(){return 17}compareTo(e){return e instanceof dr?this.then.compareTo(e.then):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof dr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof dr&&this.then.equals(e.then)}hashCode(){return s.mash(s.mix(m.hash(dr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("children").write(40).write(41),e=this.then.debugThen(e)}clone(){return new dr(this.then.clone())}}class pr extends sr{constructor(e){super(),this.then=e}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof dt){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;e.pushScope(n),i=this.then.forSelected(e,t,r),void 0===i&&this.forSelected(e,t,r),e.popScope()}}e.pushScope(n)}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){const n=e.popScope().toValue();if(n instanceof dt){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;e.pushScope(n);let s=this.then.mapSelected(e,t,r);s.isDefined()&&(s=this.mapSelected(e,t,r)),e.popScope(),s.isDefined()?s!==n&&i.set(s):i.delete()}}e.pushScope(n),i=n}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);let t=this.then.substitute(e);return t instanceof sr||(t=this.then),new pr(t)}andThen(e){return new pr(this.then.andThen(e))}get typeOrder(){return 18}compareTo(e){return e instanceof pr?this.then.compareTo(e.then):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof pr&&this.then.equivalentTo(e.then,t)}equals(e){return this===e||e instanceof pr&&this.then.equals(e.then)}hashCode(){return s.mash(s.mix(m.hash(pr),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("descendants").write(40).write(41),e=this.then.debugThen(e)}clone(){return new pr(this.then.clone())}}class fr extends sr{constructor(e,t){super(),this.predicate=e,this.then=t}forSelected(e,t,r){let i;return e.willSelect(this),0!==e.scopeDepth&&this.filterSelected(e)&&(i=this.then.forSelected(e,t,r)),e.didSelect(this,i),i}mapSelected(e,t,r){let i;return e.willTransform(this),i=0!==e.scopeDepth?this.filterSelected(e)?this.then.mapSelected(e,t,r):e.peekScope().toValue():rt.absent(),e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);let t=this.predicate.substitute(e);t instanceof sr||(t=this.predicate);let r=this.then.substitute(e);return r instanceof sr||(r=this.then),new fr(t,r)}filterSelected(e){return void 0!==this.predicate.forSelected(e,this.selected,this)}selected(e){return null}andThen(e){return new fr(this.predicate,this.then.andThen(e))}filter(e){return 0===arguments.length?this:(e=rt.fromLike(e),this.andThen(e.filter()))}get typeOrder(){return 19}compareTo(e){if(e instanceof fr){let t=this.predicate.compareTo(e.predicate);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof fr&&(this.predicate.equivalentTo(e.predicate,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof fr&&(this.predicate.equals(e.predicate)&&this.then.equals(e.then))}hashCode(){return s.mash(s.mix(s.mix(m.hash(fr),this.predicate.hashCode()),this.then.hashCode()))}debugThen(e){return e=e.write(46).write("filter").write(40).debug(this.predicate).write(41),e=this.then.debugThen(e)}clone(){return new fr(this.predicate.clone(),this.then.clone())}}class mr extends sr{constructor(e,t){super(),this.item=e.commit(),this.then=t}forSelected(e,t,r){let i;if(e.willSelect(this),0!==e.scopeDepth){const n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),i=this.then.forSelected(e,t,r),e.popScope())}return e.didSelect(this,i),i}mapSelected(e,t,r){let i;if(e.willTransform(this),0!==e.scopeDepth){let n=this.item.evaluate(e);n.isDefined()&&(e.pushScope(n),n=this.then.mapSelected(e,t,r),e.popScope()),i=n}else i=rt.absent();return e.didTransform(this,i),i}substitute(e){e=zt.fromLike(e);const t=this.item.substitute(e);let r=this.then.substitute(e);return r instanceof sr||(r=this.then),new mr(t,r)}andThen(e){return new mr(this.item,this.then.andThen(e))}get precedence(){return this.item.precedence}get typeOrder(){return 11}compareTo(e){if(e instanceof mr){let t=this.item.compareTo(e.item);return 0===t&&(t=this.then.compareTo(e.then)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof mr&&(this.item.equivalentTo(e.item,t)&&this.then.equivalentTo(e.then,t))}equals(e){return this===e||e instanceof mr&&(this.item.equals(e.item)&&this.then.equals(e.then))}hashCode(){return s.mash(s.mix(s.mix(m.hash(mr),this.item.hashCode()),this.then.hashCode()))}debug(e){return e=e.write("Selector").write(46).write("literal").write(40).debug(this.item).write(41),e=this.then.debugThen(e)}debugThen(e){return e}clone(){return new mr(this.item.clone(),this.then.clone())}}class wr extends Et{constructor(){super()}isConstant(){return!1}expand(e,t,r){}}class yr extends wr{constructor(e,t){super(),this.bindings=e,this.template=t}get precedence(){return 1}invoke(e,t,r){t=zt.fromLike(t);const i=this.bindings,n=Math.max(1,i.length),s=dt.create(n);let o=0,a=0;for(;o<n;){const t=i instanceof dt?i.getItem(o):0===o?i:rt.absent(),r=e instanceof dt?e.getItem(a).toValue():0===a?e:lt.absent();t instanceof bt&&r.isDistinct()?(s.push(ut.of(t,r)),a+=1):t instanceof ut&&(r.isDistinct()?s.push(t.updatedValue(r)):s.push(t),a+=1),o+=1}t.pushScope(s);const u=this.template.evaluate(t);return t.popScope(),u}get typeOrder(){return 50}compareTo(e){if(e instanceof yr){let t=this.bindings.compareTo(e.bindings);return 0===t&&(t=this.template.compareTo(e.template)),t}return e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e,t){return this===e||e instanceof yr&&(this.bindings.equivalentTo(e.bindings,t)&&this.template.equivalentTo(e.template,t))}equals(e){return this===e||e instanceof yr&&(this.bindings.equals(e.bindings)&&this.template.equals(e.template))}hashCode(){return s.mash(s.mix(s.mix(m.hash(yr),this.bindings.hashCode()),this.template.hashCode()))}debug(e){return e=e.debug(this.bindings).write(46).write("lambda").write(40).debug(this.template).write(41)}}class gr extends wr{get typeOrder(){return 51}compareTo(e){return e instanceof gr?m.compare(this.constructor,e.constructor):e instanceof rt?d.compare(this.typeOrder,e.typeOrder):NaN}equivalentTo(e){return this===e}equals(e){return this===e}hashCode(){return m.hash(this.constructor)}debug(e){return e=e.write(this.constructor.name)}}const br=function(){const e={};Object.defineProperty(e,"max",{get(){const r=new t;return Object.defineProperty(e,"max",{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0}),Object.defineProperty(e,"min",{get(){const t=new r;return Object.defineProperty(e,"min",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"abs",{get(){const t=new i;return Object.defineProperty(e,"abs",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ceil",{get(){const t=new n;return Object.defineProperty(e,"ceil",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"floor",{get(){const t=new s;return Object.defineProperty(e,"floor",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"round",{get(){const t=new o;return Object.defineProperty(e,"round",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sqrt",{get(){const t=new a;return Object.defineProperty(e,"sqrt",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pow",{get(){const t=new u;return Object.defineProperty(e,"pow",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rate",{get(){const t=new h;return Object.defineProperty(e,"rate",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"random",{get(){const t=new l;return Object.defineProperty(e,"random",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scope",{get(){const t=dt.create(10).slot("max",e.max).slot("min",e.min).slot("abs",e.abs).slot("ceil",e.ceil).slot("floor",e.floor).slot("round",e.round).slot("pow",e.pow).slot("sqrt",e.sqrt).slot("rate",e.rate).slot("random",e.random).commit();return Object.defineProperty(e,"scope",{value:t,configurable:!0,enumerable:!0}),t},enumerable:!0,configurable:!0});class t extends gr{invoke(e,t,r){let i,n;if(t=zt.fromLike(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.max(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.max(n):i;return r.setState(e),e}return rt.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class r extends gr{invoke(e,t,r){let i,n;if(t=zt.fromLike(t),e.length>=2?(i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t)):i=e.evaluate(t),void 0!==n)return i.min(n);if(void 0!==r){n=r.state;const e=void 0!==n?i.min(n):i;return r.setState(e),e}return rt.absent()}expand(e,t,r){if(1===e.length)return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class i extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof kt?e.abs():rt.absent()}}class n extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof kt?e.ceil():rt.absent()}}class s extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof kt?e.floor():rt.absent()}}class o extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof kt?e.round():rt.absent()}}class a extends gr{invoke(e,t,r){return(e=e.evaluate(t).toValue())instanceof kt?e.sqrt():rt.absent()}}class u extends gr{invoke(e,t,r){t=zt.fromLike(t);const i=e.getItem(0).evaluate(t),n=e.getItem(1).evaluate(t);return i instanceof kt&&n instanceof kt?i.pow(n):rt.absent()}}class h extends gr{invoke(e,t,r){let i,n;if(t=zt.fromLike(t),e.length>=2?(i=e.getItem(0).evaluate(t).numberValue(NaN),n=e.getItem(1).evaluate(t).numberValue(1e3)):(i=e.evaluate(t).numberValue(NaN),n=1e3),isFinite(i)&&void 0!==r){let e=r.state;if(void 0===e)e={v0:i,t0:Date.now(),dv:0,dt:0},r.setState(e);else{const t=Date.now(),s=t-e.t0;if(s>n&&t>e.t0||s>2*n){const r=i-e.v0;e.v0=i,e.t0=t,e.dv=r,e.dt=s}if(r.setState(e),0!==e.dt){const t=n*e.dv/e.dt;return kt.from(t)}}}return rt.absent()}expand(e,t,r){return e=e.evaluate(t).toValue(),this.invoke(e,t,r)}}class l extends gr{invoke(e,t,r){const i=(e=e.evaluate(t).toValue()).length>=1?e.getItem(0).numberValue(0):0,n=e.length>=2?e.getItem(1).numberValue(i+1):i+1,s=i+Math.random()*(n-i);return kt.from(s)}}return e}();let vr=(()=>{var e;let i,n,s,a,u,h,l=[];return e=class{withTag(e){return void 0===e||e===this.tag?this:new kr(this,e)}withUnit(e){return e===this.unit?this:new Or(this,e)}static forString(){return new xr("")}static forNumber(){return new Sr(0)}static forBoolean(){return new Cr(!1)}static forAny(){return new Er(void 0)}static forItem(){return new Tr(rt.absent())}static forValue(){return new Pr(lt.absent())}},(()=>{const c="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],s=[o],a=[o],u=[o],h=[o],t(e,null,i,{kind:"method",name:"forString",static:!0,private:!1,access:{has:e=>"forString"in e,get:e=>e.forString},metadata:c},null,l),t(e,null,n,{kind:"method",name:"forNumber",static:!0,private:!1,access:{has:e=>"forNumber"in e,get:e=>e.forNumber},metadata:c},null,l),t(e,null,s,{kind:"method",name:"forBoolean",static:!0,private:!1,access:{has:e=>"forBoolean"in e,get:e=>e.forBoolean},metadata:c},null,l),t(e,null,a,{kind:"method",name:"forAny",static:!0,private:!1,access:{has:e=>"forAny"in e,get:e=>e.forAny},metadata:c},null,l),t(e,null,u,{kind:"method",name:"forItem",static:!0,private:!1,access:{has:e=>"forItem"in e,get:e=>e.forItem},metadata:c},null,l),t(e,null,h,{kind:"method",name:"forValue",static:!0,private:!1,access:{has:e=>"forValue"in e,get:e=>e.forValue},metadata:c},null,l),c&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c}),r(e,l)})(),e})();Object.defineProperty(vr.prototype,"tag",{get(){},configurable:!0}),Object.defineProperty(vr.prototype,"unit",{get(){},configurable:!0});class kr extends vr{constructor(e,t){super(),this.form=e,this.tag=t}withTag(e){return void 0!==e&&e!==this.tag?new kr(this.form,e):void 0===e?this.form:this}withUnit(e){return e===this.unit?this:new kr(this.form.withUnit(e),this.tag)}mold(e,t){return(t=this.form.mold(e,t)).header(this.tag).isDefined()||(t=t.prepended(ot.of(this.tag))),t}cast(e,t){return e.header(this.tag).isDefined()?this.form.cast(e,t):e.keyEquals(this.tag)?this.form.cast(e.toValue(),t):void 0}}Object.defineProperty(kr.prototype,"unit",{get(){return this.form.unit},configurable:!0});class Or extends vr{constructor(e,t){super(),this.form=e,Object.defineProperty(this,"unit",{value:t,enumerable:!0,configurable:!0})}withTag(e){return e===this.tag?this:new Or(this.form.withTag(e),this.unit)}withUnit(e){return e!==this.unit?new Or(this.form,e):e===this.form.unit?this.form:this}mold(e,t){return 1===arguments.length?this.form.mold(e):this.form.mold(e,t)}cast(e,t){return 1===arguments.length?this.form.cast(e):this.form.cast(e,t)}}Object.defineProperty(Or.prototype,"tag",{get(){return this.form.tag},configurable:!0});class xr extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new xr(e)}mold(e,t){return void 0===t?bt.from(e):t.concat(bt.from(e))}cast(e,t){const r=e.target;try{return r.stringValue()}catch(e){return}}}class Sr extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Sr(e)}mold(e,t){return void 0===t?kt.from(e):t.concat(kt.from(e))}cast(e,t){const r=e.target;try{return r.numberValue()}catch(e){return}}}class Cr extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Cr(e)}mold(e,t){return void 0===t?xt.from(e):t.concat(xt.from(e))}cast(e,t){const r=e.target;try{return r.booleanValue()}catch(e){return}}}class Er extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Er(e)}mold(e,t){return e=rt.fromLike(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toLike()}}class Tr extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Tr(e)}mold(e,t){return e=rt.fromLike(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e}}class Pr extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Pr(e)}mold(e,t){return e=lt.fromLike(e),void 0!==t&&(e=t.concat(e)),e}cast(e,t){return e.toValue()}}const Dr=function(){const e={};return Object.defineProperty(e,"structureParser",{value:function(){const t=new oi;return Object.defineProperty(e,"structureParser",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"structureWriter",{value:function(){const t=new Li;return Object.defineProperty(e,"structureWriter",{value:function(){return t},enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),e.parse=function(t){return e.structureParser().parseBlockString(t)},e.parser=function(){return e.structureParser().blockParser()},e.sizeOf=function(t){return e.structureWriter().sizeOfItem(t)},e.sizeOfBlock=function(t){return e.structureWriter().sizeOfBlockItem(t)},e.write=function(t,r){return e.structureWriter().writeItem(t,r)},e.writeBlock=function(t,r){return e.structureWriter().writeBlockItem(t,r)},e.toString=function(t){let r=he.stringOutput();const i=e.write(r,t);return i.isDone()||(r=ne.error(i.trap())),r.bind()},e.toBlockString=function(t){let r=he.stringOutput();const i=e.writeBlock(r,t);return i.isDone()||(r=ne.error(i.trap())),r.bind()},e.toData=function(t){let r=He.encodedOutput(yt.output());const i=e.write(r,t);return i.isDone()||(r=ne.error(i.trap())),r.bind()},e.toBlockData=function(t){let r=He.encodedOutput(yt.output());const i=e.writeBlock(r,t);return i.isDone()||(r=ne.error(i.trap())),r.bind()},e.isSpace=function(e){return 32===e||9===e},e.isNewline=function(e){return 10===e||13===e},e.isWhitespace=function(t){return e.isSpace(t)||e.isNewline(t)},e.isIdentStartChar=function(e){return e>=65&&e<=90||95===e||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},e.isIdentChar=function(e){return 45===e||e>=48&&e<=57||e>=65&&e<=90||95===e||e>=97&&e<=122||183===e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039},rt.prototype.toRecon=function(){return e.toString(this)},rt.prototype.toReconBlock=function(){return e.toBlockString(this)},e}();lt.parseRecon=function(e){return Dr.parse(e)};class Lr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return Lr.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;e:for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont())if(33===o||34===o||36===o||37===o||39===o||40===o||43===o||45===o||o>=48&&o<=57||64===o||91===o||96===o||123===o||126===o||Dr.isIdentStartChar(o))r=r||t.valueBuilder(),s=2;else{if(35!==o)return void 0!==r?Te.done(r.build()):Te.done(t.absent());e=e.step(),s=7}else if(e.isDone())return void 0!==r?Te.done(r.build()):Te.done(t.absent())}if(2===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=3;else if(i.isError())return i}if(3===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=4):(r.push(t.item(i.bind())),i=void 0,s=6);else if(e.isDone())return r.push(t.item(i.bind())),Te.done(r.build())}if(4===s){for(;e.isCont()&&Dr.isSpace(e.head());)e=e.step();if(e.isCont())s=5;else if(e.isDone())return r.push(t.slot(i.bind())),Te.done(r.build())}if(5===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||Dr.isNewline(o)){e=e.step(),s=1;continue}if(35!==o)return Te.done(r.build());e=e.step(),s=7}else if(e.isDone())return Te.done(r.build())}if(7===s){for(;e.isCont();){if(o=e.head(),Dr.isNewline(o)){s=1;continue e}e=e.step()}if(e.isDone()){s=1;continue}}break}return new Lr(t,r,i,n,s)}}class qr extends Te{constructor(e,t,r,i){super(),this.recon=e,this.keyParser=t,this.valueParser=r,this.step=i}feed(e){return qr.parse(e,this.recon,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if(e.isCont()){if(s=e.head(),64!==s)return Te.error(de.expected(64,e));e=e.step(),n=2}else if(e.isDone())return Te.error(de.expected(64,e));if(2===n){if(void 0===r){if(e.isCont())if(s=e.head(),34===s||39===s)r=t.parseString(e);else{if(!Dr.isIdentStartChar(s))return Te.error(de.expected("attribute name",e));r=t.parseIdent(e)}else if(e.isDone())return Te.error(de.expected("attribute name",e))}else r=r.feed(e);if(void 0!==r)if(r.isDone())n=3;else if(r.isError())return r.asError()}if(3===n)if(e.isCont()&&40===e.head())e=e.step(),n=4;else if(!e.isEmpty())return Te.done(t.attr(r.bind()));if(4===n){for(;e.isCont()&&(s=e.head(),Dr.isWhitespace(s));)e=e.step();if(e.isCont()){if(41===s)return e=e.step(),Te.done(t.attr(r.bind()));n=5}else if(e.isDone())return Te.error(de.expected(")",e))}if(5===n){for(void 0===i&&(i=t.parseBlock(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;e.isCont()&&(s=e.head(),Dr.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),Te.done(t.attr(r.bind(),i.bind()))):Te.error(de.expected(")",e));if(e.isDone())return Te.error(de.expected(")",e))}return new qr(t,r,i,n)}}class Ir extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return Ir.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)r=r||t.recordBuilder(),n=t.parseRecord(e,r),s=5;else if(91===o)r=r||t.recordBuilder(),n=t.parseMarkup(e,r),s=5;else if(Dr.isIdentStartChar(o))n=t.parseIdent(e),s=4;else if(34===o||39===o)n=t.parseString(e),s=4;else if(96===o)n=t.parseRawString(e),s=4;else if(45===o||o>=48&&o<=57)n=t.parseNumber(e),s=4;else if(37===o)n=t.parseData(e),s=4;else{if(36!==o)return void 0===r?Te.done(t.extant()):Te.done(r.build());n=t.parseSelector(e),s=4}else if(e.isDone())return void 0===r?Te.done(t.extant()):Te.done(r.build());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s){for(;e.isCont()&&Dr.isSpace(e.head());)e=e.step();if(e.isCont()){s=1;continue}if(e.isDone())return Te.done(r.build())}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;e.isCont()&&Dr.isSpace(e.head());)e=e.step();if(e.isCont()){if(64!==e.head())return Te.done(r.build());s=1}else if(e.isDone())return Te.done(r.build())}break}return new Ir(t,r,i,n,s)}}class Ar extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return Ar.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont())if(o=e.head(),64===o)i=t.parseAttr(e),s=2;else if(123===o)void 0!==r?(n=t.parseRecord(e,r),s=5):(n=t.parseRecord(e),s=4);else{if(91!==o)return void 0===r?Te.done(t.extant()):Te.done(r.build());void 0!==r?(n=t.parseMarkup(e,r),s=5):(n=t.parseMarkup(e),s=4)}else if(e.isDone())return void 0===r?Te.done(t.extant()):Te.done(r.build());if(2===s){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())(r=r||t.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s)if(e.isCont())if(o=e.head(),123===o)n=t.parseRecord(e,r),s=5;else{if(91!==o)return Te.done(r.build());n=t.parseMarkup(e,r),s=5}else if(e.isDone())return Te.done(r.build());if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return(r=r||t.valueBuilder()).push(t.item(n.bind())),Te.done(r.build());if(n.isError())return n}if(5===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())return Te.done(r.build());if(n.isError())return n}return new Ar(t,r,i,n,s)}}class Nr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.keyParser=r,this.valueParser=i,this.step=n}feed(e){return Nr.parse(e,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),123!==o)return Te.error(de.expected(123,e));e=e.step(),s=2}else if(e.isDone())return Te.error(de.expected(123,e));e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont()){if(r=r||t.recordBuilder(),125===o)return e=e.step(),Te.done(r.build());35===o?(e=e.step(),s=8):s=3}else if(e.isDone())return Te.error(de.expected(125,e))}if(3===s){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=4;else if(i.isError())return i}if(4===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont())58===o?(e=e.step(),s=5):(r.push(t.item(i.bind())),i=void 0,s=7);else if(e.isDone())return Te.error(de.expected(125,e))}if(5===s){for(;e.isCont()&&Dr.isSpace(e.head());)e=e.step();if(e.isCont())s=6;else if(e.isDone())return r.push(t.slot(i.bind())),Te.done(r.build())}if(6===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())r.push(t.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=7;else if(n.isError())return n}if(7===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(44===o||59===o||Dr.isNewline(o)){e=e.step(),s=2;continue}if(35!==o)return 125===o?(e=e.step(),Te.done(r.build())):Te.error(de.expected("\'}\', \';\', \',\', or newline",e));e=e.step(),s=8}else if(e.isDone())return Te.error(de.expected(125,e))}if(8===s){for(;e.isCont();){if(o=e.head(),Dr.isNewline(o)){s=2;continue e}e=e.step()}if(e.isDone()){s=2;continue}}break}return new Nr(t,r,i,n,s)}}class jr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.textOutput=r,this.valueParser=i,this.step=n}feed(e){return jr.parse(e,this.recon,this.builder,this.textOutput,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s)if(e.isCont()){if(o=e.head(),91!==o)return Te.error(de.expected(91,e));e=e.step(),s=2}else if(e.isDone())return Te.error(de.expected(91,e));for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),64!==o&&91!==o&&92!==o&&93!==o&&123!==o&&125!==o);)e=e.step(),(i=i||t.textOutput()).write(o);if(e.isCont()){if(93===o)return e=e.step(),r=r||t.recordBuilder(),void 0!==i&&r.push(t.item(i.bind())),Te.done(r.build());if(64===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseInlineItem(e),s=3;else if(123===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseRecord(e,r),s=4;else if(91===o)r=r||t.recordBuilder(),void 0!==i&&(r.push(t.item(i.bind())),i=void 0),n=t.parseMarkup(e,r),s=4;else{if(92!==o)return Te.error(de.unexpected(e));e=e.step(),s=5}}else if(e.isDone())return Te.error(de.unexpected(e))}if(3===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){r.push(t.item(n.bind())),n=void 0,s=2;continue}if(n.isError())return n}if(4===s){for(;n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){n=void 0,s=2;continue}if(n.isError())return n}if(5===s){if(e.isCont()){if(o=e.head(),i=i||t.textOutput(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o)e=e.step(),i.write(o),s=2;else if(98===o)e=e.step(),i.write(8),s=2;else if(102===o)e=e.step(),i.write(12),s=2;else if(110===o)e=e.step(),i.write(10),s=2;else if(114===o)e=e.step(),i.write(13),s=2;else{if(116!==o)return Te.error(de.expected("escape character",e));e=e.step(),i.write(9),s=2}continue}if(e.isDone())return Te.error(de.expected("escape character",e))}break}return new jr(t,r,i,n,s)}}class zr extends Te{constructor(e,t,r){super(),this.recon=e,this.base64Parser=t,this.step=r}feed(e){return zr.parse(e,this.recon,this.base64Parser,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),37!==n)return Te.error(de.expected(37,e));e=e.step(),i=2}else if(e.isDone())return Te.error(de.expected(37,e));if(2===i){for(void 0===r&&(r=Ye.standard().parse(e,t.dataOutput()));r.isCont()&&!e.isEmpty();)r=r.feed(e);if(r.isDone())return r;if(r.isError())return r}return new zr(t,r,i)}}class Vr extends Te{constructor(e,t,r){super(),this.recon=e,this.output=t,this.step=r}feed(e){return Vr.parse(e,this.recon,this.output,this.step)}static parse(e,t,r,i=1){let n=0;if(1===i)if(e.isCont()){if(n=e.head(),!Dr.isIdentStartChar(n))return Te.error(de.expected("identifier",e));e=e.step(),r=(r=r||t.textOutput()).write(n),i=2}else if(e.isDone())return Te.error(de.expected("identifier",e));if(2===i){for(;e.isCont()&&(n=e.head(),Dr.isIdentChar(n));)e=e.step(),r.write(n);if(!e.isEmpty())return Te.done(t.ident(r.bind()))}return new Vr(t,r,i)}}class Mr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.output=t,this.quote=r,this.code=i,this.step=n}feed(e){return Mr.parse(e,this.recon,this.output,this.quote,this.code,this.step)}static parse(e,t,r,i=0,n=0,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont()){if(34!==o&&39!==o||i!==o&&0!==i)return Te.error(de.expected("string",e));e=e.step(),r=r||t.textOutput(),i=o,s=2}else if(e.isDone())return Te.error(de.expected("string",e))}e:for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),o>=32&&o!==i&&92!==o);)e=e.step(),r=r.write(o);if(e.isCont()){if(o===i)return e=e.step(),Te.done(r.bind());if(92!==o)return Te.error(de.expected(i,e));e=e.step(),s=3}else if(e.isDone())return Te.error(de.expected(i,e))}if(3===s)if(e.isCont()){if(o=e.head(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o){e=e.step(),r=r.write(o),s=2;continue}if(98===o){e=e.step(),r=r.write(8),s=2;continue}if(102===o){e=e.step(),r=r.write(12),s=2;continue}if(110===o){e=e.step(),r=r.write(10),s=2;continue}if(114===o){e=e.step(),r=r.write(13),s=2;continue}if(116===o){e=e.step(),r=r.write(9),s=2;continue}if(117!==o)return Te.error(de.expected("escape character",e));e=e.step(),s=4}else if(e.isDone())return Te.error(de.expected("escape character",e));if(s>=4)for(;;){if(e.isCont()){if(o=e.head(),Ue.isDigit(o)){if(e=e.step(),n=16*n+Ue.decodeDigit(o),s<=6){s+=1;continue}r=r.write(n),n=0,s=2;continue e}return Te.error(de.expected("hex digit",e))}if(e.isDone())return Te.error(de.expected("hex digit",e));break}break}return new Mr(t,r,i,n,s)}}class Fr extends Te{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.count=r,this.step=i}feed(e){return Fr.parse(e,this.recon,this.output,this.count,this.step)}static parse(e,t,r,i=0,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Dr.isWhitespace(s));)e=e.step();if(e.isCont()&&96===s)e=e.step(),i=1,n=2;else if(e.isDone())return Te.error(de.expected("raw string",e))}if(2===n)if(e.isCont())96===e.head()?(e=e.step(),i=2,n=3):(r=r||t.textOutput(),n=4);else if(e.isDone())return Te.error(de.expected("raw string",e));if(3===n)if(e.isCont()){if(96!==e.head())return r=r||t.textOutput(),Te.done(r.bind());e=e.step(),r=r||t.textOutput(),i=3,n=4}else if(e.isDone())return r=r||t.textOutput(),Te.done(r.bind());for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),(1!==i||s>=32)&&96!==s&&92!==s);)e=e.step(),r=r.write(s);if(e.isCont())if(92===s)e=e.step(),n=5;else{if(96!==s)return Te.error(de.expected(96,e));if(e=e.step(),1===i)return Te.done(r.bind());n=6}else if(e.isDone())return Te.error(de.expected(96,e))}if(5===n){if(e.isCont()){s=e.head(),e=e.step(),92!==s&&96!==s&&(r=r.write(92)),r=r.write(s),n=4;continue}if(e.isDone())return Te.error(de.expected("escape character",e))}if(6===n)if(e.isCont()){if(96!==e.head()){r=r.write(96),n=4;continue}e=e.step(),n=7}else if(e.isDone())return Te.error(de.message("unclosed raw string",e));if(7===n){if(e.isCont()){if(96===e.head())return e=e.step(),Te.done(r.bind());r=(r=r.write(96)).write(96),n=4;continue}if(e.isDone())return Te.error(de.message("unclosed raw string",e))}break}return new Fr(t,r,i,n)}}class Br extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.sign=t,this.value=r,this.mode=i,this.step=n}feed(e){return Br.parse(e,this.recon,this.sign,this.value,this.mode,this.step)}static parse(e,t,r=1,i=0,n=2,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont())45===o&&(e=e.step(),r=-1),s=2;else if(e.isDone())return Te.error(de.expected("number",e))}if(2===s)if(e.isCont())if(o=e.head(),48===o)e=e.step(),s=4;else{if(!(o>=49&&o<=57))return Te.error(de.expected("digit",e));e=e.step(),i=r*(o-48),s=3}else if(e.isDone())return Te.error(de.expected("digit",e));if(3===s){for(;e.isCont()&&(o=e.head(),o>=48&&o<=57);){const t=10*i+r*(o-48);if(!(-9007199254740991<=t&&t<=9007199254740992))return Te.error(de.message("integer overflow",e));i=t,e=e.step()}if(e.isCont())s=4;else if(e.isDone())return Te.done(t.num(i))}if(4===s){if(e.isCont()){if(o=e.head(),n>0&&46===o||n>1&&(69===o||101===o)){let s=he.stringOutput();return s=r<0&&0===i?s.write(45).write(48):s.write(""+i),Ur.parse(e,t,s,n)}return 120===o&&r>0&&0===i?(e=e.step(),Rr.parse(e,t)):Te.done(t.num(i))}if(e.isDone())return Te.done(t.num(i))}return new Br(t,r,i,n,s)}static parseInteger(e,t){return Br.parse(e,t,void 0,void 0,0)}static parseDecimal(e,t){return Br.parse(e,t,void 0,void 0,1)}}class Ur extends Te{constructor(e,t,r,i){super(),this.recon=e,this.output=t,this.mode=r,this.step=i}feed(e){return Ur.parse(e,this.recon,this.output,this.mode,this.step)}static parse(e,t,r,i=2,n=1){let s=0;if(1===n)if(e.isCont())if(s=e.head(),46===s)e=e.step(),r=r.write(s),n=2;else{if(!(i>1)||69!==s&&101!==s)return Te.error(de.expected("decimal or exponent",e));e=e.step(),r=r.write(s),n=5}else if(e.isDone())return Te.error(de.expected("decimal or exponent",e));if(2===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Te.error(de.expected("digit",e));e=e.step(),r=r.write(s),n=3}else if(e.isDone())return Te.error(de.expected("digit",e));if(3===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(e.isCont()){if(!(i>1))return Te.done(t.num(r.bind()));n=4}else if(e.isDone())return Te.done(t.num(r.bind()))}if(4===n){if(s=e.head(),69!==s&&101!==s)return Te.done(t.num(r.bind()));e=e.step(),r=r.write(s),n=5}if(5===n)if(e.isCont())s=e.head(),43!==s&&45!==s||(e=e.step(),r=r.write(s)),n=6;else if(e.isDone())return Te.error(de.unexpected(e));if(6===n)if(e.isCont()){if(s=e.head(),!(s>=48&&s<=57))return Te.error(de.expected("digit",e));e=e.step(),r=r.write(s),n=7}else if(e.isDone())return Te.error(de.expected("digit",e));if(7===n){for(;e.isCont()&&(s=e.head(),s>=48&&s<=57);)e=e.step(),r=r.write(s);if(!e.isEmpty())return Te.done(t.num(r.bind()))}return new Ur(t,r,i,n)}}class Rr extends Te{constructor(e,t,r){super(),this.recon=e,this.value=t,this.size=r}feed(e){return Rr.parse(e,this.recon,this.value,this.size)}static parse(e,t,r=0,i=0){let n=0;for(;e.isCont()&&(n=e.head(),Ue.isDigit(n));)e=e.step(),r=16*r+Ue.decodeDigit(n),i+=1;return e.isEmpty()?new Rr(t,r,i):i>0?i<=8?Te.done(t.uint32(r)):Te.done(t.uint64(r)):Te.error(de.expected("hex digit",e))}}class Wr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.bindingsParser=r,this.templateParser=i,this.step=n}feed(e){return Wr.parse(e,this.recon,this.builder,this.bindingsParser,this.templateParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parseConditionalOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),62!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseConditionalOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();return Te.done(t.lambda(e,r))}if(n.isError())return n.asError()}return new Wr(t,r,i,n,s)}}class Hr extends Te{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.ifParser=r,this.thenParser=i,this.elseParser=n,this.step=s}feed(e){return Hr.parse(e,this.recon,this.builder,this.ifParser,this.thenParser,this.elseParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Dr.isSpace(a));)e=e.step();if(e.isCont()){if(63!==a)return i;e=e.step(),o=3}else if(e.isDone())return i}if(3===o){for(void 0===n&&(n=t.parseConditionalOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;e.isCont()&&(a=e.head(),Dr.isSpace(a));)e=e.step();if(e.isCont()){if(58!==a)return Te.error(de.expected(58,e));e=e.step(),o=5}else if(e.isDone())return Te.error(de.expected(58,e))}if(5===o){for(void 0===s&&(s=t.parseConditionalOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const e=i.bind(),r=n.bind(),o=s.bind();return Te.done(t.conditional(e,r,o))}if(s.isError())return s.asError()}return new Hr(t,r,i,n,s,o)}}class Zr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Zr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Te.done(t.or(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Zr(t,r,i,n,s)}}class Qr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Qr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseOrOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(e.isCont()){if(o=e.head(),38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i;if(3===s){for(void 0===n&&(n=t.parseBitwiseOrOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Te.done(t.and(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Qr(t,r,i,n,s)}}class Gr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Gr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseXorOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(124!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),124===o)return i;s=4}else if(e.isDone())return Te.error(de.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseBitwiseXorOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Te.done(t.bitwiseOr(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Gr(t,r,i,n,s)}}class Xr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return Xr.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseBitwiseAndOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(94!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(void 0===n&&(n=t.parseBitwiseAndOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Te.done(t.bitwiseXor(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Xr(t,r,i,n,s)}}class $r extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(e){return $r.parse(e,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=t.parseComparisonOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(38!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s)if(e.isCont()){if(o=e.head(),38===o)return i;s=4}else if(e.isDone())return Te.error(de.unexpected(e));if(4===s){for(void 0===n&&(n=t.parseComparisonOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const e=i.bind(),r=n.bind();i=Te.done(t.bitwiseAnd(e,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new $r(t,r,i,n,s)}}class Kr extends Te{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Kr.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=t.parseAttrExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Dr.isSpace(a));)e=e.step();if(e.isCont())if(33===a)e=e.step(),o=3;else if(60===a)e=e.step(),o=4;else if(62===a)e=e.step(),o=5;else{if(61!==a)return i;e=e.step(),o=6}else if(e.isDone())return i}if(3===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="!=",o=7):(n="!",o=7);else if(e.isDone())return Te.error(de.unexpected(e));if(4===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n="<=",o=7):(n="<",o=7);else if(e.isDone())return Te.error(de.unexpected(e));if(5===o)if(e.isCont())a=e.head(),61===a?(e=e.step(),n=">=",o=7):(n=">",o=7);else if(e.isDone())return Te.error(de.unexpected(e));if(6===o)if(e.isCont())if(a=e.head(),61===a)e=e.step(),n="==",o=7;else{if(62===a)return i;n="=",o=7}else if(e.isDone())return Te.error(de.unexpected(e));if(7===o){for(void 0===s&&(s=t.parseAttrExpression(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),o=s.bind();return"<"===n?Te.done(t.lt(r,o)):"<="===n?Te.done(t.le(r,o)):"=="===n?Te.done(t.eq(r,o)):"!="===n?Te.done(t.ne(r,o)):">="===n?Te.done(t.ge(r,o)):">"===n?Te.done(t.gt(r,o)):Te.error(de.message(n,e))}if(s.isError())return s.asError()}return new Kr(t,r,i,n,s,o)}}class Yr extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.fieldParser=r,this.valueParser=i,this.step=n}feed(e){return Yr.parse(e,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;for(;;){if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont())if(64===o)s=2;else if(123===o||91===o)r=r||t.recordBuilder(),s=5;else if(40===o)s=4;else{if(!(33===o||34===o||36===o||37===o||39===o||43===o||45===o||o>=48&&o<=57||96===o||126===o||Dr.isIdentStartChar(o)))return void 0===r?Te.done(t.extant()):Te.done(r.build());s=3}else if(e.isDone())return void 0===r?Te.done(t.extant()):Te.done(r.build())}if(2===s){for(void 0===i&&(i=t.parseAttr(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){(r=r||t.recordBuilder()).push(i.bind()),i=void 0,s=1;continue}if(i.isError())return i.asError()}if(3===s){for(void 0===n&&(n=t.parseAdditiveOperator(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())(r=r||t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())void 0===r&&(r=t.valueBuilder()).push(t.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(5===s){for(void 0===n&&(n=t.parseAdditiveOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())n=void 0,s=6;else if(n.isError())return n.asError()}if(6===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(64===o){s=1;continue}return Te.done(r.build())}if(e.isDone())return Te.done(r.build())}break}return new Yr(t,r,i,n,s)}}class Jr extends Te{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return Jr.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parseMultiplicativeOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Dr.isSpace(a));)e=e.step();if(e.isCont())if(43===a)e=e.step(),n="+",o=3;else{if(45!==a)return i;e=e.step(),n="-",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parseMultiplicativeOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("+"===n)i=Te.done(t.plus(r,a));else{if("-"!==n)return Te.error(de.message(n,e));i=Te.done(t.minus(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Jr(t,r,i,n,s,o)}}class _r extends Te{constructor(e,t,r,i,n,s){super(),this.recon=e,this.builder=t,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(e){return _r.parse(e,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=t.parsePrefixOperator(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;e.isCont()&&(a=e.head(),Dr.isSpace(a));)e=e.step();if(e.isCont())if(42===a)e=e.step(),n="*",o=3;else if(47===a)e=e.step(),n="/",o=3;else{if(37!==a)return i;e=e.step(),n="%",o=3}else if(e.isDone())return i}if(3===o){for(void 0===s&&(s=t.parsePrefixOperator(e,r));s.isCont()&&!e.isEmpty();)s=s.feed(e);if(s.isDone()){const r=i.bind(),a=s.bind();if("*"===n)i=Te.done(t.times(r,a));else if("/"===n)i=Te.done(t.divide(r,a));else{if("%"!==n)return Te.error(de.message(n,e));i=Te.done(t.modulo(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new _r(t,r,i,n,s,o)}}class ei extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.operator=r,this.operandParser=i,this.step=n}feed(e){return ei.parse(e,this.recon,this.builder,this.operator,this.operandParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(33===o)e=e.step(),i="!";else if(126===o)e=e.step(),i="~";else if(45===o)e=e.step(),i="-";else{if(43!==o)return t.parseInvokeOperator(e,r);e=e.step(),i="+"}s=2}else if(e.isDone())return t.parseInvokeOperator(e,r)}if(2===s){for(void 0===n&&(n=t.parsePrefixOperator(e,r));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone()){const r=n.bind();return t.isDistinct(r)?"!"===i?Te.done(t.not(r)):"~"===i?Te.done(t.bitwiseNot(r)):"-"===i?Te.done(t.negative(r)):"+"===i?Te.done(t.positive(r)):Te.error(de.message(i,e)):Te.error(de.expected("value",e))}if(n.isError())return n.asError()}return new ei(t,r,i,n,s)}}class ti extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.exprParser=r,this.argsParser=i,this.step=n}feed(e){return ti.parse(e,this.recon,this.builder,this.exprParser,this.argsParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=t.parsePrimary(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())s=2;else if(i.isError())return i.asError()}for(;;){if(2===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(40!==o)return i;e=e.step(),s=3}else if(e.isDone())return i}if(3===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind();i=Te.done(t.invoke(r,t.extant())),s=2;continue}s=4}else if(e.isDone())return Te.error(de.expected(41,e))}if(4===s){for(void 0===n&&(n=t.parseBlock(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=5;else if(n.isError())return n.asError()}if(5===s){for(;e.isCont()&&(o=e.head(),Dr.isWhitespace(o));)e=e.step();if(e.isCont()){if(41===o){e=e.step();const r=i.bind(),o=n.bind();i=Te.done(t.invoke(r,o)),n=void 0,s=2;continue}return Te.error(de.expected(41,e))}if(e.isDone())return Te.error(de.expected(41,e))}break}return new ti(t,r,i,n,s)}}class ri extends Te{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.exprParser=r,this.step=i}feed(e){return ri.parse(e,this.recon,this.builder,this.exprParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Dr.isSpace(s));)e=e.step();e.isCont()?40===s?(e=e.step(),n=3):n=2:e.isDone()&&(n=2)}if(2===n){for(void 0===i&&(i=t.parseLiteral(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return i;if(i.isError())return i.asError()}if(3===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=4;else if(i.isError())return i.asError()}for(;;){if(4===n){for(;e.isCont()&&(s=e.head(),Dr.isSpace(s));)e=e.step();if(e.isCont()){if(44!==s)return 41===s?(e=e.step(),void 0!==i?i:Te.done(r.build())):Te.error(de.expected(41,e));e=e.step(),void 0!==i&&(void 0===r&&(r=t.recordBuilder()).push(t.item(i.bind())),i=void 0),n=5}else if(e.isDone())return Te.error(de.expected(41,e))}if(5===n){for(void 0===i&&(i=t.parseBlockExpression(e,r));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone()){i=void 0,n=4;continue}if(i.isError())return i.asError()}break}return new ri(t,r,i,n)}}class ii extends Te{constructor(e,t,r,i){super(),this.recon=e,this.builder=t,this.valueParser=r,this.step=i}feed(e){return ii.parse(e,this.recon,this.builder,this.valueParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n){for(;e.isCont()&&(s=e.head(),Dr.isSpace(s));)e=e.step();if(e.isCont())if(40===s)e=e.step(),n=4;else if(123===s)r=r||t.recordBuilder(),i=t.parseRecord(e,r),n=3;else if(91===s)r=r||t.recordBuilder(),i=t.parseMarkup(e,r),n=3;else if(Dr.isIdentStartChar(s))i=t.parseIdent(e),n=2;else if(34===s||39===s)i=t.parseString(e),n=2;else if(96===s)i=t.parseRawString(e),n=2;else if(45===s||s>=48&&s<=57)i=t.parseNumber(e),n=2;else if(37===s)i=t.parseData(e),n=2;else{if(36!==s)return void 0===r?Te.done(t.extant()):Te.done(r.build());i=t.parseSelector(e),n=2}else if(e.isDone())return void 0===r?Te.done(t.extant()):Te.done(r.build())}if(2===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return(r=r||t.valueBuilder()).push(t.item(i.bind())),Te.done(r.build());if(i.isError())return i.asError()}if(3===n){for(;i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())return Te.done(r.build());if(i.isError())return i.asError()}if(4===n){for(void 0===i&&(i=t.parseBlockExpression(e));i.isCont()&&!e.isEmpty();)i=i.feed(e);if(i.isDone())n=5;else if(i.isError())return i.asError()}if(5===n){for(;e.isCont()&&(s=e.head(),Dr.isWhitespace(s));)e=e.step();if(e.isCont())return 41===s?(e=e.step(),(r=r||t.valueBuilder()).push(t.item(i.bind())),Te.done(r.build())):Te.error(de.expected(41,e));if(e.isDone())return Te.error(de.expected(41,e))}return new ii(t,r,i,n)}}class ni extends Te{constructor(e,t,r,i,n){super(),this.recon=e,this.builder=t,this.selector=r,this.valueParser=i,this.step=n}feed(e){return ni.parse(e,this.recon,this.builder,this.selector,this.valueParser,this.step)}static parse(e,t,r,i,n,s=1){let o=0;if(1===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()&&36===o)e=e.step(),i=i||t.selector(),s=2;else if(e.isDone())return Te.error(de.expected(36,e))}if(2===s)if(e.isCont())o=e.head(),91===o?(e=e.step(),s=8):64===o?(e=e.step(),s=7):58===o?(e=e.step(),s=6):42===o?(e=e.step(),s=5):35===o?(e=e.step(),s=4):s=3;else if(e.isDone())return Te.error(de.unexpected(e));for(;;){if(3===s){for(void 0===n&&(n=t.parseLiteral(e,t.valueBuilder()));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.get(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=t.parseInteger(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.value(t.getItem(i,n.bind())),n=void 0,s=10;else if(n.isError())return n.asError()}if(5===s&&(e.isCont()?(o=e.head(),58===o?(e=e.step(),i=t.keys(i),s=10):42===o?(e=e.step(),i=t.descendants(i),s=10):(i=t.children(i),s=10)):e.isDone()&&(i=t.children(i),s=10)),6===s)if(e.isCont()){if(o=e.head(),42!==o)return Te.error(de.expected(42,e));e=e.step(),i=t.values(i),s=10}else if(e.isDone())return Te.error(de.expected(42,e));if(7===s){for(void 0===n&&(n=t.parseIdent(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())i=t.getAttr(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(8===s){for(void 0===n&&(n=t.parseBlockExpression(e));n.isCont()&&!e.isEmpty();)n=n.feed(e);if(n.isDone())s=9;else if(n.isError())return n.asError()}if(9===s){for(;e.isCont()&&(o=e.head(),Dr.isSpace(o));)e=e.step();if(e.isCont()){if(93!==o)return Te.error(de.expected(93,e));e=e.step(),i=t.filter(i,n.bind()),n=void 0,s=10}else if(e.isDone())return Te.error(de.expected(93,e))}if(10===s)if(e.isCont()){if(o=e.head(),91===o){e=e.step(),s=8;continue}if(35===o){e=e.step(),s=4;continue}if(46!==o)return void 0!==r?(r.push(t.item(i)),Te.done(r.build())):Te.done(i);e=e.step(),s=11}else if(e.isDone())return void 0!==r?(r.push(t.item(i)),Te.done(r.build())):Te.done(i);if(11===s){if(e.isCont()){if(o=e.head(),64===o){e=e.step(),s=7;continue}if(58===o){e=e.step(),s=6;continue}if(42===o){e=e.step(),s=5;continue}s=3;continue}if(e.isDone())return Te.error(de.unexpected(e))}break}return new ni(t,r,i,n,s)}}class si{parseBlock(e){return Lr.parse(e,this)}parseAttr(e){return qr.parse(e,this)}parseBlockItem(e){return Ir.parse(e,this)}parseInlineItem(e){return Ar.parse(e,this)}parseRecord(e,t){return Nr.parse(e,this,t)}parseMarkup(e,t){return jr.parse(e,this,t)}parseData(e){return zr.parse(e,this)}parseIdent(e){return Vr.parse(e,this)}parseString(e){return Mr.parse(e,this)}parseRawString(e){return Fr.parse(e,this)}parseNumber(e){return Br.parse(e,this)}parseInteger(e){return Br.parseInteger(e,this)}parseBlockExpression(e,t){return this.parseLambdaFunc(e,t)}parseLambdaFunc(e,t){return Wr.parse(e,this,t)}parseConditionalOperator(e,t){return Hr.parse(e,this,t)}parseOrOperator(e,t){return Zr.parse(e,this,t)}parseAndOperator(e,t){return Qr.parse(e,this,t)}parseBitwiseOrOperator(e,t){return Gr.parse(e,this,t)}parseBitwiseXorOperator(e,t){return Xr.parse(e,this,t)}parseBitwiseAndOperator(e,t){return $r.parse(e,this,t)}parseComparisonOperator(e,t){return Kr.parse(e,this,t)}parseAttrExpression(e,t){return Yr.parse(e,this,t)}parseAdditiveOperator(e,t){return Jr.parse(e,this,t)}parseMultiplicativeOperator(e,t){return _r.parse(e,this,t)}parsePrefixOperator(e,t){return ei.parse(e,this,t)}parseInvokeOperator(e,t){return ti.parse(e,this,t)}parsePrimary(e,t){return ri.parse(e,this,t)}parseLiteral(e,t){return ii.parse(e,this,t)}parseSelector(e,t){return ni.parse(e,this,t)}blockParser(){return new Lr(this)}parseBlockString(e){let t=he.stringInput(e);for(;t.isCont()&&Dr.isWhitespace(t.head());)t=t.step();let r=this.parseBlock(t);if(r.isDone())for(;t.isCont()&&Dr.isWhitespace(t.head());)t=t.step();return t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),r.bind()}}class oi extends si{isDistinct(e){return e.isDistinct()}item(e){return e}value(e){return e.toValue()}attr(e,t){return 1===arguments.length?ot.of(e):ot.of(e,t)}slot(e,t){return 1===arguments.length?ut.of(e):ut.of(e,t)}valueBuilder(){return lt.builder()}recordBuilder(){return dt.create()}dataOutput(){return yt.output()}textOutput(){return bt.output()}ident(e){if(e instanceof bt){const t=e.stringValue();if("true"===t)return xt.from(!0);if("false"===t)return xt.from(!1)}return e}num(e){if("number"==typeof e)return kt.from(e);if("string"==typeof e)return kt.from(+e);throw new TypeError(""+e)}uint32(e){return kt.uint32(e)}uint64(e){return kt.uint64(e)}bool(e){return xt.from(e)}selector(){return sr.identity()}extant(){return lt.extant()}absent(){return lt.absent()}conditional(e,t,r){return e.conditional(t,r)}or(e,t){return new Vt(e,t)}and(e,t){return new Mt(e,t)}bitwiseOr(e,t){return new Ft(e,t)}bitwiseXor(e,t){return new Bt(e,t)}bitwiseAnd(e,t){return new Ut(e,t)}lt(e,t){return new Rt(e,t)}le(e,t){return new Wt(e,t)}eq(e,t){return new Ht(e,t)}ne(e,t){return new Zt(e,t)}ge(e,t){return new Qt(e,t)}gt(e,t){return new Gt(e,t)}plus(e,t){return new Xt(e,t)}minus(e,t){return new $t(e,t)}times(e,t){return new Kt(e,t)}divide(e,t){return new Yt(e,t)}modulo(e,t){return new Jt(e,t)}not(e){return new _t(e)}bitwiseNot(e){return new er(e)}negative(e){return e instanceof kt?e.negative():new tr(e)}positive(e){return new rr(e)}invoke(e,t){return new ir(e,t)}lambda(e,t){return e.lambda(t)}get(e,t){return e.get(t)}getAttr(e,t){return e.getAttr(t)}getItem(e,t){return e.getItem(t)}children(e){return sr.literal(e).children()}descendants(e){return sr.literal(e).descendants()}keys(e){return sr.literal(e).keys()}values(e){return sr.literal(e).values()}filter(e,t){return e.filter(t)}}class ai extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return ai.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=1,i+=e.sizeOfValue(t),e.isExtant(e.item(r))||(i+=1,i+=e.sizeOfBlockValue(r),i+=1),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(64),s=2),2===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone()){if(n=void 0,t.isExtant(t.item(i)))return ae.end();s=3}else if(n.isError())return n.asError();if(3===s&&e.isCont()&&(e=e.write(40),s=4),4===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&e.isCont()?(e=e.write(41),ae.end()):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new ai(t,r,i,n,s)}}class ui extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.value=r,this.part=i,this.step=n}pull(e){return ui.write(e,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,e.isExtant(e.item(r))||(i+=e.sizeOfValue(r)),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()){if(e=e.write(58),t.isExtant(t.item(i)))return ae.end();s=3}if(3===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return ae.end();if(n.isError())return n.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new ui(t,r,i,n,s)}}class hi extends ae{constructor(e,t,r,i,n,s,o,a,u,h,l,c){super(),this.recon=e,this.items=t,this.inBlock=r,this.inMarkup=i,this.inBraces=n,this.inBrackets=s,this.first=o,this.markupSafe=a,this.item=u,this.next=h,this.part=l,this.step=c}pull(e){return hi.write(e,this.recon,this.items,this.inBlock,this.inMarkup,this.inBraces,this.inBrackets,this.first,this.markupSafe,this.item,this.next,this.part,this.step)}static sizeOf(e,t,r,i){let n,s=0,o=!1,a=!1,u=!0,h=!0;for(;void 0!==n||t.hasNext();){let l;void 0===n?l=t.next().value:(l=n,n=void 0),t.hasNext()&&(n=t.next().value),e.isExpression(l)&&(h=!1),a&&e.isAttr(l)&&(o&&(s+=1,o=!1),s+=1,a=!1),e.isAttr(l)?(o?(s+=1,o=!1):a&&(s+=1,a=!1),s+=e.sizeOfItem(l),u=!1):a&&e.isText(l)?(o&&(s+=1,o=!1),s+=e.sizeOfMarkupText(l)):o?(u?u=!1:s+=1,s+=hi.sizeOfBlockItem(e,l)):a?e.isRecord(l)&&e.isMarkupSafe(e.items(l))?(s+=e.sizeOfBlock(e.items(l),!1,!0),void 0!==n&&e.isText(n)?(s+=e.sizeOfMarkupText(n),n=void 0):void 0===n||e.isAttr(n)?(s+=1,a=!1):(s+=1,o=!0,u=!0)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):!h||!e.isText(l)||void 0===n||e.isField(n)||e.isText(n)||e.isBool(n)?r&&!o?(u?u=!1:s+=1,s+=hi.sizeOfBlockItem(e,l)):i&&e.isText(l)&&void 0===n?(s+=1,s+=e.sizeOfMarkupText(l),s+=1):!i&&e.isValue(l)&&!e.isRecord(l)&&(!u&&void 0===n||void 0!==n&&e.isAttr(n))?(!u&&(e.isText(l)&&e.isIdent(l)||e.isNum(l)||e.isBool(l))&&(s+=1),s+=e.sizeOfItem(l)):(s+=1,s+=e.sizeOfItem(l),o=!0,u=!1):(s+=1,s+=e.sizeOfMarkupText(l),a=!0)}return o&&(s+=1),a&&(s+=1),s}static sizeOfBlockItem(e,t){let r=0;return e.isField(t)?r+=e.sizeOfSlot(e.key(t),e.value(t)):r+=e.sizeOfItem(t),r}static write(e,t,r,i,n,s=!1,o=!1,a=!0,u=!0,h,l,c,d=1){for(;;){if(1===d){if(void 0===l&&!r.hasNext()){d=10;break}void 0===l?h=r.next().value:(h=l,l=void 0),r.hasNext()&&(l=r.next().value),t.isExpression(h)&&(u=!1),d=2}if(2===d&&e.isCont()&&(o&&t.isAttr(h)?(s&&(e=e.write(125),s=!1),d=3):d=4),3===d&&e.isCont()&&(e=e.write(93),o=!1,d=4),4===d&&e.isCont()&&(t.isAttr(h)?(s?(e=e.write(125),s=!1):o&&(e=e.write(93),o=!1),c=t.writeItem(e,h),a=!1,d=7):o&&t.isText(h)?(s&&(e=e.write(125),s=!1),c=t.writeMarkupText(e,h),d=7):s?(a?a=!1:e=e.write(44),c=hi.writeBlockItem(e,t,h),d=7):o?t.isRecord(h)&&t.isMarkupSafe(t.items(h))?(c=t.writeBlock(e,t.items(h),!1,!0),d=5):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):!u||!t.isText(h)||void 0===l||t.isField(l)||t.isText(l)||t.isBool(l)?i&&!s?(a?a=!1:e=e.write(44),c=hi.writeBlockItem(e,t,h),d=7):n&&t.isText(h)&&void 0===l?(e=e.write(91),c=t.writeMarkupText(e,h),d=8):!n&&t.isValue(h)&&!t.isRecord(h)&&(!a&&void 0===l||void 0!==l&&t.isAttr(l))?(!a&&(t.isText(h)&&t.isIdent(h)||t.isNum(h)||t.isBool(h))&&(e=e.write(32)),c=t.writeItem(e,h),d=7):(e=e.write(123),c=t.writeItem(e,h),s=!0,a=!1,d=7):(e=e.write(91),c=t.writeMarkupText(e,h),o=!0,d=7)),5===d)if((c=c.pull(e)).isDone())c=void 0,d=6;else if(c.isError())return c.asError();if(6===d&&e.isCont()){if(void 0===l||!t.isText(l)){if(void 0===l||t.isAttr(l)){e=e.write(93),o=!1,d=1;continue}e=e.write(123),s=!0,a=!0,d=1;continue}c=t.writeMarkupText(e,l),l=void 0,d=7}if(7===d){if((c=c.pull(e)).isDone()){c=void 0,d=1;continue}if(c.isError())return c.asError()}if(8===d)if((c=c.pull(e)).isDone())c=void 0,d=9;else if(c.isError())return c.asError();if(9!==d||!e.isCont())break;e=e.write(93),d=1}if(10===d&&(s?e.isCont()&&(e=e.write(125),d=11):d=11),11===d){if(!o)return ae.end();if(e.isCont())return e=e.write(93),ae.end()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new hi(t,r,i,n,s,o,a,u,h,l,c,d)}static writeBlockItem(e,t,r){return t.isField(r)?t.writeSlot(e,t.key(r),t.value(r)):t.writeItem(e,r)}}class li extends ae{constructor(e,t,r,i,n,s,o,a){super(),this.recon=e,this.items=t,this.inParens=r,this.first=i,this.item=n,this.next=s,this.part=o,this.step=a}pull(e){return li.write(e,this.recon,this.items,this.inParens,this.first,this.item,this.next,this.part,this.step)}static sizeOf(e,t){let r,i=0,n=!1,s=!0;for(;void 0!==r||t.hasNext();){let o;void 0===r?o=t.next().value:(o=r,r=void 0),t.hasNext()&&(r=t.next().value),n||s||(i+=1),e.isAttr(o)?(n&&(i+=1,n=!1),i+=e.sizeOfItem(o),s=!1):n?(s?s=!1:i+=1,i+=e.sizeOfBlockItem(o)):e.isValue(o)&&!e.isRecord(o)&&(!s&&void 0===r||void 0!==r&&e.isAttr(r))?i+=e.sizeOfItem(o):(i+=1,i+=e.sizeOfItem(o),n=!0,s=!1)}return n&&(i+=1),i}static write(e,t,r,i=!1,n=!0,s,o,a,u=1){for(;;){if(1===u){if(void 0===o&&!r.hasNext()){u=5;break}void 0===o?s=r.next().value:(s=o,o=void 0),r.hasNext()&&(o=r.next().value),u=2}if(2===u&&e.isCont()&&(i||n||(e=e.write(32)),u=3),3===u&&e.isCont()&&(t.isAttr(s)?(i&&(e=e.write(41),i=!1),a=t.writeItem(e,s),n=!1,u=4):i?(n?n=!1:e=e.write(44),a=t.writeBlockItem(e,s),u=4):t.isValue(s)&&!t.isRecord(s)&&(!n&&void 0===o||void 0!==o&&t.isAttr(o))?(a=t.writeItem(e,s),u=4):(e=e.write(40),a=t.writeItem(e,s),i=!0,n=!1,u=4)),4===u){if((a=a.pull(e)).isDone()){a=void 0,u=1;continue}if(a.isError())return a.asError()}break}if(5===u){if(!i)return ae.end();if(e.isCont())return e=e.write(41),ae.end()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new li(t,r,i,n,s,o,a,u)}}class ci extends ae{constructor(e,t,r,i){super(),this.text=e,this.index=t,this.escape=r,this.step=i}pull(e){return ci.write(e,this.text,this.index,this.escape,this.step)}static sizeOf(e){let t=0;for(let r=0;r<e.length;r=p.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=36===i||64===i||91===i||92===i||93===i||123===i||125===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:He.sizeOf(i)}return t}static write(e,t,r=0,i=0,n=1){const s=t.length;for(;e.isCont();)if(1===n){if(!(r<s))return ae.end();{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=p.offsetByCodePoints(t,r,1),36===s||64===s||91===s||92===s||93===s||123===s||125===s?(e=e.write(92),i=s,n=2):8===s?(e=e.write(92),i=98,n=2):12===s?(e=e.write(92),i=102,n=2):10===s?(e=e.write(92),i=110,n=2):13===s?(e=e.write(92),i=114,n=2):9===s?(e=e.write(92),i=116,n=2):s<32?(e=e.write(92),i=s,n=3):e=e.write(s)}}else 2===n?(e=e.write(i),i=0,n=1):3===n?(e=e.write(117),n=4):4===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>12&15)),n=5):5===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>8&15)),n=6):6===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>4&15)),n=7):7===n&&(e=e.write(Ue.uppercase.encodeDigit(15&i)),i=0,n=1);return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new ci(t,r,i,n)}}class di extends ae{constructor(e,t,r){super(),this.array=e,this.part=t,this.step=r}pull(e){return di.write(e,this.array,this.part,this.step)}static sizeOf(e){return 1+(Math.floor(4*e/3)+3&-4)}static write(e,t,r,i=1){if(1===i&&e.isCont()&&(e=e.write(37),i=2),2===i){if((r=void 0===r?Ye.standard().writeUint8Array(e,t):r.pull(e)).isDone())return r=void 0,ae.end();if(r.isError())return r.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new di(t,r,i)}}class pi extends ae{constructor(e,t){super(),this.ident=e,this.index=t}pull(e){return pi.write(e,this.ident,this.index)}static sizeOf(e){return He.sizeOf(e)}static write(e,t,r=0){let i;const n=t.length;if(0===n)return ae.error(new oe("empty identifier"));for(0===r&&e.isCont()&&(i=t.codePointAt(0),void 0===i&&(i=t.charCodeAt(0)),Dr.isIdentStartChar(i)&&(e=e.write(i),r=p.offsetByCodePoints(t,0,1)));r<n&&e.isCont();){if(i=t.codePointAt(r),void 0===i&&(i=t.charCodeAt(r)),!Dr.isIdentChar(i))return ae.error(new oe("invalid identifier"));e=e.write(i),r=p.offsetByCodePoints(t,r,1)}return r>=n?ae.end():e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new pi(t,r)}}class fi extends ae{constructor(e,t,r,i){super(),this.string=e,this.index=t,this.escape=r,this.step=i}pull(e){return fi.write(e,this.string,this.index,this.escape,this.step)}static sizeOf(e){let t=0;t+=1;for(let r=0;r<e.length;r=p.offsetByCodePoints(e,r,1)){let i=e.codePointAt(r);void 0===i&&(i=e.charCodeAt(r)),t+=34===i||92===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:He.sizeOf(i)}return t+=1,t}static write(e,t,r=0,i=0,n=1){1===n&&e.isCont()&&(e=e.write(34),n=2);const s=t.length;for(;n>=2&&n<=8&&e.isCont();)if(2===n){if(!(r<s)){n=9;break}{let s=t.codePointAt(r);void 0===s&&(s=t.charCodeAt(r)),r=p.offsetByCodePoints(t,r,1),34===s||92===s?(e=e.write(92),i=s,n=3):8===s?(e=e.write(92),i=98,n=3):12===s?(e=e.write(92),i=102,n=3):10===s?(e=e.write(92),i=110,n=3):13===s?(e=e.write(92),i=114,n=3):9===s?(e=e.write(92),i=116,n=3):s<32?(e=e.write("\\\\"),i=s,n=4):e=e.write(s)}}else 3===n?(e=e.write(i),i=0,n=2):4===n?(e=e.write(117),n=5):5===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>12&15)),n=6):6===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>8&15)),n=7):7===n?(e=e.write(Ue.uppercase.encodeDigit(i>>>4&15)),n=8):8===n&&(e=e.write(Ue.uppercase.encodeDigit(15&i)),i=0,n=2);return 9===n&&e.isCont()?(e=e.write(34),ae.end()):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new fi(t,r,i,n)}}class mi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.bindings=t,this.template=r,this.part=i,this.step=n}pull(e){return mi.write(e,this.recon,this.bindings,this.template,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfPrimary(t),i+=4,i+=e.sizeOfValue(r),i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writePrimary(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(32),s=3),3===s&&e.isCont()&&(e=e.write(61),s=4),4===s&&e.isCont()&&(e=e.write(62),s=5),5===s&&e.isCont()&&(e=e.write(32),s=6),6===s){if((n=void 0===n?t.writeValue(e,i):n.pull(e)).isDone())return ae.end();if(n.isError())return n.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new mi(t,r,i,n,s)}}class wi extends ae{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.ifTerm=t,this.thenTerm=r,this.elseTerm=i,this.precedence=n,this.part=s,this.step=o}pull(e){return wi.write(e,this.recon,this.ifTerm,this.thenTerm,this.elseTerm,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)>0&&e.precedence(t)<=n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=3,s+=e.sizeOfItem(r),s+=3,s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)>0&&t.precedence(r)<=s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a&&e.isCont()&&(e=e.write(63),a=6),6===a&&e.isCont()&&(e=e.write(32),a=7),7===a)if((o=void 0===o?t.writeItem(e,i):o.pull(e)).isDone())o=void 0,a=8;else if(o.isError())return o.asError();if(8===a&&e.isCont()&&(e=e.write(32),a=9),9===a&&e.isCont()&&(e=e.write(58),a=10),10===a&&e.isCont()&&(e=e.write(32),a=11),11===a){if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())return ae.end();if(o.isError())return o.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new wi(t,r,i,n,s,o,a)}}class yi extends ae{constructor(e,t,r,i,n,s,o){super(),this.recon=e,this.lhs=t,this.operator=r,this.rhs=i,this.precedence=n,this.part=s,this.step=o}pull(e){return yi.write(e,this.recon,this.lhs,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i,n){let s=0;return e.precedence(t)<n?(s+=1,s+=e.sizeOfItem(t),s+=1):s+=e.sizeOfItem(t),s+=1,s+=He.sizeOf(r),s+=1,e.precedence(i)<n?(s+=1,s+=e.sizeOfItem(i),s+=1):s+=e.sizeOfItem(i),s}static write(e,t,r,i,n,s,o,a=1){if(1===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(40),a=2):a=2),2===a)if((o=void 0===o?t.writeItem(e,r):o.pull(e)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(t.precedence(r)<s?e.isCont()&&(e=e.write(41),a=4):a=4),4===a&&e.isCont()&&(e=e.write(32),a=5),5===a)if((o=void 0===o?he.writeString(e,i):o.pull(e)).isDone())o=void 0,a=6;else if(o.isError())return o.asError();if(6===a&&e.isCont()&&(e=e.write(32),a=7),7===a&&(t.precedence(n)<s?e.isCont()&&(e=e.write(40),a=8):a=8),8===a)if((o=void 0===o?t.writeItem(e,n):o.pull(e)).isDone())o=void 0,a=9;else if(o.isError())return o.asError();if(9===a){if(!(t.precedence(n)<s))return ae.end();if(e.isCont())return e=e.write(41),ae.end()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new yi(t,r,i,n,s,o,a)}}class gi extends ae{constructor(e,t,r,i,n,s){super(),this.recon=e,this.operator=t,this.rhs=r,this.precedence=i,this.part=n,this.step=s}pull(e){return gi.write(e,this.recon,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(e,t,r,i){let n=0;return n+=He.sizeOf(t),e.precedence(r)<i?(n+=1,n+=e.sizeOfItem(r),n+=1):n+=e.sizeOfItem(r),n}static write(e,t,r,i,n,s,o=1){if(1===o)if((s=void 0===s?he.writeString(e,r):s.pull(e)).isDone())s=void 0,o=2;else if(s.isError())return s.asError();if(2===o&&(t.precedence(i)<n?e.isCont()&&(e=e.write(40),o=3):o=3),3===o)if((s=void 0===s?t.writeItem(e,i):s.pull(e)).isDone())s=void 0,o=4;else if(s.isError())return s.asError();if(4===o){if(!(t.precedence(i)<n))return ae.end();if(e.isCont())return e=e.write(41),ae.end()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new gi(t,r,i,n,s,o)}}class bi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.func=t,this.args=r,this.part=i,this.step=n}pull(e){return bi.write(e,this.recon,this.func,this.args,this.part,this.step)}static sizeOf(e,t,r){let i=0;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfBlockValue(r),i+=1,i}static write(e,t,r,i,n,s=1){if(1===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&e.isCont()&&(e=e.write(40),s=3),3===s)if((n=void 0===n?t.writeBlockValue(e,i):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(41),ae.end()):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new bi(t,r,i,n,s)}}class vi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.item=t,this.then=r,this.part=i,this.step=n}pull(e){return vi.write(e,this.recon,this.item,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=0;return e.precedence(t)<e.precedence(e.item(r))?(i+=1,i+=e.sizeOfItem(t),i+=1):i+=e.sizeOfItem(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(40),s=2):s=2),2===s)if((n=void 0===n?t.writeItem(e,r):n.pull(e)).isDone())n=void 0,s=3;else if(n.isError())return n.asError();return 3===s&&(t.precedence(r)<t.precedence(t.item(i))?e.isCont()&&(e=e.write(41),s=4):s=4),4===s?t.writeThen(e,i):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new vi(t,r,i,n,s)}}class ki extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return ki.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=1;return e.isRecord(e.item(t))?(i+=1,i+=e.sizeOfBlockValue(t),i+=1):i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(123),s=4):s=4),4===s)if((n=void 0===n?t.isRecord(t.item(r))?t.writeBlockValue(e,r):t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&(t.isRecord(t.item(r))?e.isCont()&&(e=e.write(125),s=6):s=6),6===s?t.writeThen(e,i):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new ki(t,r,i,n,s)}static writeThen(e,t,r,i){return ki.write(e,t,r,i,void 0,2)}}class Oi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.key=t,this.then=r,this.part=i,this.step=n}pull(e){return Oi.write(e,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()?(e=e.write(36),s=3):2===s&&e.isCont()&&(e=e.write(46),s=3),3===s&&e.isCont()&&(e=e.write(64),s=4),4===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Oi(t,r,i,n,s)}static writeThen(e,t,r,i){return Oi.write(e,t,r,i,void 0,2)}}class xi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.index=t,this.then=r,this.part=i,this.step=n}pull(e){return xi.write(e,this.recon,this.index,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(35),s=3),3===s){if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())return t.writeThen(e,i);if(n.isError())return n.asError()}return e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new xi(t,r,i,n,s)}static writeThen(e,t,r,i){return xi.write(e,t,r,i,void 0,2)}}class Si extends ae{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Si.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(58),t.writeThen(e,r)):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Si(t,r,i)}static writeThen(e,t,r){return Si.write(e,t,r,2)}}class Ci extends ae{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ci.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(58),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Ci(t,r,i)}static writeThen(e,t,r){return Ci.write(e,t,r,2)}}class Ei extends ae{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ei.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=2;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Ei(t,r,i)}static writeThen(e,t,r){return Ei.write(e,t,r,2)}}class Ti extends ae{constructor(e,t,r){super(),this.recon=e,this.then=t,this.step=r}pull(e){return Ti.write(e,this.recon,this.then,this.step)}static sizeOf(e,t){let r=3;return r+=e.sizeOfThen(t),r}static write(e,t,r,i=1){return 1===i&&e.isCont()?(e=e.write(36),i=3):2===i&&e.isCont()&&(e=e.write(46),i=3),3===i&&e.isCont()&&(e=e.write(42),i=4),4===i&&e.isCont()?(e=e.write(42),t.writeThen(e,r)):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Ti(t,r,i)}static writeThen(e,t,r){return Ti.write(e,t,r,2)}}class Pi extends ae{constructor(e,t,r,i,n){super(),this.recon=e,this.predicate=t,this.then=r,this.part=i,this.step=n}pull(e){return Pi.write(e,this.recon,this.predicate,this.then,this.part,this.step)}static sizeOf(e,t,r){let i=2;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static sizeOfThen(e,t,r){let i=1;return i+=e.sizeOfValue(t),i+=1,i+=e.sizeOfThen(r),i}static write(e,t,r,i,n,s=1){if(1===s&&e.isCont()&&(e=e.write(36),s=2),2===s&&e.isCont()&&(e=e.write(91),s=3),3===s)if((n=void 0===n?t.writeValue(e,r):n.pull(e)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&e.isCont()?(e=e.write(93),t.writeThen(e,i)):e.isDone()?ae.error(new oe("truncated")):e.isError()?ae.error(e.trap()):new Pi(t,r,i,n,s)}static writeThen(e,t,r,i){return Pi.write(e,t,r,i,void 0,2)}}class Di{sizeOfAttr(e,t){return ai.sizeOf(this,e,t)}writeAttr(e,t,r){return ai.write(e,this,t,r)}sizeOfSlot(e,t){return ui.sizeOf(this,e,t)}writeSlot(e,t,r){return ui.write(e,this,t,r)}sizeOfBlock(e,t,r){if(3===arguments.length)return hi.sizeOf(this,e,t,r);{const t=this.items(e);return t.hasNext()?hi.sizeOf(this,t,this.isBlockSafe(this.items(e)),!1):2}}writeBlock(e,t,r,i){if(4===arguments.length)return hi.write(e,this,t,r,i);{const r=this.items(t);return r.hasNext()?hi.write(e,this,r,this.isBlockSafe(this.items(t)),!1):he.writeString(e,"{}")}}sizeOfRecord(e){const t=this.items(e);return t.hasNext()?hi.sizeOf(this,t,!1,!1):2}writeRecord(e,t){const r=this.items(t);return r.hasNext()?hi.write(e,this,r,!1,!1):he.writeString(e,"{}")}sizeOfPrimary(e){if(this.isRecord(this.item(e))){const t=this.items(this.item(e));if(t.hasNext())return li.sizeOf(this,t)}else if(!this.isExtant(this.item(e)))return this.sizeOfValue(e);return 2}writePrimary(e,t){if(this.isRecord(this.item(t))){const r=this.items(this.item(t));if(r.hasNext())return li.write(e,this,r)}else if(!this.isExtant(this.item(t)))return this.writeValue(e,t);return he.writeString(e,"()")}isBlockSafe(e){for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}isMarkupSafe(e){if(!e.hasNext()||!this.isAttr(e.next().value))return!1;for(;e.hasNext();)if(this.isAttr(e.next().value))return!1;return!0}sizeOfMarkupText(e){return"string"!=typeof e&&(e=this.string(e)),ci.sizeOf(e)}writeMarkupText(e,t){return"string"!=typeof t&&(t=this.string(t)),ci.write(e,t)}sizeOfData(e){return di.sizeOf(e)}writeData(e,t){return void 0!==t?di.write(e,t):he.writeString(e,"%")}isIdent(e){"string"!=typeof e&&(e=this.string(e));const t=e.length;let r;if(0===t||(r=e.codePointAt(0),void 0!==r&&!Dr.isIdentStartChar(r)))return!1;for(let i=p.offsetByCodePoints(e,0,1);i<t;i=p.offsetByCodePoints(e,i,1))if(r=e.codePointAt(i),void 0===r||!Dr.isIdentChar(r))return!1;return!0}sizeOfText(e){return this.isIdent(e)?pi.sizeOf(e):fi.sizeOf(e)}writeText(e,t){return this.isIdent(t)?pi.write(e,t):fi.write(e,t)}sizeOfNum(e){if(isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<2147483648){let t=ce.countDigits(e);return e<0&&(t+=1),t}return(""+e).length}writeNum(e,t){return isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648?ce.writeInteger(e,t):he.writeString(e,""+t)}sizeOfUint32(e){return 10}writeUint32(e,t){return Ue.lowercase.writeIntegerLiteral(e,t,8)}sizeOfUint64(e){return 18}writeUint64(e,t){return Ue.lowercase.writeIntegerLiteral(e,t,16)}sizeOfBool(e){return e?4:5}writeBool(e,t){return he.writeString(e,t?"true":"false")}sizeOfLambdaFunc(e,t){return mi.sizeOf(this,e,t)}writeLambdaFunc(e,t,r){return mi.write(e,this,t,r)}sizeOfConditionalOperator(e,t,r,i){return wi.sizeOf(this,e,t,r,i)}writeConditionalOperator(e,t,r,i,n){return wi.write(e,this,t,r,i,n)}sizeOfInfixOperator(e,t,r,i){return yi.sizeOf(this,e,t,r,i)}writeInfixOperator(e,t,r,i,n){return yi.write(e,this,t,r,i,n)}sizeOfPrefixOperator(e,t,r){return gi.sizeOf(this,e,t,r)}writePrefixOperator(e,t,r,i){return gi.write(e,this,t,r,i)}sizeOfInvokeOperator(e,t){return bi.sizeOf(this,e,t)}writeInvokeOperator(e,t,r){return bi.write(e,this,t,r)}sizeOfIdentitySelector(){return 0}writeIdentitySelector(e){return ae.end()}sizeOfThenIdentitySelector(){return 0}writeThenIdentitySelector(e){return ae.end()}sizeOfLiteralSelector(e,t){return vi.sizeOf(this,e,t)}writeLiteralSelector(e,t,r){return vi.write(e,this,t,r)}sizeOfThenLiteralSelector(e,t){return 0}writeThenLiteralSelector(e,t,r){return ae.end()}sizeOfGetSelector(e,t){return ki.sizeOf(this,e,t)}writeGetSelector(e,t,r){return ki.write(e,this,t,r)}sizeOfThenGetSelector(e,t){return ki.sizeOf(this,e,t)}writeThenGetSelector(e,t,r){return ki.writeThen(e,this,t,r)}sizeOfGetAttrSelector(e,t){return Oi.sizeOf(this,e,t)}writeGetAttrSelector(e,t,r){return Oi.write(e,this,t,r)}sizeOfThenGetAttrSelector(e,t){return Oi.sizeOf(this,e,t)}writeThenGetAttrSelector(e,t,r){return Oi.writeThen(e,this,t,r)}sizeOfGetItemSelector(e,t){return xi.sizeOf(this,e,t)}writeGetItemSelector(e,t,r){return xi.write(e,this,t,r)}sizeOfThenGetItemSelector(e,t){return xi.sizeOfThen(this,e,t)}writeThenGetItemSelector(e,t,r){return xi.writeThen(e,this,t,r)}sizeOfKeysSelector(e){return Si.sizeOf(this,e)}writeKeysSelector(e,t){return Si.write(e,this,t)}sizeOfThenKeysSelector(e){return Si.sizeOf(this,e)}writeThenKeysSelector(e,t){return Si.writeThen(e,this,t)}sizeOfValuesSelector(e){return Ci.sizeOf(this,e)}writeValuesSelector(e,t){return Ci.write(e,this,t)}sizeOfThenValuesSelector(e){return Ci.sizeOf(this,e)}writeThenValuesSelector(e,t){return Ci.writeThen(e,this,t)}sizeOfChildrenSelector(e){return Ei.sizeOf(this,e)}writeChildrenSelector(e,t){return Ei.write(e,this,t)}sizeOfThenChildrenSelector(e){return Ei.sizeOf(this,e)}writeThenChildrenSelector(e,t){return Ei.writeThen(e,this,t)}sizeOfDescendantsSelector(e){return Ti.sizeOf(this,e)}writeDescendantsSelector(e,t){return Ti.write(e,this,t)}sizeOfThenDescendantsSelector(e){return Ti.sizeOf(this,e)}writeThenDescendantsSelector(e,t){return Ti.writeThen(e,this,t)}sizeOfFilterSelector(e,t){return Pi.sizeOf(this,e,t)}writeFilterSelector(e,t,r){return Pi.write(e,this,t,r)}sizeOfThenFilterSelector(e,t){return Pi.sizeOfThen(this,e,t)}writeThenFilterSelector(e,t,r){return Pi.writeThen(e,this,t,r)}sizeOfExtant(){return 0}writeExtant(e){return ae.end()}sizeOfAbsent(){return 0}writeAbsent(e){return ae.end()}}class Li extends Di{isField(e){return e instanceof nt}isAttr(e){return e instanceof ot}isSlot(e){return e instanceof ut}isValue(e){return e instanceof lt}isRecord(e){return e instanceof dt}isText(e){return e instanceof bt}isNum(e){return e instanceof kt}isBool(e){return e instanceof xt}isExpression(e){return e instanceof Et}isExtant(e){return e instanceof St}items(e){return e.iterator()}item(e){return e}key(e){return e.key}value(e){return e.toValue()}string(e){return e.stringValue("")}precedence(e){return e.precedence}sizeOfItem(e){if(e instanceof nt){if(e instanceof ot)return this.sizeOfAttr(e.key,e.value);if(e instanceof ut)return this.sizeOfSlot(e.key,e.value)}else if(e instanceof lt)return this.sizeOfValue(e);throw new oe("No Recon serialization for "+e)}writeItem(e,t){if(t instanceof nt){if(t instanceof ot)return this.writeAttr(e,t.key,t.value);if(t instanceof ut)return this.writeSlot(e,t.key,t.value)}else if(t instanceof lt)return this.writeValue(e,t);return ae.error(new oe("No Recon serialization for "+t))}sizeOfValue(e){if(e instanceof dt)return this.sizeOfRecord(e);if(e instanceof yt)return this.sizeOfData(e.size);if(e instanceof bt)return this.sizeOfText(e.value);if(e instanceof kt)return e.isUint32()?this.sizeOfUint32(e.value):e.isUint64()?this.sizeOfUint64(e.value):this.sizeOfNum(e.value);if(e instanceof xt)return this.sizeOfBool(e.value);if(e instanceof sr)return this.sizeOfSelector(e);if(e instanceof Tt)return this.sizeOfOperator(e);if(e instanceof wr)return this.sizeOfFunc(e);if(e instanceof St)return this.sizeOfExtant();if(e instanceof Ct)return this.sizeOfAbsent();throw new oe("No Recon serialization for "+e)}writeValue(e,t){return t instanceof dt?this.writeRecord(e,t):t instanceof yt?this.writeData(e,t.asUint8Array()):t instanceof bt?this.writeText(e,t.value):t instanceof kt?t.isUint32()?this.writeUint32(e,t.value):t.isUint64()?this.writeUint64(e,t.value):this.writeNum(e,t.value):t instanceof xt?this.writeBool(e,t.value):t instanceof sr?this.writeSelector(e,t):t instanceof Tt?this.writeOperator(e,t):t instanceof wr?this.writeFunc(e,t):t instanceof St?this.writeExtant(e):t instanceof Ct?this.writeAbsent(e):ae.error(new oe("No Recon serialization for "+t))}sizeOfSelector(e){if(e instanceof or)return this.sizeOfIdentitySelector();if(e instanceof mr)return this.sizeOfLiteralSelector(e.item,e.then);if(e instanceof ar)return this.sizeOfGetSelector(e.item,e.then);if(e instanceof ur)return this.sizeOfGetAttrSelector(e.item,e.then);if(e instanceof hr)return this.sizeOfGetItemSelector(e.item,e.then);if(e instanceof lr)return this.sizeOfKeysSelector(e.then);if(e instanceof cr)return this.sizeOfValuesSelector(e.then);if(e instanceof dr)return this.sizeOfChildrenSelector(e.then);if(e instanceof pr)return this.sizeOfDescendantsSelector(e.then);if(e instanceof fr)return this.sizeOfFilterSelector(e.predicate,e.then);throw new oe("No Recon serialization for "+e)}writeSelector(e,t){return t instanceof or?this.writeIdentitySelector(e):t instanceof mr?this.writeLiteralSelector(e,t.item,t.then):t instanceof ar?this.writeGetSelector(e,t.item,t.then):t instanceof ur?this.writeGetAttrSelector(e,t.item,t.then):t instanceof hr?this.writeGetItemSelector(e,t.item,t.then):t instanceof lr?this.writeKeysSelector(e,t.then):t instanceof cr?this.writeValuesSelector(e,t.then):t instanceof dr?this.writeChildrenSelector(e,t.then):t instanceof pr?this.writeDescendantsSelector(e,t.then):t instanceof fr?this.writeFilterSelector(e,t.predicate,t.then):ae.error(new oe("No Recon serialization for "+t))}sizeOfOperator(e){if(e instanceof Pt)return this.sizeOfInfixOperator(e.operand1,e.operator,e.operand2,e.precedence);if(e instanceof Lt)return this.sizeOfPrefixOperator(e.operator,e.operand,e.precedence);if(e instanceof ir)return this.sizeOfInvokeOperator(e.func,e.args);if(e instanceof It)return this.sizeOfConditionalOperator(e.ifTerm,e.thenTerm,e.elseTerm,e.precedence);throw new oe("No Recon serialization for "+e)}writeOperator(e,t){return t instanceof Pt?this.writeInfixOperator(e,t.operand1,t.operator,t.operand2,t.precedence):t instanceof Lt?this.writePrefixOperator(e,t.operator,t.operand,t.precedence):t instanceof ir?this.writeInvokeOperator(e,t.func,t.args):t instanceof It?this.writeConditionalOperator(e,t.ifTerm,t.thenTerm,t.elseTerm,t.precedence):ae.error(new oe("No Recon serialization for "+t))}sizeOfFunc(e){if(e instanceof yr)return this.sizeOfLambdaFunc(e.bindings,e.template);if(e instanceof gr)return 0;throw new oe("No Recon serialization for "+e)}writeFunc(e,t){return t instanceof yr?this.writeLambdaFunc(e,t.bindings,t.template):t instanceof gr?ae.end():ae.error(new oe("No Recon serialization for "+t))}sizeOfBlockItem(e){if(e instanceof nt)return this.sizeOfItem(e);if(e instanceof lt)return this.sizeOfBlockValue(e);throw new oe("No Recon serialization for "+e)}writeBlockItem(e,t){return t instanceof nt?this.writeItem(e,t):t instanceof lt?this.writeBlockValue(e,t):ae.error(new oe("No Recon serialization for "+t))}sizeOfBlockValue(e){return e instanceof dt?this.sizeOfBlock(e):this.sizeOfValue(e)}writeBlockValue(e,t){return t instanceof dt?this.writeBlock(e,t):this.writeValue(e,t)}sizeOfThen(e){if(e instanceof sr){if(e instanceof or)return this.sizeOfThenIdentitySelector();if(e instanceof mr)return this.sizeOfThenLiteralSelector(e.item,e.then);if(e instanceof ar)return this.sizeOfThenGetSelector(e.item,e.then);if(e instanceof ur)return this.sizeOfThenGetAttrSelector(e.item,e.then);if(e instanceof hr)return this.sizeOfThenGetItemSelector(e.item,e.then);if(e instanceof lr)return this.sizeOfThenKeysSelector(e.then);if(e instanceof cr)return this.sizeOfThenValuesSelector(e.then);if(e instanceof dr)return this.sizeOfThenChildrenSelector(e.then);if(e instanceof pr)return this.sizeOfThenDescendantsSelector(e.then);if(e instanceof fr)return this.sizeOfThenFilterSelector(e.predicate,e.then)}throw new oe("No Recon serialization for "+e)}writeThen(e,t){if(t instanceof sr){if(t instanceof or)return this.writeThenIdentitySelector(e);if(t instanceof mr)return this.writeThenLiteralSelector(e,t.item,t.then);if(t instanceof ar)return this.writeThenGetSelector(e,t.item,t.then);if(t instanceof ur)return this.writeThenGetAttrSelector(e,t.item,t.then);if(t instanceof hr)return this.writeThenGetItemSelector(e,t.item,t.then);if(t instanceof lr)return this.writeThenKeysSelector(e,t.then);if(t instanceof cr)return this.writeThenValuesSelector(e,t.then);if(t instanceof dr)return this.writeThenChildrenSelector(e,t.then);if(t instanceof pr)return this.writeThenDescendantsSelector(e,t.then);if(t instanceof fr)return this.writeThenFilterSelector(e,t.predicate,t.then)}return ae.error(new oe("No Recon serialization for "+t))}}let qi=(()=>{var e;let i,n,s,a=[];return e=class{constructor(e,t,r,i,n){this.scheme=e,this.authority=t,this.path=r,this.query=i,this.fragment=n,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.scheme.isDefined()||this.authority.isDefined()||this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()}isEmpty(){return!this.scheme.isDefined()&&!this.authority.isDefined()&&this.path.isEmpty()&&!this.query.isDefined()&&!this.fragment.isDefined()}withScheme(e){return(e=Ni.fromLike(e))===this.scheme?this:this.copy(e,this.authority,this.path,this.query,this.fragment)}get schemePart(){return this.scheme.toString()}withSchemePart(e){return this.withScheme(Ni.parse(e))}get schemeName(){return this.scheme.name}withSchemeName(e){return this.withScheme(Ni.create(e))}withAuthority(e){return(e=zi.fromLike(e))===this.authority?this:this.copy(this.scheme,e,this.path,this.query,this.fragment)}get authorityPart(){return this.authority.toString()}withAuthorityPart(e){return this.withAuthority(zi.parse(e))}get user(){return this.authority.user}withUser(e){return this.withAuthority(this.authority.withUser(e))}get userPart(){return this.authority.userPart}withUserPart(e){return this.withAuthority(this.authority.withUserPart(e))}get username(){return this.authority.username}withUsername(e,t){if(1===arguments.length)return this.withAuthority(this.authority.withUsername(e));if(2===arguments.length)return this.withAuthority(this.authority.withUsername(e,t));throw new Error(arguments.toString())}get password(){return this.authority.password}withPassword(e){return this.withAuthority(this.authority.withPassword(e))}get host(){return this.authority.host}withHost(e){return this.withAuthority(this.authority.withHost(e))}get hostPart(){return this.authority.hostPart}withHostPart(e){return this.withAuthority(this.authority.withHostPart(e))}get hostAddress(){return this.authority.hostAddress}get hostName(){return this.authority.hostName}withHostName(e){return this.withAuthority(this.authority.withHostName(e))}get hostIPv4(){return this.authority.hostIPv4}withHostIPv4(e){return this.withAuthority(this.authority.withHostIPv4(e))}get hostIPv6(){return this.authority.hostIPv6}withHostIPv6(e){return this.withAuthority(this.authority.withHostIPv6(e))}get port(){return this.authority.port}withPort(e){return this.withAuthority(this.authority.withPort(e))}get portPart(){return this.authority.portPart}withPortPart(e){return this.withAuthority(this.authority.withPortPart(e))}get portNumber(){return this.authority.portNumber}withPortNumber(e){return this.withAuthority(this.authority.withPortNumber(e))}withPath(...e){const t=Ki.of(...e);return t===this.path?this:this.copy(this.scheme,this.authority,t,this.query,this.fragment)}get pathPart(){return this.path.toString()}withPathPart(e){return this.withPath(Ki.parse(e))}get pathName(){return this.path.name}withPathName(e){return this.withPath(this.path.withName(e))}parentPath(){return this.path.parent()}basePath(){return this.path.base()}parent(){return e.create(this.scheme,this.authority,this.path.parent())}base(){return e.create(this.scheme,this.authority,this.path.base())}appendedPath(...e){return this.withPath(this.path.appended(...e))}appendedSlash(){return this.withPath(this.path.appendedSlash())}appendedSegment(e){return this.withPath(this.path.appendedSegment(e))}prependedPath(...e){return this.withPath(this.path.prepended(...e))}prependedSlash(){return this.withPath(this.path.prependedSlash())}prependedSegment(e){return this.withPath(this.path.prependedSegment(e))}withQuery(e){return(e=nn.fromLike(e))===this.query?this:this.copy(this.scheme,this.authority,this.path,e,this.fragment)}get queryPart(){return this.query.toString()}withQueryPart(e){return this.withQuery(nn.parse(e))}updatedQuery(e,t){return this.withQuery(this.query.updated(e,t))}removedQuery(e){return this.withQuery(this.query.removed(e))}appendedQuery(e,t){return this.withQuery(this.query.appended(e,t))}prependedQuery(e,t){return this.withQuery(this.query.prepended(e,t))}withFragment(t){return(t=hn.fromLike(t))===this.fragment?this:e.create(this.scheme,this.authority,this.path,this.query,t)}get fragmentPart(){return this.fragment.toString()}withFragmentPart(e){return this.withFragment(hn.parse(e))}get fragmentIdentifier(){return this.fragment.identifier}withFragmentIdentifier(e){return this.withFragment(hn.create(e))}endpoint(){return this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()?e.create(this.scheme,this.authority):this}resolve(t){const r=e.fromLike(t);return r.scheme.isDefined()?this.copy(r.scheme,r.authority,r.path.removeDotSegments(),r.query,r.fragment):r.authority.isDefined()?this.copy(this.scheme,r.authority,r.path.removeDotSegments(),r.query,r.fragment):r.path.isEmpty()?this.copy(this.scheme,this.authority,this.path,r.query.isDefined()?r.query:this.query,r.fragment):r.path.isAbsolute()?this.copy(this.scheme,this.authority,r.path.removeDotSegments(),r.query,r.fragment):this.copy(this.scheme,this.authority,this.merge(r.path).removeDotSegments(),r.query,r.fragment)}merge(e){return this.authority.isDefined()&&this.path.isEmpty()?e.prependedSlash():this.path.isEmpty()?e:this.path.merge(e)}unresolve(t){const r=e.fromLike(t);return this.scheme.equals(r.scheme)&&this.authority.equals(r.authority)?e.create(Ni.undefined(),zi.undefined(),this.path.unmerge(r.path),r.query,r.fragment):r}copy(t,r,i,n,s){return e.create(t,r,i,n,s)}toLike(){const e={};return e.scheme=this.scheme.toLike(),this.authority.toLike(e),e.path=this.path.toLike(),e.query=this.query.toLike(),e.fragment=this.fragment.toLike(),e}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.toString()===t.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=p.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("Uri").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("empty").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):(this.scheme.isDefined()&&(e=e.display(this.scheme).write(58)),this.authority.isDefined()&&(e=e.write(47).write(47).display(this.authority)),e=e.display(this.path),this.query.isDefined()&&(e=e.write(63).display(this.query)),this.fragment.isDefined()&&(e=e.write(35).display(this.fragment))),e}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}static empty(){return new e(Ni.undefined(),zi.undefined(),Ki.empty(),nn.undefined(),hn.undefined())}static create(t=Ni.undefined(),r=zi.undefined(),i=Ki.empty(),n=nn.undefined(),s=hn.undefined()){return t.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()||s.isDefined()?new e(t,r,i,n,s):e.empty()}static fromLike(t){if(null==t||t instanceof e)return t;if("object"==typeof t)return e.fromInit(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static fromInit(e){const t=Ni.fromLike(e.scheme),r=zi.fromLike(e.authority),i=Ki.fromLike(e.path),n=nn.fromLike(e.query),s=hn.fromLike(e.fragment);return this.create(t,r,i,n,s)}static scheme(t){return t=Ni.fromLike(t),e.create(t,void 0,void 0,void 0,void 0)}static schemePart(t){const r=Ni.parse(t);return e.create(r,void 0,void 0,void 0,void 0)}static schemeName(t){const r=Ni.create(t);return e.create(r,void 0,void 0,void 0,void 0)}static authority(t){return t=zi.fromLike(t),e.create(void 0,t,void 0,void 0,void 0)}static authorityPart(t){const r=zi.parse(t);return e.create(void 0,r,void 0,void 0,void 0)}static user(t){const r=zi.user(t);return e.create(void 0,r,void 0,void 0,void 0)}static userPart(t){const r=zi.userPart(t);return e.create(void 0,r,void 0,void 0,void 0)}static username(t,r){const i=zi.username(t,r);return e.create(void 0,i,void 0,void 0,void 0)}static password(t){const r=zi.password(t);return e.create(void 0,r,void 0,void 0,void 0)}static host(t){const r=zi.host(t);return e.create(void 0,r,void 0,void 0,void 0)}static hostPart(t){const r=zi.hostPart(t);return e.create(void 0,r,void 0,void 0,void 0)}static hostName(t){const r=zi.hostName(t);return e.create(void 0,r,void 0,void 0,void 0)}static hostIPv4(t){const r=zi.hostIPv4(t);return e.create(void 0,r,void 0,void 0,void 0)}static hostIPv6(t){const r=zi.hostIPv6(t);return e.create(void 0,r,void 0,void 0,void 0)}static port(t){const r=zi.port(t);return e.create(void 0,r,void 0,void 0,void 0)}static portPart(t){const r=zi.portPart(t);return e.create(void 0,r,void 0,void 0,void 0)}static portNumber(t){const r=zi.portNumber(t);return e.create(void 0,r,void 0,void 0,void 0)}static path(...t){const r=Ki.of(...t);return e.create(void 0,void 0,r,void 0,void 0)}static pathPart(t){const r=Ki.parse(t);return e.create(void 0,void 0,r,void 0,void 0)}static query(t){return t=nn.fromLike(t),e.create(void 0,void 0,void 0,t,void 0)}static queryPart(t){const r=nn.parse(t);return e.create(void 0,void 0,void 0,r,void 0)}static fragment(t){return t=hn.fromLike(t),e.create(void 0,void 0,void 0,void 0,t)}static fragmentPart(t){const r=hn.parse(t);return e.create(void 0,void 0,void 0,void 0,r)}static fragmentIdentifier(t){const r=hn.create(t);return e.create(void 0,void 0,void 0,void 0,r)}static parseCache(){return new Map}static parse(t){const r=this.parseCache();let i,n;if("string"==typeof t&&(i=r.get(t),void 0!==i&&r.delete(t)),void 0===i){const e="string"==typeof t?he.stringInput(t):t;n=Ai.parse(e),"string"==typeof t&&e.isCont()&&!n.isError()&&(n=Te.error(de.unexpected(e)))}if("string"==typeof t){void 0===i&&(i=n.bind()),r.set(t,i);const s=e.ParseCacheCapacity;let o=r.size;if(o>s){const e=r.keys();let t;for(;o>s&&!0!==(t=e.next()).done;)r.delete(t.value),o-=1}return i}return n}static pathBuilder(){return new en}static queryBuilder(){return new an}static form(){return new Ii(e.empty())}static isUnreservedChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||45===e||46===e||95===e||126===e}static isSubDelimChar(e){return 33===e||36===e||38===e||40===e||41===e||42===e||43===e||44===e||59===e||61===e||39===e}static isSchemeChar(e){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||43===e||45===e||46===e}static isUserInfoChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)||58===t}static isUserChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)}static isHostChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)}static isPathChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)||58===t||64===t}static isQueryChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)||47===t||58===t||63===t||64===t}static isParamChar(t){return e.isUnreservedChar(t)||33===t||36===t||40===t||41===t||42===t||43===t||44===t||47===t||58===t||59===t||63===t||64===t||39===t}static isFragmentChar(t){return e.isUnreservedChar(t)||e.isSubDelimChar(t)||47===t||58===t||63===t||64===t}static isAlpha(e){return e>=65&&e<=90||e>=97&&e<=122}static toLowerCase(e){return e>=65&&e<=90?e+32:e}static writeScheme(t,r){if(0===r.length||!e.isAlpha(r.charCodeAt(0)))return ne.error(new Error("Invalid scheme: "+r));for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);if(!e.isSchemeChar(n))return ne.error(new Error("Invalid scheme: "+r));t=t.write(n)}return t}static writeUserInfo(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isUserInfoChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeUser(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isUserChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeHost(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isHostChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeHostLiteral(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isHostChar(n)||58===n?t.write(n):e.writeEncoded(t,n)}return t}static writePathSegment(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isPathChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeQuery(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isQueryChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeParam(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isParamChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeFragment(t,r){for(let i=0;i<r.length;i+=1){const n=r.charCodeAt(i);t=e.isFragmentChar(n)?t.write(n):e.writeEncoded(t,n)}return t}static writeEncoded(t,r){return 0===r?(t=e.writePctEncoded(t,192),t=e.writePctEncoded(t,128)):r>=0&&r<=127?t=e.writePctEncoded(t,r):r>=128&&r<=2047?(t=e.writePctEncoded(t,192|r>>>6),t=e.writePctEncoded(t,128|63&r)):r>=2048&&r<=65535?(t=e.writePctEncoded(t,224|r>>>12),t=e.writePctEncoded(t,128|r>>>6&63),t=e.writePctEncoded(t,128|63&r)):r>=65536&&r<=1114111?(t=e.writePctEncoded(t,240|r>>>18),t=e.writePctEncoded(t,128|r>>>12&63),t=e.writePctEncoded(t,128|r>>>6&63),t=e.writePctEncoded(t,128|63&r)):(t=e.writePctEncoded(t,239),t=e.writePctEncoded(t,191),t=e.writePctEncoded(t,189)),t}static writePctEncoded(e,t){const r=Ue.lowercase;return e=e.write(37).write(r.encodeDigit(t>>>4&15)).write(r.encodeDigit(15&t))}},(()=>{const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],s=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:u},null,a),t(e,null,n,{kind:"method",name:"parseCache",static:!0,private:!1,access:{has:e=>"parseCache"in e,get:e=>e.parseCache},metadata:u},null,a),t(e,null,s,{kind:"method",name:"form",static:!0,private:!1,access:{has:e=>"form"in e,get:e=>e.form},metadata:u},null,a),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,a)})(),e.ParseCacheCapacity=256,e})();class Ii extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new Ii(e)}mold(e,t){return e=qi.fromLike(e),void 0===t?bt.from(e.toString()):t.concat(bt.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return qi.parse(e)}catch(e){}}}class Ai extends Te{constructor(e,t,r,i,n,s){super(),this.schemeParser=e,this.authorityParser=t,this.pathParser=r,this.queryParser=i,this.fragmentParser=n,this.step=s}feed(e){return Ai.parse(e,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)}static parse(e,t,r,i,n,s,o=1){let a=0;if(1===o)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(a=t.head(),qi.isSchemeChar(a));)t.step();o=t.isCont()&&58===a?2:3}else e.isDone()&&(o=3);if(2===o)if((t=void 0===t?ji.parse(e):t.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),o=3;else if(!e.isEmpty())return Te.error(de.expected(58,e))}else if(t.isError())return t.asError();if(3===o)if(e.isCont())a=e.head(),47===a?(e=e.step(),o=4):63===a?(e=e.step(),o=7):35===a?(e=e.step(),o=8):o=6;else if(e.isDone())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0,void 0,void 0,void 0));if(4===o)if(e.isCont()&&47===e.head())e=e.step(),o=5;else if(e.isCont()){const t=new en;t.addSlash(),i=rn.parse(e,t),o=6}else if(e.isDone())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0,Ki.slash(),void 0,void 0));if(5===o)if((r=void 0===r?Vi.parse(e):r.feed(e)).isDone()){if(e.isCont())a=e.head(),63===a?(e=e.step(),o=7):35===a?(e=e.step(),o=8):o=6;else if(e.isDone())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0!==r?r.bind():void 0,void 0,void 0,void 0))}else if(r.isError())return r.asError();if(6===o)if((i=void 0===i?rn.parse(e):i.feed(e)).isDone()){if(e.isCont()&&63===e.head())e=e.step(),o=7;else if(e.isCont()&&35===e.head())e=e.step(),o=8;else if(!e.isEmpty())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0!==r?r.bind():void 0,i.bind(),void 0,void 0))}else if(i.isError())return i.asError();if(7===o)if((n=void 0===n?un.parse(e):n.feed(e)).isDone()){if(e.isCont()&&35===e.head())e=e.step(),o=8;else if(!e.isEmpty())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,n.bind(),void 0))}else if(n.isError())return n.asError();if(8===o){if((s=void 0===s?ln.parse(e):s.feed(e)).isDone())return Te.done(qi.create(void 0!==t?t.bind():void 0,void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,s.bind()));if(s.isError())return s.asError()}return new Ai(t,r,i,n,s,o)}}let Ni=(()=>{var e;let i,n=[];return e=class{constructor(e){this.name=e}isDefined(){return 0!==this.name.length}toLike(){return 0!==this.name.length?this.name:void 0}compareTo(t){return t instanceof e?this.name.localeCompare(t.name):NaN}equals(t){return this===t||t instanceof e&&this.name===t.name}hashCode(){return p.hash(this.name)}debug(e){return e=e.write("UriScheme").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return e=qi.writeScheme(e,this.name)}toString(){return this.name}static undefined(){return new e("")}static create(t){return new e(t)}static fromLike(t){if(null==t||t instanceof e)return t;if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=ji.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class ji extends Te{constructor(e,t){super(),this.output=e,this.step=t}feed(e){return ji.parse(e,this.output,this.step)}static parse(e,t,r=1){let i=0;if(1===r)if(e.isCont()&&(i=e.head(),qi.isAlpha(i)))e=e.step(),t=(t=t||He.decodedString()).write(qi.toLowerCase(i)),r=2;else if(!e.isEmpty())return Te.error(de.expected("scheme",e));if(2===r){for(;e.isCont()&&(i=e.head(),qi.isSchemeChar(i));)e=e.step(),t.write(qi.toLowerCase(i));if(!e.isEmpty())return Te.done(Ni.create(t.bind()))}return new ji(t,r)}}let zi=(()=>{var e;let i,n=[];return e=class{constructor(e,t,r){this.user=e,this.host=t,this.port=r,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.user.isDefined()||this.host.isDefined()||this.port.isDefined()}withUser(e){return(e=Mi.fromLike(e))===this.user?this:this.copy(e,this.host,this.port)}get userPart(){return this.user.toString()}withUserPart(e){return this.withUser(Mi.parse(e))}get username(){return this.user.username}withUsername(e,t){if(1===arguments.length)return this.withUser(this.user.withUsername(e));if(2===arguments.length)return this.withUser(Mi.create(e,t));throw new Error(arguments.toString())}get password(){return this.user.password}withPassword(e){return this.withUser(this.user.withPassword(e))}withHost(e){return(e=Bi.fromLike(e))===this.host?this:this.copy(this.user,e,this.port)}get hostPart(){return this.host.toString()}withHostPart(e){return this.withHost(Bi.parse(e))}get hostAddress(){return this.host.address}get hostName(){return this.host.name}withHostName(e){return this.withHost(Bi.hostname(e))}get hostIPv4(){return this.host.ipv4}withHostIPv4(e){return this.withHost(Bi.ipv4(e))}get hostIPv6(){return this.host.ipv6}withHostIPv6(e){return this.withHost(Bi.ipv6(e))}withPort(e){return(e=Xi.fromLike(e))===this.port?this:this.copy(this.user,this.host,e)}get portPart(){return this.port.toString()}withPortPart(e){return this.withPort(Xi.parse(e))}get portNumber(){return this.port.number}withPortNumber(e){return this.withPort(Xi.create(e))}copy(t,r,i){return e.create(t,r,i)}toLike(e){return this.isDefined()&&(void 0===e&&(e={}),this.user.toLike(e),this.host.isDefined()&&(e.host=this.host.toLike()),this.port.isDefined()&&(e.port=this.port.toLike())),e}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.toString()===t.toString()}hashCode(){let e=this.hashValue;return void 0===e&&(e=p.hash(this.toString()),this.hashValue=e),e}debug(e){return e=e.write("UriAuthority").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;if(void 0!==t)e=e.write(t);else{const t=this.user;t.isDefined()&&(e=e.display(t).write(64)),e=e.display(this.host);const r=this.port;r.isDefined()&&(e=e.write(58).display(r))}return e}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}static undefined(){return new e(Mi.undefined(),Bi.undefined(),Xi.undefined())}static create(t=Mi.undefined(),r=Bi.undefined(),i=Xi.undefined()){return t.isDefined()||r.isDefined()||i.isDefined()?new e(t,r,i):e.undefined()}static fromLike(t){if(null==t||t instanceof e)return t;if("object"==typeof t)return e.fromInit(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static fromInit(e){const t=Mi.fromLike(e.user),r=Bi.fromLike(e.host),i=Xi.fromLike(e.port);return this.create(t,r,i)}static user(e){return e=Mi.fromLike(e),this.create(e,void 0,void 0)}static userPart(e){const t=Mi.parse(e);return this.create(t,void 0,void 0)}static username(e,t){const r=Mi.create(e,t);return this.create(r,void 0,void 0)}static password(e){const t=Mi.create("",e);return this.create(t,void 0,void 0)}static host(e){return e=Bi.fromLike(e),this.create(void 0,e,void 0)}static hostPart(e){const t=Bi.parse(e);return this.create(void 0,t,void 0)}static hostName(e){const t=Bi.hostname(e);return this.create(void 0,t,void 0)}static hostIPv4(e){const t=Bi.ipv4(e);return this.create(void 0,t,void 0)}static hostIPv6(e){const t=Bi.ipv6(e);return this.create(void 0,t,void 0)}static port(e){return e=Xi.fromLike(e),this.create(void 0,void 0,e)}static portPart(e){const t=Xi.parse(e);return this.create(void 0,void 0,t)}static portNumber(e){const t=Xi.create(e);return this.create(void 0,void 0,t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=Vi.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class Vi extends Te{constructor(e,t,r,i){super(),this.userParser=e,this.hostParser=t,this.portParser=r,this.step=i}feed(e){return Vi.parse(e,this.userParser,this.hostParser,this.portParser,this.step)}static parse(e,t,r,i,n=1){let s=0;if(1===n)if(e.isCont()){const t=e.clone();for(;t.isCont()&&(s=t.head(),64!==s&&47!==s);)t.step();n=t.isCont()&&64===s?2:3}else e.isDone()&&(n=3);if(2===n)if((t=void 0===t?Fi.parse(e):t.feed(e)).isDone()){if(e.isCont()&&64===e.head())e=e.step(),n=3;else if(!e.isEmpty())return Te.error(de.expected(64,e))}else if(t.isError())return t.asError();if(3===n)if((r=void 0===r?Zi.parse(e):r.feed(e)).isDone()){if(e.isCont()&&58===e.head())e=e.step(),n=4;else if(!e.isEmpty())return Te.done(zi.create(void 0!==t?t.bind():void 0,r.bind()))}else if(r.isError())return r.asError();if(4===n){if((i=void 0===i?$i.parse(e):i.feed(e)).isDone())return Te.done(zi.create(void 0!==t?t.bind():void 0,r.bind(),i.bind()));if(i.isError())return i.asError()}return new Vi(t,r,i,n)}}let Mi=(()=>{var e;let i,n=[];return e=class{constructor(e,t){this.username=e,this.password=t}isDefined(){return void 0!==this.username}withUsername(e){return e===this.username?this:this.copy(e,this.password)}withPassword(e){return e===this.password?this:this.copy(this.username,e)}copy(t,r){return e.create(t,r)}toLike(e){return void 0!==this.username&&(void 0===e&&(e={}),e.username=this.username,void 0!==this.password&&(e.password=this.password)),e}equals(t){return this===t||t instanceof e&&(this.username===t.username&&this.password===t.password)}hashCode(){return p.hash(this.toString())}debug(e){return e=e.write("UriUser").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){return void 0!==this.username&&(e=qi.writeUser(e,this.username),void 0!==this.password&&(e=e.write(58),e=qi.writeUser(e,this.password))),e}toString(){return le.display(this)}static undefined(){return new e(void 0,void 0)}static create(t,r){return void 0===t&&void 0===r?e.undefined():new e(t,r)}static fromInit(t){return e.create(t.username,t.password)}static fromLike(t){if(null==t||t instanceof e)return t;if("object"==typeof t)return e.fromInit(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=Fi.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class Fi extends Te{constructor(e,t,r,i){super(),this.usernameOutput=e,this.passwordOutput=t,this.c1=r,this.step=i}feed(e){return Fi.parse(e,this.usernameOutput,this.passwordOutput,this.c1,this.step)}static parse(e,t,r,i=0,n=1){let s=0;for(;;){if(1===n){for(t=t||He.decodedString();e.isCont()&&(s=e.head(),qi.isUserChar(s));)e=e.step(),t.write(s);if(e.isCont()&&58===s)e=e.step(),n=4;else if(e.isCont()&&37===s)e=e.step(),n=2;else if(!e.isEmpty())return Te.done(Mi.create(t.bind()))}if(2===n)if(e.isCont()&&(s=e.head(),Ue.isDigit(s)))e=e.step(),i=s,n=3;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(3===n){if(e.isCont()&&(s=e.head(),Ue.isDigit(s))){e=e.step(),t.write(Ue.decodeDigit(i)<<4|Ue.decodeDigit(s)),i=0,n=1;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}if(4===n){for(r=r||He.decodedString();e.isCont()&&(s=e.head(),qi.isUserInfoChar(s));)e=e.step(),r.write(s);if(e.isCont()&&37===s)e=e.step(),n=5;else if(!e.isEmpty())return Te.done(Mi.create(t.bind(),r.bind()))}if(5===n)if(e.isCont()&&(s=e.head(),Ue.isDigit(s)))e=e.step(),i=s,n=6;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(6===n){if(e.isCont()&&(s=e.head(),Ue.isDigit(s))){e=e.step(),r.write(Ue.decodeDigit(i)<<4|Ue.decodeDigit(s)),i=0,n=4;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}break}return new Fi(t,r,i,n)}}let Bi=(()=>{var e;let i,n=[];return e=class{constructor(){}isDefined(){return!0}get name(){}get ipv4(){}get ipv6(){}toLike(){return this.toString()}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.toString()===t.toString()}hashCode(){return p.hash(this.toString())}static undefined(){return new Ui}static hostname(e){return new Ri(e)}static ipv4(e){return new Wi(e)}static ipv6(e){return new Hi(e)}static fromLike(t){if(null==t||t instanceof e)return t;if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=Zi.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class Ui extends Bi{constructor(){super()}isDefined(){return!1}get address(){return""}debug(e){return e=e.write("UriHost").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class Ri extends Bi{constructor(e){super(),this.address=e}get name(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("hostname").write(40).debug(this.address).write(41)}display(e){return e=qi.writeHost(e,this.address)}toString(){return this.address}}class Wi extends Bi{constructor(e){super(),this.address=e}get ipv4(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv4").write(40).debug(this.address).write(41)}display(e){return e=qi.writeHost(e,this.address)}toString(){return this.address}}class Hi extends Bi{constructor(e){super(),this.address=e}get ipv6(){return this.address}debug(e){return e=e.write("UriHost").write(46).write("ipv6").write(40).debug(this.address).write(41)}display(e){return e=e.write(91),e=(e=qi.writeHostLiteral(e,this.address)).write(93)}toString(){return"["+this.address+"]"}}class Zi extends Te{feed(e){return Zi.parse(e)}static parse(e){if(e.isCont()){return 91===e.head()?Gi.parse(e):Qi.parse(e)}return e.isDone()?Te.done(Bi.hostname("")):new Zi}}class Qi extends Te{constructor(e,t,r,i){super(),this.output=e,this.c1=t,this.x=r,this.step=i}feed(e){return Qi.parse(e,this.output,this.c1,this.x,this.step)}static parse(e,t,r=0,i=0,n=1){let s=0;for(t=t||He.decodedString();n<=4;){for(;e.isCont()&&(s=e.head(),ce.isDigit(s));)e=e.step(),t=t.write(s),i=10*i+ce.decodeDigit(s);if(!e.isCont()){if(e.isEmpty())break;return 4===n&&i<=255?Te.done(Bi.ipv4(t.bind())):Te.done(Bi.hostname(t.bind()))}if(!(46===s&&n<4&&i<=255)){if(!qi.isHostChar(s)&&37!==s&&4===n&&i<=255)return Te.done(Bi.ipv4(t.bind()));i=0,n=5;break}e=e.step(),t=t.write(s),i=0,n+=1}for(;;){if(5===n){for(;e.isCont()&&(s=e.head(),qi.isHostChar(s));)e=e.step(),t.write(qi.toLowerCase(s));if(e.isCont()&&37===s)e=e.step(),n=6;else if(!e.isEmpty())return Te.done(Bi.hostname(t.bind()))}if(6===n)if(e.isCont()&&(s=e.head(),Ue.isDigit(s)))e=e.step(),r=s,n=7;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(7===n){if(e.isCont()&&(s=e.head(),Ue.isDigit(s))){e=e.step(),t.write(Ue.decodeDigit(r)<<4|Ue.decodeDigit(s)),r=0,n=5;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}break}return new Qi(t,r,i,n)}}class Gi extends Te{constructor(e,t){super(),this.output=e,this.step=t}feed(e){return Gi.parse(e,this.output,this.step)}static parse(e,t,r=1){let i=0;if(1===r)if(e.isCont()&&91===e.head())e=e.step(),r=2;else if(!e.isEmpty())return Te.error(de.expected(91,e));if(2===r){for(t=t||He.decodedString();e.isCont()&&(i=e.head(),qi.isHostChar(i)||58===i);)e=e.step(),t=t.write(qi.toLowerCase(i));if(e.isCont()&&93===i)return e=e.step(),Te.done(Bi.ipv6(t.bind()));if(!e.isEmpty())return Te.error(de.expected(93,e))}return new Gi(t,r)}}let Xi=(()=>{var e;let i,n=[];return e=class{constructor(e){this.number=e}isDefined(){return 0!==this.number}valueOf(){return this.number}toLike(){return this.number}compareTo(t){return t instanceof e?this.number<t.number?-1:this.number>t.number?1:0:NaN}equals(t){return this===t||t instanceof e&&this.number===t.number}hashCode(){return p.hash(this.toString())}debug(e){return e=e.write("UriPort").write(46),this.isDefined()?(e=e.write("create").write(40),e=le.displayNumber(e,this.number)):e=e.write("undefined").write(40),e=e.write(41)}display(e){return e=le.displayNumber(e,this.number)}toString(){return""+this.number}static undefined(){return new e(0)}static create(t){if(t<0)throw new TypeError(""+t);return 0===t?e.undefined():new e(t)}static fromLike(t){if(null==t||t instanceof e)return t;if("number"==typeof t)return e.create(t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=$i.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class $i extends Te{constructor(e){super(),this.number=e}feed(e){return $i.parse(e,this.number)}static parse(e,t=0){let r=0;for(;e.isCont()&&(r=e.head(),ce.isDigit(r));)e=e.step(),t=10*t+ce.decodeDigit(r);return e.isEmpty()?new $i(t):Te.done(Xi.create(t))}}let Ki=(()=>{var e;let i,n,s=[];return e=class{constructor(){}get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}get(e){let t=0,r=this;for(;!r.isEmpty();){if(t>=e)return r.head();t+=1,r=r.tail()}}get name(){if(this.isEmpty())return"";let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e.isRelative()?e.head():"";e=t}}withName(e){const t=new en;return t.addPath(this.base()),t.addSegment(e),t.build()}body(){if(this.isEmpty())return this;const e=new en;let t=this;for(;;){const r=t.tail();if(r.isEmpty())return e.build();t.isSegment()?e.addSegment(t.head()):t.isAbsolute()&&e.addSlash(),t=r}}foot(){if(this.isEmpty())return this;let e=this;for(;;){const t=e.tail();if(t.isEmpty())return e;e=t}}isSubpathOf(t){t=e.fromLike(t);let r=this;for(;!r.isEmpty()&&!t.isEmpty();){if(r.isRelative()!=t.isRelative()||r.head()!==t.head())return!1;r=r.tail(),t=t.tail()}return t.isEmpty()}appended(...e){if(0===arguments.length)return this;const t=new en;return t.addPath(this),t.push(...e),t.build()}appendedSlash(){const e=new en;return e.addPath(this),e.addSlash(),e.build()}appendedSegment(e){const t=new en;return t.addPath(this),t.addSegment(e),t.build()}prepended(...e){if(0===arguments.length)return this;const t=new en;return t.push(...e),t.addPath(this),t.build()}prependedSlash(){return new Ji(this)}prependedSegment(t){return this.isEmpty()||this.isAbsolute()?e.segment(t,this):e.segment(t,this.prependedSlash())}resolve(e){return e.isEmpty()?this:e.isAbsolute()||this.isEmpty()?e.removeDotSegments():this.merge(e).removeDotSegments()}removeDotSegments(){let t=this;const r=new en;for(;!t.isEmpty();){const i=t.head();if("."===i||".."===i)t=t.tail(),t.isEmpty()||(t=t.tail());else if(t.isAbsolute()){const n=t.tail();if(n.isEmpty())r.push(t.head()),t=t.tail();else{const s=n.head();"."===s?(t=n.tail(),t.isEmpty()&&(t=e.slash())):".."===s?(t=n.tail(),t.isEmpty()&&(t=e.slash()),r.isEmpty()||r.pop().isAbsolute()||r.isEmpty()||r.pop()):(r.push(i,s),t=n.tail())}}else r.push(t.head()),t=t.tail()}return r.build()}merge(e){if(this.isEmpty())return e;const t=new en;let r=this;for(;;){const e=r.tail();if(e.isEmpty()){r.isAbsolute()&&t.addSlash();break}r.isAbsolute()?t.addSlash():t.addSegment(r.head()),r=e}return t.addPath(e),t.build()}unmerge(t){let r=this,i=t;if(r.isEmpty())return i;for(;;){if(r.isEmpty())return i.isEmpty()||i.tail().isEmpty()?i:i.tail();if(r.isRelative())return i;if(i.isRelative())return i.prependedSlash();let n=r.tail(),s=i.tail();if(!n.isEmpty()&&s.isEmpty())return e.slash();if(n.isEmpty()||s.isEmpty()||n.isRelative()!=s.isRelative()||n.head()!==s.head())return s;if(n=n.tail(),s=s.tail(),!n.isEmpty()&&s.isEmpty())return t;r=n,i=s}}relativeTo(t){return e.difference(t,this)}static difference(e,t){let r=!1;for(;!e.isEmpty()&&!t.isEmpty()&&e.isRelative()===t.isRelative()&&e.head()===t.head();)r=e.isAbsolute(),e=e.tail(),t=t.tail();if(e.isEmpty())return t;const i=new en;for(;!e.isEmpty();)e.isRelative()&&i.addSegment(".."),e=e.tail();return r&&i.addSlash(),i.addPath(t),i.build()}toLike(){const e=[];let t=this;for(;!t.isEmpty();)e.push(t.head()),t=t.tail();return e}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.toString()===t.toString()}hashCode(){return p.hash(this.toString())}display(e){let t=this;for(;!t.isEmpty();)e=t.isAbsolute()?e.write(47):qi.writePathSegment(e,t.head()),t=t.tail();return e}static builder(){return new en}static empty(){return new Yi}static slash(e){return void 0===e?Ji.slash():("string"==typeof e&&(e=this.segment(e)),new Ji(e))}static segment(t,r){return void 0===r&&(r=e.empty()),new _i(t,r)}static of(...e){const t=new en;return t.push(...e),t.build()}static fromLike(t){if(null==t||t instanceof e)return t;if(Array.isArray(t))return e.of(...t);if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=rn.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}static pathForm(){return new tn(e.empty())}},(()=>{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],n=[o],t(e,null,i,{kind:"method",name:"empty",static:!0,private:!1,access:{has:e=>"empty"in e,get:e=>e.empty},metadata:a},null,s),t(e,null,n,{kind:"method",name:"pathForm",static:!0,private:!1,access:{has:e=>"pathForm"in e,get:e=>e.pathForm},metadata:a},null,s),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),r(e,s)})(),e})();class Yi extends Ki{constructor(){super()}isDefined(){return!1}isAbsolute(){return!1}isRelative(){return!0}isSegment(){return!1}isEmpty(){return!0}head(){throw new Error("empty path")}tail(){throw new Error("empty path")}setTail(e){throw new Error("empty path")}dealias(){return this}parent(){return this}base(){return this}appended(...e){return Ki.of(...e)}appendedSlash(){return Ki.slash()}appendedSegment(e){return Ki.segment(e)}prepended(...e){return Ki.of(...e)}prependedSlash(){return Ki.slash()}prependedSegment(e){return Ki.segment(e)}merge(e){return e}debug(e){return e=e.write("UriPath").write(46).write("empty").write(40).write(41)}display(e){return e}toString(){return""}}let Ji=(()=>{var e;let i,n=Ki,s=[];return e=class extends n{constructor(e){super(),this.rest=e,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!0}isRelative(){return!1}isSegment(){return!1}isEmpty(){return!1}head(){return"/"}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new e(this.rest)}parent(){const t=this.rest;if(t.isEmpty())return Ki.empty();return t.tail().isEmpty()?Ki.slash():new e(t.parent())}base(){const t=this.rest;return t.isEmpty()?this:new e(t.base())}prependedSegment(e){return Ki.segment(e,this)}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}static slash(){return new e(Ki.empty())}},(()=>{var a;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=n[Symbol.metadata])&&void 0!==a?a:null):void 0;i=[o],t(e,null,i,{kind:"method",name:"slash",static:!0,private:!1,access:{has:e=>"slash"in e,get:e=>e.slash},metadata:u},null,s),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u}),r(e,s)})(),e})();class _i extends Ki{constructor(e,t){super(),this.segment=e,this.rest=t,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!1}isRelative(){return!0}isSegment(){return!0}isEmpty(){return!1}head(){return this.segment}tail(){return this.rest}setTail(e){if(e instanceof _i)throw new Error("adjacent path segments");this.rest=e}dealias(){return new _i(this.segment,this.rest)}parent(){const e=this.rest;if(e.isEmpty())return Ki.empty();return e.tail().isEmpty()?Ki.empty():new _i(this.segment,e.parent())}base(){const e=this.rest;return e.isEmpty()?Ki.empty():new _i(this.segment,e.base())}prependedSegment(e){return Ki.segment(e,this.prependedSlash())}debug(e){return e=e.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}}class en{constructor(){this.first=Ki.empty(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}push(...e){for(let t=0;t<e.length;t+=1){const r=e[t];r instanceof Ki?this.addPath(r):Array.isArray(r)?this.push(...r):"/"===r?this.addSlash():this.addSegment(r)}}build(){return this.aliased=0,this.first}addSlash(){const e=Ki.slash().dealias(),t=this.size;0===t?this.first=e:this.dealias(t-1).setTail(e),this.last=e,this.size=t+1,this.aliased+=1}addSegment(e){const t=Ki.segment(e,Ki.empty());let r=this.size;if(0===r)this.first=t;else{const e=this.dealias(r-1);e.isAbsolute()?e.setTail(t):(e.setTail(t.prependedSlash()),r+=1,this.aliased+=1)}this.last=t,this.size=r+1,this.aliased+=1}addPath(e){if(e.isEmpty())return;let t=this.size;if(0===t)this.first=e;else{const r=this.dealias(t-1);r.isAbsolute()||e.isAbsolute()?r.setTail(e):(r.setTail(e.prependedSlash()),t+=1,this.aliased+=1)}for(t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}pop(){const e=this.size,t=this.aliased;if(0===e)throw new Error("Empty UriPath");if(1===e){const r=this.first;return this.first=r.tail(),r.tail().isEmpty()&&(this.last=null),this.size=e-1,t>0&&(this.aliased=t-1),r}const r=this.dealias(e-2);return r.setTail(Ki.empty()),this.last=r,this.size=e-1,this.aliased=t-1,r.tail()}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}toString(){return this.build().toString()}}class tn extends vr{constructor(e){super(),Object.defineProperty(this,"unit",{value:e,enumerable:!0,configurable:!0})}withUnit(e){return e===this.unit?this:new tn(e)}mold(e,t){return e=Ki.fromLike(e),void 0===t?bt.from(e.toString()):t.concat(bt.from(e.toString()))}cast(e,t){const r=e.target;try{const e=r.stringValue();if("string"==typeof e)return Ki.parse(e)}catch(e){}}}class rn extends Te{constructor(e,t,r,i){super(),this.builder=e,this.output=t,this.c1=r,this.step=i}feed(e){return rn.parse(e,this.builder,this.output,this.c1,this.step)}static parse(e,t,r,i=0,n=1){let s=0;for(;;){if(1===n){for(;e.isCont()&&(s=e.head(),qi.isPathChar(s));)r=r||He.decodedString(),e=e.step(),r=r.write(s);if(e.isCont()&&47===s){e=e.step(),t=t||new en,void 0!==r&&(t.addSegment(r.bind()),r=void 0),t.addSlash();continue}if(e.isCont()&&37===s)e=e.step(),n=2;else if(!e.isEmpty())return void 0!==r&&(t=t||new en).addSegment(r.bind()),void 0!==t?Te.done(t.build()):Te.done(Ki.empty())}if(2===n)if(e.isCont()&&(s=e.head(),Ue.isDigit(s)))e=e.step(),i=s,n=3;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(3===n){if(e.isCont()&&(s=e.head(),Ue.isDigit(s))){r=r||He.decodedString(),e=e.step(),r=r.write(Ue.decodeDigit(i)<<4|Ue.decodeDigit(s)),i=0,n=1;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}break}return new rn(t,r,i,n)}}let nn=(()=>{var e;let i,n=[];return e=class{get length(){let e=0,t=this;for(;!t.isEmpty();)e+=1,t=t.tail();return e}has(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return!0;t=t.tail()}return!1}get(e){let t=this;for(;!t.isEmpty();){if(e===t.key)return t.value;t=t.tail()}}updated(e,t){let r=this;const i=new an;let n=!1;for(;!r.isEmpty();)e===r.key?(i.addParam(e,t),n=!0):i.addParam(r.key,r.value),r=r.tail();return n||i.addParam(e,t),i.build()}removed(e){let t=this;const r=new an;let i=!1;for(;!t.isEmpty();)e===t.key?i=!0:r.addParam(t.key,t.value),t=t.tail();return i?r.build():this}appended(e,t){const r=new an;return r.addQuery(this),r.add(e,t),r.build()}prepended(e,t){const r=new an;return r.add(e,t),r.addQuery(this),r.build()}toLike(e){if(this.isDefined()){e=e||{};let t=this,r=0;for(;!t.isEmpty();){const i=t.key;void 0!==i?e[i]=t.value:e["$"+r]=t.value,t=t.tail(),r+=1}}return e}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.toString()===t.toString()}hashCode(){return p.hash(this.toString())}display(e){let t=this,r=!0;for(;!t.isEmpty();){r?r=!1:e=e.write(38);const i=t.key;void 0!==i&&(e=(e=qi.writeParam(e,i)).write(61)),e=qi.writeQuery(e,t.value),t=t.tail()}return e}static builder(){return new an}static undefined(){return new sn}static param(t,r,i){return void 0===i&&(i=r,r=t,t=void 0),void 0===i&&(i=e.undefined()),new on(t,r,i)}static fromLike(t){if(null==t||t instanceof e)return t;if("object"==typeof t){const e=new an;return e.add(t),e.build()}if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=un.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class sn extends nn{isDefined(){return!1}isEmpty(){return!0}head(){throw new Error("undefined query")}get key(){throw new Error("undefined query")}get value(){throw new Error("undefined query")}tail(){throw new Error("undefined query")}setTail(e){throw new Error("undefined query")}dealias(){return this}updated(e,t){return nn.param(e,t,this)}removed(e){return this}appended(e,t){const r=new an;return r.add(e,t),r.build()}prepended(e,t){const r=new an;return r.add(e,t),r.build()}debug(e){return e=e.write("UriQuery").write(46).write("undefined").write(40).write(41)}display(e){return e}toString(){return""}}class on extends nn{constructor(e,t,r){super(),this.key=e,this.value=t,this.rest=r,this.stringValue=void 0}isDefined(){return!0}isEmpty(){return!1}head(){return[this.key,this.value]}tail(){return this.rest}setTail(e){this.rest=e}dealias(){return new on(this.key,this.value,this.rest)}debug(e){return e=e.write("UriQuery").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(e){const t=this.stringValue;return e=void 0!==t?e.write(t):super.display(e)}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}}class an{constructor(){this.first=nn.undefined(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}add(e,t){if(void 0!==t)this.addParam(e,t);else if("string"==typeof e)this.addParam(void 0,e);else if(e instanceof nn)this.addQuery(e);else{const t=e;for(const e in t){let r=e;const i=t[e];36===e.charCodeAt(0)&&(r=void 0),this.addParam(r,i)}}}build(){return this.aliased=0,this.first}addParam(e,t){void 0===t&&(t=e,e=void 0);const r=nn.param(e,t,nn.undefined()),i=this.size;0===i?this.first=r:this.dealias(i-1).setTail(r),this.last=r,this.size=i+1,this.aliased+=1}addQuery(e){if(e.isEmpty())return;let t=this.size;for(0===t?this.first=e:this.dealias(t-1).setTail(e),t+=1;;){const r=e.tail();if(r.isEmpty())break;e=r,t+=1}this.last=e,this.size=t}dealias(e){let t=0,r=null,i=this.first;if(this.aliased<=e){for(;t<this.aliased;)r=i,i=i.tail(),t+=1;for(;t<=e;){const e=i.dealias();0===t?this.first=e:r.setTail(e),r=e,i=i.tail(),t+=1}t===this.size&&(this.last=r),this.aliased=t}else if(0===e)r=this.first;else if(e===this.size-1)r=this.last;else for(;t<=e;)r=i,i=i.tail(),t+=1;return r}toString(){return this.build().toString()}}class un extends Te{constructor(e,t,r,i,n){super(),this.builder=e,this.keyOutput=t,this.valueOutput=r,this.c1=i,this.step=n}feed(e){return un.parse(e,this.builder,this.keyOutput,this.valueOutput,this.c1,this.step)}static parse(e,t,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(r=r||He.decodedString();e.isCont()&&(o=e.head(),qi.isParamChar(o));)e=e.step(),r.write(o);if(e.isCont()&&61===o)e=e.step(),s=4;else{if(e.isCont()&&38===o){e=e.step(),(t=t||new an).addParam(r.bind()),r=void 0;continue}if(e.isCont()&&37===o)e=e.step(),s=2;else if(!e.isEmpty())return(t=t||new an).addParam(r.bind()),Te.done(t.build())}}if(2===s)if(e.isCont()&&(o=e.head(),Ue.isDigit(o)))e=e.step(),n=o,s=3;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(3===s){if(e.isCont()&&(o=e.head(),Ue.isDigit(o))){e=e.step(),r.write(Ue.decodeDigit(n)<<4|Ue.decodeDigit(o)),n=0,s=1;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}if(4===s){for(i=i||He.decodedString();e.isCont()&&(o=e.head(),qi.isParamChar(o)||61===o);)e=e.step(),i.write(o);if(e.isCont()&&38===o){e=e.step(),(t=t||new an).addParam(r.bind(),i.bind()),r=void 0,i=void 0,s=1;continue}if(e.isCont()&&37===o)e=e.step(),s=5;else if(!e.isEmpty())return(t=t||new an).addParam(r.bind(),i.bind()),Te.done(t.build())}if(5===s)if(e.isCont()&&(o=e.head(),Ue.isDigit(o)))e=e.step(),n=o,s=6;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(6===s){if(e.isCont()&&(o=e.head(),Ue.isDigit(o))){e=e.step(),i.write(Ue.decodeDigit(n)<<4|Ue.decodeDigit(o)),n=0,s=4;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}break}return new un(t,r,i,n,s)}}let hn=(()=>{var e;let i,n=[];return e=class{constructor(e){this.identifier=e,this.stringValue=void 0}isDefined(){return void 0!==this.identifier}toLike(){return this.identifier}compareTo(t){return t instanceof e?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof e&&this.identifier===t.identifier}hashCode(){return p.hash(this.identifier)}debug(e){return e=e.write("UriFragment").write(46),e=this.isDefined()?e.write("parse").write(40).write(34).display(this).write(34).write(41):e.write("undefined").write(40).write(41)}display(e){const t=this.stringValue;return void 0!==t?e=e.write(t):void 0!==this.identifier&&(e=qi.writeFragment(e,this.identifier)),e}toString(){let e=this.stringValue;return void 0===e&&(e=le.display(this),this.stringValue=e),e}static undefined(){return new e(void 0)}static create(t){return void 0===t?e.undefined():new e(t)}static fromLike(t){if(null==t||t instanceof e)return t;if("string"==typeof t)return e.parse(t);throw new TypeError(""+t)}static parse(e){const t="string"==typeof e?he.stringInput(e):e;let r=ln.parse(t);return"string"==typeof e&&t.isCont()&&!r.isError()&&(r=Te.error(de.unexpected(t))),"string"==typeof e?r.bind():r}},(()=>{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;i=[o],t(e,null,i,{kind:"method",name:"undefined",static:!0,private:!1,access:{has:e=>"undefined"in e,get:e=>e.undefined},metadata:s},null,n),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),r(e,n)})(),e})();class ln extends Te{constructor(e,t,r){super(),this.output=e,this.c1=t,this.step=r}feed(e){return ln.parse(e,this.output,this.c1,this.step)}static parse(e,t,r=0,i=1){let n=0;for(t=t||He.decodedString();;){if(1===i){for(;e.isCont()&&(n=e.head(),qi.isFragmentChar(n));)e=e.step(),t=t.write(n);if(e.isCont()&&37===n)e=e.step(),i=2;else if(!e.isEmpty())return Te.done(hn.create(t.bind()))}if(2===i)if(e.isCont()&&(n=e.head(),Ue.isDigit(n)))e=e.step(),r=n,i=3;else if(!e.isEmpty())return Te.error(de.expected("hex digit",e));if(3===i){if(e.isCont()&&(n=e.head(),Ue.isDigit(n))){e=e.step(),t=t.write(Ue.decodeDigit(r)<<4|Ue.decodeDigit(n)),r=0,i=1;continue}if(!e.isEmpty())return Te.error(de.expected("hex digit",e))}break}return new ln(t,r,i)}}class cn{get tag(){return this.constructor.tag}toLike(){return this.toValue().toLike()}toRecon(){return Dr.toString(this.toValue())}toString(){return le.debug(this)}static fromValue(e){switch(e.tag){case"open":return fn.fromValue(e);case"opened":return mn.fromValue(e);case"close":return wn.fromValue(e);case"closed":return yn.fromValue(e);case"connect":return gn.fromValue(e);case"connected":return bn.fromValue(e);case"disconnect":return vn.fromValue(e);case"disconnected":return kn.fromValue(e);case"error":return On.fromValue(e);case"event":return Tn.fromValue(e);case"command":return Pn.fromValue(e);case"link":return Dn.fromValue(e);case"linked":return Ln.fromValue(e);case"sync":return qn.fromValue(e);case"synced":return In.fromValue(e);case"unlink":return An.fromValue(e);case"unlinked":return Nn.fromValue(e);case"auth":return jn.fromValue(e);case"authed":return zn.fromValue(e);case"deauth":return Vn.fromValue(e);case"deauthed":return Mn.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Dr.parse(e))}}class dn extends cn{static fromValue(e){switch(e.tag){case"open":return fn.fromValue(e);case"opened":return mn.fromValue(e);case"close":return wn.fromValue(e);case"closed":return yn.fromValue(e);case"connect":return gn.fromValue(e);case"connected":return bn.fromValue(e);case"disconnect":return vn.fromValue(e);case"disconnected":return kn.fromValue(e);case"error":return On.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Dr.parse(e))}}class pn extends dn{constructor(e,t){super(),this.host=e,this.body=t}withHost(e){return e=qi.fromLike(e),this.copy(e,this.body)}withBody(e){return e=lt.fromLike(e),this.copy(this.host,e)}copy(e,t){return new this.constructor(e,t)}equals(e){return this===e||e instanceof pn&&(this.constructor===e.constructor&&this.host.equals(e.host)&&this.body.equals(e.body))}hashCode(){return s.mash(s.mix(s.mix(m.hash(this.constructor),this.host.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.host.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=dt.create(1).slot("host",this.host.toString());return ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t;if(e.header(this.tag).forEach((function(e,r){const i=e.key.stringValue(void 0);void 0!==i?"host"===i&&(t=qi.parse(e.toValue().stringValue(""))):e instanceof lt&&0===r&&(t=qi.parse(e.stringValue("")))})),void 0!==t){const r=e.body();return new this(t,r)}return null}static create(e,t){return new this(e=qi.fromLike(e),t=void 0===t?lt.absent():lt.fromLike(t))}}class fn extends pn{}fn.tag="open";class mn extends pn{}mn.tag="opened";class wn extends pn{}wn.tag="close";class yn extends pn{}yn.tag="closed";class gn extends pn{}gn.tag="connect";class bn extends pn{}bn.tag="connected";class vn extends pn{}vn.tag="disconnect";class kn extends pn{}kn.tag="disconnected";class On extends pn{}On.tag="error";class xn extends cn{withPrio(e){return this}withRate(e){return this}static fromValue(e){switch(e.tag){case"event":return Tn.fromValue(e);case"command":return Pn.fromValue(e);case"link":return Dn.fromValue(e);case"linked":return Ln.fromValue(e);case"sync":return qn.fromValue(e);case"synced":return In.fromValue(e);case"unlink":return An.fromValue(e);case"unlinked":return Nn.fromValue(e);case"auth":return jn.fromValue(e);case"authed":return zn.fromValue(e);case"deauth":return Vn.fromValue(e);case"deauthed":return Mn.fromValue(e);default:return null}}static parseRecon(e){return this.fromValue(Dr.parse(e))}}Object.defineProperty(xn.prototype,"prio",{get:()=>0,configurable:!0}),Object.defineProperty(xn.prototype,"rate",{get:()=>0,configurable:!0});class Sn extends xn{constructor(e){super(),this.body=e}get node(){return qi.empty()}withNode(e){return this}get lane(){return qi.empty()}withLane(e){return this}withBody(e){return e=lt.fromLike(e),this.copy(e)}copy(e){return new this.constructor(e)}equals(e){return this===e||e instanceof Sn&&(this.constructor===e.constructor&&this.body.equals(e.body))}hashCode(){return s.mash(s.mix(m.hash(this.constructor),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40),this.body.isDefined()&&(e=e.debug(this.body)),e=e.write(41)}toValue(){return ot.of(this.tag).concat(this.body)}static fromValue(e){if(!e.header(this.tag).isDefined())return null;return new this(e.body())}static create(e){return new this(e=void 0===e?lt.absent():lt.fromLike(e))}}class Cn extends xn{constructor(e,t,r){super(),this.node=e,this.lane=t,this.body=r}withNode(e){return e=qi.fromLike(e),this.copy(e,this.lane,this.body)}withLane(e){return e=qi.fromLike(e),this.copy(this.node,e,this.body)}withBody(e){return e=lt.fromLike(e),this.copy(this.node,this.lane,e)}copy(e,t,r){return new this.constructor(e,t,r)}equals(e){return this===e||e instanceof Cn&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.body.equals(e.body))}hashCode(){return s.mash(s.mix(s.mix(s.mix(m.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=dt.create(2).slot("node",this.node.toString()).slot("lane",this.lane.toString());return ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r;if(e.header(this.tag).forEach((function(e,i){const n=e.key.stringValue(void 0);void 0!==n?"node"===n?t=qi.parse(e.toValue().stringValue("")):"lane"===n&&(r=qi.parse(e.toValue().stringValue(""))):e instanceof lt&&(0===i?t=qi.parse(e.stringValue("")):1===i&&(r=qi.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const i=e.body();return new this(t,r,i)}return null}static create(e,t,r){return new this(e=qi.fromLike(e),t=qi.fromLike(t),r=void 0===r?lt.absent():lt.fromLike(r))}}class En extends xn{constructor(e,t,r,i,n){super(),this.node=e,this.lane=t,Object.defineProperty(this,"prio",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"rate",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.body=n}withNode(e){return e=qi.fromLike(e),this.copy(e,this.lane,this.prio,this.rate,this.body)}withLane(e){return e=qi.fromLike(e),this.copy(this.node,e,this.prio,this.rate,this.body)}withPrio(e){return this.copy(this.node,this.lane,e,this.rate,this.body)}withRate(e){return this.copy(this.node,this.lane,this.prio,e,this.body)}withBody(e){return e=lt.fromLike(e),this.copy(this.node,this.lane,this.prio,this.rate,e)}copy(e,t,r,i,n){return new this.constructor(e,t,r,i,n)}equals(e){return this===e||e instanceof En&&(this.constructor===e.constructor&&this.node.equals(e.node)&&this.lane.equals(e.lane)&&this.prio===e.prio&&this.rate===e.rate&&this.body.equals(e.body))}hashCode(){return s.mash(s.mix(s.mix(s.mix(s.mix(s.mix(m.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),d.hash(this.prio)),d.hash(this.rate)),this.body.hashCode()))}debug(e){return e=e.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),0===this.prio&&0===this.rate||(e=e.write(", ").debug(this.prio).write(", ").debug(this.rate)),this.body.isDefined()&&(e=e.write(", ").debug(this.body)),e=e.write(41)}toValue(){const e=dt.create(4).slot("node",this.node.toString()).slot("lane",this.lane.toString());return 0!==this.prio&&e.slot("prio",this.prio),0!==this.rate&&e.slot("rate",this.rate),ot.of(this.tag,e).concat(this.body)}static fromValue(e){let t,r,i=0,n=0;if(e.header(this.tag).forEach((function(e,s){const o=e.key.stringValue(void 0);void 0!==o?"node"===o?t=qi.parse(e.toValue().stringValue("")):"lane"===o?r=qi.parse(e.toValue().stringValue("")):"prio"===o?i=e.numberValue(i):"rate"===o&&(n=e.numberValue(n)):e instanceof lt&&(0===s?t=qi.parse(e.stringValue("")):1===s&&(r=qi.parse(e.stringValue(""))))})),void 0!==t&&void 0!==r){const s=e.body();return new this(t,r,i,n,s)}return null}static create(e,t,r,i,n){return void 0===r&&(r=0),void 0===i&&(i=0),new this(e=qi.fromLike(e),t=qi.fromLike(t),r,i,n=void 0===n?lt.absent():lt.fromLike(n))}}class Tn extends Cn{}Tn.tag="event";class Pn extends Cn{}Pn.tag="command";class Dn extends En{}Dn.tag="link";class Ln extends En{}Ln.tag="linked";class qn extends En{}qn.tag="sync";class In extends Cn{}In.tag="synced";class An extends Cn{}An.tag="unlink";class Nn extends Cn{}Nn.tag="unlinked";class jn extends Sn{}jn.tag="auth";class zn extends Sn{}zn.tag="authed";class Vn extends Sn{}Vn.tag="deauth";class Mn extends Sn{}Mn.tag="deauthed";class Fn{constructor(e,t){this.hostUri=e,this.options=t,this.sendBuffer=[],this.channel=new MessageChannel,this.socket=null,this.onPortReceive=this.onPortReceive.bind(this),this.channel.port1.addEventListener("message",this.onPortReceive),this.channel.port1.start()}get sendBufferSize(){const e=this.options.sendBufferSize;return void 0!==e?e:Fn.SendBufferSize}onPortReceive(e){const t=lt.fromLike(e.data),r=cn.fromValue(t);null!==r?this.onReceiveMessage(r):this.onReceiveUnknownMessage(t)}onReceiveMessage(e){e instanceof dn?this.onReceiveSignal(e):e instanceof xn?this.onReceiveEnvelope(e):this.onReceiveUnknownMessage(e)}onReceiveEnvelope(e){this.push(e)}onReceiveSignal(e){e instanceof gn?this.onConnectSignal(e):e instanceof vn?this.onDisconnectSignal(e):this.onReceiveUnexpectedSignal(e)}onConnectSignal(e){this.connect()}onDisconnectSignal(e){const t=this.socket;null!==t&&(t.onopen=null,t.onmessage=null,t.onclose=null,t.onerror=null,this.socket=null,t.close(),this.onDisconnect())}onReceiveUnexpectedSignal(e){throw new Error("unexpected warp host signal: "+e)}onReceiveUnknownMessage(e){throw new Error("unknown warp host message: "+e)}onReceiveUnknownEnvelope(e){throw new Error("unknown warp host envelope: "+e)}get connected(){return null!==this.socket&&this.socket.readyState===this.socket.OPEN}connect(){let e,t=this.socket;if(null!==t)return;if(void 0!==this.options.WebSocket)e=this.options.WebSocket;else if("undefined"!=typeof WebSocket)e=WebSocket;else{if(null===Fn.WebSocket)throw new Error("Missing WebSocket implementation");e=Fn.WebSocket}let r=this.hostUri;const i=r.schemeName;"warp"===i||"swim"===i?r=r.withSchemeName("ws"):"warps"!==i&&"swims"!==i||(r=r.withSchemeName("wss")),t=void 0!==this.options.protocols?new e(r.toString(),this.options.protocols):new e(r.toString()),this.socket=t,t.onopen=this.onWebSocketOpen.bind(this),t.onmessage=this.onWebSocketMessage.bind(this),t.onclose=this.onWebSocketClose.bind(this),t.onerror=this.onWebSocketError.bind(this)}close(){null!==this.socket&&this.socket.close()}onConnect(){this.channel.port1.postMessage(bn.create(this.hostUri).toLike())}onDisconnect(){this.channel.port1.postMessage(kn.create(this.hostUri).toLike())}onError(e){this.channel.port1.postMessage(On.create(this.hostUri).toLike())}onEnvelope(e){this.channel.port1.postMessage(e.toLike())}push(e){if(this.connected){const t=e.toRecon();this.socket.send(t)}else{if(this.sendBuffer.length>=this.sendBufferSize)throw new Error("send buffer overflow");this.sendBuffer.push(e),this.connect()}}onWebSocketOpen(){let e;for(this.onConnect();(e=this.sendBuffer.shift())&&this.connected;)this.push(e)}onWebSocketMessage(e){const t=e.data;if("string"==typeof t){const e=xn.parseRecon(t);null!==e?this.onEnvelope(e):this.onReceiveUnknownEnvelope(t)}}onWebSocketClose(){const e=this.socket;null!==e&&(e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,this.socket=null,this.onDisconnect())}onWebSocketError(){null!==this.socket&&(this.onError(),this.socket.close())}}Fn.SendBufferSize=1024,Fn.WebSocket=null,"undefined"!=typeof WebSocket&&(Fn.WebSocket=WebSocket);new class{constructor(e,t={}){this.scope=e,this.options=t,this.hosts={},this.onWorkerReceive=this.onWorkerReceive.bind(this),this.scope.addEventListener("message",this.onWorkerReceive)}getHost(e){e=qi.fromLike(e);const t=this.hosts[e.toString()];return void 0!==t?t:null}openHost(e,t){e=qi.fromLike(e);const r=this.hosts;let i=r[e.toString()];return void 0===i&&(i=new Fn(e,t),r[e.toString()]=i),i}closeHost(e){const t=this.hosts;void 0!==t[e.hostUri.toString()]&&(delete t[e.hostUri.toString()],e.close())}onWorkerReceive(e){const t=lt.fromLike(e.data),r=cn.fromValue(t);null!==r?this.onMessage(r):this.onUnknownMessage(t)}onMessage(e){e instanceof dn?this.onSignal(e):e instanceof xn?this.onEnvelope(e):this.onUnknownMessage(e)}onSignal(e){e instanceof fn?this.onOpenSignal(e):e instanceof wn?this.onCloseSignal(e):this.onUnexpectedSignal(e)}onOpenSignal(e){const t=e.host,r=this.openHost(t,{});r instanceof Fn&&(this.scope.postMessage(mn.create(t).toLike(),[r.channel.port2]),r.connect())}onCloseSignal(e){const t=e.host,r=this.getHost(t);r instanceof Fn&&(this.closeHost(r),this.scope.postMessage(yn.create(t).toLike()))}onUnexpectedSignal(e){throw new Error("unexpected warp signal: "+e)}onEnvelope(e){throw new Error("unexpected warp envelope: "+e)}onUnknownMessage(e){throw new Error("unknown warp message: "+e)}}(self)}();'],{type:"text/javascript"});return URL.createObjectURL(e)}})],p=[o.Property({extends:!0,inherits:!1,initValue(){return this.owner}})],f=[o.Property({extends:!0,inherits:!1,initValue:()=>"object"!=typeof navigator||navigator.onLine,didSetValue(e){let t=this.owner.firstChild;for(;null!==t;){const r=t.nextSibling;t instanceof Y&&(t.online.recohere(performance.now()),e?t.connect():t.disconnect()),t=r}}})],t=[i.Lazy],F(e,null,t,{kind:"method",name:"global",static:!0,private:!1,access:{has:e=>"global"in e,get:e=>e.global},metadata:s},null,w),F(null,null,r,{kind:"field",name:"sendBufferSize",static:!1,private:!1,access:{has:e=>"sendBufferSize"in e,get:e=>e.sendBufferSize,set:(e,t)=>{e.sendBufferSize=t}},metadata:s},y,g),F(null,null,a,{kind:"field",name:"maxReconnectTimeout",static:!1,private:!1,access:{has:e=>"maxReconnectTimeout"in e,get:e=>e.maxReconnectTimeout,set:(e,t)=>{e.maxReconnectTimeout=t}},metadata:s},v,g),F(null,null,u,{kind:"field",name:"idleTimeout",static:!1,private:!1,access:{has:e=>"idleTimeout"in e,get:e=>e.idleTimeout,set:(e,t)=>{e.idleTimeout=t}},metadata:s},b,g),F(null,null,l,{kind:"field",name:"unlinkDelay",static:!1,private:!1,access:{has:e=>"unlinkDelay"in e,get:e=>e.unlinkDelay,set:(e,t)=>{e.unlinkDelay=t}},metadata:s},k,g),F(null,null,h,{kind:"field",name:"wsConstructor",static:!1,private:!1,access:{has:e=>"wsConstructor"in e,get:e=>e.wsConstructor,set:(e,t)=>{e.wsConstructor=t}},metadata:s},S,g),F(null,null,c,{kind:"field",name:"wsProtocols",static:!1,private:!1,access:{has:e=>"wsProtocols"in e,get:e=>e.wsProtocols,set:(e,t)=>{e.wsProtocols=t}},metadata:s},O,g),F(null,null,d,{kind:"field",name:"workerUrl",static:!1,private:!1,access:{has:e=>"workerUrl"in e,get:e=>e.workerUrl,set:(e,t)=>{e.workerUrl=t}},metadata:s},C,g),F(null,null,p,{kind:"field",name:"warpRef",static:!1,private:!1,access:{has:e=>"warpRef"in e,get:e=>e.warpRef,set:(e,t)=>{e.warpRef=t}},metadata:s},x,g),F(null,null,f,{kind:"field",name:"online",static:!1,private:!1,access:{has:e=>"online"in e,get:e=>e.online,set:(e,t)=>{e.online=t}},metadata:s},T,g),s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s}),z(e,w)})(),e})();e.AuthRequest=I,e.AuthedResponse=V,e.CloseSignal=p,e.ClosedSignal=f,e.CommandMessage=x,e.ConnectSignal=m,e.ConnectedSignal=w,e.DeauthRequest=A,e.DeauthedResponse=U,e.DisconnectSignal=g,e.DisconnectedSignal=y,e.Envelope=b,e.ErrorSignal=v,e.EventDownlink=W,e.EventDownlinkModel=B,e.EventMessage=C,e.HostAddressed=k,e.LaneAddressed=S,e.LinkAddressed=O,e.LinkRequest=T,e.LinkedResponse=E,e.ListDownlink=Z,e.ListDownlinkModel=K,e.MapDownlink=J,e.MapDownlinkModel=X,e.Message=u,e.OpenSignal=c,e.OpenedSignal=d,e.Signal=l,e.SyncRequest=D,e.SyncedResponse=P,e.UnlinkRequest=L,e.UnlinkedResponse=q,e.ValueDownlink=H,e.ValueDownlinkModel=Q,e.WarpClient=te,e.WarpDownlink=R,e.WarpDownlinkContext=j,e.WarpDownlinkModel=N,e.WarpHost=Y,e.WarpRef=_,e.WarpScope=ee,e.WarpSocketHost=$,e.WarpWorkerHost=G,e.WorkerAddressed=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=swim-host.min.js.map
