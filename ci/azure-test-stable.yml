jobs:
  - job: ${{ parameters.name }}
    displayName: ${{ parameters.displayName }}
    strategy:
      matrix:
        Linux:
          vmImage: ubuntu-18.04

        ${{ if parameters.cross }}:
          MacOS:
            vmImage: macOS-10.15
          Windows:
            vmImage: windows-2019
    pool:
      vmImage: $(vmImage)

    steps:
      - script: cargo test
        env:
          RUST_BACKTRACE: 1
        displayName: cargo test
        workingDirectory: $(Build.SourcesDirectory)

  - job: WASM_client_build
      displayName: WASM client build

      pool:
        vmImage: ubuntu-18.04

      steps:
        - script: |
            rustup target add wasm32-unknown-unknown
            cargo build --no-default-features --target wasm32-unknown-unknown
          env:
            RUST_BACKTRACE: 1
          displayName: Client WASM build
          workingDirectory: $(Build.SourcesDirectory)/client
